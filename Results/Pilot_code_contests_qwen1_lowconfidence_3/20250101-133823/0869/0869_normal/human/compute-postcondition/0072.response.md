Postcondition: ***`Q` is either `[i, i_next, i]` or `[i_next, i]`, `marked` includes `i_next` and `i`, and `res` includes `v`, `i`. This is true whether `i` is in `marked` or not, as there is no else part that changes this condition when `i` is already in `marked`.***