### Reasoning:

1. **Input Handling:**
   - The program correctly reads the number of test cases `t`.
   - For each test case, it reads `n`, `m`, and `k` from the input.
   - It then reads `m` tuples of integers `a`, `b`, and `f` representing the pairs of friends and their initial friendship values.

2. **Sum of Friendship Values:**
   - The program correctly calculates the sum of the initial friendship values `sum_f` for all pairs of friends.

3. **Combinatorial Calculation:**
   - The program calculates the number of possible pairs of children `cn2` using the combination formula \( \binom{n}{2} = \frac{n(n-1)}{2} \).

4. **Expected Value Calculation:**
   - The program calculates the numerator `p` and the denominator `q` of the expected value formula.
   - The formula used is \( p = 2 \cdot k \cdot \binom{n}{2} \cdot \text{sum\_f} + m \cdot k \cdot (k - 1) \).
   - The denominator is \( q = 2 \cdot \binom{n}{2}^2 \).

5. **Simplification:**
   - The program simplifies the fraction \( \frac{p}{q} \) by finding the greatest common divisor (GCD) of `p` and `q` and dividing both by the GCD.

6. **Modular Inverse and Output:**
   - The program calculates the modular inverse of `q` using `pow(q, -1, M)`.
   - It then computes the final result as \( p \cdot q^{-1} \mod (10^9 + 7) \) and prints it.

### Analysis of the Formula:
- The formula \( p = 2 \cdot k \cdot \binom{n}{2} \cdot \text{sum\_f} + m \cdot k \cdot (k - 1) \) is derived from the expected value of the sum of friendship values over `k` excursions.
- The term \( 2 \cdot k \cdot \binom{n}{2} \cdot \text{sum\_f} \) accounts for the initial friendship values being chosen and the expected increase in friendship values over `k` excursions.
- The term \( m \cdot k \cdot (k - 1) \) accounts for the additional increase in friendship values due to the pairs being chosen multiple times.

### Potential Issues:
- The formula for `p` and `q` seems correct based on the problem description.
- The use of `math.gcd` to simplify the fraction is appropriate.
- The modular inverse calculation using `pow(q, -1, M)` is correct for finding \( q^{-1} \mod (10^9 + 7) \).

### Conclusion:
The program appears to correctly implement the solution for the given problem. The logic and calculations are aligned with the problem requirements, and the modular arithmetic is handled appropriately.

### Correctness:
Correctness: **True**