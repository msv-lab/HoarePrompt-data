The function should take three parameters: t (an integer representing the number of test cases, 1 ≤ t ≤ 10^4), a list of integers n (each representing the number of mushrooms for each test case, 1 ≤ n ≤ 200,000), and two lists of lists v and p (each of size n, where v contains the magic powers of the mushrooms, 1 ≤ v_i ≤ 10^9, and p is a permutation of numbers from 1 to n). The sum of the values of n over all test cases does not exceed 2 · 10^5.