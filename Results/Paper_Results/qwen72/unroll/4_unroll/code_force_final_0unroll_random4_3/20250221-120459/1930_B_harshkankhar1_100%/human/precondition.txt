The function `solve` is part of a program that processes multiple test cases. Each test case is defined by a single integer n (3 ≤ n ≤ 10^5), which represents the length of the permutation p. The sum of n over all test cases does not exceed 10^5.