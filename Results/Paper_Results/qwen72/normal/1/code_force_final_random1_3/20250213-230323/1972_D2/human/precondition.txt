The function `fun()` is incomplete and does not match the problem description. The correct function definition should be `def count_valid_pairs(t, cases):` where `t` is an integer representing the number of test cases (1 ≤ t ≤ 10^4), and `cases` is a list of tuples, each containing two integers `n` and `m` (1 ≤ n, m ≤ 2 · 10^6).