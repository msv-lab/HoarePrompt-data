f is a function object, and stack is an optional list that is initially empty.