Output State: **`final_x` and `final_y` are the results of net movements; `target_pos` is equal to `current_x + dx, current_y + dy`; `position_map[current_x, current_y]` is updated to `i`.**