Functionality: **The function accepts a string `encoded` and returns another string `decoded` where each character in `encoded` is mapped to its corresponding character from the end of a reference string `r` according to a given `char_map`.**