d is a dictionary where each key maps to a list of integers, processing is a list of integers of length at least max(da, max(d[da])) where each element is either 0 or 1, da is a positive integer, and rank is a list of integers of length at least da.