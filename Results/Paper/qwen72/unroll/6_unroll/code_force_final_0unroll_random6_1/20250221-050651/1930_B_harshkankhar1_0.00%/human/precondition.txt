The function `solve` is part of a program that processes multiple test cases. Each test case is defined by a single integer n (3 ≤ n ≤ 10^5) representing the length of the permutation p. The total number of test cases t (1 ≤ t ≤ 10^3) is provided at the beginning of the input, and the sum of n over all test cases does not exceed 10^5.