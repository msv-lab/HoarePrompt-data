### Reasoning:

The problem involves determining the minimum number of invitations Monocarp needs to send to ensure at least two friends attend the party. The key insight here is that for a friend to attend, both the friend and their best friend must receive an invitation.

Let's analyze the provided program:

1. **Initialization and Input Reading:**
   - The program correctly reads the number of test cases `t`.
   - For each test case, it reads the number of friends `n` and their best friends list `p` (renamed as `v` in the code).

2. **Handling Special Case `n = 2`:**
   - If there are exactly 2 friends, the program directly prints `2` because both friends must be invited for either of them to attend.

3. **Checking for Cycles of Length 3:**
   - The program then checks if there exists a cycle of length 3 in the best-friend relationships. This is done by checking if `v[v[v[i]]] == i` for any `i`. If such a cycle exists, the program prints `2` and exits the function.
   - The logic behind this is that if there is a cycle of length 3, Monocarp can invite any two friends in this cycle to ensure at least two friends attend.

4. **Default Case:**
   - If no cycle of length 3 is found, the program defaults to printing `3`. This is because, in the worst case, Monocarp might need to invite three friends to ensure at least two attend (consider a scenario where friends are arranged in a way that no smaller set of invitations can satisfy the condition).

### Verification Against Example Test Cases:

- **First Test Case:**
  - Input: `n = 5`, `p = [3, 1, 2, 5, 4]`
  - The program correctly identifies that there is a cycle of length 3 (friends 1, 2, 3 form a cycle) and prints `2`.

- **Second Test Case:**
  - Input: `n = 4`, `p = [2, 3, 4, 1]`
  - There is no cycle of length 3, and the program correctly prints `3`.

- **Third Test Case:**
  - Input: `n = 2`, `p = [2, 1]`
  - The program correctly handles the special case for `n = 2` and prints `2`.

### Conclusion:

The provided program correctly implements the logic to determine the minimum number of invitations required to ensure at least two friends attend the party. It handles the special case for `n = 2`, checks for cycles of length 3, and defaults to `3` if no such cycle exists.

Therefore, the program is correct.

**Correctness: True**