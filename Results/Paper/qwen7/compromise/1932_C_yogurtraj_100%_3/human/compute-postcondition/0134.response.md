Postcondition: `i` is either `n-4` or `n-5`, `k` is updated as `k * a[q2] % m` if `t[i] == 'R'` and `k` is updated as `k * a[q1] % m` otherwise.