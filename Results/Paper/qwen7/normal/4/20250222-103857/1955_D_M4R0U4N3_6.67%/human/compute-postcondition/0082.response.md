Postcondition: `r` is `m + 2`, `m`, `n`, `a`, `extra`, `done`, and `ans` are such that if `a[r]` is in `todo`, then `todo` now includes `a[r]` and `a[r - m]` if `old` was in `done`, or contains `a[r]` or does not contain `a[r]` if `old` is not in `done`, `ans` is incremented by 1 if the length of `done` is at least `k`, and `done` is reduced by `old` if `old` was present. If `a[r]` is not in `todo`, then `extra` contains `a[r]`, `done` remains unchanged if `old` is in `done`, otherwise `todo` now includes `a[r]` and `a[r - m]` if `old` was in `done`, or contains `a[r]` or does not contain `a[r]` if `old` is not in `done`, and `ans` is incremented by 1 if the length of `done` is at least `k`.