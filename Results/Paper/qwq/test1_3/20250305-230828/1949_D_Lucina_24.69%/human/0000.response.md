Alright, I've got this problem to solve. Let's see what it's about. So, I'm designing a video game with n scenarios, and the player can play them in any order, but each one must be played exactly once. When switching from one scenario to another, there's a transition video that's either funny or scary. The key thing is that these transition videos are symmetric; the video from scenario A to B is the same as from B to A.

So, I need to decide whether each transition is funny or scary, but with a constraint: no matter what order the player chooses to play the scenarios, they should never see more than ceil(3n/4) transition videos of the same type in a row.

Also, some of these transitions are already decided (either funny or scary), and the rest are undecided (marked with '?'). I need to assign either 'F' or 'S' to these '?' positions in a way that satisfies the constraint.

First, I need to understand the input and output formats. The input consists of n+1 lines. The first line has the integer n (2 ≤ n ≤ 24), and the next n lines each have n characters, representing the transition videos between scenarios. The j-th character of the i-th line corresponds to the transition from scenario i to j. The diagonal elements (i.e., when i=j) are '.' since there's no transition.

It's guaranteed that the matrix is symmetric, meaning the transition from i to j is the same as from j to i. Also, at most floor(n/2) transitions are already decided as 'F' or 'S'.

My task is to fill in the '?' positions with either 'F' or 'S' such that for any permutation of the scenarios, the sequence of transition videos doesn't have more than ceil(3n/4) consecutive 'F's or 'S's.

The problem also mentions that a solution always exists for the given constraints, so I don't need to worry about cases where it's impossible.

Let me try to rephrase the problem to make sure I understand it correctly. I have a complete graph with n nodes, where each edge has a label 'F' , 'S' , or '?' . I need to assign 'F' or 'S' to the '?' edges so that for any Hamiltonian path in the graph, there are no more than ceil(3n/4) consecutive 'F' edges or 'S' edges.

Wait a minute, Hamiltonian paths correspond to permutations of the scenarios, and the transitions between them are the edges in the path, labeled 'F' or 'S'. So, I need to ensure that in any such path, there are no more than ceil(3n/4) consecutive 'F's or 'S's.

This seems quite challenging because I have to consider all possible permutations, which is n!, and ensure this constraint for each of them.

But the problem says that a solution always exists, so I don't need to worry about cases where it's impossible. I just need to find one such assignment of 'F' and 'S' to the '?' positions.

Also, the problem mentions that at most floor(n/2) transitions are already decided. Wait, actually, it says that at most floor(n/2) transitions are already decided, meaning that the total number of 'F' and 'S' in the input is at most floor(n/2), and the rest are '?'.

Wait, no. It says: "It is guaranteed that at most floor(n/2) transition videos will already be decided, in other words, that at most 2*floor(n/2) characters in the input will be 'F' or 'S'."

Wait, but each transition is represented twice in the input (since the matrix is symmetric), so the total number of 'F' and 'S' in the input is at most 2*floor(n/2), corresponding to floor(n/2) unique transitions.

Okay, now, the problem is to assign 'F' or 'S' to the '?' positions in such a way that for any permutation of the scenarios, the sequence of transition videos doesn't have more than ceil(3n/4) consecutive 'F's or 'S's.

Given that n can be up to 24, and that n! grows very quickly, it's impractical to check all permutations. So, there must be a smarter way to assign the labels.

The problem mentions that a solution always exists, so I don't need to handle cases where it's impossible.

Let me think about the constraint: no more than ceil(3n/4) consecutive 'F's or 'S's in any permutation.

First, let's compute ceil(3n/4). For example, if n=4, ceil(3*4/4)=3. So, no more than 3 consecutive 'F's or 'S's in any permutation.

But in a permutation of 4 scenarios, there are 3 transitions, which is exactly ceil(3*4/4)=3. So, in this case, it's allowed to have up to 3 'F's or 'S's in a row.

Wait, but the problem says "no matter in which order the player approaches the scenarios, they will never see more than ceil(3n/4) transition videos of the same type in a row."

So, for n=4, ceil(3*4/4)=3, meaning that in any sequence of 3 transitions, there should not be more than 3 consecutive 'F's or 'S's.

But in n=4, there are exactly 3 transitions in any permutation, so having 3 'F's or 'S's in a row is allowed.

Similarly, for n=5, ceil(15/4)=4, so up to 4 consecutive 'F's or 'S's are allowed.

Wait, but in the first sample input with n=5, the output has sequences like "FFFF" which is 4 'F's in a row, which seems to be allowed since ceil(15/4)=4.

Wait, but the note says: "We are allowed ceil(3*5/4)=4 transition videos of the same type in a row, but for each permutation of the 5 scenarios, the player will see only 4 transition videos in total, therefore we can choose funny or scary freely."

Wait, but in n=5, there are 4 transitions in any permutation, and ceil(15/4)=4, so up to 4 'F's or 'S's in a row are allowed.

Wait, but 15 divided by 4 is 3.75, ceil of which is 4.

So, for n=5, it's allowed to have up to 4 consecutive 'F's or 'S's in any permutation.

In the first sample input, the output has sequences like "FFFF", which is 4 'F's in a row, which seems to be acceptable.

Wait, but the note says: "the player will see only 4 transition videos in total", which is not entirely accurate. In a permutation of 5 scenarios, there are 4 transitions, but the note seems to suggest that in any sequence of transitions, there are no more than 4 'F's or 'S's in a row, which aligns with ceil(15/4)=4.

Wait, perhaps I misread it.

Wait, the note says: "We are allowed ceil(3*5/4)=4 transition videos of the same type in a row, but for any permutation of the 5 scenarios, the player will see only 4 transition videos in total, therefore we can choose funny or scary freely."

So, in n=5, any permutation has exactly 4 transitions, so the maximum number of consecutive 'F's or 'S's is 4, which is allowed.

Hence, in this case, since the maximum number of transitions in any permutation is equal to the allowed maximum, we can assign 'F' or 'S' to the '?' positions freely, as long as we respect the already decided transitions.

Wait, but in the second sample input with n=12, ceil(36/4)=9, and in the output, there are sequences with up to 9 'S's in a row, like "SSSSSSSSS", which is allowed.

But in that case, n=12 has 11 transitions in any permutation, so sequences of up to 9 'S's are allowed, as long as there are no sequences of 10 or more 'S's in a row.

Wait, but in the note, it mentions a permutation where there are 10 'S's in total, but only 9 in a row, which is acceptable.

So, the constraint is about consecutive 'F's or 'S's in a row, not the total number.

Okay, that makes sense.

So, my task is to assign 'F' or 'S' to the '?' positions in the transition matrix, respecting the symmetry, and ensuring that for any permutation of the scenarios, the sequence of transition videos doesn't contain more than ceil(3n/4) consecutive 'F's or 'S's.

Given that n is small (up to 24), and that a solution always exists, I need to find an efficient way to assign the labels.

But checking all permutations is not feasible for n=24, as n! is too large.

Hence, there must be a smarter way to assign the labels without checking all permutations.

Let me think about the properties that the assignment must satisfy.

First, the transition matrix is symmetric, so it's an undirected graph with labeled edges.

Each permutation corresponds to a Hamiltonian path in this graph, and I need to ensure that in the sequence of labels along any Hamiltonian path, there are no more than ceil(3n/4) consecutive 'F's or 'S's.

Given that, I need to assign labels in such a way that no matter what path is taken, this constraint is satisfied.

But ensuring this directly seems too complicated, especially since n can be up to 24.

Wait, but the problem says that a solution always exists, so I don't need to worry about unsolvable cases.

Perhaps there's a way to assign the labels based on some properties of the graph.

Let me consider the already decided transitions.

Some transitions are already assigned 'F' or 'S', and I need to respect those.

The rest are '?', and I need to assign them 'F' or 'S'.

I need to maximize the number of 'F's or 'S's in a row in any permutation to be at most ceil(3n/4).

But since n can be up to 24, and ceil(3*24/4)=18, meaning that in any permutation, no more than 18 consecutive 'F's or 'S's are allowed.

But in reality, for n=24, there are 23 transitions, and ceil(3*24/4)=18, so up to 18 consecutive 'F's or 'S's are allowed.

But in practice, it's unlikely that assigning labels in a certain way would lead to 18 consecutive 'F's or 'S's in some permutation, especially since some labels are already fixed.

But I need to ensure that no permutation has more than 18 consecutive 'F's or 'S's.

This seems tricky.

Let me consider a simpler approach.

Perhaps I can assign the '?' labels in a way that minimizes the maximum number of consecutive 'F's or 'S's in any permutation.

But minimizing is too slow for n=24.

Alternatively, since a solution is guaranteed to exist, maybe I can assign the '?' labels in a way that makes the graph have some properties which ensure the constraint is satisfied.

Wait, maybe I can think in terms of graph coloring or something similar.

But graph coloring usually deals with assigning colors to vertices, not labels to edges.

Wait, perhaps I can think of this as assigning labels to edges and ensuring that certain paths don't have too many consecutive 'F's or 'S's.

But I'm not sure.

Let me consider that the transitions are edges in a complete graph, and the scenarios are nodes.

Each Hamiltonian path is a path that visits each node exactly once.

I need to label the edges with 'F' or 'S', ensuring that in any such path, there are no more than ceil(3n/4) consecutive edges with the same label.

This seems too general to handle directly.

Perhaps there's a way to model this as a constraint satisfaction problem (CSP), where the variables are the '?' edges, and the constraints are that for each Hamiltonian path, the sequence doesn't have too many consecutive 'F's or 'S's.

But with n=24, this is infeasible due to the number of constraints.

Hence, I need a smarter approach.

Let me consider that the problem guarantees that a solution exists, so perhaps there's a way to assign the labels based on some properties of the graph.

Wait, maybe I can look at the already decided transitions and try to assign the '?' transitions in a way that balances the number of 'F's and 'S's.

But I need to ensure that in any permutation, the sequence doesn't have too many consecutive 'F's or 'S's.

Wait, perhaps I can think in terms of the degrees of the nodes.

Each node has n-1 transitions, each labeled 'F', 'S', or '?'.

Wait, but I'm not sure if that helps directly.

Let me look at the sample input and output to get some ideas.

In the first sample input with n=5, the input is:

.

?F??

?.???

F?.S?

??S.?

????..

And the output is:

.

FFFF

F.FFF

FF.SF

FFS.F

FFFF.

So, in this case, all '?' are assigned 'F', except for one 'S' in row 3, column 4.

Given that n=5, ceil(3*5/4)=4, and in any permutation, the number of transitions is 4, which is equal to the allowed maximum.

Hence, in this case, it's acceptable to have up to 4 'F's in a row.

In the output, some rows have 4 'F's in a row, which is acceptable.

In the second sample input with n=12, ceil(3*12/4)=9, and in the output, there are sequences with up to 9 'S's in a row, which is allowed.

So, perhaps the approach is to assign all '?' to 'F' or 'S' in a way that doesn't create sequences longer than ceil(3n/4) in any permutation.

But how to decide which '?' to assign to 'F' and which to 'S'?

Wait, perhaps I can group the scenarios based on their already decided transitions and assign the '?' transitions accordingly.

But I'm not sure.

Let me think differently.

Suppose I fix an ordering of the scenarios and assign labels accordingly.

But since the player can choose any permutation, I need to ensure the constraint for all possible orderings.

Hence, this approach won't work.

Wait, perhaps I can look for a way to partition the scenarios into groups and assign labels based on group memberships.

But I'm not sure.

Let me consider that if I can ensure that the graph doesn't have long paths with the same label, that would suffice.

But ensuring that no long paths with the same label exist is equivalent to ensuring that the graph doesn't have long induced paths with edges of the same label.

This seems related to graph theory concepts like coloring or avoiding monochromatic paths.

But again, for n=24, this seems too complex.

Wait, perhaps I can look for a way to assign labels such that the graph doesn't have paths with more than ceil(3n/4) consecutive edges of the same label.

But ensuring this directly is still too difficult.

Let me consider that the problem guarantees a solution exists, so maybe there's a way to assign labels based on some heuristics.

Perhaps assigning '?' labels in a way that alternates between 'F' and 'S' would help.

But in a complete graph, it's not straightforward to alternate labels.

Wait, perhaps I can look at cycles and ensure that they don't have too many consecutive 'F's or 'S's.

But cycles are not directly related to Hamiltonian paths.

Wait, perhaps I can look for a way to maximize the mixing of 'F' and 'S' labels.

But this is too vague.

Let me consider that in the first sample input, assigning most '?' to 'F' is acceptable, as long as there are no more than 4 consecutive 'F's in any permutation.

Given that n=5, and ceil(3n/4)=4, and any permutation has only 4 transitions, assigning all '?' to 'F' is acceptable.

But in the second sample input with n=12, assigning all '?' to 'F' might lead to sequences with more than 9 'F's in some permutations, which is not allowed.

Hence, I need a way to assign labels that prevents having too many consecutive 'F's or 'S's in any permutation.

But how?

Wait, perhaps I can look at the already decided transitions and try to minimize the maximum number of consecutive 'F's or 'S's in the worst-case permutation.

But with n=24, checking all permutations is impossible.

Hence, I need a different approach.

Let me consider that the problem allows up to ceil(3n/4) consecutive 'F's or 'S's in any permutation.

Given that, perhaps I can assign labels in a way that the graph doesn't have paths with more than ceil(3n/4) consecutive edges of the same label.

But ensuring this directly is still too difficult.

Wait, perhaps I can look for a way to assign labels such that the maximum number of consecutive 'F's or 'S's in any path is limited.

But I need a practical way to do this.

Let me consider that in a complete graph, any two nodes are connected, so there are many possible paths between any two nodes.

Hence, ensuring that no path has too many consecutive 'F's or 'S's is challenging.

Wait, perhaps I can look for a way to assign labels such that the graph doesn't have long monochromatic paths.

But again, for a complete graph, this is tricky.

Let me consider that in the first sample input, since n=5 and ceil(3n/4)=4, and any permutation has only 4 transitions, I can assign all '?' to 'F' and still satisfy the condition.

Hence, in that case, it's straightforward.

But for larger n, say n=12, ceil(3n/4)=9, and there are 11 transitions in any permutation, so I need to ensure that no permutation has more than 9 consecutive 'F's or 'S's.

In the second sample input, the output has sequences with up to 9 'S's in a row, but no more.

Hence, it seems that assigning labels in a way that doesn't create long sequences of the same label is acceptable.

But how to achieve this in general?

Let me consider that I can assign labels to '?' edges in a way that balances the number of 'F's and 'S's.

For example, assign '?' edges alternately between 'F' and 'S'.

But in a complete graph, this is not straightforward.

Wait, perhaps I can choose a subset of edges to assign 'F' and the rest to 'S', ensuring that no path has too many consecutive 'F's or 'S's.

But again, this seems too vague.

Let me consider that the problem guarantees a solution exists, so perhaps I can use a backtracking approach to assign labels to '?' edges, checking the constraint after each assignment.

But with n=24, and potentially up to floor(n/2) '?' edges, this is still too slow.

Hence, I need a more efficient approach.

Let me consider that the problem allows up to ceil(3n/4) consecutive 'F's or 'S's, which is 3n/4 rounded up.

Given that, perhaps I can assign labels in a way that the proportion of 'F's and 'S's is balanced.

But I'm not sure.

Wait, perhaps I can look at the degrees of the nodes in terms of 'F' and 'S'.

Let me define, for each node, the number of 'F' transitions and 'S' transitions.

In the input, some transitions are already decided, so I can count the number of 'F's and 'S's for each node.

Then, for nodes with more 'F's, I might want to assign '?' transitions to 'S', and vice versa, to balance things out.

But I'm not sure if this is the right approach.

Let me try to formalize this.

Let me denote, for each node i:

- a[i]: number of 'F' transitions from node i

- b[i]: number of 'S' transitions from node i

From the input, some of these are already decided, and the rest are '?'.

I need to assign 'F' or 'S' to the '?' transitions.

My goal is to assign these in a way that for any Hamiltonian path, the sequence of transition labels doesn't have more than ceil(3n/4) consecutive 'F's or 'S's.

Given that, perhaps I can group nodes based on their a[i] and b[i] values.

Wait, perhaps I can select a subset of nodes to have more 'F' transitions and the rest to have more 'S' transitions.

But I'm not sure.

Let me consider that if I can partition the nodes into two sets, one with more 'F' transitions and the other with more 'S' transitions, that might help.

But again, I'm not sure.

Wait, perhaps I can look for a way to assign labels such that the graph doesn't have large monochromatic components.

But this is still too vague.

Let me consider that in the first sample input, n=5, and I can assign all '?' to 'F', respecting the constraint since any permutation has only 4 transitions.

Hence, in this case, it's straightforward.

For larger n, say n=12, I need to be more careful.

Looking at the second sample output, it seems that labels are assigned in a way that there are blocks of 'S's and 'F's, but no more than 9 consecutive 'S's or 'F's in any permutation.

But ensuring this for all permutations is difficult.

Wait, perhaps I can look for a way to assign labels such that the maximum degree in the subgraph induced by 'F' edges and in the subgraph induced by 'S' edges is limited.

But I'm not sure if this relates directly to the constraint.

Let me consider that the problem is about avoiding long runs of the same label in any path.

Hence, perhaps I can look for a way to interleave 'F' and 'S' labels in a way that prevents long sequences.

But how to do this efficiently?

Let me consider that if I can ensure that the graph doesn't have paths with more than ceil(3n/4) consecutive 'F' edges or 'S' edges, that would suffice.

But ensuring this directly is too difficult.

Wait, perhaps I can look for a way to assign labels such that the maximum number of consecutive 'F's or 'S's in any path is limited.

But again, without a specific algorithm, this is too vague.

Let me consider that the problem is about assigning labels to edges in a complete graph such that in any Hamiltonian path, the sequence of labels doesn't have too many consecutive 'F's or 'S's.

Given that, perhaps I can look for a way to assign labels based on some properties of the graph.

Wait, perhaps I can look for a way to assign labels such that the graph doesn't have long monochromatic paths.

But again, for a complete graph, this is challenging.

Let me consider that in graph theory, there's a concept of monochromatic paths in edge-colored graphs.

In particular, Ramsey theory deals with conditions under which monochromatic subgraphs must appear.

But I don't know much about this area, and it might not be directly applicable here.

Given the time constraints, perhaps I need to look for a different approach.

Let me consider that since n is small (up to 24), and the problem guarantees a solution exists, maybe I can assign labels to '?' edges in a way that minimizes the maximum number of consecutive 'F's or 'S's in any permutation.

But even for n=24, checking all permutations is impossible.

Hence, I need a heuristic approach.

Perhaps I can assign labels to '?' edges in a way that alternates between 'F' and 'S' as much as possible.

For example, for each node, assign 'F' to some '?' edges and 'S' to others, trying to balance the number of 'F's and 'S's.

But in a complete graph, this is not straightforward.

Wait, perhaps I can look for cycles in the graph and assign labels in a way that breaks long monochromatic cycles.

But this seems too vague.

Let me consider that the problem allows up to ceil(3n/4) consecutive 'F's or 'S's, which is 3n/4 rounded up.

Given that, perhaps I can assign labels in a way that the proportion of 'F's and 'S's is roughly balanced.

But I need to ensure this for any permutation, which is tricky.

Given the time constraints, perhaps I need to accept that my solution might not be optimal but still correct,