Alright, I have this problem to solve. Let's see what it's about. So, there's this magical girl named Nene who has an n by n matrix filled with zeros. She can perform two types of operations on this matrix. The first type allows her to choose a row and assign a permutation of numbers from 1 to n to that row. The second type is similar but for columns. She can do this for any row or column, and she can choose different permutations each time. The goal is to maximize the sum of all the elements in the matrix after performing some operations, and she wants to do this with no more than 2n operations.

First, I need to understand what operations are allowed. For type 1 operation, she picks a row i and a permutation p of 1 to n, and sets the elements of that row to the permutation p. Similarly, for type 2 operation, she picks a column i and a permutation p of 1 to n, and sets the elements of that column to the permutation p, but indexed by j.

I need to maximize the sum of all elements in the matrix. Since the matrix is initially all zeros, every operation sets the chosen row or column to a permutation of 1 to n, which means each operation sets the chosen row or column to contain numbers from 1 to n exactly once.

I need to think about how these operations interact with each other. If I perform a type 1 operation on a row, it sets all the elements in that row to the chosen permutation. If later I perform a type 2 operation on a column that intersects with that row, the type 2 operation will overwrite the value in that intersection.

So, the order of operations matters because later operations can overwrite earlier ones. I need to find an optimal sequence of operations that maximizes the sum of the matrix.

Let me consider small values of n to get an intuition.

Take n=1. The matrix is 1x1. I can perform either a type 1 operation on row 1 or a type 2 operation on column 1. In either case, I set the single element to 1. So, the sum is 1. That seems straightforward.

Now, n=2. The matrix is 2x2. I can perform up to 4 operations (2n=4). Let's see what's the best way to maximize the sum.

If I do two type 1 operations, setting both rows to [2,1], for example, the matrix would be:

2 1

2 1

Sum is 6.

Alternatively, if I do two type 2 operations, setting both columns to [2,1], the matrix would be:

2 2

1 1

Sum is 6.

If I do one type 1 and one type 2, for example, set row 1 to [2,1] and then set column 1 to [2,1], the matrix would be:

2 (from row 1) but then column 1 sets it to 2

1 (from row 1)

2 (from column 1)

1 (from row 1, not overwritten by column 1)

So, matrix:

2 1

2 1

Sum is 6 again.

Wait, same as before.

Is there a way to get a higher sum? Let's see.

If I set row 1 to [2,1], then set column 2 to [2,1], the matrix would be:

2 2 (from column 2)

2 1

Sum is 7.

Is that better? Yes.

Is there a way to get more than 7?

If I set row 1 to [2,1], row 2 to [2,1], and column 1 to [2,1], the matrix would be:

2 (from row 1) overwritten by column 1 to 2

1 (from row 1)

2 (from row 2) overwritten by column 1 to 2

1 (from row 2)

So, matrix:

2 1

2 1

Sum is 6.

Wait, same as before.

Alternatively, set column 1 to [2,1], column 2 to [2,1], and row 1 to [2,1]. Let's see:

First, set column 1 to [2,1], matrix:

2 _

1 _

Then, set column 2 to [2,1], matrix:

2 2

1 1

Then, set row 1 to [2,1], matrix:

2 1

1 1

Sum is 5.

Wait, that's less than before.

Alternatively, set column 1 to [2,1], then row 1 to [2,1], then column 2 to [2,1]:

After column 1: 2 _, 1 _

After row 1: 2 1, 1 _

After column 2: 2 1, 1 1

Sum is 5.

Not better.

Alternatively, set row 1 to [2,1], column 1 to [2,1], column 2 to [2,1], and row 2 to [2,1]. But that's 4 operations, which is allowed for n=2.

Let's see:

Set row 1 to [2,1], matrix:

2 1

0 0

Set column 1 to [2,1], matrix:

2 1

1 0

Set column 2 to [2,1], matrix:

2 1

1 1

Set row 2 to [2,1], matrix:

2 1

2 1

Sum is 6.

Still not better than 7.

Wait, but in the example provided in the problem, they achieved a sum of 7 with 3 operations. So, 7 seems to be achievable with 3 operations for n=2.

I need to find a general way to maximize the sum for any n, using no more than 2n operations.

Let me think about the maximum possible sum.

Each cell in the matrix can be set to any value between 1 and n, but depending on the operations, some cells might be set multiple times, and the last operation on that cell determines its final value.

To maximize the sum, I need as many high values as possible in the matrix.

One way to think about it is to maximize the number of cells that are set to n, then to n-1, and so on.

But since operations set entire rows or columns, I need to find a way to cover as much of the matrix with high values as possible.

Another way is to consider that each operation sets a row or a column to a permutation of 1 to n, so the sum contributed by each operation is the sum of 1 to n, which is n(n+1)/2.

If I perform operations on all rows and all columns, that's 2n operations, but some cells will be overwritten.

I need to find a sequence where the overwrites are minimized or optimized to keep higher values.

Wait, perhaps I can find a sequence where each cell is set exactly once, but that's not possible because if I set all rows and all columns, some cells are set twice.

Wait, for n=1, setting row 1 and column 1 would set the single cell twice.

For n=2, setting row 1, row 2, column 1, column 2 would set each cell twice.

But in the example, they set row 1, row 2, and column 1, which is 3 operations, setting cell (1,1) twice, and other cells once.

They achieved a sum of 7, which seems better than setting all cells twice.

Wait, in their example, they set row 1 to [1,2], row 2 to [1,2], and column 1 to [1,2], resulting in matrix:

1 2

1 2

Sum is 6, but in the note, they have a different matrix with sum 7.

Wait, perhaps I misread the example.

Looking back at the example in the problem statement:

Input:

2

1

2

Output:

1 1

1 1 1

7 3

1 1 1 2

1 2 1 2

2 1 1 2

And the explanation says that with these operations, the matrix becomes:

First, set row 1 to [1,2], matrix:

1 2

0 0

Then set row 2 to [1,2], matrix:

1 2

1 2

Then set column 1 to [1,2], matrix:

1 2

2 2

Sum is 1+2+2+2=7.

Ah, I see. I missed that step. So, setting column 1 to [1,2] overwrites the first element of row 1 to 1 and the first element of row 2 to 2.

So, the matrix becomes:

1 2

2 2

Sum is 7.

Indeed, that's better than setting all rows and columns, which would set each cell twice, resulting in sum 6.

So, the key is to set rows and columns in a way that maximizes the sum, possibly overwriting some cells to higher values.

I need to find a general strategy for any n.

Let me consider the following approach:

- For each row, set it to the permutation [n, n-1, ..., 1], so the highest value is in the first column.

- Then, for each column, set it to the permutation [n, n-1, ..., 1], so the highest value is in the first row.

But wait, in the example for n=2, setting row 1 to [2,1], row 2 to [2,1], and then column 1 to [2,1], results in:

First, set row 1 to [2,1], matrix:

2 1

0 0

Then set row 2 to [2,1], matrix:

2 1

2 1

Then set column 1 to [2,1], matrix:

2 1

1 1

Sum is 5, which is less than the example's 7.

Wait, in the example, they set row 1 to [1,2], row 2 to [1,2], and column 1 to [1,2], getting matrix:

1 2

2 2

Sum 7.

Wait, but if I set rows to [2,1], and column to [2,1], I get:

Set row 1 to [2,1], matrix:

2 1

0 0

Set row 2 to [2,1], matrix:

2 1

2 1

Set column 1 to [2,1], matrix:

2 1

1 1

Sum 5.

But if I set rows to [1,2], and column to [1,2], I get:

Set row 1 to [1,2], matrix:

1 2

0 0

Set row 2 to [1,2], matrix:

1 2

1 2

Set column 1 to [1,2], matrix:

1 2

2 2

Sum 7.

So, using [1,2] instead of [2,1] gives a higher sum.

Wait, that's counterintuitive. Why would setting lower values first give a higher sum?

Wait, no. In this case, setting row 1 to [1,2], then row 2 to [1,2], and then column 1 to [1,2], results in:

- Cell (1,1): set to 1 by row 1, then to 1 by column 1, so final value 1

- Cell (1,2): set to 2 by row 1, not overwritten, so 2

- Cell (2,1): set to 1 by row 2, then to 2 by column 1, so 2

- Cell (2,2): set to 2 by row 2, not overwritten, so 2

Total sum: 1+2+2+2=7

Alternatively, if I set row 1 to [2,1], row 2 to [2,1], and column 1 to [2,1]:

- Cell (1,1): set to 2 by row 1, then to 2 by column 1, so 2

- Cell (1,2): set to 1 by row 1, not overwritten, so 1

- Cell (2,1): set to 2 by row 2, then to 1 by column 1, so 1

- Cell (2,2): set to 1 by row 2, not overwritten, so 1

Total sum: 2+1+1+1=5, which is less than 7.

So, using [1,2] instead of [2,1] gives a better sum in this case.

Wait, why is that?

Let me think differently.

Perhaps the key is to set the rows and columns in such a way that the overwrites set cells to higher values.

In the first approach, setting row 1 to [2,1], row 2 to [2,1], and column 1 to [2,1], results in cell (1,1) being 2, cell (2,1) being 1, and cell (2,2) being 1, sum 4.

But in the second approach, setting row 1 to [1,2], row 2 to [1,2], and column 1 to [1,2], results in cell (1,1) being 1, cell (2,1) being 2, and cell (2,2) being 2, sum 7.

So, in the second approach, the overwrites are setting cells to higher values.

So, perhaps the strategy is to set rows and columns to permutations that prioritize higher values in columns more than in rows.

Wait, but it's not immediately clear.

Let me try to generalize.

Suppose I set all rows to the same permutation, say [1,2,...,n], and then set all columns to the same permutation [1,2,...,n].

Then, for cell (i,j):

- If i <= j, it will be set by row i to some value, and then possibly overwritten by column j.

- If the operations are ordered in a certain way, the overwrites can be controlled.

Wait, perhaps I need to think in terms of the order of operations.

If I set rows first from row 1 to row n, and then set columns from column 1 to column n, then for cell (i,j):

- If i <= j, it will be set by row i, then by column j if j >=i.

Wait, perhaps I need to be more systematic.

Let me consider performing all row operations first, and then all column operations.

Suppose I set rows 1 to n, each to [n, n-1, ..., 1], and then set columns 1 to n, each to [n, n-1, ..., 1].

Then, for cell (i,j):

- Initially set by row i to (n - i + 1)

- Then set by column j to (n - j + 1)

- So the final value is (n - j + 1)

Wait, but in this case, all columns are set to [n, n-1, ..., 1], so the matrix would be:

Column 1: n, n-1, ..., 1

Column 2: n-1, n-2, ..., 2

And so on.

Wait, no, because column operations set the entire column to the permutation.

Wait, but in the operations, when setting a column, it sets a_j,i := p_j for all j.

Wait, in the problem statement, for type 2 operation, it's a_j,i := p_j for all j.

So, for column i, a_j,i is set to p_j.

So, if I set column i to [p_1, p_2, ..., p_n], then a_1,i = p_1, a_2,i = p_2, and so on.

So, in the earlier example for n=2:

Set row 1 to [1,2], set row 2 to [1,2], set column 1 to [1,2]:

- After row 1: a = [1,2; 0,0]

- After row 2: a = [1,2; 1,2]

- After column 1: a = [1,2; 2,2]

Because a_1,1 is set to 1, a_2,1 is set to 2.

Similarly, a_1,2 remains 2, a_2,2 remains 2.

Total sum: 1+2+2+2=7.

Alternatively, if I set row 1 to [2,1], row 2 to [2,1], column 1 to [2,1]:

- After row 1: a = [2,1; 0,0]

- After row 2: a = [2,1; 2,1]

- After column 1: a = [2,1; 1,1]

Total sum: 2+1+1+1=5, which is less.

So, setting rows to [1,2] and column to [1,2] gives a better sum than setting to [2,1].

Interesting.

So, perhaps the strategy is to set rows to [1,2,...,n] and columns to [1,2,...,n].

Let me see for n=3.

Set row 1 to [1,2,3], row 2 to [1,2,3], row 3 to [1,2,3], column 1 to [1,2,3], column 2 to [1,2,3], column 3 to [1,2,3].

Let's see step by step:

Start with all zeros.

Set row 1 to [1,2,3]:

1 2 3

0 0 0

0 0 0

Set row 2 to [1,2,3]:

1 2 3

1 2 3

0 0 0

Set row 3 to [1,2,3]:

1 2 3

1 2 3

1 2 3

Set column 1 to [1,2,3]:

1 2 3

2 2 3

3 2 3

Set column 2 to [1,2,3]:

1 1 3

2 2 3

3 2 3

Set column 3 to [1,2,3]:

1 1 1

2 2 2

3 2 3

Sum: 1+1+1 + 2+2+2 + 3+2+3 = 15.

Is there a better way?

Alternatively, set rows to [3,2,1], columns to [3,2,1].

Set row 1 to [3,2,1], row 2 to [3,2,1], row 3 to [3,2,1], column 1 to [3,2,1], column 2 to [3,2,1], column 3 to [3,2,1].

Step by step:

Start with zeros.

Set row 1 to [3,2,1]:

3 2 1

0 0 0

0 0 0

Set row 2 to [3,2,1]:

3 2 1

3 2 1

0 0 0

Set row 3 to [3,2,1]:

3 2 1

3 2 1

3 2 1

Set column 1 to [3,2,1]:

3 2 1

2 2 1

1 2 1

Set column 2 to [3,2,1]:

3 3 1

2 2 1

1 2 1

Set column 3 to [3,2,1]:

3 3 3

2 2 2

1 2 1

Sum: 3+3+3 + 2+2+2 + 1+2+1 = 19.

That's better than 15.

Is there a way to get more than 19?

Let me try a different sequence.

Set row 1 to [1,2,3], row 2 to [1,2,3], row 3 to [1,2,3], column 1 to [1,2,3], column 2 to [1,2,3], column 3 to [1,2,3].

As before, sum is 15.

Set row 1 to [3,2,1], row 2 to [3,2,1], row 3 to [3,2,1], column 1 to [3,2,1], column 2 to [3,2,1], column 3 to [3,2,1], sum is 19.

Is there a way to get higher than 19?

Let me try setting rows to [3,2,1] and columns to [1,2,3].

Set row 1 to [3,2,1], row 2 to [3,2,1], row 3 to [3,2,1], column 1 to [1,2,3], column 2 to [1,2,3], column 3 to [1,2,3].

Step by step:

Start with zeros.

Set row 1 to [3,2,1]:

3 2 1

0 0 0

0 0 0

Set row 2 to [3,2,1]:

3 2 1

3 2 1

0 0 0

Set row 3 to [3,2,1]:

3 2 1

3 2 1

3 2 1

Set column 1 to [1,2,3]:

1 2 1

2 2 1

3 2 1

Set column 2 to [1,2,3]:

1 1 1

2 2 1

3 2 1

Set column 3 to [1,2,3]:

1 1 1

2 2 2

3 2 3

Sum: 1+1+1 + 2+2+2 + 3+2+3 = 17, which is less than 19.

Alternatively, set rows to [3,2,1], columns to [3,2,1], but in a different order.

Wait, perhaps I need a different approach.

Let me consider that each cell is set by its row operation and its column operation, with the column operation overwriting the row operation.

So, for cell (i,j), its final value is p_j from the column operation if column j is set after row i, otherwise it's p_j from row i.

Wait, perhaps I need to think in terms of the last operation that sets each cell.

In other words, for each cell (i,j), the final value is determined by the last operation that sets it, either the last row i operation or the last column j operation.

So, to maximize the sum, I need to arrange operations such that higher values are set later, overwriting lower values set earlier.

Wait, perhaps I should set columns first with higher values and then set rows with lower values, so that when rows are set, they don't overwrite the higher values in the columns.

Wait, but in the n=2 example, setting rows first with [1,2] and then column with [1,2] gives a higher sum than setting rows with [2,1] and column with [2,1].

So, maybe setting lower values in rows and higher values in columns works better.

Let me try for n=3.

Set column 1 to [3,2,1], column 2 to [3,2,1], column 3 to [3,2,1], then set row 1 to [1,2,3], row 2 to [1,2,3], row 3 to [1,2,3].

Step by step:

Start with zeros.

Set column 1 to [3,2,1]:

3 0 0

2 0 0

1 0 0

Set column 2 to [3,2,1]:

3 3 0

2 2 0

1 1 0

Set column 3 to [3,2,1]:

3 3 3

2 2 2

1 1 1

Set row 1 to [1,2,3]:

1 2 3

2 2 2

1 1 1

Set row 2 to [1,2,3]:

1 2 3

1 2 3

1 1 1

Set row 3 to [1,2,3]:

1 2 3

1 2 3

1 2 3

Sum: 1+2+3 + 1+2+3 + 1+2+3 = 18, which is higher than 17 but less than 19.

So, still not better than setting rows and columns to [3,2,1].

Wait, but in n=2, setting rows to [1,2] and column to [1,2] gives sum 7, while setting rows to [2,1] and column to [2,1] gives sum 5.

But in n=3, setting rows to [3,2,1] and columns to [3,2,1] gives sum 19, which is higher than setting rows to [1,2,3] and columns to [1,2,3], which gives sum 18.

So, perhaps for higher n, setting higher values in rows and columns gives a better sum.

But in n=2, it's the opposite.

Wait, perhaps there's a pattern based on the parity of n.

Wait, n=1: sum=1

n=2: sum=7

n=3: sum=19

Let me see if I can find a general formula for the sum.

Looking back at n=2, sum=7; n=3, sum=19.

Wait, for n=2, 7=2*(2)+3=7

Wait, maybe it's n^2 + (n-1)^2 + ... + 1^2.

Wait, for n=2: 4 + 1 =5, but in the example, it's 7.

Wait, not matching.

Alternatively, maybe it's n*(n+1)/2 * n.

For n=2: 3*2=6, but in the example, it's 7.

Still not matching.

Wait, perhaps it's the sum of the maximum of each row and each column.

Wait, perhaps it's the sum of the maximum of the row operations and column operations.

Wait, perhaps I need to think in terms of the maximum possible sum achievable.

Let me consider that each operation sets a row or a column to a permutation of 1 to n, and the sum of that permutation is n*(n+1)/2.

So, for 2n operations, the total sum of all operations is 2n * n*(n+1)/2 = n^2*(n+1).

But since operations overwrite each other, the actual sum in the matrix could be less.

But I need to maximize this sum.

Wait, perhaps I can think in terms of the number of times each cell is set.

Each cell can be set at most twice, once by its row and once by its column.

The last operation that sets the cell determines its value.

So, to maximize the sum, I need to maximize the value of each cell based on the last operation that sets it.

I need a way to arrange operations so that as many cells as possible are set to the highest possible value.

Perhaps it's optimal to set all columns first with [n, n-1, ..., 1], and then set the rows with [n, n-1, ..., 1].

Then, for cell (i,j):

- Set by column j to (n - j + 1)

- Then set by row i to (n - i + 1)

- So the final value is (n - i + 1)

Wait, but in this case, the column operation is overwritten by the row operation.

So, the matrix would be:

n, n, n, ...

n-1, n-1, n-1, ...

...

1, 1, 1

Sum would be n*n + (n-1)*n + ... + 1*n = n*(n(n+1)/2) = n^2(n+1)/2

For n=2: 4*3/2=6, which matches the sum when setting all rows and columns with [2,1].

But in the example, they achieved a higher sum of 7 with only 3 operations.

So, perhaps performing fewer operations allows for higher sums by reducing overwrites.

Wait, but the problem allows up to 2n operations, so performing fewer operations is allowed.

But I need to use no more than 2n operations.

I need to maximize the sum, possibly using fewer operations.

Wait, perhaps I need to choose which rows and columns to set to maximize the sum.

But the problem requires performing operations on entire rows or columns, and I need to choose the permutations for each operation.

Wait, perhaps I can set rows and columns in such a way that the overwrites set higher values.

Let me consider that when a column operation overwrites a row operation, it sets the cell to the value from the column permutation.

So, if I set rows with lower values and columns with higher values, the overwrites can set higher values in the cells.

In the n=2 example, setting rows to [1,2] and columns to [1,2] gives sum 7, which is higher than setting rows to [2,1] and columns to [2,1], which gives sum 5.

Similarly, for n=3, setting rows to [3,2,1] and columns to [3,2,1] gives sum 19, which is higher than setting rows to [1,2,3] and columns to [1,2,3], which gives sum 15, and higher than setting columns first and then rows with [1,2,3], which gives sum 18.

Wait, but in n=2, setting rows to [1,2] and columns to [1,2] gives sum 7, which is higher than setting rows to [2,1] and columns to [2,1], which gives sum 5.

But in n=3, setting rows to [3,2,1] and columns to [3,2,1] gives sum 19, which is higher than setting rows to [1,2,3] and columns to [1,2,3], which gives sum 18.

So, perhaps for even n, setting rows and columns to [1,2,...,n] gives a higher sum, while for odd n, setting rows and columns to [n,n-1,...,1] gives a higher sum.

But n=2 is even, sum=7 with [1,2], n=3 is odd, sum=19 with [3,2,1].

Wait, but n=1 is odd, sum=1 with [1], and n=2 is even, sum=7 with [1,2].

Wait, perhaps it's not related to parity.

Let me look for another pattern.

Looking at the sum for n=1:1; n=2:7; n=3:19.

Is there a formula for the sum?

For n=1:1=1^2

n=2:7=2^2 + 3

n=3:19=3^2 + 2^2 + 3

Wait, not sure.

Alternatively, for n=1:1

n=2:7=1+2+2+2

n=3:19=1+2+3+2+2+3+3+2+3

Wait, seems like for each row operation, the sum increases by the sum of the permutation, and for each column operation, similarly, but with overwrites.

Wait, perhaps I need to think in terms of the sum contributed by row operations and column operations, minus the overwrites.

Wait, maybe it's better to accept that finding an exact formula is difficult and look for a pattern in the operations.

Looking back at the example for n=2, they performed 3 operations: set row 1 to [1,2], set row 2 to [1,2], set column 1 to [1,2], resulting in sum=7.

Similarly, for n=3, if I perform 5 operations: set row 1 to [3,2,1], set row 2 to [3,2,1], set row 3 to [3,2,1], set column 1 to [3,2,1], set column 2 to [3,2,1], set column 3 to [3,2,1], resulting in sum=19.

Wait, but that's 6 operations, which is 2n for n=3.

But perhaps I can do fewer operations.

Wait, the problem allows up to 2n operations, but I can use fewer if possible.

But in the example for n=2, they used 3 operations to achieve sum=7, which is better than using 4 operations to achieve sum=6.

So, perhaps using exactly 2n operations doesn't always give the maximum sum.

Wait, but in n=2, 2n=4 operations can give sum=6, but using 3 operations can give sum=7.

So, sometimes using fewer operations can give a higher sum.

But the problem allows up to 2n operations, so I should choose the number of operations that maximizes the sum, up to 2n.

But I need to provide a solution with no more than 2n operations.

I need to find a way to maximize the sum, possibly using fewer operations.

But finding the minimal number of operations for the maximum sum is not required; I just need to achieve the maximum sum using no more than 2n operations.

Given that, perhaps I can find a way to arrange operations to maximize the sum.

Let me consider that each operation sets a row or a column to a permutation of 1 to n, and the sum of each permutation is n(n+1)/2.

So, if I perform m operations, the total sum contributed is m * n(n+1)/2, but with overwrites.

So, the actual sum in the matrix would be less due to overwrites.

I need to maximize the sum by arranging operations such that overwrites set higher values.

Wait, perhaps I can prioritize setting higher values in columns.

Wait, but I need a systematic way.

Let me consider that for each cell, the last operation that sets it determines its value.

So, if I set columns after rows, the column operations will overwrite the row operations for their cells.

Therefore, to maximize the sum, I should set the columns with higher values after setting the rows with lower values.

Wait, but in the n=2 example, setting rows to [1,2] and then column to [1,2] gives sum=7, which is higher than setting rows to [2,1] and column to [2,1], which gives sum=5.

Similarly, for n=3, setting rows to [3,2,1] and columns to [3,2,1] gives sum=19, which is higher than setting rows to [1,2,3] and columns to [1,2,3], which gives sum=18.

So, perhaps setting rows and columns to [n, n-1, ..., 1] gives a higher sum than setting them to [1,2,...,n].

But in n=2, it's the opposite.

Wait, maybe I need to set rows to [1,2,...,n] and columns to [n, n-1, ..., 1], or vice versa.

Let me try for n=3.

Set rows to [1,2,3], columns to [3,2,1].

Set row 1 to [1,2,3], row 2 to [1,2,3], row 3 to [1,2,3], column 1 to [3,2,1], column 2 to [3,2,1], column 3 to [3,2,1].

Step by step:

Start with zeros.

Set row 1 to [1,2,3]:

1 2 3

0 0 0

0 0 0

Set row 2 to [1,2,3]:

1 2 3

1 2 3

0 0 0

Set row 3 to [1,2,3]:

1 2 3

1 2 3

1 2 3

Set column 1 to [3,2,1]:

3 2 3

2 2 3

1 2 3

Set column 2 to [3,2,1]:

3 3 3

2 2 2

1 2 1

Set column 3 to [3,2,1]:

3 3 3

2 2 2

1 1 1

Sum: 3+3+3 + 2+2+2 + 1+1+1 = 18, which is less than 19.

So, setting rows to [3,2,1] and columns to [3,2,1] gives sum=19, which is higher.

Wait, but in n=2, it's different.

Wait, perhaps for n even, setting rows and columns to [n, n-1, ..., 1] gives a higher sum, and for n odd, the same.

Wait, but n=2 is even, and sum=7 with [1,2], but sum=5 with [2,1], which is less than 7.

Wait, but for n=3, sum=19 with [3,2,1], which is higher than sum=18 with [1,2,3].

So, perhaps for all n, setting rows and columns to [n, n-1, ..., 1] gives a higher sum than setting them to [1,2,...,n].

But in n=2, it's the opposite.

Wait, perhaps I need to think differently.

Let me consider that when I set a column, it overwrites the row settings for that column.

So, to maximize the sum, I need to set columns with higher values after setting rows with lower values.

Wait, perhaps I should set rows with [1,2,...,n] and columns with [n, n-1, ..., 1], so that the column operations overwrite the row operations with higher values.

Let me try for n=2.

Set row 1 to [1,2], row 2 to [1,2], column 1 to [2,1], column 2 to [2,1].

Step by step:

Start with zeros.

Set row 1 to [1,2]:

1 2

0 0

Set row 2 to [1,2]:

1 2

1 2

Set column 1 to [2,1]:

2 2

1 2

Set column 2 to [2,1]:

2 1

1 1

Sum: 2+1 +1+1=5, which is less than 7.

So, not better.

Alternatively, set rows to [2,1], columns to [1,2].

Set row 1 to [2,1], row 2 to [2,1], column 1 to [1,2], column 2 to [1,2].

Step by step:

Start with zeros.

Set row 1 to [2,1]:

2 1

0 0

Set row 2 to [2,1]:

2 1

2 1

Set column 1 to [1,2]:

1 1

2 1

Set column 2 to [1,2]:

1 1

2 2

Sum:1+1 +2+2=6, which is less than 7.

So, still not better.

So, perhaps the initial approach of setting rows to [1,2] and columns to [1,2] gives the highest sum for n=2.

Wait, but in the example, they used only 3 operations to get sum=7.

So, perhaps using fewer operations can give a higher sum.

But the problem allows up to 2n operations, so for n=2, up to 4 operations.

But using 3 operations gives sum=7, which is higher than using 4 operations to get sum=6.

So, sometimes using fewer operations can give a higher sum.

But I need to use no more than 2n operations.

So, perhaps the strategy is to set rows to [1,2,...,n] and columns to [1,2,...,n], using 2n operations, but in some cases, using fewer operations can give a higher sum.

Wait, but in the n=2 example, using 3 operations gives sum=7, while using 4 operations gives sum=6.

So, perhaps for even n, using 2n-1 operations is better.

But I need a general approach for any n.

Let me try to find a pattern in the sum.

Looking at n=1: sum=1

n=2: sum=7

n=3: sum=19

Is there a formula for sum in terms of n?

Let me see:

For n=1:1

n=2:7=1+2+2+2

n=3:19=1+2+3+2+2+3+3+2+3

Wait, perhaps sum can be expressed as sum over j from 1 to n of (2n - j) * j.

Wait, for n=2: (4-1)*1 + (4-2)*2 = 3*1 + 2*2 = 3 + 4 =7

For n=3: (6-1)*1 + (6-2)*2 + (6-3)*3 =5*1 +4*2 +3*3=5+8+9=22, which is different from 19.

Wait, not matching.

Alternatively, perhaps sum is n*n + (n-1)*n + ... + 1*n = n*(n(n+1)/2)=n^2(n+1)/2

For n=2:4*3/2=6, but in the example, sum=7.

Not matching.

Wait, perhaps it's sum over j from 1 to n of (2n - j)*j - something.

Wait, for n=2: (4-1)*1 + (4-2)*2=3+4=7

For n=3:5*1 +4*2 +3*3=5+8+9=22, but earlier approach gave sum=19.

Wait, perhaps it's sum over j from 1 to n of (2n - j - (j-1)) * j

Wait, for n=2: (4-1-0)*1 + (4-2-1)*2=3*1 +1*2=3+2=5, which matches the sum when setting rows and columns to [2,1].

But in the example, sum=7 with [1,2].

Wait, perhaps I need to consider the specific arrangement.

Wait, perhaps the sum is sum over j from 1 to n of (n + max(0, j -1)) * j

Wait, for n=2: (2+1)*1 + (2+1)*2=3*1 +3*2=3+6=9, which is higher than 7.

Not matching.

Alternatively, perhaps it's sum over j from 1 to n of (n + j -1) * j

For n=2: (2+1-1)*1 + (2+2-1)*2=2*1 +3*2=2+6=8, still not