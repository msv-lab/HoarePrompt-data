Alright, I have this problem to solve. Let's see what it's about. So, there's this magical girl named Nene who has an n by n matrix filled with zeros. She can perform two types of operations on this matrix:

1. Type 1: Choose a row i and a permutation p of numbers from 1 to n, and set the elements of that row to the permutation p.

2. Type 2: Choose a column i and a permutation p of numbers from 1 to n, and set the elements of that column to the permutation p.

The goal is to maximize the sum of all the elements in the matrix after performing a certain number of these operations, and we need to do this with no more than 2n operations.

First, I need to understand what these operations do. For Type 1, when I choose a row and a permutation, I'm essentially setting that entire row to the values in the permutation. Similarly, for Type 2, I'm setting an entire column to the values in the permutation.

Now, since the matrix is initially all zeros, every operation I perform will set the chosen row or column to the permutation values. But here's the thing: if I perform both a Type 1 and a Type 2 operation on the same cell, which one takes precedence?

Wait, actually, the operation defines that when you perform a Type 1 operation on row i, you set a_{i,j} = p_j for all j. Similarly, for Type 2 on column i, you set a_{j,i} = p_j for all j. So, if I perform both operations on the same cell, the last operation performed will overwrite the previous value.

But to maximize the sum, I need to think about how to assign the highest possible values to as many cells as possible.

Let me think about the constraints. The matrix is n by n, and I can perform up to 2n operations. I need to maximize the sum of all elements.

I recall that in matrix terms, if I fix rows and columns, there might be some interaction between them. But in this case, since each operation sets entire rows or columns, I need to see how to overlap them to get the highest values.

Wait a minute, perhaps I can think of it in terms of assigning values to rows and columns independently, but considering that assigning to a row will affect all its columns, and assigning to a column will affect all its rows.

Maybe I should consider the contribution of each operation to the total sum.

Let me try a small example to get some intuition. Let's take n=1.

For n=1, the matrix is 1x1. I can perform either a Type 1 operation on row 1, setting a_{1,1} to 1, or a Type 2 operation on column 1, setting a_{1,1} to 1. Since it's the only cell, either operation sets it to 1, and that's the maximum possible sum.

So for n=1, the maximum sum is 1, and I can achieve it with one operation.

Now, let's try n=2.

For n=2, the matrix is 2x2. I can perform up to 4 operations.

I need to maximize the sum of a_{1,1} + a_{1,2} + a_{2,1} + a_{2,2}.

Each operation, whether Type 1 or Type 2, allows me to set a row or a column to a permutation of [1,2].

So, for example, if I perform Type 1 on row 1 with permutation [2,1], then a_{1,1}=2 and a_{1,2}=1.

Then, if I perform Type 2 on column 1 with permutation [2,1], then a_{1,1}=2 and a_{2,1}=1.

So after these two operations, the matrix would be:

a_{1,1}=2 (from both operations, last one is Type 2, which sets a_{1,1}=2)

a_{1,2}=1 (from Type 1)

a_{2,1}=1 (from Type 2)

a_{2,2}=0 (unchanged)

So the sum is 2 + 1 + 1 + 0 = 4.

But in the example provided in the problem, for n=2, the maximum sum is 7 with 3 operations. So I must be missing something.

Let me look at the example provided in the output:

7 3

1 1 1 2

1 2 1 2

2 1 1 2

So, first operation: Type 1 on row 1 with permutation [1,2]

Second operation: Type 1 on row 2 with permutation [1,2]

Third operation: Type 2 on column 1 with permutation [1,2]

Let's see what the matrix looks like after these operations.

Initially:

0 0

0 0

After first operation (Type 1 on row 1 with [1,2]):

1 2

0 0

After second operation (Type 1 on row 2 with [1,2]):

1 2

1 2

After third operation (Type 2 on column 1 with [1,2]):

1 2 (a_{1,1} set to 1 by Type 2)

2 2 (a_{2,1} set to 2 by Type 2)

So final matrix:

1 2

2 2

Sum: 1 + 2 + 2 + 2 = 7

Okay, that makes sense. So, by performing operations in this order, we can achieve a higher sum.

Now, I need to find a general strategy for any n.

I need to maximize the sum of all elements in the matrix using at most 2n operations.

First, note that each operation sets an entire row or column to a permutation of [1,2,...,n]. Since permutations contain each number from 1 to n exactly once, the highest possible value in any cell is n.

If I could set every cell to n, the sum would be n^3, but that's not possible because operations overwrite each other.

I need to find a way to set as many cells as possible to the highest values.

Perhaps I can think in terms of prioritizing certain cells to have higher values.

Alternatively, maybe there's a pattern where I can set the main diagonal to n and other cells to lower values, but I'm not sure.

Wait, perhaps I can consider the operations in such a way that I maximize the sum by assigning higher values to cells that are intersected by fewer operations.

But that seems vague.

Let me try to think differently.

Suppose I perform Type 1 operations on all rows, setting each row to the permutation [n, n-1, ..., 1]. That would set each row to decreasing order, with the first column having the highest value.

Then, the sum would be the sum of all values in the matrix, which is n*(n+1)/2 per row, times n rows, so n^2*(n+1)/2.

But I can maybe do better by also performing Type 2 operations on columns.

Alternatively, perhaps I should perform operations in a specific order to maximize the sum.

Wait, perhaps I should aim to set the main diagonal to n, and the off-diagonal elements to as high as possible.

But I need a more systematic approach.

Let me consider that each operation, whether on a row or a column, sets the entire row or column to the chosen permutation.

Since permutations are arrangements of numbers from 1 to n, the highest value n can only appear once in each row or column if I'm using permutations.

Wait, but actually, in a permutation, each number from 1 to n appears exactly once, so in a row or column, each operation sets the cells to distinct values from 1 to n.

But in the matrix, there's no restriction on duplicates; it's just that each operation uses a permutation.

So, I can have multiple cells with the same value, as long as within each operation, the permutation is used.

I need to maximize the sum, so I want as many high values as possible in the matrix.

I need to think about how operations interact.

If I perform a Type 1 operation on a row, it sets all columns of that row to specific values.

Then, if I perform a Type 2 operation on a column, it sets all rows of that column to specific values, overwriting what was set by the Type 1 operation on those rows.

So, the order of operations matters because later operations overwrite earlier ones.

Therefore, to maximize the sum, I should aim to perform operations that set higher values in cells that are less likely to be overwritten by subsequent operations.

Alternatively, perhaps I can plan the operations in such a way that the highest possible values are set in cells where multiple operations can agree on high values.

This is getting complicated.

Let me try to look for a pattern or a formula for the maximum sum.

Looking back at the example for n=2, the maximum sum is 7.

For n=1, it's 1.

For n=3, if I try to compute, say, with 6 operations (2*3), what would be the maximum sum?

Let me attempt n=3.

If I perform Type 1 operations on all three rows with permutations [3,2,1], and then Type 2 operations on all three columns with permutations [3,2,1], what would the matrix look like?

Let's see:

Start with all zeros.

Perform Type 1 on row 1 with [3,2,1]:

3 2 1

0 0 0

0 0 0

Then, Type 1 on row 2 with [3,2,1]:

3 2 1

3 2 1

0 0 0

Then, Type 1 on row 3 with [3,2,1]:

3 2 1

3 2 1

3 2 1

Now, perform Type 2 on column 1 with [3,2,1]:

3 2 1 â†’ set a_{1,1}=3, a_{2,1}=2, a_{3,1}=1

So:

3 2 1

2 2 1

1 2 1

Then, Type 2 on column 2 with [3,2,1]:

Set a_{1,2}=3, a_{2,2}=2, a_{3,2}=1

So:

3 3 1

2 2 1

1 1 1

Finally, Type 2 on column 3 with [3,2,1]:

Set a_{1,3}=3, a_{2,3}=2, a_{3,3}=1

So:

3 3 3

2 2 2

1 1 1

Sum: 3+3+3 + 2+2+2 + 1+1+1 = 18

But is this the maximum possible sum?

Let's see: the sum is 18, which seems higher than what I might get with other strategies.

Is there a way to get a higher sum than 18 for n=3 with at most 6 operations?

If I try a different sequence of operations, can I get a higher sum?

Let's try performing only row operations.

Perform Type 1 on row 1 with [3,2,1]:

3 2 1

0 0 0

0 0 0

Type 1 on row 2 with [3,2,1]:

3 2 1

3 2 1

0 0 0

Type 1 on row 3 with [3,2,1]:

3 2 1

3 2 1

3 2 1

Sum: 3+2+1 + 3+2+1 + 3+2+1 = 18

Same as before.

Alternatively, perform only column operations.

Type 2 on column 1 with [3,2,1]:

3 0 0

2 0 0

1 0 0

Type 2 on column 2 with [3,2,1]:

3 3 0

2 2 0

1 1 0

Type 2 on column 3 with [3,2,1]:

3 3 3

2 2 2

1 1 1

Again, sum is 18.

So, it seems that with 3 Type 2 operations, I can achieve sum 18.

But can I do better by mixing Type 1 and Type 2 operations?

Let's try performing 3 Type 1 operations and 3 Type 2 operations carefully.

Start with all zeros.

Perform Type 1 on row 1 with [3,3,3]:

Wait, but permutations must be of [1,2,3], so I can't set [3,3,3]. Permutations must contain each number from 1 to n exactly once. So, I can't set all elements of a row to 3; they must be distinct.

Wait, I made a mistake earlier. In my earlier steps, I used [3,2,1], which is a permutation, but I thought [3,3,3] is allowed, but it's not, because it's not a permutation.

So, corrections: in each operation, I must use a permutation of [1,2,3], meaning each number appears exactly once in the permutation.

Therefore, in my earlier steps, setting [3,2,1] is correct, but I can't set [3,3,3].

So, my earlier sum of 18 is achievable, but is it the maximum?

Is there a way to get a higher sum?

Let me think about the constraints again.

Each operation sets a row or a column to a permutation of [1,2,3].

So, in any row or column, the sum is always 1+2+3=6, regardless of the permutation.

Wait a minute, in the earlier steps, when I set row 1 to [3,2,1], sum is 6.

Row 2 to [3,2,1], sum is 6.

Row 3 to [3,2,1], sum is 6.

Total sum is 18.

Similarly, when setting columns, same thing.

But is there a way to make some cells have higher values by overlapping operations?

Wait, but in the n=2 example, they achieved a sum of 7, which is higher than what I would get by just setting rows or columns to their maximum permutations.

Wait, for n=2, the maximum sum with rows and columns set to [2,1] would be 2+1+2+1=6, but in the example, they achieved 7 by performing operations in a specific order.

So, perhaps by performing operations in a specific order, I can get higher sums.

Looking back, in the n=2 example, they performed:

1 1 1 2 â†’ Type 1 on row 1 with [1,2]

1 2

0 0

Then, 1 2 1 2 â†’ Type 1 on row 2 with [1,2]

1 2

1 2

Then, 2 1 1 2 â†’ Type 2 on column 1 with [1,2]

Set a_{1,1}=1, a_{2,1}=2

So, matrix becomes:

1 2

2 2

Sum: 1+2+2+2=7

So, by performing operations in this order, they achieved a higher sum than just setting rows or columns to their maximum permutations.

So, perhaps there's a smarter way to overlap operations to get higher sums in some cells.

Let me try to generalize this.

Suppose I perform Type 1 operations on all rows with the permutation [n,n-1,...,1], and then perform Type 2 operations on the first k columns with the same permutation.

Wait, but I need to think carefully about which operations overwrite which cells.

Maybe a better approach is to perform Type 1 operations on some rows and Type 2 operations on some columns, choosing which to perform first to maximize the sum.

Alternatively, perhaps I can prioritize setting the highest values in the cells that are less likely to be overwritten.

Wait, perhaps I can perform Type 2 operations on the first m columns, and then Type 1 operations on the remaining rows.

But I need a better strategy.

Let me consider the following approach:

- Perform Type 1 operations on the first k rows with permutation [n, n-1, ..., 1]

- Perform Type 2 operations on the first m columns with permutation [n, n-1, ..., 1]

Then, the cells at the intersection of these rows and columns will have their values overwritten by the last operation performed.

I need to choose k and m such that the sum is maximized.

But this seems too vague.

Let me try to calculate the sum based on this approach.

Suppose I perform Type 1 operations on all n rows with permutation [n, n-1, ..., 1], and then perform Type 2 operations on all n columns with the same permutation.

Then, the cells will be set by the last operation that affects them.

Specifically, for cell (i,j), if row i was last operated on by a Type 1 operation after any Type 2 operation on column j, then a_{i,j} would be the value from the Type 1 operation.

Otherwise, if column j was last operated on by a Type 2 operation after any Type 1 operation on row i, then a_{i,j} would be the value from the Type 2 operation.

But since operations are performed in sequence, the order matters.

If I perform all Type 1 operations first, followed by all Type 2 operations, then all cells will be set by the Type 2 operations, because they are performed last.

Wait, but in the n=2 example, they performed two Type 1 operations followed by one Type 2 operation, and the Type 2 operation overwrote some cells.

Wait, perhaps I need to interleave the operations in a specific way to maximize the sum.

This is getting complicated.

Maybe I need to think in terms of which cells are set by which operations.

Each cell (i,j) can be set by either the last Type 1 operation on row i or the last Type 2 operation on column j, whichever was performed last.

So, to maximize the sum, I need to arrange the operations such that each cell is set by the operation that can assign it the highest possible value.

But how do I know which operation can assign a higher value to a cell?

Wait, in a Type 1 operation on row i with permutation p, a_{i,j} = p_j.

In a Type 2 operation on column i with permutation p, a_{j,i} = p_j.

So, for cell (i,j), if the last operation is a Type 1 on row i, then a_{i,j} = p_j.

If the last operation is a Type 2 on column j, then a_{i,j} = p_j.

So, to maximize a_{i,j}, I need to choose the operation (either Type 1 on row i or Type 2 on column j) that can assign the highest possible p_j to that cell, and ensure that this operation is performed last for that cell.

But p_j is a permutation, so the highest possible value is n, but only one cell in each row or column can get n, because permutations have each number exactly once.

This seems tricky.

Maybe I need to accept that achieving sum n^3 is impossible due to the permutation constraints, and find a feasible sum that can be achieved within 2n operations.

Looking back at the n=2 example, they achieved sum 7 with 3 operations.

Let me see what sum I can achieve with 4 operations (since 2n=4 for n=2).

If I perform Type 1 on row 1 with [2,1], Type 1 on row 2 with [2,1], Type 2 on column 1 with [2,1], and Type 2 on column 2 with [2,1], what would the matrix look like?

Start with:

0 0

0 0

After Type 1 on row 1 with [2,1]:

2 1

0 0

Then, Type 1 on row 2 with [2,1]:

2 1

2 1

Then, Type 2 on column 1 with [2,1]:

2 1 â†’ a_{1,1}=2, a_{2,1}=1

So:

2 1

1 1

Then, Type 2 on column 2 with [2,1]:

Set a_{1,2}=2, a_{2,2}=1

So:

2 2

1 1

Sum: 2+2+1+1=6

Wait, which is less than the 7 achieved with 3 operations.

So, perhaps using fewer operations allows for a higher sum.

Wait, that seems counterintuitive, but in this case, using 3 operations gave a higher sum than using 4 operations.

Hmm.

Wait, in the 3-operation sequence, they did two Type 1 operations followed by one Type 2 operation, achieving sum 7.

In the 4-operation sequence, I did two Type 1 and two Type 2 operations, achieving sum 6.

So, perhaps by performing fewer Type 2 operations, I can achieve a higher sum.

This suggests that there's a trade-off in the number of operations used.

I need to find the optimal number of operations to maximize the sum, without exceeding 2n operations.

Now, I need to find a general formula or approach for any n.

Let me try to find a pattern in the sums for small n.

For n=1:

Maximum sum is 1, with 1 operation.

For n=2:

Maximum sum is 7, with 3 operations.

For n=3:

From earlier, with 6 operations, sum is 18.

But is that the maximum?

Wait, in n=2, with 4 operations, sum is 6, but with 3 operations, sum is 7.

So perhaps 7 is the maximum for n=2.

Similarly, for n=3, perhaps there's a way to achieve a higher sum than 18 with fewer operations.

Wait, for n=3, if I perform 5 operations, can I get a sum higher than 18?

Let's try.

Perform Type 1 on row 1 with [3,3,3]: Wait, can't do that, since permutations must be [1,2,3] in some order.

So, perform Type 1 on row 1 with [3,2,1]:

3 2 1

0 0 0

0 0 0

Then, Type 1 on row 2 with [3,2,1]:

3 2 1

3 2 1

0 0 0

Then, Type 1 on row 3 with [3,2,1]:

3 2 1

3 2 1

3 2 1

Then, Type 2 on column 1 with [3,2,1]:

3 2 1 â†’ a_{1,1}=3, a_{2,1}=2, a_{3,1}=1

So:

3 2 1

2 2 1

1 2 1

Then, Type 2 on column 2 with [3,2,1]:

Set a_{1,2}=3, a_{2,2}=2, a_{3,2}=1

So:

3 3 1

2 2 1

1 1 1

Sum: 3+3+1 + 2+2+1 + 1+1+1 = 15

Wait, which is less than 18.

So, performing 5 operations gives sum 15, which is less than performing 6 operations to get sum 18.

Wait, perhaps I did something wrong.

Wait, in the first step, after Type 1 on row 1 with [3,2,1]:

3 2 1

0 0 0

0 0 0

Then, Type 1 on row 2 with [3,2,1]:

3 2 1

3 2 1

0 0 0

Then, Type 1 on row 3 with [3,2,1]:

3 2 1

3 2 1

3 2 1

Then, Type 2 on column 1 with [3,2,1]:

Set a_{1,1}=3, a_{2,1}=2, a_{3,1}=1

So:

3 2 1 â†’ a_{1,1}=3

2 2 1 â†’ a_{2,1}=2

1 2 1 â†’ a_{3,1}=1

Then, Type 2 on column 2 with [3,2,1]:

Set a_{1,2}=3, a_{2,2}=2, a_{3,2}=1

So:

3 3 1

2 2 1

1 1 1

Sum: 3+3+1 + 2+2+1 + 1+1+1 = 15

But earlier, with only Type 1 operations on all rows and Type 2 operations on all columns, I got sum 18.

Wait, perhaps I need to perform Type 2 operations differently.

Let me try performing Type 2 operations before Type 1 operations.

Start with all zeros.

Perform Type 2 on column 1 with [3,2,1]:

3 0 0

2 0 0

1 0 0

Then, Type 2 on column 2 with [3,2,1]:

3 3 0

2 2 0

1 1 0

Then, Type 2 on column 3 with [3,2,1]:

3 3 3

2 2 2

1 1 1

Sum: 3+3+3 + 2+2+2 + 1+1+1 = 18

Then, perform Type 1 on row 1 with [3,3,3]: Wait, can't do that, permutations must be [1,2,3].

So, perform Type 1 on row 1 with [3,2,1]:

3 2 1

2 2 0

1 1 0

Wait, but in this case, Type 1 on row 1 overwrites the column operations.

This is getting too confusing.

Perhaps the maximum sum is indeed 18 for n=3, achieved by performing Type 2 operations on all columns.

But in the n=2 case, performing only Type 2 operations on both columns would give sum 6, but the example shows sum 7 with 3 operations.

So, there must be a better way.

Wait, perhaps I need to prioritize setting the main diagonal to the highest values.

Let me try that.

For n=3, set the main diagonal to [3,3,3], and the off-diagonal elements to [2,2,2].

But wait, in a permutation, I can't have duplicates.

Wait, no, in the matrix, duplicates are allowed, as long as each operation uses a permutation.

So, for example, I can perform Type 1 on row 1 with [3,2,1], Type 1 on row 2 with [3,2,1], and Type 1 on row 3 with [3,2,1], then perform Type 2 on column 1 with [3,2,1], Type 2 on column 2 with [3,2,1], and Type 2 on column 3 with [3,2,1].

But as I saw earlier, this gives sum 18.

Is there a way to get higher than that?

Looking back at the n=2 example, they achieved sum 7 with 3 operations, which is higher than what I would get by performing operations only on rows or only on columns.

So, perhaps there's a pattern or formula for the maximum sum.

Let me try to find a general formula for the maximum sum.

Suppose I perform Type 1 operations on all rows with permutation [n,n-1,...,1], and then perform Type 2 operations on the first k columns with the same permutation.

Then, the cells in the first k columns will be set by the Type 2 operations, and the cells in the remaining columns will be set by the Type 1 operations.

So, the sum would be:

Sum = sum over j=1 to k of (sum over i=1 to n of a_{i,j} from Type 2 operation) + sum over j=k+1 to n of (sum over i=1 to n of a_{i,j} from Type 1 operation)

Since in Type 2 operation on column j, a_{i,j} = p_i, where p is a permutation of [1,2,...,n].

If I choose p as [n,n-1,...,1], then sum over i=1 to n of a_{i,j} = sum from 1 to n, which is n(n+1)/2.

Similarly for Type 1 operations.

So, Sum = k * [n(n+1)/2] + (n - k) * [n(n+1)/2] = n * [n(n+1)/2] = n^2(n+1)/2

For n=2, this would be 2*2*(3)/2 = 6, which is less than the achieved sum of 7.

So, this suggests that there's a better way.

Wait, perhaps I need to choose k optimally.

But in the n=2 example, with k=1, sum is 7, which is higher than 6.

So, perhaps choosing k=1 is better.

Wait, but according to the formula, Sum = 1*(2*3/2) + 1*(2*3/2) = 3 + 3 = 6, but in practice, they achieved 7.

So, perhaps my formula is incorrect.

I need to think differently.

Let me consider that when I perform a Type 2 operation on a column after performing Type 1 operations on rows, the Type 2 operation overwrites the cells in that column.

So, perhaps I can choose which columns to perform Type 2 operations on to maximize the sum.

Wait, maybe I should perform Type 1 operations on all rows, and then perform Type 2 operations on some columns to set their values to higher numbers.

But I need a better approach.

Let me try to model this problem differently.

Each cell (i,j) can be set by either a Type 1 operation on row i or a Type 2 operation on column j, with the last operation performed taking effect.

So, to maximize the sum, I need to assign to each cell (i,j) the highest possible value from either a Type 1 operation on row i or a Type 2 operation on column j, depending on which operation is performed last.

This sounds like assigning to each cell the maximum value possible considering the operations performed.

But since operations are performed in sequence and later operations overwrite earlier ones, the order matters.

This seems too vague.

Perhaps I should look for a formula for the maximum sum.

Looking back at the n=2 example, sum is 7.

For n=1, sum is 1.

For n=3, I think sum is 18.

Is there a pattern here?

Let's see:

n=1: sum=1 = 1^3

n=2: sum=7 = 2^3 -1

n=3: sum=18 = 3^3 - 9

n=4: sum=?

It's not clear.

Wait, maybe it's n^3 - (n*(n-1)/2)

For n=2: 8 - 1 =7

For n=3: 27 - 3 =24, but earlier I thought sum=18, which doesn't match.

So, perhaps that's not the formula.

Alternatively, perhaps it's sum = n * (n + 1)^2 / 2 - something.

This is getting too speculative.

Maybe I should think in terms of the number of operations.

Given that I can perform up to 2n operations, I need to choose a sequence of operations that maximizes the sum.

Perhaps I can prioritize performing operations that set the highest values in the most cells.

Wait, perhaps I can perform Type 1 operations on all rows, and then perform Type 2 operations on the first m columns, choosing m optimally.

Let me try to calculate the sum in this case.

After performing Type 1 operations on all n rows with permutation [n,n-1,...,1], the sum would be n * (1 + 2 + ... + n) = n * n(n+1)/2 = n^2(n+1)/2

Then, performing Type 2 operations on the first m columns with permutation [n,n-1,...,1], each Type 2 operation would set the column to [n,n-1,...,1], overwriting the corresponding cells in the rows.

So, for each Type 2 operation on column j, the sum of that column becomes 1 + 2 + ... + n = n(n+1)/2

But since these operations overwrite the values set by the Type 1 operations on the rows, the total sum would be the sum of the first m columns set by Type 2 operations plus the sum of the remaining n - m columns set by Type 1 operations.

Therefore, Sum = m * [n(n+1)/2] + (n - m) * [n(n+1)/2] = n * [n(n+1)/2] = n^2(n+1)/2

Wait, that's the same as performing only Type 1 operations on all rows.

But in the n=2 example, this would give sum=6, but the example achieves sum=7 with 3 operations.

So, perhaps I need to choose m optimally.

Wait, maybe m=1 is better.

If m=1, Sum = 1 * [n(n+1)/2] + (2 - 1) * [n(n+1)/2] = n(n+1)/2 + n(n+1)/2 = n(n+1)

For n=2, this would be 2*3 =6, which is still less than 7.

Hmm.

This suggests that there's a better way to arrange the operations.

Perhaps I need to perform Type 2 operations before Type 1 operations.

Let me try that.

First, perform Type 2 operations on all n columns with permutation [n,n-1,...,1], then perform Type 1 operations on the first k rows with permutation [n,n-1,...,1].

Then, the cells in the first k rows would be set by the Type 1 operations, overwriting the Type 2 operations on those rows, and the remaining n - k rows would be set by the Type 2 operations.

So, Sum = k * [n(n+1)/2] + (n - k) * [n(n+1)/2] = n * [n(n+1)/2] = n^2(n+1)/2

Again, same as before.

Wait, perhaps I need to choose k and m differently.

This seems stuck.

Maybe I need to accept that the maximum sum is n^2(n+1)/2 and output that.

But in the n=2 example, they achieved 7, which is more than 2^2*3/2=6.

So, that can't be the maximum.

Wait, perhaps I'm missing something.

Wait, in the n=2 example, they achieved 7 with 3 operations, which is higher than 6.

So, perhaps n^2(n+1)/2 is not achievable, but higher sums can be achieved by performing operations in a specific order.

I need to think differently.

Let me consider that each cell can be set to at most n, and that in order to maximize the sum, I should set as many cells as possible to n.

But due to the permutation constraints, in each row or column, n can only appear once.

Wait, but in the matrix, there's no restriction on duplicates; it's just that each operation uses a permutation.

So, in theory, multiple cells in a row or column can have n, as long as the operations that set them allow it.

Wait, but in practice, since operations overwrite each other, it's tricky.

Let me try to maximize the number of cells set to n.

For n=2, in the example, they achieved two cells with 2: a_{1,2}=2 and a_{2,2}=2, and a_{2,1}=2, and a_{1,1}=1.

So, three cells with 2 and one cell with 1, sum=7.

Is that the maximum?

Could I get four cells with 2? No, because in the permutation, each row and column can have only one 2.

Wait, no, in the operations, permutations are used, which must contain each number from 1 to n exactly once.

But in the matrix, there's no such restriction; the matrix can have multiple cells with the same number.

Wait, but in the operations, when you set a row or a column to a permutation, you're assigning distinct numbers to each cell in that row or column.

Wait, no, in a Type 1 operation, you choose a permutation p and set a_{i,j} = p_j for all j.

Similarly, in Type 2, you choose a permutation p and set a_{j,i} = p_j for all j.

So, in a Type 1 operation on row i, you assign the permutation p to that row, meaning each cell in that row gets a unique value from 1 to n.

Similarly for Type 2 operations on columns.

Therefore, in the matrix, each row and each column must contain distinct values from 1 to n if only one operation is performed on that row or column.

But if multiple operations are performed, the last operation overwrites previous ones.

So, in the n=2 example, performing Type 1 on row 1 with [1,2], then Type 1 on row 2 with [1,2], then Type 2 on column 1 with [1,2], results in:

a_{1,1}=1 (set by Type 2 last)

a_{1,2}=2 (set by Type 1 last)

a_{2,1}=2 (set by Type 2 last)

a_{2,2}=2 (set by Type 1 last)

So, matrix is:

1 2

2 2

Sum: 7

Here, column 2 is set by Type 1 on row 1 and row 2, with a_{1,2}=2 and a_{2,2}=2, and Type 2 on column 1 sets a_{1,2}=2 (but Type 1 on row 2 overwrites it to 2 again).

Wait, no, Type 2 operations set columns, so Type 2 on column 1 sets a_{1,1} and a_{2,1}, but doesn't directly affect a_{1,2} and a_{2,2}, unless overwritten by later operations.

In this case, a_{1,2} is set by Type 1 on row 1 to 2, and a_{2,2} is set by Type 1 on row 2 to 2.

So, in this specific sequence, we end up with three cells having 2 and one cell having 1.

Is there a way to get four cells with 2? No, because in the permutations used, each row and column can have only one 2 if only one operation is performed on them.

But in this case, since multiple operations are performed, and Type 2 operations can overwrite Type 1 operations on specific cells, perhaps there's a way to arrange operations to have more cells set to 2.

Wait, but in n=2, the maximum sum achievable is 7, as per the example.

So, perhaps for general n, the maximum sum is sum_{i=1 to n} sum_{j=1 to n} min(i,j)

Wait, for n=1: min(1,1)=1 â†’ sum=1

n=2: min(1,1)=1, min(1,2)=1, min(2,1)=1, min(2,2)=2 â†’ sum=1+1+1+2=5, but the example shows sum=7, which is higher.

So, that can't be.

Alternatively, perhaps it's sum_{i=1 to n} sum_{j=1 to n} max(i,j)

For n=1: max(1,1)=1 â†’ sum=1

n=2: max(1,1)=1, max(1,2)=2, max(2,1)=2, max(2,2)=2 â†’ sum=1+2+2+2=7, which matches the n=2 example.

For n=3: max(1,1)=1, max(1,2)=2, max(1,3)=3, max(2,1)=2, max(2,2)=2, max(2,3)=3, max(3,1)=3, max(3,2)=3, max(3,3)=3 â†’ sum=1+2+3 + 2+2+3 + 3+3+3 = 1+2+3 + 2+2+3 + 3+3+3 = 6 + 7 + 9 = 22

Wait, but earlier, for n=3, I thought sum=18 was achievable, but according to this, the maximum sum should be 22.

Is that possible?

Wait, let's see.

If I perform operations in such a way that cell (1,1) is set to 1, cells (1,2)=(1,3)=(2,1)=(2,2)=(2,3)=(3,1)=(3,2)=(3,3)=3, then sum would be 1 + 3 + 3 + 3 + 3 + 3 + 3 + 3 + 3 = 1 + 8*3 = 25, which is higher than 22.

But is that achievable within the operation constraints?

Wait, no, because in permutations, each row or column can have only one 3 if only one operation is performed on it.

Wait, but if I perform multiple operations, perhaps I can arrange it.

Wait, no, in reality, due to the permutation constraints, I can't have all cells in a row or column set to 3; only one cell per row or column can be set to 3 in a single operation.

Wait, but operations can be performed multiple times, and later operations overwrite earlier ones.

So, perhaps I can set multiple cells in a row or column to 3 by performing multiple operations.

But in practice, it's limited by the permutation constraint in each operation.

Wait, perhaps I need to accept that the maximum sum is sum_{i=1 to n} sum_{j=1 to n} max(i,j), which for n=2 is 7, matching the example.

So, for general n, the maximum sum s is sum_{i=1 to n} sum_{j=1 to n} max(i,j)

This can be calculated as sum_{i=1 to n} (2*i*(n - i + 1) - i)

Wait, let's compute it.

For each i from 1 to n, sum_{j=1 to n} max(i,j)

This is equal to sum_{j=1 to i} i + sum_{j=i+1 to n} j

Wait, no.

Wait, for each i, j:

if i >= j, max(i,j) = i

if i < j, max(i,j) = j

So, sum over j=1 to n of max(i,j) = sum_{j=1 to i} i + sum_{j=i+1 to n} j

= i*i + sum_{j=i+1 to n} j

= i^2 + (n*(n+1)/2 - i*(i+1)/2)

So, sum over all i=1 to n of [i^2 + n(n+1)/2 - i(i+1)/2]

= sum_{i=1 to n} [i^2 + n(n+1)/2 - i(i+1)/2]

= sum_{i=1 to n} [i^2] + n(n+1)/2 * n - sum_{i=1 to n} [i(i+1)/2]

= sum_{i=1 to n} [i^2] + n^2(n+1)/2 - sum_{i=1 to n} [i^2/2 + i/2]

= sum_{i=1 to n} [