Alright, I've got this problem to solve. Let's see what it's asking for. So, there are n items in a shop, each with two prices: a_i for Alice to buy from the shop, and b_i for Bob to buy from Alice. Alice wants to choose a subset of items to buy, and then Bob will either take all of them for free if she buys less than k items, or take k items for free and pay for the rest.

Alice's profit is the difference between what Bob pays her and what she spends on buying the items. She wants to maximize this profit, while Bob wants to minimize it. I need to find out what Alice's profit will be if both act optimally.

First, I need to understand the rules clearly. If Alice buys fewer than k items, Bob takes all of them for free, so Alice's profit is negative the sum of a_i for the items she bought. Because she didn't get any payment from Bob.

If she buys k or more items, Bob takes k items for free that Alice bought, and pays b_i for the remaining items. So, Alice's profit is the sum of b_i for the items Bob buys minus the sum of a_i for all items she bought.

Alice needs to choose which items to buy to maximize her profit, knowing that Bob will choose which k items to take for free to minimize her profit.

I need to find a strategy where Alice picks a subset of items, and Bob, given that subset, picks which k items to take for free.

Let me think about this step by step.

First, if Alice buys fewer than k items, her profit is simply minus the sum of a_i for those items. Since Bob takes them all for free, she doesn't get any money from Bob.

If she buys exactly k items, Bob takes all k for free, so again, her profit is minus the sum of a_i for those k items.

If she buys more than k items, say m items where m > k, Bob takes k items for free, and pays b_i for the remaining (m - k) items. So, her profit is sum of b_i for (m - k) items minus sum of a_i for all m items.

Alice wants to maximize this profit, while Bob, given the subset Alice chose, wants to minimize it by choosing which k items to take for free.

So, it's like a minimax problem: Alice maximizes the minimum profit she can get, considering Bob's minimizing action.

I need to find a way to compute this efficiently, especially since n can be up to 2*10^5 per test case, and t can be up to 10^4, with the sum of n over all test cases not exceeding 2*10^5.

First, I need to find a way to model Alice's profit.

Let me denote S as the set of items Alice buys, and T as the set of items Bob buys from S (after Alice has bought them).

If |S| < k, T = S, and Alice's profit is -sum_{i in S} a_i.

If |S| >= k, Bob chooses T with |T| = k to minimize Alice's profit, which is sum_{i in S - T} b_i - sum_{i in S} a_i.

Alice wants to choose S to maximize the minimum profit, given that Bob will choose T to minimize it.

This seems complex. Maybe there's a smarter way to approach this.

Let me think about the difference between a_i and b_i.

Alice has to pay a_i for each item she buys, and she gets b_i for each item Bob buys from her.

So, for each item, if Bob buys it from her, her net profit for that item is b_i - a_i.

But Bob can choose to take up to k items for free, which means those items don't contribute to Bob's payment, but Alice still paid a_i for them.

Wait, for the items Bob takes for free, Alice doesn't get b_i, but she still paid a_i.

For the items Bob buys from her, she gets b_i per item, but she paid a_i for each item she bought.

So, her total profit is sum_{i in S - T} b_i - sum_{i in S} a_i.

Which can be written as sum_{i in S} (b_i - a_i) - sum_{i in T} b_i.

Wait, let's see:

sum_{i in S - T} b_i - sum_{i in S} a_i = sum_{i in S} (b_i - a_i) - sum_{i in T} b_i.

Alice wants to maximize this, and Bob wants to minimize it.

So, for a given S, Bob will choose T to minimize sum_{i in S - T} b_i - sum_{i in S} a_i, which is equivalent to minimizing -sum_{i in T} b_i, since the other terms are fixed for a given S.

Minimizing -sum_{i in T} b_i is the same as maximizing sum_{i in T} b_i.

So, Bob will choose the k items with the highest b_i from S to take for free, in order to minimize Alice's profit.

Therefore, Alice's profit is sum_{i in S} (b_i - a_i) - sum_{i in top-k b_i in S} b_i.

Wait, more precisely, since Bob takes k items with the highest b_i from S for free, the items that Bob buys are S - T, where T is the k items with highest b_i in S.

So, sum_{i in S - T} b_i is the sum of b_i for the items not in T.

Therefore, Alice's profit is sum_{i in S - T} b_i - sum_{i in S} a_i = -sum_{i in T} b_i + sum_{i in S} (b_i - a_i).

Wait, let's double-check:

sum_{i in S - T} b_i - sum_{i in S} a_i = sum_{i in S} (b_i - a_i) - sum_{i in T} b_i.

Yes, that's correct.

So, Alice's profit is sum_{i in S} (b_i - a_i) - sum_{i in T} b_i, where T is the set of k items in S with the highest b_i.

Alice wants to maximize this profit, knowing that Bob will choose T to minimize it.

So, for a given S, Bob's choice of T is fixed: he takes the k items with the highest b_i in S.

Therefore, Alice needs to choose S to maximize sum_{i in S} (b_i - a_i) - sum_{i in T} b_i.

Which is equivalent to sum_{i in S} (-a_i) - sum_{i in T} b_i.

Wait, more clearly:

sum_{i in S} (b_i - a_i) - sum_{i in T} b_i = sum_{i in S} (-a_i) - sum_{i in T} b_i.

But I think it's better to keep it as sum_{i in S} (b_i - a_i) - sum_{i in T} b_i.

Let me see if I can simplify this expression.

sum_{i in S} (b_i - a_i) - sum_{i in T} b_i = sum_{i in S} (-a_i) + sum_{i in S - T} b_i - sum_{i in T} b_i = sum_{i in S} (-a_i) - 2 * sum_{i in T} b_i + sum_{i in S} b_i.

Wait, that seems messy.

Let me try another approach.

Let me consider the items in S sorted by their b_i in descending order.

Bob will choose the top k items by b_i to take for free.

So, the items Bob buys are the remaining items in S after removing the top k by b_i.

Therefore, Alice's profit is sum_{i in S without the top k by b_i} b_i - sum_{i in S} a_i.

I need to maximize this over all possible S.

This seems tricky.

Maybe I can think in terms of selecting items to include in S, considering the cost and the benefit.

Let me consider the net profit for each item if included in S.

If an item is in S but not in T (i.e., not among the top k by b_i in S), its contribution to the profit is b_i - a_i.

If an item is in S and in T (among the top k by b_i in S), its contribution is -a_i - b_i.

Wait, why?

Because she paid a_i for buying it, and Bob takes it for free, so she doesn't get b_i from it.

Wait, no.

Actually, if an item is in T, Bob takes it for free, so Alice paid a_i but doesn't get b_i.

So, her profit for that item is -a_i.

For items in S but not in T, Bob pays b_i, so her profit is b_i - a_i.

So, for each item in S, if it's not in T, profit is b_i - a_i; if it's in T, profit is -a_i.

Since T consists of the top k items by b_i in S, Alice needs to choose S to maximize the sum of (b_i - a_i) for items not in T minus a_i for items in T.

This seems complicated.

Maybe I can think of it differently.

Let me consider that for items in S but not in T, the profit is b_i - a_i, and for items in T, the profit is -a_i.

So, total profit is sum_{i in S - T} (b_i - a_i) + sum_{i in T} (-a_i).

Which is sum_{i in S} (-a_i) + sum_{i in S - T} b_i.

But since T is the top k items by b_i in S, sum_{i in S - T} b_i is sum_{i in S} b_i - sum_{i in T} b_i.

So, total profit is sum_{i in S} (-a_i) + sum_{i in S} b_i - sum_{i in T} b_i = sum_{i in S} (b_i - a_i) - sum_{i in T} b_i.

This seems to be the same expression as before.

I need to find a way to maximize this over all possible S.

This seems tricky.

Maybe I can consider different sizes of S and find the optimal S for each size.

But n can be up to 2*10^5, so that's not feasible.

I need a smarter approach.

Let me consider that for items not in T, their contribution is b_i - a_i, and for items in T, their contribution is -a_i.

Wait, but items in T have a contribution of -a_i, and items not in T have a contribution of b_i - a_i.

I can think of it as follows:

For each item, if it's not in T, its contribution is b_i - a_i, else -a_i.

Given that T is the top k items by b_i in S.

This seems messy.

Maybe I can consider sorting the items by b_i and try to select S accordingly.

Wait, perhaps I can sort the items by b_i - a_i.

Wait, no, that might not help directly.

Let me consider that Alice wants to maximize her profit, and Bob, given S, chooses T to minimize it.

So, for a given S, Bob chooses T as the k items in S with the highest b_i.

Therefore, Alice needs to choose S such that the sum of (b_i - a_i) for S minus the sum of the top k b_i in S is maximized.

This seems like a tricky optimization problem.

Maybe I can consider the following approach:

- For items where b_i - a_i >= 0, Alice wants to include them in S and have them not in T, so that their contribution is b_i - a_i >= 0.

- For items where b_i - a_i < 0, including them in S would be detrimental unless they are in T, which means Bob takes them for free, and Alice only loses a_i.

Wait, let's see:

If an item has b_i - a_i >= 0, Alice wants to have it in S but not in T, so that she gets b_i - a_i >= 0.

If an item has b_i - a_i < 0, including it in S and having it in T would mean she loses a_i, which is bad, but if it's not in T, she loses a_i and gets b_i, which is worse since b_i - a_i < 0.

So, for items with b_i - a_i >= 0, Alice wants to include them in S and ensure they are not in T.

For items with b_i - a_i < 0, including them in S is not beneficial unless they are in T, but being in T means Alice loses a_i, which is still bad.

Wait, for items with b_i - a_i < 0, it's better not to include them in S at all, because:

- If included in S and in T, Alice loses a_i.

- If included in S and not in T, Alice loses a_i - b_i, which is larger since b_i - a_i < 0.

So, it's better to exclude them from S.

Therefore, Alice should only consider items with b_i - a_i >= 0.

Wait, but that can't be entirely true, because in the example, some items with b_i - a_i < 0 are included.

Wait, in the second example:

n=4, k=1

a = [1,2,1,4]

b = [3,3,2,3]

So, b - a = [2,1,1,-1]

If Alice includes all items, Bob takes the item with highest b_i, which is item 1 or 2 (both have b_i=3), say item 1.

Then, Alice's profit is (b2 + b3 + b4) - (a1 + a2 + a3 + a4) = (3 + 2 + 3) - (1 + 2 + 1 + 4) = 8 - 8 = 0.

But according to the note, the profit is 1, so maybe I'm missing something.

Wait, in the note, it says Alice buys the 1st, 2nd, and 3rd items, and Bob takes the 1st item for free, so Alice's profit is (3 + 2) - (1 + 2 + 1) = 5 - 4 = 1.

Wait, but according to my calculation, it's (3 + 2 + 3) - (1 + 2 + 1 + 4) = 8 - 8 = 0.

Hmm, maybe I need to adjust my understanding.

Wait, perhaps I need to consider that Bob takes k items for free, and pays for the rest.

So, if Alice buys m items (m >= k), Bob takes k items for free and pays for m - k items.

So, Alice's profit is sum of b_i for m - k items minus sum of a_i for m items.

In the second example, if Alice buys the 1st, 2nd, and 3rd items, Bob takes the 1st item for free (since it has the highest b_i=3), and pays for the 2nd and 3rd items, which are b2=3 and b3=2.

So, Alice's profit is (3 + 2) - (1 + 2 + 1) = 5 - 4 = 1.

If Alice buys only the 1st and 2nd items, Bob takes the 1st item for free, and pays for the 2nd item: profit is 3 - (1 + 2) = 0.

If Alice buys the 1st, 3rd, and 4th items, Bob takes the 1st item for free, pays for the 3rd and 4th items: profit is (2 + 3) - (1 + 1 + 4) = 5 - 6 = -1.

If Alice buys all four items, Bob takes the 1st item for free, pays for the 2nd, 3rd, and 4th items: profit is (3 + 2 + 3) - (1 + 2 + 1 + 4) = 8 - 8 = 0.

So, the maximum profit is 1, as in the note.

Back to the general case.

I need to maximize, over all subsets S with |S| >= k, the expression sum_{i in S - T} b_i - sum_{i in S} a_i, where T is the k items in S with the highest b_i.

Alternatively, sum_{i in S} (b_i - a_i) - sum_{i in T} b_i.

I need to find a way to compute this efficiently.

Let me consider sorting the items in S by b_i in descending order.

Then, T consists of the first k items, and sum_{i in S - T} b_i = sum_{i=k+1 to |S|} b_i.

So, Alice's profit is sum_{i=k+1 to |S|} b_i - sum_{i=1 to |S|} a_i.

I need to maximize this over all possible S.

This seems manageable.

Let me think about it.

I can iterate over all possible sizes of S starting from k up to n.

For each size m from k to n, I can select the top m items by b_i, sort them by b_i in descending order.

Then, T would be the first k items, and sum_{i=k+1 to m} b_i - sum_{i=1 to m} a_i.

Wait, but S is not necessarily the top m by b_i; it can be any subset of size m.

But maybe focusing on the top m by b_i is sufficient.

Wait, perhaps I can sort all items by b_i in descending order and then consider prefix sums.

Let me try that.

Sort all items in descending order of b_i.

Let's say the sorted items are item1, item2, ..., itemn, with b_i decreasing.

Then, for a given m, if S is the first m items, then T is the first k items, and sum_{i=k+1 to m} b_i - sum_{i=1 to m} a_i.

I need to maximize this over m from k to n.

But is this always the optimal choice?

Wait, maybe not, because there might be items with very low a_i that are not in the top m by b_i, but including them could be beneficial.

Wait, for example, if an item has a very low a_i and a moderate b_i, even if it's not in the top m by b_i, including it could increase the sum of b_i - a_i for S - T.

But given that T is the top k by b_i in S, including such an item might push a higher b_i item out of S, which could be beneficial or not.

This seems complicated.

Maybe I need to consider a different approach.

Let me consider that for items in S - T, their contribution is b_i - a_i, and for items in T, their contribution is -a_i.

I need to maximize the sum of these contributions over all possible S.

This seems like a problem that can be approached using priority queues or some kind of heap data structure.

Wait, perhaps I can iterate through the items sorted by some criteria and decide whether to include them in S or not.

Let me think differently.

Let me consider that Alice can choose any subset S, and Bob will choose the k items with the highest b_i in S to take for free.

So, Alice's profit is sum_{i in S - T} b_i - sum_{i in S} a_i.

I can rewrite this as sum_{i in S} (b_i - a_i) - sum_{i in T} b_i.

I need to maximize this over all S, considering that T is the k items in S with the highest b_i.

This seems like a minimax problem.

Maybe I can find a way to select S such that the sum_{i in S} (b_i - a_i) is maximized, minus the sum of the top k b_i in S.

I need to maximize sum_{i in S} (b_i - a_i) - sum_{i in T} b_i.

Which is equal to sum_{i in S - T} (b_i - a_i) - sum_{i in T} a_i.

Wait, no:

sum_{i in S} (b_i - a_i) - sum_{i in T} b_i = sum_{i in S - T} b_i - sum_{i in S} a_i.

Yes, back to the same expression.

I need to find a way to compute this efficiently.

Let me consider that for a fixed S, the sum_{i in S - T} b_i is sum_{i in S} b_i - sum_{i in T} b_i.

So, Alice's profit is sum_{i in S} b_i - sum_{i in S} a_i - sum_{i in T} b_i = sum_{i in S} (b_i - a_i) - sum_{i in T} b_i.

I need to maximize this over all S.

This seems tricky, but maybe I can think about it in terms of choosing S to maximize sum_{i in S} (b_i - a_i) - sum_{i in top-k b_i in S} b_i.

Let me consider defining c_i = b_i - a_i.

Then, Alice's profit is sum_{i in S} c_i - sum_{i in T} b_i.

I need to maximize this over S.

This seems complicated.

Maybe I can consider different cases based on the size of S.

Case 1: |S| < k.

Then, T = S, and profit is -sum_{i in S} a_i.

Case 2: |S| >= k.

Profit is sum_{i in S - T} (b_i - a_i) - sum_{i in T} a_i.

Wait, let's see:

sum_{i in S - T} (b_i - a_i) - sum_{i in T} a_i = sum_{i in S - T} b_i - sum_{i in S} a_i.

Yes, same as before.

I need to find a way to maximize this.

Let me consider that for items in S - T, their contribution is b_i - a_i, and for items in T, their contribution is -a_i.

I need to select S to maximize the sum of these contributions.

This seems like a complex optimization problem.

Maybe I can consider the following approach:

- Sort the items in descending order of b_i.

- Consider including items one by one, keeping track of the sum of (b_i - a_i) for the items beyond k.

- Use a heap to manage the a_i values for the T set.

Wait, perhaps I can use a priority queue to keep track of the a_i values for the items in T.

Let me try to outline an algorithm:

1. Sort the items in descending order of b_i.

2. Initialize a min-heap to store the a_i values of the top k items by b_i.

3. Iterate through the sorted items:

a. Add the item to S.

b. If |S| > k, add the item's a_i to the heap.

c. If |S| == k, calculate the profit as -sum_{i in S} a_i.

d. If |S| > k, calculate the profit as sum_{i in S - T} b_i - sum_{i in S} a_i, where T is the k items with highest b_i in S.

e. Keep track of the maximum profit.

This seems too vague.

Let me think differently.

Let me consider that for any S with |S| >= k, the profit is sum_{i in S} (b_i - a_i) - sum_{i in T} b_i, where T is the k items in S with highest b_i.

I can rewrite this as sum_{i in S} (b_i - a_i) - sum_{i=1 to k} b_{(i)}, where b_{(i)} are the k highest b_i in S.

This is equivalent to sum_{i in S} (-a_i) - sum_{i=1 to k} b_{(i)}.

Wait, perhaps I can think of it as sum_{i in S} (-a_i) minus the sum of the k highest b_i in S.

I need to maximize this over S.

This seems tricky.

Maybe I can iterate over potential thresholds for the k-th highest b_i in S, and compute the sum accordingly.

But that sounds too slow for the given constraints.

Let me consider another angle.

Suppose I fix S, and T is the k items in S with highest b_i.

Then, Alice's profit is sum_{i in S - T} b_i - sum_{i in S} a_i.

I can rewrite this as sum_{i in S} (b_i - a_i) - sum_{i in T} b_i.

I need to maximize this over all possible S.

This seems difficult to optimize directly.

Maybe I can consider that for items with b_i - a_i >= 0, including them in S and ensuring they are not in T would be beneficial.

For items with b_i - a_i < 0, including them would decrease the profit unless they are in T, but being in T means Alice loses a_i, which is still bad.

So, perhaps Alice should only include items with b_i - a_i >= 0, and choose S such that the top k items by b_i in S have the smallest possible b_i.

Wait, that might not make sense.

Let me think differently.

Suppose I sort all items by b_i in descending order.

Then, for any m >= k, consider the first m items.

T would be the first k items, and sum_{i=k+1 to m} b_i - sum_{i=1 to m} a_i.

I can compute this for each m from k to n and find the maximum.

But is this always optimal?

Wait, maybe not, because there might be better combinations by excluding some high b_i items that have high a_i as well.

Let me consider an example.

Suppose n=3, k=1

a = [1, 2, 3]

b = [4, 3, 2]

So, sorted by b_i: item1 (b=4), item2 (b=3), item3 (b=2)

If m=1: S={item1}, T={item1}, profit = -a1 = -1

If m=2: S={item1, item2}, T={item1}, profit = b2 - (a1 + a2) = 3 - 3 = 0

If m=3: S={item1, item2, item3}, T={item1}, profit = b2 + b3 - (a1 + a2 + a3) = 3 + 2 - 6 = -1

So, the maximum profit is 0.

But, if Alice chooses S={item2, item3}, T={item2}, profit = b3 - (a2 + a3) = 2 - 5 = -3, which is worse than choosing m=2.

So, in this case, the earlier approach works.

Another example:

n=4, k=1

a = [1,2,1,4]

b = [3,3,2,3]

Sorted by b_i: items1,2,4 (b=3), item3 (b=2)

If m=1: S={item1}, T={item1}, profit = -a1 = -1

m=2: S={item1, item2}, T={item1}, profit = b2 - (a1 + a2) = 3 - 3 = 0

m=3: S={item1, item2, item4}, T={item1}, profit = b2 + b4 - (a1 + a2 + a4) = 3 + 3 - (1 + 2 + 4) = 6 - 7 = -1

m=4: S={item1, item2, item4, item3}, T={item1}, profit = b2 + b4 + b3 - (a1 + a2 + a4 + a3) = 3 + 3 + 2 - (1 + 2 + 4 + 1) = 8 - 8 = 0

But according to the note, choosing S={item1, item2, item3}, T={item1}, profit = (3 + 2) - (1 + 2 + 1) = 5 - 4 = 1.

Wait, in my earlier calculation, when m=3, I had S={item1, item2, item4}, T={item1}, profit = 3 + 3 - (1 + 2 + 4) = 6 - 7 = -1.

But in the note, S={item1, item2, item3}, T={item1}, profit = 3 + 2 - (1 + 2 + 1) = 5 - 4 = 1.

So, according to this, choosing S={item1, item2, item3} gives a better profit than S={item1, item2, item4}.

This suggests that simply taking the top m by b_i might not be optimal.

So, my earlier assumption is incorrect.

Therefore, I need a different approach.

Let me consider that Alice can choose any subset S, and Bob will choose the k items with the highest b_i in S to take for free.

Alice's profit is sum_{i in S - T} b_i - sum_{i in S} a_i.

I need to maximize this over all possible S.

This seems like a problem where I need to select S to maximize the profit, considering that Bob will choose the k items with the highest b_i in S to take for free.

One way to approach this is to consider the items sorted by some combination of a_i and b_i.

Wait, perhaps I can consider the items sorted by b_i - a_i in descending order.

But I'm not sure.

Let me consider defining c_i = b_i - a_i.

Then, Alice's profit is sum_{i in S - T} c_i - sum_{i in T} b_i.

This seems messy.

Maybe I can think in terms of selecting items where c_i >= 0.

Wait, perhaps I can consider that for items where c_i >= 0, including them in S and ensuring they are not in T would be beneficial.

But ensuring they are not in T means that their b_i should not be among the top k in S.

This is tricky.

Let me consider that for items with c_i >= 0, including them in S and having them not in T would give a positive contribution.

But if they are in T, their contribution is -a_i.

So, for items with c_i >= 0, Alice wants them not in T.

For items with c_i < 0, including them is generally bad, unless their a_i is very low.

Wait, for items with c_i < 0, including them in