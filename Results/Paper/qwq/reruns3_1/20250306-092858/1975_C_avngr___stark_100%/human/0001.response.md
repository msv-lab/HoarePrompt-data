Alright, I have this problem to solve. Let's see what it's about. So, Mocha has an array of positive integers, and she can perform this operation where she chooses two indices l and r, finds the median of the subarray from a_l to a_r, and then sets all elements in that subarray to that median. She does this until all elements in the array are the same, and I need to find the maximum possible value that can be achieved.

First, I need to understand what a median is in this context. The problem says that the median is the element at position floor((m+1)/2) after sorting the subarray in non-decreasing order. So, for a subarray of length m, sort it, and pick the element at that position.

Let's look at the examples to get a better understanding.

In the first test case:

n = 2

a = [1, 2]

If she chooses l=1, r=2, the subarray is [1,2]. Sorting gives [1,2], and the median is the element at position floor((2+1)/2) = 1, which is 1. So, she sets both elements to 1, resulting in [1,1]. That's the only operation she can do, so the final number is 1.

In the second test case:

n = 5

a = [1,2,3,4,5]

She can choose (l,r)=(4,5), subarray [4,5], sorted is [4,5], median is 4, so set both to 4: [1,2,3,4,4]

Then choose (l,r)=(3,5), subarray [3,4,4], sorted is [3,4,4], median is 4, set all to 4: [1,2,4,4,4]

Then choose (l,r)=(1,5), subarray [1,2,4,4,4], sorted is [1,2,4,4,4], median is 4, set all to 4: [4,4,4,4,4]

So, the final number is 4.

I need to find the maximum possible final number for any array given the operations.

Looking at the operations, I see that she can choose any subarray of length at least 2, find its median, and set all elements in that subarray to that median. She can do this multiple times until all elements are the same.

I need to think about what values can be achieved through these operations.

First, observe that the median of a subarray is always one of the elements in that subarray. So, when she sets all elements in the subarray to the median, she's essentially setting them to one of the existing values in that subarray.

My goal is to maximize the final uniform value of the array.

I need to find a strategy to apply these operations in such a way that the final uniform value is as large as possible.

Let me consider the possible values in the array. Since the median has to be one of the elements in the subarray, I need to see how I can propagate the larger values across the array.

Wait, but in the second example, she was able to set the entire array to 4, which is not the maximum value in the array (which is 5). So, it's possible that the maximum achievable uniform value is not necessarily the maximum value in the array.

Wait, but in that case, why didn't she reach 5? Maybe because she can't overwrite smaller values with larger ones in a single operation.

Let me think differently. Suppose I have an array with elements [1,2,3,4,5]. If I choose the entire array, sorted is [1,2,3,4,5], median is the third element, which is 3. So, setting all to 3. But that's lower than what was achieved in the example.

In the example, by choosing smaller subarrays first, she was able to increase some parts to 4 before setting the entire array to 4.

So, the order of operations matters.

This seems a bit tricky. I need to find a way to maximize the final value.

Let me consider that the final uniform value has to be present somewhere in the array initially, because the median has to be an existing element in the subarray.

Wait, but through operations, can I create new medians that weren't in the array initially? No, because the median is always one of the elements in the subarray, so it's always an original element of the array.

So, the final uniform value has to be one of the original elements in the array.

Given that, my task is to select the largest possible original element that can be spread to the entire array through a series of operations.

So, I need to identify which original elements can be propagated to the entire array.

I need to find the largest element that can be made uniform across the entire array.

How can I determine which elements can be made uniform?

Let's think about it.

Suppose I have an element x in the array. I want to see if I can make the entire array consist of x.

To do that, I need to be able to set all elements to x through a series of operations.

Each operation sets a subarray to the median of that subarray.

So, to set a subarray to x, the median of that subarray must be x.

Which means that x must be present in that subarray.

So, to set a subarray to x, x must be present in that subarray.

Therefore, to make the entire array x, I need to have x present in the array, and be able to spread it to all positions through operations.

I need to find the largest x in the array such that it can be spread to the entire array.

But how?

Let me consider that if x is present in the array, and I can choose subarrays that include x and set them to x, then gradually cover the entire array.

But I need to ensure that I can cover the entire array with such operations.

Wait, perhaps I can think in terms of connected components where elements are connected if they can be set to the same value through operations.

But I need a better strategy.

Let me consider sorting the array and seeing how the medians behave.

Wait, but the array doesn't have to be sorted; the operations can be applied to any subarrays.

Let me consider that each operation sets a subarray to its median.

I need to maximize the final uniform value.

Looking at the program provided, it seems to be trying to find the maximum median over all subarrays of length 3.

Wait, in the program:

def func():

t = int(input())

for _ in range(t):

n = int(input())

a = list(map(int, input().split()))

if n == 2:

print(min(a))

continue

max = 0

for i in range(n - 2):

temp = a[i:i + 3]

temp.sort()

if temp[1] > max:

max = temp[1]

print(max)



So, for each test case, it reads n and the array a.

If n == 2, it prints the minimum of a.

Otherwise, it initializes max to 0.

Then, for each subarray of length 3, it sorts it, takes the median (the second element after sorting), and keeps track of the maximum median among all such subarrays.

Finally, it prints this maximum median.

Is this correct?

Let's see.

In the first test case:

n = 2

a = [1,2]

It prints the minimum, which is 1.

In the second test case:

n = 5

a = [1,2,3,4,5]

It considers subarrays of length 3:

[1,2,3], sorted is [1,2,3], median is 2

[2,3,4], sorted is [2,3,4], median is 3

[3,4,5], sorted is [3,4,5], median is 4

So, the maximum median among these is 4, which matches the example output.

But is this always correct?

Wait, in the second test case, the final uniform value is 4, which is the maximum median among all subarrays of length 3.

Is this a general rule?

I need to verify if this is indeed the maximum possible uniform value.

In the example, they achieved 4, but could they have achieved higher?

Well, in that specific sequence of operations, they reached 4, and it's claimed that it's not possible to get higher than 4.

So, in this case, the program's output matches the correct answer.

But is this approach general?

Let me think about another example.

Suppose n=3, a=[1,2,5]

Subarrays of length 3:

[1,2,5], sorted is [1,2,5], median is 2

So, according to the program, the output would be 2.

But can I make the entire array 2?

Let's see:

- Choose (l,r)=(1,3), median is 2, set all to 2: [2,2,2]

Yes, achieved uniform 2.

Could I have achieved higher, like 5?

If I choose (l,r)=(2,3), subarray [2,5], sorted is [2,5], median is 2, set both to 2: [1,2,2]

Then choose (l,r)=(1,3), subarray [1,2,2], sorted is [1,2,2], median is 2, set all to 2: [2,2,2]

Again, can't get to 5.

So, in this case, 2 is the maximum achievable.

Another example:

n=4, a=[1,2,3,5]

Subarrays of length 3:

[1,2,3], median=2

[2,3,5], median=3

So, maximum median is 3.

Can I make the entire array 3?

- Choose (l,r)=(2,4), subarray [2,3,5], median=3, set all to 3: [1,3,3,3]

- Then choose (l,r)=(1,4), subarray [1,3,3,3], sorted is [1,3,3,3], median is 3, set all to 3: [3,3,3,3]

Yes, achieved uniform 3, which matches the program's output.

Can I achieve higher, like 5?

- Choose (l,r)=(3,4), subarray [3,5], median=3, set both to 3: [1,2,3,3]

- Choose (l,r)=(2,4), subarray [2,3,3], median=3, set all to 3: [1,3,3,3]

- Choose (l,r)=(1,4), subarray [1,3,3,3], median=3, set all to 3: [3,3,3,3]

Again, can't get to 5.

So, in this case, 3 is the maximum achievable.

Wait, but in the previous example with n=5 and a=[1,2,3,4,5], they achieved 4, which is the maximum median of subarrays of length 3.

Seems consistent.

But is this always the case?

Let me try another example.

n=4, a=[1,2,4,5]

Subarrays of length 3:

[1,2,4], median=2

[2,4,5], median=4

So, maximum median is 4.

Can I make the entire array 4?

- Choose (l,r)=(2,4), subarray [2,4,5], median=4, set all to 4: [1,4,4,4]

- Choose (l,r)=(1,4), subarray [1,4,4,4], sorted is [1,4,4,4], median is 4, set all to 4: [4,4,4,4]

Yes, achieved 4.

Could I achieve higher, like 5?

- Choose (l,r)=(3,4), subarray [4,5], median=4, set both to 4: [1,2,4,4]

- Choose (l,r)=(2,4), subarray [2,4,4], median=4, set all to 4: [1,4,4,4]

- Choose (l,r)=(1,4), subarray [1,4,4,4], median=4, set all to 4: [4,4,4,4]

Again, can't get to 5.

So, 4 is the maximum achievable.

Another example:

n=5, a=[1,3,3,3,5]

Subarrays of length 3:

[1,3,3], median=3

[3,3,3], median=3

[3,3,5], median=3

Maximum median is 3.

Can I make the entire array 3?

- Choose (l,r)=(1,3), subarray [1,3,3], median=3, set all to 3: [3,3,3,3,5]

- Choose (l,r)=(4,5), subarray [3,5], median=3, set both to 3: [3,3,3,3,3]

Yes, achieved 3.

Could I achieve higher, like 5?

- Choose (l,r)=(4,5), subarray [3,5], median=3, set both to 3: [1,3,3,3,3]

- Choose (l,r)=(1,5), subarray [1,3,3,3,3], sorted is [1,3,3,3,3], median is 3, set all to 3: [3,3,3,3,3]

Again, can't get to 5.

So, 3 is the maximum achievable.

Wait, but in this array, there are multiple 3's.

Is there a way to achieve higher if there are multiple instances of higher values?

Let me try another example.

n=4, a=[2,2,5,5]

Subarrays of length 3:

[2,2,5], median=2

[2,5,5], median=5

Maximum median is 5.

Can I make the entire array 5?

- Choose (l,r)=(2,4), subarray [2,5,5], median=5, set all to 5: [2,5,5,5]

- Choose (l,r)=(1,4), subarray [2,5,5,5], sorted is [2,5,5,5], median is 5, set all to 5: [5,5,5,5]

Yes, achieved 5.

So, in this case, the maximum median is 5, and I can achieve it.

Another example:

n=5, a=[1,2,5,5,5]

Subarrays of length 3:

[1,2,5], median=2

[2,5,5], median=5

[5,5,5], median=5

Maximum median is 5.

Can I make the entire array 5?

- Choose (l,r)=(2,5), subarray [2,5,5,5], median is 5, set all to 5: [1,5,5,5,5]

- Choose (l,r)=(1,5), subarray [1,5,5,5,5], sorted is [1,5,5,5,5], median is 5, set all to 5: [5,5,5,5,5]

Yes, achieved 5.

So, in this case, it works.

Another example:

n=3, a=[1,5,5]

Subarrays of length 3:

[1,5,5], median=5

So, maximum median is 5.

Can I make the entire array 5?

- Choose (l,r)=(1,3), subarray [1,5,5], median=5, set all to 5: [5,5,5]

Yes.

Seems consistent.

Wait, but what if the array has a single high value?

n=3, a=[1,2,5]

Subarrays of length 3:

[1,2,5], median=2

Maximum median is 2.

But in this array, there is a 5, but the maximum median is 2.

Can I make the entire array 5?

- Choose (l,r)=(2,3), subarray [2,5], median=2, set both to 2: [1,2,2]

- Choose (l,r)=(1,3), subarray [1,2,2], median=2, set all to 2: [2,2,2]

Can't get to 5.

So, in this case, the maximum achievable is 2, which matches the program's output.

Another example:

n=4, a=[1,3,5,7]

Subarrays of length 3:

[1,3,5], median=3

[3,5,7], median=5

Maximum median is 5.

Can I make the entire array 5?

- Choose (l,r)=(2,4), subarray [3,5,7], median=5, set all to 5: [1,5,5,5]

- Choose (l,r)=(1,4), subarray [1,5,5,5], sorted is [1,5,5,5], median is 5, set all to 5: [5,5,5,5]

Yes, achieved 5.

So, in this case, it works.

Another example:

n=5, a=[2,3,5,7,11]

Subarrays of length 3:

[2,3,5], median=3

[3,5,7], median=5

[5,7,11], median=7

Maximum median is 7.

Can I make the entire array 7?

- Choose (l,r)=(3,5), subarray [5,7,11], median=7, set all to 7: [2,3,7,7,7]

- Choose (l,r)=(2,4), subarray [3,7,7], median=7, set all to 7: [2,7,7,7,7]

- Choose (l,r)=(1,5), subarray [2,7,7,7,7], sorted is [2,7,7,7,7], median is 7, set all to 7: [7,7,7,7,7]

Yes, achieved 7.

Seems correct.

But is there a case where the maximum median of subarrays of length 3 is not the maximum achievable uniform value?

I need to find a counterexample.

Let me try:

n=4, a=[1,2,5,6]

Subarrays of length 3:

[1,2,5], median=2

[2,5,6], median=5

Maximum median is 5.

Can I make the entire array 5?

- Choose (l,r)=(2,4), subarray [2,5,6], median=5, set all to 5: [1,5,5,5]

- Choose (l,r)=(1,4), subarray [1,5,5,5], sorted is [1,5,5,5], median is 5, set all to 5: [5,5,5,5]

Yes, achieved 5.

Another example:

n=5, a=[1,3,5,6,7]

Subarrays of length 3:

[1,3,5], median=3

[3,5,6], median=5

[5,6,7], median=6

Maximum median is 6.

Can I make the entire array 6?

- Choose (l,r)=(3,5), subarray [5,6,7], median=6, set all to 6: [1,3,6,6,6]

- Choose (l,r)=(2,4), subarray [3,6,6], median=6, set all to 6: [1,6,6,6,6]

- Choose (l,r)=(1,5), subarray [1,6,6,6,6], sorted is [1,6,6,6,6], median is 6, set all to 6: [6,6,6,6,6]

Yes, achieved 6.

Still consistent.

Wait, maybe I need to think of an array where the maximum median of subarrays of length 3 is not the maximum achievable.

Let me try:

n=5, a=[1,2,4,5,5]

Subarrays of length 3:

[1,2,4], median=2

[2,4,5], median=4

[4,5,5], median=5

Maximum median is 5.

Can I make the entire array 5?

- Choose (l,r)=(3,5), subarray [4,5,5], median=5, set all to 5: [1,2,5,5,5]

- Choose (l,r)=(2,4), subarray [2,5,5], median=5, set all to 5: [1,5,5,5,5]

- Choose (l,r)=(1,5), subarray [1,5,5,5,5], sorted is [1,5,5,5,5], median is 5, set all to 5: [5,5,5,5,5]

Yes, achieved 5.

Another example:

n=4, a=[1,3,5,5]

Subarrays of length 3:

[1,3,5], median=3

[3,5,5], median=5

Maximum median is 5.

Can I make the entire array 5?

- Choose (l,r)=(2,4), subarray [3,5,5], median=5, set all to 5: [1,5,5,5]

- Choose (l,r)=(1,4), subarray [1,5,5,5], sorted is [1,5,5,5], median is 5, set all to 5: [5,5,5,5]

Yes.

Still consistent.

Wait, maybe I need to think of an array where the maximum achievable is higher than the maximum median of subarrays of length 3.

Is that possible?

Let me try:

n=5, a=[1,2,3,6,7]

Subarrays of length 3:

[1,2,3], median=2

[2,3,6], median=3

[3,6,7], median=6

Maximum median is 6.

Can I make the entire array 6?

- Choose (l,r)=(3,5), subarray [3,6,7], median=6, set all to 6: [1,2,6,6,6]

- Choose (l,r)=(2,4), subarray [2,6,6], median=6, set all to 6: [1,6,6,6,6]

- Choose (l,r)=(1,5), subarray [1,6,6,6,6], sorted is [1,6,6,6,6], median is 6, set all to 6: [6,6,6,6,6]

Yes, achieved 6.

Another example:

n=5, a=[1