Alright, I have this problem to solve. Let's see what it's about. There are n items in a shop, each with two prices: a_i for Alice to buy from the shop, and b_i for Bob to buy from Alice. Alice wants to choose a subset of items to buy, and then Bob will either take all of them for free if she buys less than k items, or take k items for free and pay for the rest.

Alice's profit is the amount Bob pays her minus the amount she spends buying the items. Alice wants to maximize this profit, while Bob wants to minimize it. I need to calculate Alice's profit when both act optimally.

First, I need to understand the rules clearly. If Alice buys fewer than k items, Bob takes all of them for free, so Alice's profit is negative the cost she incurred buying those items, since Bob doesn't pay her anything. If she buys k or more items, Bob takes k items for free and pays for the rest.

Wait, no: the problem says that if Alice buys less than k items, Bob can take all of them for free. But it doesn't specify what happens to the items Alice bought in that case. Does Alice still have to pay for the items even if Bob takes them for free? The profit would be negative the cost of the items in that case.

On the other hand, if Alice buys k or more items, Bob takes k items for free (the ones that are most beneficial for him), and pays for the remaining items at their b_i prices.

Alice's profit is the total Bob pays her minus the total she paid for the items.

So, if Alice buys a subset S of items, and if |S| < k, then Bob takes all of S for free, and Alice's profit is -sum_{i in S} a_i.

If |S| >= k, Bob chooses k items from S to take for free, and pays for the remaining |S| - k items at b_i each. So Alice's profit is sum_{i in S \ T} b_i - sum_{i in S} a_i, where T is the set of k items Bob takes for free.

Bob, wanting to minimize Alice's profit, will choose the k items to take for free in a way that minimizes Alice's profit. That means he will choose the k items from S that have the smallest b_i - a_i, because taking those for free reduces the amount Alice can get from selling the remaining items.

Wait, let's think carefully.

Alice's profit is sum_{i in S \ T} b_i - sum_{i in S} a_i, where T is the set of k items Bob takes for free.

This can be rewritten as sum_{i in S} (b_i - a_i) - sum_{i in T} b_i.

Alice wants this to be as large as possible, while Bob, in choosing T, wants to minimize it.

So, Bob will choose T to minimize sum_{i in T} b_i, because the smaller sum_{i in T} b_i is, the smaller Alice's profit is.

Wait, but Alice's profit is sum_{i in S \ T} b_i - sum_{i in S} a_i = sum_{i in S} (b_i - a_i) - sum_{i in T} b_i.

Since sum_{i in S} (b_i - a_i) is fixed for a given S, and Bob chooses T to minimize sum_{i in T} b_i, which minimizes Alice's profit.

Therefore, Bob will choose the k items with the smallest b_i to take for free.

So, for a given S, Alice's profit is sum_{i in S} (b_i - a_i) minus the sum of the smallest k b_i's in S.

But, Alice can choose S to maximize this profit.

Alternatively, if |S| < k, Alice's profit is -sum_{i in S} a_i.

So, overall, Alice needs to choose S such that:

- If |S| < k, profit is -sum_{i in S} a_i.

- If |S| >= k, profit is sum_{i in S} (b_i - a_i) - sum of the smallest k b_i's in S.

Alice wants to maximize this profit.

Bob, in turn, will choose T to minimize Alice's profit, which means choosing the k items with the smallest b_i if |S| >= k.

So, to find the optimal profit, we need to consider all possible subsets S and find the maximum profit Alice can achieve, considering Bob's minimizing action.

This seems complex, but maybe there's a smarter way to approach it.

Let me consider the following:

- For each item, there is a cost a_i for Alice and a revenue b_i from Bob.

- If Alice buys an item, she pays a_i and may get b_i back if Bob doesn't take it for free.

- Bob will take k items with the smallest b_i for free, if Alice buys at least k items.

So, for items that Alice buys and are not among the k items Bob takes for free, she gets b_i - a_i profit.

For items that Bob takes for free, she only loses a_i.

So, to maximize profit, Alice should select a subset S where the sum of (b_i - a_i) for the items not taken by Bob minus the sum of a_i for all items in S is maximized.

Given that Bob takes the k items with the smallest b_i in S for free, Alice needs to choose S such that the sum of (b_i - a_i) for S minus the sum of the smallest k b_i's in S is maximized.

This is equivalent to sum_{i in S} (b_i - a_i) - sum of the smallest k b_i's in S.

Wait, no: Alice's profit is sum_{i in S \ T} b_i - sum_{i in S} a_i, where T is the set of k items with smallest b_i in S.

So, profit = sum_{i in S} (b_i - a_i) - sum_{i in T} b_i.

This simplifies to sum_{i in S \ T} b_i - sum_{i in S} a_i.

Wait, let's double-check:

sum_{i in S \ T} b_i - sum_{i in S} a_i = sum_{i in S} (b_i - a_i) - sum_{i in T} b_i.

Yes, that's correct.

So, Alice's profit is sum_{i in S} (b_i - a_i) - sum_{i in T} b_i.

To maximize this, Alice needs to choose S such that this expression is maximized, given that Bob chooses T as the k items in S with the smallest b_i.

So, effectively, Alice's profit is sum_{i in S} (b_i - a_i) - sum of the smallest k b_i's in S.

Alice needs to choose S to maximize this.

Alternatively, this can be seen as sum_{i in S \ T} (b_i - a_i) - sum_{i in T} a_i.

Wait, let's see:

sum_{i in S} (b_i - a_i) - sum_{i in T} b_i = sum_{i in S \ T} (b_i - a_i) + sum_{i in T} (b_i - a_i) - sum_{i in T} b_i = sum_{i in S \ T} (b_i - a_i) - sum_{i in T} a_i.

Yes, that's correct.

So, Alice's profit is sum_{i in S \ T} (b_i - a_i) - sum_{i in T} a_i.

This seems a bit messy. Maybe there's a better way to approach this.

Let me consider the following approach:

- Sort the items based on some criterion.

- Select a subset S of items, and decide whether to buy them or not.

- Consider the cases where |S| < k and |S| >= k separately.

But this might not be efficient, especially since n can be up to 2*10^5 per test case, and t can be up to 10^4, with the sum of n over all test cases not exceeding 2*10^5.

So, I need an efficient solution, probably O(n log n) per test case.

Let me think about the decision for each item.

For each item, Alice can choose to buy it or not.

If she buys it, she pays a_i and may or may not get b_i back, depending on whether Bob takes it for free or not.

If Alice buys fewer than k items, Bob takes all of them for free, so Alice's profit is -sum of a_i for the items she buys.

If Alice buys k or more items, Bob takes k items with the smallest b_i for free, and Alice gets b_i - a_i for the remaining items.

So, for items with b_i - a_i > 0, Alice probably wants to include them, as they contribute positively to her profit.

But, if she includes too many such items, Bob might take some of them for free, reducing her profit.

Wait, let's think differently.

Suppose Alice selects a subset S of size m.

If m < k, her profit is -sum_{i in S} a_i.

If m >= k, her profit is sum_{i in S \ T} (b_i - a_i) - sum_{i in T} a_i, where T is the set of k items in S with the smallest b_i.

This seems complicated to maximize directly.

Maybe I can transform the problem.

Let me consider that Alice's profit can be expressed in terms of the items she chooses to buy and the items Bob takes for free.

I need to find a way to optimize this profit.

An alternative approach is to consider the items in decreasing order of b_i - a_i.

But I need to account for Bob taking the k items with the smallest b_i.

This is getting tricky.

Let me try to think of small examples to get some intuition.

Take the first example in the problem:

n=2, k=0

a=[2,1]

b=[1,2]

If k=0, Bob takes no items for free.

So, if Alice buys both items, she pays 2+1=3, and Bob pays for both items: 1+2=3, so profit is 3-3=0.

If she buys only the first item, pays 2, Bob takes it for free, profit is -2.

If she buys only the second item, pays 1, Bob takes it for free, profit is -1.

So, the maximum profit is 0.

But according to the problem's example output, it's 1.

Wait, in the problem's example input, it's:

4 test cases:

2 0

2 1

1 2

Output for this is 1.

Wait, maybe I miscalculated.

Wait, input is:

t=4

First test case:

n=2, k=0

a=[2,1]

b=[1,2]

If k=0, Bob takes no items for free.

So, if Alice buys both items, pays 2+1=3, Bob pays 1+2=3, profit 3-3=0.

If she buys only first item, pays 2, Bob takes it for free, profit -2.

If she buys only second item, pays 1, Bob takes it for free, profit -1.

So, the maximum profit is 0, but the sample output is 1.

Wait, perhaps I misunderstood the problem.

Wait, in the problem statement, it says:

if Alice bought less than k items, Bob can take all of them for free;

otherwise, he will take k items for free that Alice bought (Bob chooses which k items it will be), and for the rest of the chosen items, Bob will buy them from Alice and pay b_i for the i-th item.

Alice's profit is sum_{i in S} b_i - sum_{j in T} a_j, where S is the set of items Bob buys from Alice, and T is the set of items Alice buys from the shop.

Wait, in the first test case, n=2, k=0.

If Alice buys both items, pays a1 + a2 = 3, Bob takes nothing for free (k=0), so Bob buys both items from Alice, paying b1 + b2 = 3, so profit is 3 - 3 = 0.

If Alice buys only one item, say item 1, pays a1=2, Bob takes it for free, so S is empty, profit is 0 - 2 = -2.

Similarly, if she buys only item 2, pays a2=1, Bob takes it for free, profit is 0 - 1 = -1.

So, the maximum profit is 0, but the sample output is 1.

Wait, perhaps I misread the problem.

Wait, looking back at the problem statement:

Alice wants to choose a subset (possibly empty) of items and buy them.

After that, Bob does the following:

- if Alice bought less than k items, Bob can take all of them for free;

- otherwise, he will take k items for free that Alice bought (Bob chooses which k items it will be), and for the rest of the chosen items, Bob will buy them from Alice and pay b_i for the i-th item.

Alice's profit is sum_{i in S} b_i - sum_{j in T} a_j, where S is the set of items Bob buys from Alice, and T is the set of items Alice buys from the shop.

Wait, in the first test case, if Alice buys both items, since k=0, Bob takes no items for free, so S={1,2}, T={1,2}, profit is b1 + b2 - a1 - a2 = 1 + 2 - 2 - 1 = 0.

If Alice buys only item 2, pays a2=1, Bob takes it for free (since she bought less than k=0 items, which is impossible since buying less than 0 items doesn't make sense. Wait, k=0, so if she buys less than 0 items, which is impossible, so perhaps the condition is only applicable when k > 0.

Wait, in the first test case, k=0, so Bob takes no items for free, and buys all the items Alice bought.

So, in the first test case, the maximum profit should indeed be 0, but the sample output is 1.

Wait, perhaps there's a mistake in the problem statement or the sample input/output.

Alternatively, maybe I'm misinterpreting the problem.

Wait, perhaps when k=0, Bob takes no items for free, so S is all items Alice bought, and T is all items Alice bought.

So, profit is sum_{i in S} b_i - sum_{j in T} a_j = sum_{i in S} (b_i - a_i).

In the first test case, if S={1,2}, profit is (1-2) + (2-1) = -1 + 1 = 0.

If S={2}, profit is (2-1) = 1.

If S={1}, profit is (1-2) = -1.

If S=empty, profit is 0 - 0 = 0.

So, the maximum profit is 1, achieved by buying only item 2.

Wait, now I see: when k=0, Bob takes no items for free, so S is all items Alice bought.

Therefore, profit is sum_{i in S} b_i - sum_{j in S} a_j = sum_{i in S} (b_i - a_i).

So, in the first test case:

- If S={1,2}, profit = (1-2) + (2-1) = 0.

- If S={1}, profit = (1-2) = -1.

- If S={2}, profit = (2-1) = 1.

- If S=empty, profit = 0.

Hence, the maximum profit is 1, achieved by buying only item 2.

I see, so my earlier misunderstanding was about what S is when k=0.

Now, generalizing this:

- When k=0, Bob takes no items for free, so S = T = the items Alice bought, and profit is sum_{i in S} (b_i - a_i).

- When k >= 1, if |S| < k, Bob takes all items in S for free, so S is empty, and profit is -sum_{j in T} a_j = -sum_{j in S} a_j.

- When |S| >= k, Bob takes k items with the smallest b_i in S for free, so S \ T is the remaining |S| - k items, and profit is sum_{i in S \ T} b_i - sum_{j in T} a_j.

This is getting complicated.

I need to find a way to compute the maximum profit over all possible subsets S.

This seems too slow for n up to 2e5 per test case.

I need a smarter approach.

Let me consider the following:

- For k=0, it's straightforward: choose the subset S that maximizes sum_{i in S} (b_i - a_i).

- For k >= 1, it's more involved.

Wait, perhaps I can handle k >=1 similarly, by selecting a subset S of size at least k, choosing the k items with smallest b_i to be in T, and then sum_{i in S \ T} (b_i - a_i) - sum_{j in T} a_j.

But this is still not straightforward to optimize.

An alternative approach is to consider the items in a certain order.

Let me try to sort the items based on some criterion.

Suppose I sort the items in decreasing order of b_i - a_i.

Then, for k >=1, I can select the top m items, and choose the k items with smallest b_i among them for T.

Wait, perhaps it's better to sort by b_i.

Let me try to sort the items in decreasing order of b_i.

Then, for a given S, the items in T would be the ones with the smallest b_i in S.

But since S is a subset chosen by Alice, and she can choose any subset, I need a way to select S to maximize the profit.

Wait, maybe I can iterate over the possible sizes of S.

Let me fix |S| = m, where m >= k.

Then, I need to choose the m items with the highest (b_i - a_i), and among those, choose the k items with smallest b_i for T.

Wait, no: I need to choose m items, and then Bob chooses the k items with smallest b_i in those m items for T.

Alice wants to maximize the profit, which is sum_{i in S \ T} (b_i - a_i) - sum_{j in T} a_j.

This seems tricky.

Perhaps I can consider the items sorted by b_i in ascending order.

Let me try to sort the items by b_i ascending.

Then, for a given S, the first k items in S (the ones with smallest b_i) would be T.

Wait, not necessarily, because Bob chooses which k items to take for free, but probably it's optimal for him to choose the k items with smallest b_i.

So, if Alice chooses S, Bob will select the k items in S with smallest b_i as T.

Alice wants to maximize the profit, which depends on S and T.

So, perhaps Alice should choose S such that the sum of (b_i - a_i) for S minus the sum of the smallest k b_i's in S is maximized.

This sounds similar to selecting a subset where the sum of (b_i - a_i) is maximized, minus the sum of the k smallest b_i's in S.

This is equivalent to selecting S where sum_{i in S \ T} (b_i - a_i) - sum_{j in T} a_j is maximized.

This is getting too convoluted.

Maybe I need to consider the difference between b_i and a_i more carefully.

Wait, perhaps I can look at the items where b_i > a_i, meaning that if Bob buys them and Alice sold them, she makes a profit on that item.

Similarly, if b_i <= a_i, selling those items would not be beneficial for Alice.

Wait, but in reality, even if b_i <= a_i, Alice might still want to include them in S if it helps in making overall profit higher.

Wait, no: if b_i <= a_i, including such an item in S would generally decrease Alice's profit, unless it affects the selection of T in a beneficial way.

This is getting too complicated.

I need a better approach.

Let me consider the following idea:

- For a given S with |S| >= k, Alice's profit is sum_{i in S} (b_i - a_i) - sum_{j in T} b_j, where T is the set of k items in S with smallest b_j.

This can be rewritten as sum_{i in S \ T} b_i - sum_{j in S} a_j.

I need to maximize this over all possible S.

This seems difficult, but perhaps I can iterate through possible S and keep track of the required sums.

But with n up to 2e5, I need an efficient way.

An alternative idea is to sort the items in S in decreasing order of b_i, and then select the top (m - k) items for S \ T, and the next k items for T.

Wait, if I sort the items in S in decreasing order of b_i, then S \ T would be the first (m - k) items, and T would be the next k items.

Then, sum_{i in S \ T} (b_i - a_i) - sum_{j in T} a_j = sum_{i in top (m - k)} (b_i - a_i) - sum_{j in next k} a_j.

But this seems too vague.

Let me think differently.

Suppose I sort all items in decreasing order of b_i.

Then, for a subset S consisting of the top m items, the T would be the k items in S with smallest b_i, which would be the last k items in the sorted S.

Then, sum_{i in S \ T} (b_i - a_i) - sum_{j in T} a_j = sum_{i=1}^{m - k} (b_i - a_i) + sum_{i=m - k + 1}^{m} (-a_i).

Wait, this seems promising.

Let me denote the items sorted in decreasing order of b_i as item1, item2, ..., itemn.

Then, for a subset S consisting of the top m items, T would be the last k items in this sorted list (the ones with smallest b_i in S).

Then, profit = sum_{i=1}^{m - k} (b_i - a_i) + sum_{i=m - k + 1}^{m} (-a_i).

Simplify this:

sum_{i=1}^{m - k} b_i - sum_{i=1}^{m - k} a_i - sum_{i=m - k + 1}^{m} a_i = sum_{i=1}^{m - k} b_i - sum_{i=1}^{m} a_i.

So, profit = sum_{i=1}^{m - k} b_i - sum_{i=1}^{m} a_i.

Now, to maximize this, for a given m, I need to choose the top m items in terms of b_i.

Wait, but m needs to be at least k.

So, for m >= k, profit = sum_{i=1}^{m - k} b_i - sum_{i=1}^{m} a_i.

Additionally, for m < k, profit = -