Alright, I've got this problem to solve. Let's see what it's asking for.

So, Kirill wants to pick mushrooms under the Wise Oak to make an elixir. Each mushroom has a magic power, and he can pick them in any order. The strength of the elixir is the product of the number of mushrooms he picks and the minimum magic power among those mushrooms. That makes sense. So, if he picks k mushrooms, the strength is k times the smallest magic power among those k mushrooms.

But there's a catch. There's a permutation p of numbers from 1 to n, and if he picks k mushrooms, the magic power of the mushrooms with indices p_1 through p_{k-1} becomes zero. And he can't use mushrooms with zero magic power in his elixir.

So, I need to help Kirill figure out which mushrooms to pick to maximize the elixir's strength, and among all the options that give the maximum strength, choose the one with the minimum number of mushrooms.

First, I need to understand the permutation p. It's a sequence of indices from 1 to n, and it determines which mushrooms lose their magic power based on how many mushrooms Kirill picks.

Let's consider an example to get a better grasp.

Suppose n=3, v=[9,8,14], and p=[3,2,1].

If Kirill picks 1 mushroom, then the mushrooms with indices p_1=3 have their magic power set to zero. So, mushroom 3's magic power becomes zero, and he can only use mushrooms 1 and 2, with magic powers 9 and 8. The minimum among them is 8, and since he's picking 1 mushroom, but he can't use mushroom 3, so maybe he picks one of the remaining two.

Wait, but the problem says that he picks k mushrooms, and the magic power of p_1 through p_{k-1} becomes zero. So, if he picks k=1 mushroom, only p_1=3's magic power becomes zero. So, he can pick either mushroom 1 or 2, since mushroom 3's magic power is zero.

But actually, according to the problem, he picks k mushrooms, but the magic power of p_1 to p_{k-1} becomes zero. So, for k=1, p_1=3's magic power becomes zero, and he can pick one mushroom from the remaining two, which are mushrooms 1 and 2, with magic powers 9 and 8.

So, the elixir's strength would be 1 * min(9,8), which is 8.

If he picks k=2 mushrooms, then p_1=3 and p_2=2's magic powers become zero. So, mushrooms 3 and 2 have zero magic power, and he can only use mushroom 1 with magic power 9. So, elixir's strength is 2 * 9 = 18.

If he picks k=3 mushrooms, then p_1=3, p_2=2, p_3=1's magic powers become zero, so all mushrooms have zero magic power, and he can't use any mushrooms, so elixir's strength is 0.

So, the maximum strength is 18 with k=2.

But according to the sample input, for this case, the output is 16 with k=2. Wait, maybe I miscalculated.

Let me check again.

If k=2, p_1=3 and p_2=2 have their magic power set to zero. So, mushrooms 3 and 2 have zero magic power, and he can only use mushroom 1 with magic power 9. So, elixir's strength is 2 * 9 = 18.

But the sample output is 16, which corresponds to k=2 and min(9,8)=8, so 2*8=16. Wait, maybe I misunderstood which mushrooms he picks.

Wait, perhaps when he picks k mushrooms, the magic power of p_1 to p_{k-1} becomes zero, but he can pick any k mushrooms, but the magic power of p_1 to p_{k-1} is set to zero, and he can't use those in his elixir.

So, in the sample input, n=3, v=[9,8,14], p=[3,2,1].

If k=2, p_1=3 and p_2=2 have their magic power set to zero, so mushrooms 3 and 2 have zero magic power. He can pick any 2 mushrooms, but can only use those with non-zero magic power.

So, if he picks mushrooms 1 and 2, but mushroom 2 has zero magic power, so only mushroom 1 with magic power 9 is used, so strength is 2 * 9 = 18.

But sample output is 16, which is 2 * 8 = 16. So, perhaps he picks mushrooms 1 and 3, but mushroom 3 has zero magic power, so only mushroom 1 is used, same as above.

Wait, maybe I'm misunderstanding the problem.

Let me read the problem again carefully.

"The magic power of all mushrooms with indices p_1 through p_{k-1} becomes zero. Kirill will not use mushrooms with zero magic power to prepare the elixir."

So, when he picks k mushrooms, the mushrooms with indices p_1 through p_{k-1} have their magic power set to zero, and he can't use those in his elixir.

So, the k mushrooms he picks can include some of the p_1 to p_{k-1}, but those will have zero magic power and can't be used.

So, to maximize the elixir's strength, which is k times the minimum magic power among the k picked mushrooms that still have non-zero magic power.

Wait, perhaps I need to think differently.

Let me consider that when he picks k mushrooms, the first k-1 mushrooms in the permutation p have their magic power set to zero, and he can't use those in his elixir.

But actually, it's the mushrooms with indices p_1 to p_{k-1} that have their magic power set to zero, regardless of which mushrooms he picks.

So, when he picks k mushrooms, the first k-1 positions in the permutation p have their magic power set to zero, and he can't use those in his elixir.

Wait, no, it's the mushrooms with indices p_1 to p_{k-1} that have their magic power set to zero.

So, p is a permutation of indices from 1 to n.

So, p_1 is the first index, p_2 is the second, and so on.

When he picks k mushrooms, the mushrooms with indices p_1 to p_{k-1} have their magic power set to zero.

Then, he can pick any k mushrooms, but the ones with indices in p_1 to p_{k-1} have zero magic power and can't be used.

Wait, no, he can pick any k mushrooms, but the mushrooms with indices in p_1 to p_{k-1} have their magic power set to zero, and he can't use those in his elixir.

So, among the k mushrooms he picks, any that have indices in p_1 to p_{k-1} have zero magic power and can't be used.

So, the elixir's strength is k times the minimum magic power among the k picked mushrooms that do not have their magic power set to zero.

Wait, this is getting confusing.

Maybe I should think in terms of which mushrooms are available.

When he picks k mushrooms, the mushrooms with indices p_1 to p_{k-1} have their magic power set to zero.

So, the mushrooms that have their magic power set to zero are p_1 to p_{k-1}.

Then, among the k mushrooms he picks, if any of them are in p_1 to p_{k-1}, their magic power is zero and can't be used.

So, to maximize the elixir's strength, which is k times the minimum magic power among the k picked mushrooms that still have non-zero magic power.

I think another way to look at it is that, when he picks k mushrooms, the first k-1 mushrooms in the permutation p have their magic power set to zero, and he can't use those.

So, the mushrooms that have their magic power set to zero are the first k-1 mushrooms in the permutation p.

Then, among the k mushrooms he picks, if any of them are among the first k-1 in p, their magic power is zero and can't be used.

So, to maximize the elixir's strength, he should pick k mushrooms such that as few as possible of them are among the first k-1 in p.

Wait, actually, he can pick any k mushrooms, but the first k-1 in p have their magic power set to zero.

So, the mushrooms with indices in p_1 to p_{k-1} have their magic power set to zero.

Then, among the k mushrooms he picks, if any of them are in p_1 to p_{k-1}, their magic power is zero and can't be used.

So, to maximize the elixir's strength, which is k times the minimum magic power among the k picked mushrooms that still have non-zero magic power, he should pick k mushrooms such that as few as possible of them are in p_1 to p_{k-1}.

Ideally, he would pick k mushrooms where none of them are in p_1 to p_{k-1}, but that might not be possible if k is larger than n - (k - 1), which simplifies to k <= (n + 1)/2.

Wait, maybe I need to think in terms of choosing k mushrooms where none of them are in p_1 to p_{k-1}.

But that might not be possible, depending on k and p.

Alternatively, perhaps it's better to consider that the mushrooms with indices p_1 to p_{k-1} have their magic power set to zero, and he can pick any k mushrooms, but can only use those that are not in p_1 to p_{k-1}.

So, the elixir's strength is k times the minimum magic power among the mushrooms he picks that are not in p_1 to p_{k-1}.

Wait, perhaps I need to think about it differently.

Let me consider that when he picks k mushrooms, the mushrooms with indices p_1 to p_{k-1} have their magic power set to zero, and he can only use the mushrooms among the k he picks that are not in p_1 to p_{k-1}.

So, the number of mushrooms he can actually use is k minus the number of mushrooms in p_1 to p_{k-1} that he picks.

Wait, but it's more precise to say that among the k mushrooms he picks, any that are in p_1 to p_{k-1} have their magic power set to zero and can't be used.

So, the number of mushrooms he can use is k minus the number of picked mushrooms that are in p_1 to p_{k-1}.

And the minimum magic power among the usable mushrooms is the minimum magic power among the picked mushrooms that are not in p_1 to p_{k-1}.

This seems complicated.

Maybe I should look for a different approach.

Let me consider that the permutation p defines an ordering in which mushrooms lose their magic power as k increases.

So, as k increases from 1 to n, p_1 to p_k-1 have their magic power set to zero.

So, for each k, I need to consider which mushrooms are available, i.e., which mushrooms are not in p_1 to p_{k-1}.

Wait, that seems promising.

For each possible k, from 1 to n, I can determine which mushrooms have their magic power set to zero, which are p_1 to p_{k-1}, and then choose k mushrooms such that as many as possible are not in p_1 to p_{k-1}, and among those, choose the ones with the highest possible minimum magic power.

But since he can pick any k mushrooms, but some of them might have their magic power set to zero, I need to maximize k times the minimum magic power among the mushrooms he picks that are not in p_1 to p_{k-1}.

This seems tricky.

Maybe I can think about sorting the mushrooms in decreasing order of magic power and then trying to pick the highest magic power mushrooms while minimizing the impact of the mushrooms whose magic power is set to zero.

Wait, perhaps I can consider the following approach:

- Sort the mushrooms in decreasing order of magic power.

- Then, for each possible k, from 1 to n, calculate the strength as k times the k-th mushroom's magic power, but considering that some mushrooms have their magic power set to zero.

But I need to account for the fact that when he picks k mushrooms, the first k-1 mushrooms in the permutation p have their magic power set to zero.

Wait, perhaps I can map the permutation p to the order in which mushrooms lose their magic power.

So, as k increases from 1 to n, the mushrooms p_1 to p_{k-1} have their magic power set to zero.

So, for each k, the mushrooms p_1 to p_{k-1} have zero magic power.

Then, when he picks k mushrooms, he can only use the ones among the k he picks that are not in p_1 to p_{k-1}.

Wait, perhaps I can think in terms of choosing k mushrooms and ensuring that as few as possible are in p_1 to p_{k-1}.

But this seems too vague.

Let me consider the following approach:

- For each possible k from 1 to n, determine which mushrooms have their magic power set to zero (p_1 to p_{k-1}).

- Then, among the remaining mushrooms (those not in p_1 to p_{k-1}), select the k mushrooms with the highest magic power.

- The elixir's strength would be k times the smallest magic power among these k mushrooms.

Wait, but he might pick fewer than k mushrooms that are not in p_1 to p_{k-1}.

Wait, no, he picks exactly k mushrooms, but only those among them that are not in p_1 to p_{k-1} can be used.

So, to maximize the elixir's strength, he needs to maximize k times the smallest magic power among the mushrooms he picks that are not in p_1 to p_{k-1}.

This seems complicated.

Maybe I need to consider that for each k, the number of mushrooms he can actually use is k minus the number of picked mushrooms that are in p_1 to p_{k-1}.

But this seems too vague.

Let me try to think differently.

Suppose I sort the mushrooms in decreasing order of their magic power.

Let's say I have the sorted list of mushrooms: s_1 >= s_2 >= ... >= s_n.

Now, for each k from 1 to n, I can consider that the elixir's strength is k * s_k.

But in this problem, some mushrooms have their magic power set to zero based on the permutation p.

So, I need to adjust for that.

Wait, perhaps I can consider that for each k, the minimum magic power among the k picked mushrooms that are not in p_1 to p_{k-1} is at least s_m, where m is the number of mushrooms not in p_1 to p_{k-1}.

But I'm getting lost here.

Let me consider another approach.

Let me consider that for each k, the mushrooms with indices in p_1 to p_{k-1} have their magic power set to zero.

So, the available mushrooms are those not in p_1 to p_{k-1}.

Then, Kirill needs to pick k mushrooms, but only the ones that are available (not in p_1 to p_{k-1}) can be used in the elixir.

So, to maximize the elixir's strength, which is k times the minimum magic power among the picked and available mushrooms, he should pick the k mushrooms with the highest magic powers among the available ones.

Wait, but he has to pick exactly k mushrooms, but only the ones that are available are considered.

So, for each k, I need to find the k-th highest magic power among the available mushrooms (those not in p_1 to p_{k-1}), and then the elixir's strength is k times that magic power.

Wait, that seems promising.

So, for each k from 1 to n:

- Identify the available mushrooms: those not in p_1 to p_{k-1}.

- Find the k-th highest magic power among the available mushrooms.

- Compute the elixir's strength as k * that magic power.

- Choose the k that maximizes this strength, and among those, choose the smallest k.

So, to implement this, I need an efficient way to find, for each k, the k-th highest magic power among the available mushrooms, where available mushrooms are those not in p_1 to p_{k-1}.

This seems manageable.

Let me think about how to implement this efficiently, especially considering that n can be up to 200,000 and t up to 10,000, with the sum of n over all test cases up to 2*10^5.

So, I need an efficient way to handle this.

First, I can sort the magic powers in decreasing order.

Let's say I have a sorted list of magic powers: s_1 >= s_2 >= ... >= s_n.

Now, for each k from 1 to n, the k-th highest magic power among all mushrooms is s_k.

But in this problem, for each k, some mushrooms have their magic power set to zero, specifically those in p_1 to p_{k-1}.

So, for each k, the available mushrooms are those not in p_1 to p_{k-1}.

I need to find the k-th highest magic power among the available mushrooms.

Wait, but if I sort the magic powers in decreasing order, and I have p_1 to p_{k-1} having their magic power set to zero, then I need to exclude those mushrooms from the sorted list.

But this seems tricky because the permutation p defines the order in which mushrooms lose their magic power.

Wait, perhaps I can think in terms of the position of the mushrooms in the sorted list.

Let me consider that for each k, the mushrooms in p_1 to p_{k-1} have their magic power set to zero, so they are effectively removed from the available mushrooms.

Then, the available mushrooms are those not in p_1 to p_{k-1}.

So, for each k, I need to find the k-th largest magic power among the mushrooms not in p_1 to p_{k-1}.

This is equivalent to finding the k-th largest magic power in the set difference of all mushrooms and p_1 to p_{k-1}.

This seems computationally expensive if done naively for each k.

I need a smarter way to handle this.

Let me consider that as k increases, the set of mushrooms with zero magic power increases (p_1 to p_{k-1}).

So, for k=1, only p_1 has its magic power set to zero.

For k=2, p_1 and p_2 have their magic power set to zero, and so on.

So, for each k, the set of mushrooms with zero magic power is p_1 to p_{k-1}.

Therefore, the available mushrooms are those not in p_1 to p_{k-1}.

So, for k=1, available mushrooms are all except p_1.

For k=2, available mushrooms are all except p_1 and p_2.

And so on.

Now, for each k, I need to pick k mushrooms from the available ones, and the elixir's strength is k times the smallest magic power among the k picked mushrooms.

To maximize this, I need to pick the k mushrooms with the highest magic powers among the available ones.

Then, the smallest among these k mushrooms will be the k-th highest magic power among the available mushrooms.

So, for each k, I need to find the k-th highest magic power among the available mushrooms, and then compute k times that value.

Then, among all these possible strengths for k from 1 to n, I need to find the maximum strength, and among those, the smallest k.

So, the task reduces to, for each k from 1 to n, finding the k-th highest magic power among the mushrooms not in p_1 to p_{k-1}, and then computing k times that value, and selecting the maximum such value, and among those, the smallest k.

This seems manageable.

Now, to implement this efficiently, especially given the constraints, I need a way to quickly find, for each k, the k-th highest magic power among the mushrooms not in p_1 to p_{k-1}.

One way to do this is to maintain a data structure that allows me to efficiently remove elements and find the k-th largest element.

Given that n can be up to 2*10^5 and t up to 10^4, with the sum of n over all test cases up to 2*10^5, I need an efficient way to handle this.

I recall that there are data structures like sorted multisets that allow for efficient insertion, deletion, and finding the k-th element.

In Python, the bisect module can be used with lists to maintain sorted lists, but for multisets, I might need to use a custom implementation or a library like sortedcontainers.

But since we're dealing with large n, I need an efficient way to handle this.

Looking at the given code, it seems to implement a custom SortedMultiset using buckets to achieve O(âˆšN) operations, which might be acceptable given the time constraints.

So, perhaps I can proceed with that.

Let me outline the steps:

1. For each test case:

a. Read n, read the list v of magic powers, read the permutation p.

b. Initialize a sorted multiset with the magic powers in decreasing order.

c. For each k from 1 to n:

i. Set the magic powers of p_1 to p_{k-1} to zero, which effectively removes them from the available mushrooms.

ii. Find the k-th largest magic power among the remaining mushrooms.

iii. Compute the elixir's strength as k times that magic power.

iv. Keep track of the maximum strength found and the corresponding k.

d. Output the maximum strength and the smallest k that achieves it.

But removing elements one by one would be too slow for n up to 2*10^5.

I need a smarter way.

Wait, perhaps I can precompute the available mushrooms for each k.

Since p is a permutation, p_1 to p_{k-1} are the mushrooms with zero magic power when picking k mushrooms.

So, for each k, the available mushrooms are those not in p_1 to p_{k-1}.

So, I can sort the magic powers in decreasing order and keep track of the available mushrooms.

Wait, perhaps I can sort the magic powers in decreasing order and map them to their positions in p.

Then, for each k, I can find the k-th mushroom in the sorted list that is not in p_1 to p_{k-1}.

This might be manageable.

Alternatively, perhaps I can sort the magic powers in decreasing order and, for each position in p, keep track of when the mushroom becomes unavailable.

This seems complicated.

Let me consider another approach.

Suppose I sort the magic powers in decreasing order: s_1 >= s_2 >= ... >= s_n.

Then, for each k from 1 to n, the k-th highest magic power among the available mushrooms is s_m, where m is the number of mushrooms in the first k positions of the sorted list that are not in p_1 to p_{k-1}.

Wait, perhaps I need to find, for each k, the smallest m such that m >= k and s_m is available (not in p_1 to p_{k-1}).

This seems too vague.

Let me try to think differently.

Let me consider that for each k, the available mushrooms are those not in p_1 to p_{k-1}.

So, I can sort the available mushrooms in decreasing order and pick the top k to maximize the minimum magic power.

Wait, but I need to find the k-th highest magic power among the available mushrooms.

So, perhaps I can sort the magic powers in decreasing order and, for each k, find the smallest s_m such that m >= the number of available mushrooms up to that point.

This is getting too convoluted.

Let me consider the following plan:

- Create a list of magic powers sorted in decreasing order: s_1 >= s_2 >= ... >= s_n.

- For each k from 1 to n:

- Determine how many of the top k magic powers are not in p_1 to p_{k-1}.

- If the number of available top k magic powers is at least k, then the k-th highest available magic power is s_k.

- Otherwise, need to find the correct s_m that corresponds to the k-th highest available magic power.

This still seems messy.

Maybe I need to think in terms of the position of each mushroom in both the sorted list and the permutation p.

Let me assign each mushroom an index from 1 to n.

Each mushroom has a magic power v_i and a position in p, say pos_i = position of i in p.

So, pos_i is the step at which mushroom i's magic power is set to zero.

So, for k >= pos_i, mushroom i has its magic power set to zero.

Therefore, for each k, mushrooms with pos_i <= k-1 have their magic power set to zero.

So, available mushrooms are those with pos_i > k-1.

So, for each k, available mushrooms are those with pos_i > k-1.

Now, I need to pick k mushrooms, but only the ones with pos_i > k-1 can have