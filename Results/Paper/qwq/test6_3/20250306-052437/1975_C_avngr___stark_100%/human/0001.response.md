Alright, I have this problem to solve. Let's see what it's asking for. So, Mocha has an array of positive integers, and she can perform this operation any number of times to make all elements in the array the same. The operation involves choosing two indices l and r, finding the median of the subarray from a_l to a_r, and then setting all elements in that subarray to that median.

The goal is to find the maximum possible value that all elements can be set to after performing these operations as many times as needed.

First, I need to understand what a median is in this context. The problem says that the median is the element at position floor((m+1)/2) after sorting the subarray of length m in non-decreasing order. So, for an odd-length subarray, it's the middle element, and for an even-length subarray, it's the element at position m/2 after sorting.

For example, in the subarray [1,2,3,4,5], which is already sorted, the median is the third element, which is 3. In the subarray [5,25,20,24], after sorting to [5,20,24,25], the median is the third element, which is 24.

Wait, but according to the definition, for m=4, floor((4+1)/2)=2, so the second element after sorting, which is 20. So, the median is 20, not 24. I need to make sure I'm getting this right.

Yes, the median is at position floor((m+1)/2). For m=4, floor(5/2)=2, so the second element. For m=5, floor(6/2)=3, so the third element.

Okay, now, the problem is to find the maximum possible value that can be achieved by making all elements equal using these operations.

Let's look at the example provided:

Input:

2

2

1 2

5

1 2 3 4 5

Output:

1

4

In the first test case, n=2, array [1,2]. The only possible operation is to choose l=1, r=2. The median is 1 (since sorted subarray is [1,2], median is the first element, which is 1). So, set both elements to 1, and that's the final array.

In the second test case, n=5, array [1,2,3,4,5]. The solution provided is 4, achieved by choosing (l,r)=(4,5), then (3,5), then (1,5).

Let me see if I can find another sequence of operations that might lead to a higher value.

Suppose I choose (l,r)=(3,4) first. Subarray [3,4], median is 3. Set both to 3. Now array is [1,2,3,3,5].

Then choose (l,r)=(2,4), subarray [2,3,3], median is 3. Set all to 3. Now array is [1,3,3,3,5].

Then choose (l,r)=(1,5), subarray [1,3,3,3,5], median is 3. Set all to 3.

So, in this sequence, I end up with all elements as 3, which is less than the 4 achieved in the sample solution.

Another sequence: Choose (l,r)=(2,5), subarray [2,3,4,5], median is 3. Set all to 3. Now array is [1,3,3,3,3].

Then choose (l,r)=(1,5), subarray [1,3,3,3,3], median is 3. Set all to 3.

Again, ends with all 3's.

But in the sample solution, they achieved 4 by choosing (4,5), then (3,5), then (1,5).

Let me see what's happening there.

First operation: (4,5), subarray [4,5], median is 4. Set both to 4. Now array is [1,2,3,4,4].

Second operation: (3,5), subarray [3,4,4], median is 4. Set all to 4. Now array is [1,2,4,4,4].

Third operation: (1,5), subarray [1,2,4,4,4], median is 4. Set all to 4.

So, all elements are 4.

Is there a way to get higher than 4? Let's see.

Suppose I choose (l,r)=(1,2), subarray [1,2], median is 1. Set both to 1. Now array is [1,1,3,4,5].

Then choose (l,r)=(3,5), subarray [3,4,5], median is 4. Set all to 4. Now array is [1,1,4,4,4].

Then choose (l,r)=(1,5), subarray [1,1,4,4,4], median is 4. Set all to 4.

Again, ends with all 4's.

Another attempt: Choose (l,r)=(2,3), subarray [2,3], median is 2. Set both to 2. Now array is [1,2,2,4,5].

Then choose (l,r)=(4,5), subarray [4,5], median is 4. Set both to 4. Now array is [1,2,2,4,4].

Then choose (l,r)=(2,4), subarray [2,2,4], median is 2. Set all to 2. Now array is [1,2,2,2,4].

Then choose (l,r)=(1,5), subarray [1,2,2,2,4], median is 2. Set all to 2.

This ends with all 2's, which is worse.

So, it seems that choosing subarrays wisely can lead to higher values.

I need to find a strategy to maximize the final value.

Let's think about the properties of this operation.

First, the operation allows us to set a range of elements to their median.

Since we can choose any subarray of length at least 2, and set all elements in that subarray to their median, which is the middle value after sorting.

So, in each operation, we're effectively propagating the median value of the chosen subarray to all elements in that subarray.

Our goal is to make all elements equal to the maximum possible value, using these operations.

I need to find a way to maximize this final value.

Let me consider the entire array in one operation.

If I choose l=1 and r=n, i.e., the whole array, find its median, and set all elements to that median.

In the first test case, [1,2], median is 1, so set both to 1.

In the second test case, [1,2,3,4,5], median is 3, so set all to 3.

But in the sample solution, they achieved 4, which is higher than 3.

So, choosing the entire array in one operation doesn't always give the maximum possible value.

Hence, performing multiple operations on smaller subarrays might allow us to achieve a higher final value.

I need to find a way to propagate higher values towards the entire array.

Let me consider the highest value in the array.

In the second test case, the highest value is 5.

Is it possible to set all elements to 5?

Let's try.

Choose (l,r)=(5,5), but that's a single element, which is not allowed since l < r.

Choose (4,5), subarray [4,5], median is 4. Set both to 4. Now array is [1,2,3,4,4].

Choose (3,5), subarray [3,4,4], median is 4. Set all to 4. Now array is [1,2,4,4,4].

Choose (1,5), subarray [1,2,4,4,4], median is 4. Set all to 4.

Again, ends with all 4's.

Another attempt: Choose (l,r)=(4,5), set to 4, getting [1,2,3,4,4].

Choose (2,4), subarray [2,3,4], median is 3. Set all to 3. Now array is [1,3,3,3,4].

Choose (4,5), subarray [3,4], median is 3. Set both to 3. Now array is [1,3,3,3,3].

Choose (1,5), subarray [1,3,3,3,3], median is 3. Set all to 3.

Again, ends with all 3's.

Another attempt: Choose (l,r)=(3,5), subarray [3,4,5], median is 4. Set all to 4. Now array is [1,2,4,4,4].

Choose (l,r)=(1,2), subarray [1,2], median is 1. Set both to 1. Now array is [1,1,4,4,4].

Choose (l,r)=(1,5), subarray [1,1,4,4,4], median is 4. Set all to 4.

Again, ends with all 4's.

Seems like 4 is the best we can get in this case.

But why can't we get 5?

Is 5 achievable?

Let me try.

Choose (l,r)=(5,5), but can't, since r-l >=1 is required.

Choose (4,5), set to 4, then choose (3,5), set to 4, then choose (1,5), set to 4.

Same as before.

Alternatively, choose (3,4), set to 3, then choose (4,5), set to 3, then choose (1,5), set to 3.

Ends with all 3's.

Not better.

Another idea: Choose (l,r)=(2,3), set to 2, then choose (3,4), set to 2, then choose (4,5), set to 2, then choose (1,5), set to 2.

Ends with all 2's.

Worse.

So, it seems that 4 is the best we can get in this case.

But how to generalize this to find the maximum possible value for any given array?

Let me think about the properties of these operations.

Each operation sets a subarray to its median.

The median is the middle value of the sorted subarray.

So, it's like choosing a subarray and setting all elements to the middle value of that subarray.

By repeating this operation, we can propagate these median values across the array.

I need to find a way to maximize the final uniform value.

I need to find the highest value that can be spread to the entire array through a series of such operations.

I need to think about how higher values can influence lower values through these operations.

Let me consider that each operation can potentially increase the values in a subarray to their median, which could be higher than some of the original values in that subarray.

But it's also possible that choosing a subarray with higher values can pull up the lower values in that subarray to the median.

So, perhaps I need to identify the highest possible value that can be propagated to the entire array.

Let me consider the following approach:

- Find the maximum value in the array that appears frequently enough to be propagated across the array.

But I'm not sure.

Wait, perhaps I can think in terms of the minimal value that is greater than or equal to a certain number of elements.

Wait, maybe I need to consider the median of the entire array, but in a more sophisticated way.

Wait, perhaps I need to consider the minimal position where a higher value can be established, and then spread out from there.

But this seems too vague.

Let me consider the array [1,2,3,4,5] again.

From earlier attempts, it seems that 4 is the maximum achievable.

Is there a way to formalize why 4 is the best?

Let me look at the subarrays of length 3.

In the sample solution, they chose subarrays of length 2 and 3.

Let me see what the medians of all possible subarrays of length 3 are.

Subarrays of length 3:

[1,2,3] -> sorted [1,2,3] -> median 2

[2,3,4] -> sorted [2,3,4] -> median 3

[3,4,5] -> sorted [3,4,5] -> median 4

So, the medians are 2, 3, and 4.

In the sample solution, they achieved 4, which is the highest median among all subarrays of length 3.

Is this a general pattern?

That is, the maximum achievable value is the maximum median among all subarrays of length 3.

Wait, but in the first test case, n=2, array [1,2], the only subarray of length 2 has median 1, and that's what was achieved.

So, in that case, it's also the maximum median of subarrays of length 2.

Wait, but n=2 is a special case because the only possible subarray length is 2.

In general, for n >= 2, and subarrays of length at least 2, perhaps the maximum achievable value is the maximum median among all subarrays of length 3.

Wait, but why length 3?

In the second test case, it's the maximum median of subarrays of length 3 that was achieved.

Is that always the case?

Let me consider another test case.

Suppose n=3, array [1,2,5].

Possible subarrays:

- [1,2], median=1

- [2,5], median=2

- [1,2,5], median=2

The maximum median among subarrays of length 3 is 2.

Can I achieve higher than 2?

Let's try.

Choose (l,r)=(1,2), set to 1, array becomes [1,1,5].

Then choose (l,r)=(2,3), set to 5, array becomes [1,5,5].

Then choose (l,r)=(1,3), set to 5, array becomes [5,5,5].

Wait, achieved 5, which is higher than 2.

But according to the earlier pattern, the maximum median of subarrays of length 3 was 2, but I achieved 5.

So, my earlier hypothesis is incorrect.

What's happening here?

In this case, I was able to achieve 5 by first choosing (1,2) to set to 1, then (2,3) to set to 5, and finally (1,3) to set to 5.

So, even though the median of [1,2,5] is 2, I was able to achieve 5 by choosing smaller subarrays first.

This suggests that the maximum achievable value is not just the maximum median of subarrays of length 3, but possibly the maximum value in the array that can be propagated to the entire array through a series of operations.

But how?

Wait, in the previous test case, [1,2,3,4,5], the maximum achievable was 4, which is less than the maximum value in the array, which is 5.

Wait, but in the test case [1,2,5], the maximum achievable is 5.

So, what's the difference?

In [1,2,3,4,5], 5 cannot be achieved because any operation that includes 5 also includes lower values, and the median would be less than 5.

Wait, in [1,2,3,4,5], if I choose any subarray that includes 5 and at least one other element, the median would be at most 4.

For example:

- [4,5], median 4

- [3,4,5], median 4

- [2,3,4,5], median 4

- [1,2,3,4,5], median 3

So, in this case, 5 cannot be achieved because there's no way to set a subarray including 5 to 5 without including lower elements that pull the median down.

Hence, in this case, the maximum achievable is 4.

In contrast, in [1,2,5], I can choose [2,5], set to 5, then choose [1,5], set to 5.

Wait, but according to the operation definition, I need to choose l and r such that l < r, and set all elements in [l,r] to the median of [l,r].

In [2,5], median is 5, so set both to 5.

Then, [1,5], median is 5, set all to 5.

Hence, achievable.

But in [1,2,3,4,5], choosing [4,5], set to 4, then [3,5], set to 4, then [1,5], set to 4.

Cannot achieve 5.

So, the maximum achievable value depends on whether there exists a way to set higher values without being limited by lower values in the subarrays.

I need a way to generalize this.

Let me consider that the maximum achievable value is the minimal value among the maximum possible values in any overlapping subarrays.

Wait, that sounds confusing.

Alternatively, perhaps it's the minimal value that appears in enough subarrays to cover the entire array.

Wait, perhaps I need to think in terms of the minimal value that can be spread to the entire array through a series of operations.

But I need a better way to think about this.

Let me consider that each operation can set a subarray to its median.

I need to maximize the final uniform value.

I need to find the highest value that can be propagated to the entire array through such operations.

Let me consider that if a value x appears in the array, and there exists a way to set all elements to x through these operations, then x is a candidate for the final value.

Among all such candidates, I need to choose the maximum x.

But how to determine if a particular x can be achieved?

I need to check if it's possible to set all elements to x using the given operations.

Given that, perhaps I can perform a binary search on x, and for each x, check if it's possible to achieve it.

But that might be too slow, especially since n can be up to 10^5 per test case.

I need a smarter way.

Let me consider the following approach:

- Find the maximum median among all subarrays of length 3.

- But as the earlier counterexample showed, this might not always give the correct answer.

Wait, in the [1,2,3,4,5] case, the maximum median among subarrays of length 3 is 4, which matches the sample output.

In the [1,2,5] case, the maximum median among subarrays of length 3 is 2, but we were able to achieve 5.

So, perhaps for n >= 3, the maximum achievable is the maximum median among all subarrays of length 3, but for n=2, it's the minimum of the two elements.

Wait, but in the n=2 case, it's clearly the minimum of the two elements, as shown in the first test case.

In the n=3 case, [1,2,5], the maximum median among subarrays of length 3 is 2, but we achieved 5, which is higher.

So, my earlier approach is incorrect.

I need to find another way.

Let me consider that in order to set all elements to a value x, x must be present in the array, and there must be a way to propagate x to all positions through the operations.

But that's not necessarily true, because in the sample input, x=4 is not present in the original array, but we can achieve it by operations.

Wait, in the second test case, 4 is present in the original array.

Wait, no, in [1,2,3,4,5], 4 is present.

In the operations, we set [4,5] to 4, then [3,5] to 4, then [1,5] to 4.

So, 