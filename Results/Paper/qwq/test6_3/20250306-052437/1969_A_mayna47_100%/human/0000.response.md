Alright, I've got this problem to solve. Let's see what it's asking for. Monocarp wants to throw a party and invite some of his friends, but there are some conditions. He has n friends, and each friend has a best friend, which is specified by p_i. The key points are:

1. All p_i are distinct and p_i != i, meaning no one is their own best friend, and everyone has a unique best friend.

2. A friend comes to the party only if both they and their best friend receive an invitation.

3. Monocarp wants at least 2 friends to come to the party.

4. He needs to send the minimum number of invitations to achieve this.

First, I need to understand the relationship between the friends. Since each friend has a unique best friend and no one is their own best friend, the friendships form pairs or cycles. For example, if A's best friend is B, and B's best friend is A, then they form a pair. If A's best friend is B, B's best friend is C, and C's best friend is A, then they form a cycle of three.

Given that, I need to figure out how to invite the minimum number of friends such that at least two friends come to the party, and for that to happen, each coming friend must have both them and their best friend invited.

Looking at the example provided:

n = 5

p = [3, 1, 2, 5, 4]

Monocarp sends invitations to [1, 2, 4, 5], and friends [2, 4, 5] come. But according to the condition, friend 2 comes because both 2 and p_2=1 are invited, and friend 4 comes because both 4 and p_4=5 are invited, and friend 5 comes because both 5 and p_5=4 are invited. So, in this case, sending invitations to 4 friends results in 3 friends coming. But the problem is to find the minimum number of invitations to have at least 2 friends come.

In this example, the answer is 2, which suggests there's a better way to invite friends so that at least 2 come with fewer invitations sent.

Wait, in the first testcase, it says sending invitations to friends 4 and 5 makes friends 2, 4, and 5 come. Wait, that doesn't seem right based on the p array.

Wait, p = [3,1,2,5,4], so:

- friend 1's best friend is 3

- friend 2's best friend is 1

- friend 3's best friend is 2

- friend 4's best friend is 5

- friend 5's best friend is 4

So, if Monocarp invites friends 4 and 5, then:

- friend 4 will come only if both 4 and p_4=5 are invited. Yes, both are invited, so friend 4 comes.

- friend 5 will come only if both 5 and p_5=4 are invited. Yes, both are invited, so friend 5 comes.

- friend 1 is not invited, so doesn't come.

- friend 2 is not invited, so doesn't come.

- friend 3 is not invited, so doesn't come.

So, only friends 4 and 5 come, which satisfies the condition of at least 2 friends coming. So, with 2 invitations, we can have 2 friends come.

In the second testcase:

n=4

p=[2,3,4,1]

So:

- friend 1's best friend is 2

- friend 2's best friend is 3

- friend 3's best friend is 4

- friend 4's best friend is 1

This forms a cycle of 4.

To have at least 2 friends come, we need to invite in such a way that at least 2 friends have both themselves and their best friend invited.

If we invite friends 1, 2, and 3:

- friend 1 comes if both 1 and p_1=2 are invited. Yes, both are invited, so friend 1 comes.

- friend 2 comes if both 2 and p_2=3 are invited. Yes, both are invited, so friend 2 comes.

- friend 3 comes if both 3 and p_3=4 are invited. 3 is invited, but 4 is not invited, so friend 3 does not come.

- friend 4 is not invited, so doesn't come.

So, friends 1 and 2 come. So, with 3 invitations, we have 2 friends come.

The problem says it's impossible to do with fewer than 3 invitations. Let's see:

If we invite only 2 friends, say 1 and 2:

- friend 1 comes if both 1 and 2 are invited. Yes.

- friend 2 comes if both 2 and 3 are invited. 3 is not invited, so friend 2 does not come.

- friends 3 and 4 are not invited, so don't come.

So, only friend 1 comes, which is less than 2.

Another try: invite 1 and 3.

- friend 1 comes if both 1 and 2 are invited. 1 is invited, but 2 is not, so friend 1 does not come.

- friend 3 comes if both 3 and 4 are invited. 3 is invited, but 4 is not, so friend 3 does not come.

- friends 2 and 4 are not invited, so don't come.

No one comes. Not acceptable.

Another try: invite 1, 2, and 4.

- friend 1 comes if both 1 and 2 are invited. Yes.

- friend 2 comes if both 2 and 3 are invited. 3 is not invited, so friend 2 does not come.

- friend 4 comes if both 4 and 1 are invited. Yes.

- friend 3 is not invited, so doesn't come.

So, friends 1 and 4 come. That's 2 friends coming with 3 invitations.

Seems like 3 is the minimum for this case.

Third testcase:

n=2

p=[2,1]

- friend 1's best friend is 2

- friend 2's best friend is 1

If we invite both 1 and 2:

- friend 1 comes if both 1 and 2 are invited. Yes.

- friend 2 comes if both 2 and 1 are invited. Yes.

So, both come with 2 invitations.

Alternatively, inviting only one wouldn't make any friend come, since each needs both themselves and their best friend invited.

Hence, 2 invitations are necessary.

So, from these examples, it seems that in cycles of even length, inviting half of them might suffice, but in this specific problem, the answer seems to be either 2 or 3 invitations.

Looking back at the program provided:

t = int(input())

for i in range(t):

func_1()

def func_1():

n = int(input())

v = [0] * (n + 1)

v = [0] + list(map(int, input().split()))

for i in range(1, n + 1):

if v[v[i]] == i:

print(2)

return

print(3)

So, the program reads t test cases, and for each test case, it reads n and the list p, then checks for each friend if their best friend's best friend is themselves. If yes for any friend, it prints 2; else, it prints 3.

Wait, v[v[i]] == i checks if the best friend of the best friend is oneself. So, in other words, it checks if there is a pair of friends where each is the other's best friend.

In the first testcase:

p = [3,1,2,5,4]

- v[1] = 3, v[3] = 2, which is not 1

- v[2] = 1, v[1] = 3, which is not 2

- v[3] = 2, v[2] = 1, which is not 3

- v[4] = 5, v[5] = 4, which is 4

So, for i=4, v[v[4]]=v[5]=4, which matches i=4. Hence, it prints 2.

In the second testcase:

p = [2,3,4,1]

- v[1]=2, v[2]=3 !=1

- v[2]=3, v[3]=4 !=2

- v[3]=4, v[4]=1 !=3

- v[4]=1, v[1]=2 !=4

So, no i where v[v[i]] == i, hence prints 3.

In the third testcase:

p = [2,1]

- v[1]=2, v[2]=1 ==1

So, prints 2.

So, the logic seems to be: if there exists at least one pair where each is the other's best friend, then 2 invitations suffice; else, 3 invitations are needed.

Is this always true?

Let's think about it.

If there exists a pair where each is the other's best friend, then inviting both of them would make both come, satisfying the condition of at least 2 friends coming. So, with 2 invitations, we achieve the goal.

If no such pair exists, then what's the minimum number of invitations needed to have at least 2 friends come?

In the second testcase, n=4, p=[2,3,4,1], which forms a cycle of 4: 1->2->3->4->1.

To have at least 2 friends come, we need to invite in such a way that at least 2 friends have both themselves and their best friend invited.

From earlier, inviting 1,2,3 makes friends 1 and 4 come. Wait, no, friend 4 doesn't come because p_4=1 is invited, but 4 itself is not invited. Wait, no, to come, a friend needs both themselves and their best friend invited.

Wait, friend 4 needs both 4 and p_4=1 invited. So, if we invite 1,2,3:

- friend 1 comes if 1 and 2 are invited: yes

- friend 2 comes if 2 and 3 are invited: yes

- friend 3 comes if 3 and 4 are invited: 4 is not invited, so no

- friend 4 comes if 4 and 1 are invited: 1 is invited, but 4 is not, so no

Hence, friends 1 and 2 come.

Similarly, inviting 1,2,4:

- friend 1 comes if 1 and 2 are invited: yes

- friend 2 comes if 2 and 3 are invited: 3 is not invited, so no

- friend 3 comes if 3 and 4 are invited: 3 is not invited, so no

- friend 4 comes if 4 and 1 are invited: yes

So, friends 1 and 4 come.

In both cases, with 3 invitations, we have 2 friends coming.

Is it possible to have 2 friends come with only 2 invitations? Let's try:

Invite 1 and 2:

- friend 1 comes if 1 and 2 are invited: yes

- friend 2 comes if 2 and 3 are invited: 3 is not invited, so no

- friends 3 and 4 are not invited, so don't come

So, only friend 1 comes, which is less than 2.

Invite 1 and 3:

- friend 1 comes if 1 and 2 are invited: 2 is not invited, so no

- friend 2 comes if 2 and 3 are invited: 2 is not invited, so no

- friend 3 comes if 3 and 4 are invited: 4 is not invited, so no

- friend 4 comes if 4 and 1 are invited: 1 is invited, but 4 is not, so no

No one comes.

Invite 1 and 4:

- friend 1 comes if 1 and 2 are invited: 2 is not invited, so no

- friend 2 comes if 2 and 3 are invited: 2 is not invited, so no

- friend 3 comes if 3 and 4 are invited: 4 is invited, but 3 is not, so no

- friend 4 comes if 4 and 1 are invited: yes

So, only friend 4 comes, which is less than 2.

Invite 2 and 3:

- friend 1 comes if 1 and 2 are invited: 1 is not invited, so no

- friend 2 comes if 2 and 3 are invited: yes

- friend 3 comes if 3 and 4 are invited: 4 is not invited, so no

- friend 4 comes if 4 and 1 are invited: 1 is not invited, so no

So, only friend 2 comes.

Invite 2 and 4:

- friend 1 comes if 1 and 2 are invited: 1 is not invited, so no

- friend 2 comes if 2 and 3 are invited: 3 is not invited, so no

- friend 3 comes if 3 and 4 are invited: 4 is invited, but 3 is not, so no

- friend 4 comes if 4 and 1 are invited: 1 is not invited, so no

No one comes.

Invite 3 and 4:

- friend 1 comes if 1 and 2 are invited: 1 is not invited, so no

- friend 2 comes if 2 and 3 are invited: 3 is invited, but 2 is not, so no

- friend 3 comes if 3 and 4 are invited: yes

- friend 4 comes if 4 and 1 are invited: 1 is not invited, so no

So, only friend 3 comes.

Hence, with 2 invitations, it's impossible to have at least 2 friends come in this scenario. Therefore, the program's logic seems correct: if there exists a pair where each is the other's best friend, then 2 invitations suffice; else, 3 invitations are needed.

Let me test this logic with another example.

Suppose n=4

p=[3,4,1,2]

So:

- friend 1's best friend is 3

- friend 2's best friend is 4

- friend 3's best friend is 1

- friend 4's best friend is 2

Here, friends 1 and 3 are each other's best friends, and friends 2 and 4 are each other's best friends.

According to the program:

- for i=1, v[v[1]]=v[3]=1, which matches i=1

- for i=2, v[v[2]]=v[4]=2, which matches i=2

So, it would print 2.

Indeed, inviting friends 1 and 3 would make both come, as both have their best friends invited. Similarly, inviting friends 2 and 4 would make both come.

So, 2 invitations suffice.

Another example: n=3

p=[2,3,1]

- friend 1's best friend is 2

- friend 2's best friend is 3

- friend 3's best friend is 1

This forms a cycle of 3.

According to the program:

- for i=1, v[v[1]]=v[2]=3 !=1

- for i=2, v[v[2]]=v[3]=1 !=2

- for i=3, v[v[3]]=v[1]=2 !=3

So, it would print 3.

Is that correct?

Let's see:

If we invite friends 1,2,3:

- friend 1 comes if 1 and 2 are invited: yes

- friend 2 comes if 2 and 3 are invited: yes

- friend 3 comes if 3 and 1 are invited: yes

So, all three come.

But can we have at least 2 friends come with fewer than 3 invitations?

Let's try inviting 1 and 2:

- friend 1 comes if 1 and 2 are invited: yes

- friend 2 comes if 2 and 3 are invited: 3 is not invited, so no

- friend 3 is not invited, so doesn't come

So, only friend 1 comes, which is less than 2.

Inviting 1 and 3:

- friend 1 comes if 1 and 2 are invited: 2 is not invited, so no

- friend 2 comes if 2 and 3 are invited: 2 is not invited, so no

- friend 3 comes if 3 and 1 are invited: yes

So, only friend 3 comes.

Inviting 2 and 3:

- friend 1 comes if 1 and 2 are invited: 1 is not invited, so no

- friend 2 comes if 2 and 3 are invited: yes

- friend 3 comes if 3 and 1 are invited: 1 is not invited, so no

So, only friend 2 comes.

Hence, with 2 invitations, it's impossible to have at least 2 friends come. Therefore, 3 invitations are needed, as the program suggests.

Another example: n=6

p=[4,5,6,1,2,3]

- friend 1's best friend is 4

- friend 2's best friend is 5

- friend 3's best friend is 6

- friend 4's best friend is 1

- friend 5's best friend is 2

- friend 6's best friend is 3

Here, we have two cycles: 1-4 and 2-5 and 3-6, each of length 2.

According to the program:

- for i=1, v[v[1]]=v[4]=1, which matches i=1

- for i=2, v[v[2]]=v[5]=2, which matches i=2

- for i=3, v[v[3]]=v[6]=3, which matches i=3

So, it would print 2.

Indeed, inviting friends 1 and 4 would make both come, or inviting 2 and 5, or 3 and 6.

So, 2 invitations suffice.

Another example: n=5

p=[2,3,4,5,1]

- friend 1's best friend is 2

- friend 2's best friend is 3

- friend 3's best friend is 4

- friend 4's best friend is 5

- friend 5's best friend is 1

This forms a single cycle of 5.

According to the program:

- for i=1, v[v[1]]=v[2]=3 !=1

- for i=2, v[v[2]]=v[3]=4 !=2

- for i=3, v[v[3]]=v[4]=5 !=3

- for i=4, v[v[4]]=v[5]=1 !=4

- for i=5, v[v[5]]=v[1]=2 !=5

So, it would print 3.

Is that correct?

Let's see:

If we invite friends 1,2,3:

- friend 1 comes if 1 and 2 are invited: yes

- friend 2 comes if 2 and 3 are invited: yes

- friend 3 comes if 3 and 4 are invited: 4 is not invited, so no

- friend 4 comes if 4 and 5 are invited: 4 is invited, but 5 is not, so no

- friend 5 comes if 5 and 1 are invited: 1 is invited, but 5 is not, so no

So, friends 1 and 2 come.

Alternatively, inviting 1,2,4:

- friend 1 comes if 1 and 2 are invited: yes

- friend 2 comes if 2 and 3 are invited: 3 is not invited, so no

- friend 3 comes if 3 and 4 are invited: 3 is not invited, so no

- friend 4 comes if 4 and 5 are invited: 4 is invited, but 5 is not, so no

- friend 5 comes if 5 and 1 are invited: 1 is invited, but 5 is not, so no

So, only friend 1 comes.

Wait, that's not right. Friend 1 comes because 1 and 2 are invited.

Wait, seems like with 1,2,4 invited:

- friend 1: 1 and 2 invited -> comes

- friend 2: 2 and 3 invited -> 3 not invited -> doesn't come

- friend 3: 3 and 4 invited -> 3 not invited