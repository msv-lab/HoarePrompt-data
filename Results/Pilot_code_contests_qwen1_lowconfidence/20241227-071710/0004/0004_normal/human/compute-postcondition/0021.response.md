Functionality: **The function `func_8` accepts an integer `x` such that \(0 \leq x \leq \frac{n(n-1)}{2}\), where `n` is a positive integer representing the size of the permutation, and `BITTree` is a Binary Indexed Tree (Fenwick Tree) storing cumulative sums of some permutation-related values up to a certain index. The function iterates backward through a range of bits from 21 to 0. During each iteration, it checks if adding \(2^i\) (where `i` is the current bit index) to `ret` and `BITTree[ret + 2^i]` to `sm` still satisfies the condition `sm + BITTree[ret + 2^i] <= x`. If the condition holds, it updates `ret` and `sm` accordingly. After the loop, the function returns `ret`, which is the maximum value such that `ret` ≤ `n` and `sm + BITTree[ret]` ≤ `x`. This ensures that `ret` is the largest possible value meeting the specified conditions.**

This summary covers the actual logic performed by the code, including the iterative process and the final state of `ret` and `sm`. It also highlights the importance of considering the constraints and conditions imposed by the `BITTree` and the input `x`.