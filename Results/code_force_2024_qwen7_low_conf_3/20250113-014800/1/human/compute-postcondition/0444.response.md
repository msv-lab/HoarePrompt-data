Let's analyze the loop step by step to determine the final state of the variables after the loop has executed all iterations.

### Initial State Recap
- `t` is a positive integer such that \(1 \leq t \leq 5000\).
- `n` and `k` are integers satisfying \(2 \leq n \leq 5 \cdot 10^4\) and \(1 \leq k \leq \lfloor n/2 \rfloor\).
- `a` is a list of \(2n\) integers where each integer from 1 to \(n\) appears exactly twice.
- `tc` is an integer read from `sys.stdin`.

### Loop Analysis

#### Variables Inside the Loop
- `_`: A dummy variable used for iteration.
- `n`: The number of unique elements to process.
- `k`: A parameter that is doubled (`2 * k`).
- `a`: The list of \(2n\) integers.
- `half`: The first \(n\) elements of `a`.
- `half2`: The last \(n\) elements of `a`.
- `cnts`: A counter for the first half of `a`.
- `cnts2`: A counter for the second half of `a`.
- `pairs`: Count of pairs in `cnts`.
- `singles`: Count of singles in `cnts`.
- `found`: Boolean indicating if a valid configuration is found.
- `ws`, `wp`: Temporary variables for singles and pairs.
- `res1`, `res2`: Lists to store the result pairs.
- `hs`, `hp`: Temporary variables to track the number of singles and pairs added to `res1`.

### Key Observations

1. **Finding Pairs and Singles**:
   - `cnts` and `cnts2` count occurrences of each number in the respective halves.
   - `pairs` and `singles` are derived from these counts.

2. **Valid Configuration**:
   - The loop iterates over possible configurations of `k` singles and `k` pairs.
   - `found` is set to `True` if a valid configuration is found.
   - If no valid configuration is found, the loop will assert `found`, which implies an error in the problem setup.

3. **Constructing Result Lists**:
   - `res1` and `res2` are constructed based on the counts of singles and pairs.
   - `res1` contains pairs of identical elements from `cnts`.
   - `res2` contains pairs of identical elements from `cnts2`.

### Final Output State After All Iterations

After the loop executes all iterations (or fails to find a valid configuration), the following conditions hold:

- `ws` and `wp` are the optimal number of singles and pairs found for `k`.
- `res1` and `res2` are constructed as per the optimal configuration.
- `hs` and `hp` reflect the number of elements added to `res1` and `res2`.

Given that the loop ensures a valid configuration is found, the final state can be summarized as follows:

- `ws` is the number of singles in the optimal configuration.
- `wp` is the number of pairs in the optimal configuration.
- `res1` contains pairs of identical elements from `cnts` that form the optimal configuration.
- `res2` contains pairs of identical elements from `cnts2` that form the optimal configuration.

### Output State

Output State: **`ws` is the number of singles, `wp` is the number of pairs, `res1` is a list of elements `[ai, ai]` for each key-value pair in `cnts` where `cnt == 2` and `res2` is a list of elements `[ai, ai]` for each key-value pair in `cnts2` where `cnt == 2`.**