Reasoning:

1. **Input Handling**: The program correctly reads the number of test cases \( t \) and processes each test case individually.
2. **Friendship Value Calculation**: For each test case, the program correctly sums up the friendship values \( f_i \) of all given pairs of friends.
3. **Combinatorial Calculation**: The program calculates the expected value of the sum of friendship values for all \( k \) pairs chosen for the excursions. This calculation involves combinatorial elements and uses the formula derived from the problem statement.
4. **GCD and Modular Inverse**: The program correctly simplifies the fraction using the greatest common divisor (gcd) and computes the modular inverse of the denominator modulo \( M \).
5. **Modulo Operation**: The program ensures that the final result is computed modulo \( M \) as required.

Given the execution summary and the provided example, the program appears to follow the correct approach and logic as per the problem statement. The calculations and operations performed match the expected steps and formulas.

Correctness: **True**