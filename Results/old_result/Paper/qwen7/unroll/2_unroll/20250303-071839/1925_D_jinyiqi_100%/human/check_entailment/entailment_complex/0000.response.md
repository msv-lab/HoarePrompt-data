Reasoning:
Let's analyze the logic and correctness of the provided program step-by-step:

1. **Input Reading and Initialization**:
   - The program correctly reads the number of test cases `t`.
   - For each test case, it reads `n`, `m`, and `k` which are the number of children, pairs of friends, and the number of excursions respectively.
   - It initializes `sum_f` to accumulate the total friendship values of all given pairs.

2. **Processing Each Test Case**:
   - For each of the `m` pairs, it reads the indices `a`, `b`, and the friendship value `f`, and adds `f` to `sum_f`.
   - This part is correct as it correctly sums up the friendship values.

3. **Calculating Expected Value**:
   - The program calculates `cn2 = n * (n - 1) // 2`, which represents the total number of unique pairs of children.
   - It then uses the formula `p = 2 * k * cn2 * sum_f + m * k * (k - 1)` to calculate `p`.
   - It calculates `q = 2 * cn2 ** 2` to represent the denominator.
   - It then finds the greatest common divisor (gcd) of `p` and `q` and divides both `p` and `q` by this gcd to simplify the fraction.
   - Finally, it computes `p * pow(q, -1, M) % M` to get the result and prints it.

4. **Modular Arithmetic**:
   - The use of modular arithmetic (`pow(q, -1, M)`) to find the modular inverse of `q` under modulo `M` is correct.
   - The final result is computed correctly using the properties of modular arithmetic.

Given the problem statement and the provided example, the logic and calculations in the program align with the requirements. The program correctly handles the constraints and performs the necessary computations to find the expected value of the sum of friendship values.

Therefore, the program is correct.

Correctness: **True**