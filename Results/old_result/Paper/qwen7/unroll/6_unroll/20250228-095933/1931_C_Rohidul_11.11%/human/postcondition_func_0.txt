The function processes multiple test cases, where for each test case, it reads an integer `t`, an integer `n`, and a list `a` of `n` integers. It then determines the maximum length of a subarray starting from either the first or last element, excluding the first and last elements if they are equal, or the entire array minus one if the first and last elements are different and there are no consecutive duplicates at the start or end. Finally, it prints the maximum length found for each test case.