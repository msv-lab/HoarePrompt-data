Reasoning:

1. **Problem Understanding**: The problem requires calculating the expected value of the sum of friendship values for all k pairs chosen for the excursions. The key points are:
   - Each excursion chooses a pair of children randomly.
   - If a pair of friends is chosen, their friendship value increases by 1 for all subsequent excursions.
   - The expected value is calculated considering the probability of choosing each pair and the increase in friendship values.

2. **Given Code Analysis**:
   - The code correctly reads the number of test cases `t`.
   - For each test case, it reads `n`, `m`, and `k`.
   - It calculates the sum of friendship values `sum_f` for all given pairs.
   - It uses combinatorial calculations to derive the numerator `p` and denominator `q` of the expected value.
   - It simplifies `p` and `q` using the greatest common divisor (gcd).
   - Finally, it prints the result of the expression \( \frac{p}{q} \mod M \).

3. **Key Calculations**:
   - The code correctly calculates the expected value using the formula derived from the problem statement.
   - The use of modular arithmetic ensures that the result fits within the required constraints.

4. **Edge Cases**:
   - The code handles the edge cases where there are no pairs of friends (`sum_f = 0`), ensuring the expected value is 0.
   - The code correctly processes the constraints on the inputs, such as the limits on `t`, `n`, `m`, and `k`.

5. **Correctness Verification**:
   - The provided example cases are correctly handled by the code.
   - The logic for calculating the expected value and simplifying the fraction is sound and follows the problem's requirements.

Based on the above analysis, the given program correctly implements the solution to the problem as described.

Correctness: **True**