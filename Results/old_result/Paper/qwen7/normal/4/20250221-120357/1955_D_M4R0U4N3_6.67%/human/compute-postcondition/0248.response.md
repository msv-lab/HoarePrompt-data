Postcondition: `r` is `r_end + 1`, `old` is `a[r - m]`, `extra` does not contain `old` if `old` was previously in `extra`, `done` includes `a[r_end + 1]` if it was in `todo` and does not include `old` if `old` was in `done`, `todo` does not include `a[r_end + 1]` if it was in `todo` and includes `old` if `old` was in `done`, and `todo` has added `old` if `old` was in `done`.