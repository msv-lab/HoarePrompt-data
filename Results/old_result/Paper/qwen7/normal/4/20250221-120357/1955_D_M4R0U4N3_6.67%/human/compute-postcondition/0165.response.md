Postcondition: `ans` is either 2 or 3, `r` is `m + 1`, and `old` is equal to `a[r - m]`. If `len(done) >= k`, then `ans` is 3. Otherwise, the conditions involving `done`, `todo`, and `extra` remain unchanged.