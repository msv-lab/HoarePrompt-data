Postcondition: `r` is `m`, `m` is some integer, `n` is some integer greater than `m`, `a[r]` is not in `todo`, `old` (which is `a[r - m]`) is either in `extra` and has been added to `todo` and removed from `done`, or it remains unchanged in `done` if it was already there, and if `old` was not in `done`, it is now in `extra`, and the length of `done` is at least `k`.