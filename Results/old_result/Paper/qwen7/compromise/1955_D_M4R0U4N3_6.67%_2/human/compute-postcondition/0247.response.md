Postcondition: **`r` is `r_end + 1`, `old` is `a[r - m]`, `extra` is `extra - {old}` if `old` was in `extra`, `done` is `done - {old}`, `todo` is `todo + {old}` if `old` was in `done`, and `todo.add(old)` has been executed.**