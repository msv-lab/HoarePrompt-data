Postcondition: `r` is either `r_end + 1` or `r_end + 2`, `old` is either `a[r - m]` or `a[r - m - 1]`, `extra`, `done`, and `todo` are updated as follows:
- If `a[r]` was in `todo`:
  - `extra` does not contain `old`.
  - `done` includes `old`.
  - `todo` does not include `old`.
  - `extra` is `extra - {old}`.
  - `done` is `done + {old}`.
- Otherwise:
  - `extra` now includes `a[r]`.
  - `done` does not include `old` if `old` was in `done`.
  - `todo` includes `old` if `old` was in `done`.
  - `extra` does not include `old` if `old` was in `extra`.
  - `done` does not include `old`.
  - `todo` adds `old` if `old` was in `done`.