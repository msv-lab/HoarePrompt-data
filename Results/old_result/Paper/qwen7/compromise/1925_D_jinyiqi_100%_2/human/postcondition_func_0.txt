The function processes multiple test cases, where each test case consists of integers \( t \), \( n \), \( m \), and \( k \). For each test case, it further processes \( m \) pairs of integers \( a_i \) and \( b_i \) along with an integer \( f_i \). It calculates a specific mathematical expression involving these inputs, simplifies the result using the greatest common divisor, and finally outputs the modular multiplicative inverse of the simplified fraction modulo \( M \).