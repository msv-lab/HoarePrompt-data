Alright, I have this problem to solve. Let's read it carefully.

We have two firework launchers: one launches every 'a' minutes, and the other every 'b' minutes. Each firework remains visible in the sky for 'm + 1' minutes after launch. I need to find the maximum number of fireworks that can be seen in the sky at the same time.

First, I need to understand what's happening with the fireworks. Each launcher is launching fireworks at regular intervals: the first one at times a, 2a, 3a, and so on, and the second one at times b, 2b, 3b, and so on.

Each firework is visible from the time it's launched up to m minutes after launch, inclusive. So, a firework launched at time t is visible at times t, t+1, t+2, ..., t+m.

I need to find a time when the最多的 fireworks are visible in the sky. That means I need to find a time t where the sum of fireworks from both launchers that are visible at time t is maximized.

Let me think about how to approach this.

One way is to consider the launch times and the visibility periods. For each launcher, I can determine how many fireworks are visible at any given time.

Let's consider the first launcher. It launches at times a, 2a, 3a, etc. Each of these launches has a visibility period of m minutes.

Similarly, the second launcher launches at times b, 2b, 3b, etc., with each firework visible for m minutes.

To find the maximum number of fireworks visible at any time, I need to find a time t where the number of fireworks from both launchers that are visible at t is maximized.

I need to find t such that the number of launch times from the first launcher where t is within [launch time, launch time + m] plus the number of launch times from the second launcher where t is within [launch time, launch time + m] is maximized.

This seems a bit complicated. Maybe there's a smarter way to think about it.

Let me consider the number of fireworks from the first launcher that are visible at time t. This would be the number of integers k such that ka ≤ t ≤ ka + m, which is equivalent to (t - m)/a ≤ k ≤ t/a, where k is an integer.

Similarly, for the second launcher, it's the number of integers l such that lb ≤ t ≤ lb + m, which is (t - m)/b ≤ l ≤ t/b.

So, the total number of fireworks visible at time t is the sum of these two counts.

I need to maximize this sum over all possible t.

This seems tricky because t can be any real number, but in practice, it's discrete since launches happen at integer minutes.

Wait, the problem likely assumes that time is measured in whole minutes, so t is an integer.

Yes, probably t is a non-negative integer.

So, t is an integer starting from 0.

Now, for each t, the number of fireworks from the first launcher visible at t is the number of k such that ka ≤ t ≤ ka + m, which is the same as floor((t - m)/a) ≤ k ≤ floor(t/a).

Similarly for the second launcher.

But counting this for each t would be inefficient, especially since t can be up to very large values given that a, b, m can be up to 10^18.

I need a smarter approach.

Let me think about the possible overlaps.

The maximum number of fireworks visible at any time would occur when as many fireworks as possible are overlapping their visibility periods.

Given that each firework is visible for m+1 minutes (from t to t+m inclusive), I need to find a time t where the launches from both launchers have as many fireworks as possible overlapping.

One way to approach this is to consider the density of launches and their visibility periods.

Alternatively, perhaps I can calculate the maximum possible sum of the number of visibility periods from both launchers at any time.

Let me consider the first launcher. The number of fireworks visible at time t is floor(t/a) - floor((t - m - 1)/a), because floor(t/a) is the number of launches up to t, and floor((t - m - 1)/a) is the number of launches before t - m.

Similarly for the second launcher.

So, the total number of fireworks visible at time t is:

floor(t/a) - floor((t - m - 1)/a) + floor(t/b) - floor((t - m - 1)/b)

I need to maximize this expression over t.

This seems complex, but maybe I can find a pattern or a mathematical way to find the maximum.

Another approach: consider that the fireworks from the first launcher are launched periodically every a minutes, and each stays visible for m minutes.

Similarly for the second launcher.

So, for the first launcher, the visibility periods are [ka, ka + m] for each integer k.

Similarly, for the second launcher, [lb, lb + m] for each integer l.

I need to find the time t where the number of intervals from both launchers that contain t is maximized.

This sounds like a line sweep problem, but since t can be up to 10^18 and a, b can be up to 10^18, I can't implement a traditional line sweep.

I need a mathematical insight here.

Let me consider the least common multiple (LCM) of a and b. The LCM is the time after which the launch patterns repeat.

However, since a and b can be up to 10^18, their LCM could be up to 10^36, which is too large to handle directly.

Perhaps I can find a way to calculate the maximum overlap without considering the entire time span.

Let me consider the times when both launchers launch fireworks simultaneously, i.e., at times that are multiples of LCM(a, b).

But again, LCM(a, b) can be very large.

Wait, maybe I can consider the times relative to the launch times.

Let me think differently.

Suppose I fix a time t and look at how many fireworks from each launcher are visible at that time.

For the first launcher, the number of visible fireworks is the number of k such that t - m ≤ ka ≤ t.

Similarly, for the second launcher, the number of l such that t - m ≤ lb ≤ t.

So, for the first launcher, the number of visible fireworks is floor(t/a) - floor((t - m - 1)/a).

Similarly for the second launcher.

I need to maximize the sum of these two.

I need to find t such that this sum is maximized.

Let me denote:

visible1(t) = floor(t/a) - floor((t - m - 1)/a)

visible2(t) = floor(t/b) - floor((t - m - 1)/b)

total_visible(t) = visible1(t) + visible2(t)

I need to maximize total_visible(t).

I need to find the maximum value of total_visible(t) over integer t.

Given that a, b, m can be up to 10^18, I need an efficient way to compute this.

Let me consider the possible values of total_visible(t).

First, consider that visible1(t) can be 0, 1, or possibly more, depending on how m relates to a.

Similarly for visible2(t).

I need to find when both visible1(t) and visible2(t) are as large as possible.

Let me consider the case when a and b are co-prime.

In that case, their launch times don't overlap except at multiples of LCM(a, b) = a*b.

But again, a and b can be up to 10^18, so a*b can be up to 10^36, which is too large.

I need another approach.

Let me consider that for a given t, visible1(t) is the number of multiples of a in the interval [t - m, t].

Similarly, visible2(t) is the number of multiples of b in [t - m, t].

So, visible1(t) = floor(t/a) - floor((t - m - 1)/a)

Similarly for visible2(t).

I need to maximize the sum of these two.

I need to find t such that both floor(t/a) - floor((t - m - 1)/a) and floor(t/b) - floor((t - m - 1)/b) are as large as possible.

I recall that floor(x/y) is the number of multiples of y up to x.

So, floor(t/a) is the number of multiples of a up to t.

floor((t - m - 1)/a) is the number of multiples of a up to t - m - 1.

Therefore, floor(t/a) - floor((t - m - 1)/a) is the number of multiples of a in [t - m, t].

Similarly for b.

So, total_visible(t) is the number of multiples of a in [t - m, t] plus the number of multiples of b in [t - m, t].

I need to maximize this sum.

Let me consider that [t - m, t] is a interval of length m + 1.

I need to place this window in time to capture as many multiples of a and b as possible.

So, I need to find a window of length m + 1 that contains the most multiples of a and b.

Each multiple of a in the window contributes +1 to visible1(t), and each multiple of b contributes +1 to visible2(t).

Hence, total_visible(t) is the count of multiples of a plus the count of multiples of b in the window [t - m, t].

To maximize this, I need to maximize the number of multiples of a and b in any window of length m + 1.

So, this reduces to finding the maximum number of multiples of a and b in any interval of length m + 1.

This seems more manageable.

Now, to find the maximum number of multiples of a and b in an interval of length m + 1, I need to consider how densely the multiples of a and b are packed in any interval of that length.

Let me consider the number of multiples of a in an interval of length l is floor((t + l - 1)/a) - floor(t/a), but since l = m + 1, it's floor((t + m)/a) - floor(t/a).

Wait, but in our case, l = m + 1, and the interval is [t - m, t], which has length m + 1.

So, the number of multiples of a in [t - m, t] is floor(t/a) - floor((t - m - 1)/a).

Similarly for b.

So, total_visible(t) = floor(t/a) - floor((t - m - 1)/a) + floor(t/b) - floor((t - m - 1)/b)

I need to maximize this expression over integer t.

This seems tricky, but perhaps there's a mathematical way to find the maximum without iterating over all possible t.

Let me consider that floor(t/a) - floor((t - m - 1)/a) is equal to the number of multiples of a in [t - m + 1, t].

Wait, actually, [t - m, t] includes t - m to t, inclusive, which is m + 1 minutes.

So, the number of multiples of a in this interval is floor(t/a) - floor((t - m)/a)

Wait, I think there's a confusion here.

Let me recall that floor(x/y) gives the greatest integer less than or equal to x/y.

So, the number of multiples of a in [t - m, t] is floor(t/a) - floor((t - m)/a)

Similarly for b.

Hence, total_visible(t) = floor(t/a) - floor((t - m)/a) + floor(t/b) - floor((t - m)/b)

I need to maximize this sum.

Let me consider that floor(t/a) - floor((t - m)/a) is equal to the number of integers k such that (t - m)/a < k ≤ t/a

Similarly for b.

I need to find t that maximizes the sum of these counts for a and b.

This seems complex, but perhaps I can consider that in an interval of length m, the number of multiples of a is ceil(m/a)

Wait, no.

Actually, the number of multiples of a in an interval of length l is floor((t + l - 1)/a) - floor(t/a), but in our case, l = m + 1.

Wait, perhaps it's floor((t + m)/a) - floor(t/a)

But I need to think differently.

Let me consider that in any interval of length m + 1, the maximum number of multiples of a is floor(m/a) + 1, if t is chosen such that t is a multiple of a.

Similarly for b.

Hence, the maximum number of multiples of a in any window of length m + 1 is floor(m/a) + 1

Similarly, for b, it's floor(m/b) + 1

So, naively, I might think that the maximum total_visible(t) is floor(m/a) + 1 + floor(m/b) + 1 = floor(m/a) + floor(m/b) + 2

But this assumes that the windows for a and b can be perfectly aligned, which might not be possible if a and b are not multiples of each other.

However, if a and b are co-prime, their multiples are spread out, and it might not be possible to have that many overlaps.

I need to consider the overlaps between the multiples of a and b within the window.

Let me consider that some multiples of a and b might coincide within the window, meaning that a firework from both launchers is visible at the same time.

In that case, I need to account for the fact that a particular time t might be a multiple of both a and b, meaning that it's counted in both visible1(t) and visible2(t).

But I need to make sure not to double-count such times.

Wait, no. Since each firework is from a different launcher, even if t is a multiple of both a and b, it means that there are fireworks from both launchers visible at t.

So, in that case, both are counted separately.

Hence, if t is a multiple of both a and b, then both launchers have a firework visible at t.

So, in the sum, both visible1(t) and visible2(t) include t, if t is a multiple of both a and b.

Hence, the maximum total_visible(t) would be the sum of the maximum number of multiples of a and b in any window of length m + 1.

But I need to consider if there's any overlap in the multiples of a and b within the window.

Let me consider the number of multiples of a in the window is floor(m/a) + 1, and similarly for b.

But if a and b have common multiples within the window, then the total count would be floor(m/a) + floor(m/b) - floor(m/lcm(a,b)) + 1, where lcm is the least common multiple of a and b.

Wait, but lcm(a,b) could be very large, up to a*b if a and b are co-prime.

Given that a and b can be up to 10^18, lcm(a,b) could be up to 10^36, which is too big to handle directly.

Hence, I need a different approach.

Let me consider that in the interval [t - m, t], the number of multiples of a is floor(t/a) - floor((t - m - 1)/a)

Similarly for b.

Hence, total_visible(t) = floor(t/a) - floor((t - m - 1)/a) + floor(t/b) - floor((t - m - 1)/b)

I need to maximize this sum over t.

Let me consider that floor(t/x) - floor((t - m - 1)/x) is equal to floor((t - (t - m - 1)) / x) = floor((m + 1)/x)

Wait, no, that's not correct.

Actually, floor(t/x) - floor((t - m - 1)/x) is equal to the number of multiples of x in [t - m, t]

Which can be calculated as floor(t/x) - floor((t - m - 1)/x)

But I need a better way to maximize this sum.

Let me consider that for large t, floor(t/a) - floor((t - m - 1)/a) is approximately (t - (t - m -1))/a = (m + 1)/a

But since we're dealing with integers, I need to be careful.

Wait, perhaps I can consider that floor(t/a) - floor((t - m - 1)/a) is equal to floor((t - (t - m - 1))/a) = floor((m + 1)/a)

But that's not generally true.

Actually, the number of multiples of a in [t - m, t] is floor(t/a) - floor((t - m)/a)

Similarly for b.

Hence, total_visible(t) = floor(t/a) - floor((t - m)/a) + floor(t/b) - floor((t - m)/b)

I need to maximize this sum.

Let me consider that floor(t/a) - floor((t - m)/a) is the number of multiples of a in [t - m + 1, t]

Wait, actually, [t - m, t] includes t - m to t, inclusive, which is m + 1 elements.

So, floor(t/a) - floor((t - m)/a) gives the count of multiples of a in this interval.

Similarly for b.

Hence, total_visible(t) = number of multiples of a in [t - m, t] + number of multiples of b in [t - m, t]

I need to maximize this sum.

Let me consider that the maximum number of multiples of a in any window of size m + 1 is floor(m/a) + 1, achieved when t is a multiple of a.

Similarly for b.

Hence, naively, the maximum total_visible(t) would be floor(m/a) + floor(m/b) + 2

But this might not be achievable if a and b have no overlapping multiples within the window.

Wait, actually, if a and b are such that their multiples don't overlap within the window, then the total would be floor(m/a) + floor(m/b) + 2

But if there are overlapping multiples, then some multiples are counted in both, but since they are from different launchers, both are still counted.

Wait, no, since each firework is from a different launcher, even if t is a multiple of both a and b, both fireworks are visible.

Hence, in that case, total_visible(t) would include both.

Hence, the maximum should be floor(m/a) + floor(m/b) + 2

But I need to confirm if this is always achievable.

Let me consider some examples.

Take the first sample input:

a = 6, b = 7, m = 4

floor(4/6) + 1 = 1 (since floor(4/6) = 0)

floor(4/7) + 1 = 1 (floor(4/7) = 0)

So, total_visible(t) = 1 + 1 = 2

Which matches the sample output.

Another sample input:

a = 3, b = 4, m = 10

floor(10/3) + 1 = 4 + 1 = 5

floor(10/4) + 1 = 2 + 1 = 3

Total_visible(t) = 5 + 3 = 8

But the sample output is 7, which is less than 8.

Wait, perhaps my assumption is incorrect.

In this case, floor(10/3) = 3, so floor(10/3) + 1 = 4

floor(10/4) = 2, so floor(10/4) + 1 = 3

Sum is 7, which matches the sample output.

Wait, perhaps I miscalculated earlier.

Wait, floor(10/3) = 3, since 3*3=9 ≤ 10, and 4*3=12 >10

Similarly, floor(10/4) = 2

Hence, floor(10/3) + 1 = 4, and floor(10/4) + 1 = 3, sum is 7, which matches the sample.

So, perhaps the formula is floor(m/a) + 1 + floor(m/b) + 1, but in this case, it's floor(m/a) + floor(m/b) + 2

Wait, but in the first sample, floor(4/6) + 1 = 1, floor(4/7) + 1 = 1, sum is 2, which matches.

In the second sample, floor(10/3) + 1 = 4, floor(10/4) + 1 = 3, sum is 7, which matches.

So, perhaps the formula is floor(m/a) + 1 + floor(m/b) + 1 = floor(m/a) + floor(m/b) + 2

But let's check another sample.

Third sample:

a = 7, b = 8, m = 56

floor(56/7) + 1 = 8 + 1 = 9

floor(56/8) + 1 = 7 + 1 = 8

Sum is 17, which matches the sample output.

Fourth sample:

a = 5, b = 6, m = 78123459896

floor(78123459896/5) + 1 = 15624691979 + 1 = 15624691980

floor(78123459896/6) + 1 = 13020576649 + 1 = 13020576650

Sum is 15624691980 + 13020576650 = 28645268630, which matches the sample.

Fifth sample:

a = 1, b = 1, m = 1

floor(1/1) + 1 = 1 + 1 = 2

floor(1/1) + 1 = 1 + 1 = 2

Sum is 4, which matches the sample.

Sixth sample:

a = 1, b = 1, m = 1000000000000000000

floor(1000000000000000000/1) + 1 = 1000000000000000000 + 1 = 1000000000000000001

floor(1000000000000000000/1) + 1 = 1000000000000000000 + 1 = 1000000000000000001

Sum is 1000000000000000001 + 1000000000000000001 = 2000000000000000002, which matches the sample.

So, in all these cases, the formula floor(m/a) + 1 + floor(m/b) + 1 = floor(m/a) + floor(m/b) + 2 seems to hold.

Hence, perhaps the maximum number of visible fireworks is floor(m/a) + floor(m/b) + 2

But let's think if this is always the case.

Consider a case where a = 2, b = 3, m = 0

floor(0/2) + 1 = 0 + 1 = 1

floor(0/3) + 1 = 0 + 1 = 1

Sum is 2

But in reality, if m = 0, each firework is visible only at the launch time.

So, at t = 0, both launchers have launched at t=0, so both fireworks are visible at t=0.

At t=2, only the first launcher has launched at t=2, so only one firework is visible.

At t=3, only the second launcher has launched at t=3, so only one firework is visible.

Hence, the maximum is 2, which matches the formula.

Another case: a = 2, b = 2, m = 2

floor(2/2) + 1 = 1 + 1 = 2

floor(2/2) + 1 = 1 + 1 = 2

Sum is 4

But in reality, at t=0, both launchers launch, and fireworks are visible at t=0,1,2

At t=2, both launchers launch again, and fireworks are visible at t=2,3,4

So, at t=2, there are four fireworks visible: two from t=0 and two from t=2.

Hence, the formula holds.

Wait, but in this case, t=2, the fireworks from t=0 and t=2 are both visible at t=2.

Each launcher has launched at t=0 and t=2, and each launch has m=2, so at t=2, there are four fireworks visible.

Hence, the formula holds.

Wait, but in this case, a=2, b=2, m=2

floor(2/2) + 1 = 1 + 1 = 2

floor(2/2) + 1 = 1 + 1 = 2

Sum is 4, which matches.

But what if a and b are different and their multiples overlap within the window.

For example, a=2, b=3, m=3

floor(3/2) + 1 = 1 + 1 = 2

floor(3/3) + 1 = 1 + 1 = 2

Sum is 4

At t=0, launches at t=0 from both, visible at t=0,1,2,3

At t=2, launches at t=2 from a, visible at t=2,3,4,5

At t=3, launches at t=3 from b, visible at t=3,4,5,6

At t=4, launches at t=4 from a, visible at t=4,5,6,7

At t=6, launches at t=6 from b, visible at t=6,7,8,9

Now, at t=3, fireworks from t=0 (a and b), t=2 (a), t=3 (b) → total of 4 fireworks

At t=4, fireworks from t=0 (a and b), t=2 (a), t=3 (b), t=4 (a) → 5 fireworks

Wait, according to the formula, floor(3/2) + 1 = 1 + 1 = 2, floor(3/3) + 1 = 1 + 1 = 2, sum is 4, but at t=4, there are 5 fireworks visible.

So, in this case, the formula gives 4, but in reality, at t=4, there are 5 fireworks visible.

Hence, the formula is incorrect.

So, what's wrong here?

Wait, perhaps I miscalculated the number of visible fireworks at t=4.

At t=4:

Fireworks launched at t=0 (a and b), visible until t=3

Fireworks launched at t=2 (a), visible until t=5

Fireworks launched at t=3 (b), visible until t=6

Fireworks launched at t=4 (a), visible until t=7

So, at t=4, fireworks from t=2, t=3, t=4 are visible.

Wait, but t=0 fireworks are only visible up to t=3, so not at t=4.

Hence, only fireworks from t=2, t=3, t=4 are visible at t=4.

So, from a: t=2 and t=4 (2 fireworks)

From b: t=3 (1 firework)

Total: 3 fireworks.

Wait, but according to the formula, floor(3/2) + 1 = 1 + 1 = 2, floor(3/3) + 1 = 1 + 1 = 2, sum is 4.

But in reality, at t=4, there are 3 fireworks visible.

So, the formula overestimates in this case.

Wait, perhaps I need to adjust the formula.

Let me think again.

In the formula floor(m/a) + 1 + floor(m/b) + 1, the '+1' accounts for the possibility that t is a multiple of a or b.

But in reality, the overlaps might not always allow for t to be optimally placed to maximize both counts simultaneously.

Hence, perhaps the formula needs to be adjusted to account for overlapping multiples.

Let me consider that the maximum number of multiples of a in any window of size m + 1 is floor(m/a) + 1, but only if t is chosen such that t is a multiple of a.

Similarly for b.

But if t is chosen to be a multiple of a, it may not be a multiple of b, unless a and b have a common multiple within the window.

Hence, perhaps the maximum is floor(m/a) + floor(m/b) + 2 - overlap, where overlap is the number of times t is a multiple of both a and b within the window.

But in the formula, since each firework is from a different launcher, even if t is a multiple of both a and b, both are counted separately.

Hence, overlap doesn't reduce the total count.

Wait, in the earlier example, the formula overestimates, but I'm not sure why.

Wait, perhaps the formula floor(m/a) + floor(m/b) + 2 is not always correct.

Let me consider another example.

Let a=1, b=2, m=1

floor(1/1) + 1 = 1 + 1 = 2

floor(1/2) + 1 = 0 + 1 = 1

Sum is 3

At t=0: fireworks from a at t=0, visible at t=0,1; fireworks from b at t=0, visible at t=0,1 → total 2 fireworks at t=0 and t=1

At t=1: fireworks from a at t=1, visible at t=1,2; fireworks from b at t=0, visible at t=1,2 → total 2 fireworks at t=1 and t=2

At t=2: fireworks from a at t=1, visible at t=1,2; fireworks from b at t=0, visible at t=1,2; fireworks from a at t=2, visible at t=2,3 → total 3 fireworks at t=2

Hence, at t=2, there are 3 fireworks visible, which matches the formula.

Wait, but according to the formula, floor(1/1) + 1 = 2, floor(1/2) + 1 = 1, sum is 3, which matches.

Another example: a=2, b=4, m=5

floor(5/2) + 1 = 2 + 1 = 3

floor(5/4) + 1 = 1 + 1 = 2

Sum is 5

At t=0: a launches at t=0, visible at t=0,1,2,3,4,5

b launches at t=0, visible at t=0,1,2,3,4,5

Total at t=0: 2 fireworks

At t=2: a launches at t=2, visible at t=2,3,4,5,6,7

b launches at t=0, visible at t=0,1,2,3,4,5

Total at t=2: fireworks from a at t=0 and t=2, b at t=0 → total 3 fireworks

At t=4: a launches at t=0, t=2, t=4, visible at t=0-5, t=2-7, t=4-9

b launches at t=0, t=4, visible at t=0-5, t=4-9

At t=4: fireworks from a at t=0, t=2, t=4; b at t=0, t=4 → total 5 fireworks

Hence, the formula holds.

Wait, but earlier in the a=2, b=3, m=3 example, the formula overestimates.

Wait, in that case, floor(3/2) + 1 = 1 + 1 = 2, floor(3/3) + 1 = 1 + 1 = 2, sum is 4

But at t=4, there were only 3 fireworks visible.

Wait, perhaps I made a mistake in calculating the visible fireworks at t=4.

Wait, if a=2, b=3, m=3

At t=4:

Fireworks from a launched at t=0, t=2, t=4, visible from t=0-3, t=2-5, t=4-7

Fireworks from b launched at t=0, t=3, visible from t=0-3, t=3-6

At t=4:

From a: t=2 and t=4 (two fireworks)

From b: t=0 and t=3 (two fireworks)

Wait, but t=0 from b is visible until t=3, so not at t=4.

t=3 from b is visible at t=3-6, so at t=4.

Hence, from a: t=2 and t=4 (two fireworks)

From b: t=3 (one firework)

Total: three fireworks

Hence, the formula gives 4, but in reality, it's 3.

So, the formula overestimates in this case.

Hence, the formula floor(m/a) + floor(m/b) + 2 is not always correct.

I need to find a better way.

Let me consider that the maximum number of multiples of a in any window of size m + 1 is floor(m/a) + 1, but this is only achievable if t is aligned with the multiples of a.

Similarly for b.

But when considering both a and b together, the alignment might not allow both to achieve their maximum counts simultaneously.

Hence, perhaps the correct formula is floor(m/a) + floor(m/b) + 2 - overlap, where overlap is the number of times t is a multiple of both a and b within the window.

But in the earlier example, a=2, b=3, m=3

floor(3/2) + 1 = 2

floor(3/3) + 1 = 2

overlap: t=0 is a multiple of both a and b

Hence, overlap =1

So, total_visible(t) = 2 + 2 - 1 = 3, which matches the actual count.

In the previous miscount, I had mistakenly thought the formula gave 4, but actually, considering the overlap, it should be 3.

Hence, perhaps the correct formula is floor(m/a) + floor(m/b) + 2 - overlap, where overlap is the number of multiples of LCM(a,b) in the window.

But calculating LCM(a,b) for a and b up to 10^18 is problematic, as LCM(a,b) could be up to 10^36.

Hence, I need a better way to calculate overlap without computing LCM(a,b).

Wait, perhaps I can consider that overlap is floor(m/LCM(a,b)) + 1, but again, LCM(a,b) is too large.

Hence, I need another approach.

Let me consider that if a and b are co-prime, their multiples don't overlap except at multiples of a*b.

But again, a*b is too large.

Wait, perhaps I can consider the greatest common divisor (GCD) of a and b.

Let gcd = GCD(a,b)

Then, LCM(a,b) = a*b / gcd

But a and b can be up to 10^18, so a*b can be up to 10^36, which is too big.

Hence, I need a different approach.

Let me consider that the maximum number of visible fireworks is floor((m + a)/a) + floor((m + b)/b)

Wait, floor((m + a)/a) = floor(m/a) + 1

Similarly for b.

Hence, this is the same as floor(m/a) + floor(m/b) + 2, which we saw overestimates in some cases.

Hence, perhaps I need to subtract the overlap, but as discussed, calculating overlap directly is problematic.

Let me consider another approach.

Let me consider that the total number of visible fireworks at time t is the number of a's multiples in [t - m, t] plus the number of b's multiples in [t - m, t].

I need to maximize this sum.

Let me consider that the number of a's multiples in [t - m, t] is floor(t/a) - floor((t - m - 1)/a)

Similarly for b.

I need to maximize floor(t/a) - floor((t - m - 1)/a) + floor(t/b) - floor((t - m - 1)/b)

This seems tricky, but perhaps I can consider that floor(t/x) - floor((t - m - 1)/x) is equal to floor((t - (t - m -1))/x) = floor((m + 1)/x)

Wait, no, that's not correct.

Actually, floor(t/x) - floor((t - m - 1)/x) is equal to the number of multiples of x in [t - m, t]

Which can be calculated as floor(t/x) - floor((t - m)/x)

Hence, floor(t/a) - floor((t - m)/a) + floor(t/b) - floor((t - m)/b)

I need to maximize this sum.

Let me consider that floor(t/a) - floor((t - m)/a) is equal to the number of multiples of a in [t - m, t]

Similarly for b.

Hence, total_visible(t) is the sum of these two counts.

I need to find t that maximizes this sum.

Let me consider that for t in [ka, (k+1)a -1], floor(t/a) is k

Similarly, floor((t - m)/a) is floor((t - m)/a)

I need to find t where floor(t/a) - floor((t - m)/a) is maximized, and similarly for b.

Wait, perhaps I can consider that floor(t/a) - floor((t - m)/a) is maximized when t is such that [t - m, t] contains as many multiples of a as possible.

Which is floor(m/a) + 1

Similarly for b.

Hence, perhaps the maximum is floor(m/a) + floor(m/b) + 2 - overlap

Where overlap is the number of multiples of LCM(a,b) in [t - m, t]

But again, LCM(a,b) is too large to handle directly.

Wait, perhaps I can calculate the overlap as floor(m / LCM(a,b)) + 1

But LCM(a,b) could be up to 10^36, which is problematic.

Hence, perhaps I need to find a way to compute floor(m / LCM(a,b)) efficiently.

But since LCM(a,b) could be up to 10^36, and m up to 10^18, floor(m / LCM(a,b)) could be 0 or 1, depending on the values.

Wait, if LCM(a,b) > m, then floor(m / LCM(a,b)) = 0

Else, it's floor(m / LCM(a,b))

But in practice, for a and b up to 10^18, LCM(a,b) could be up to 10^36, which is larger than m=10^18, so floor(m / LCM(a,b)) = 0

Hence, overlap would be 1 if LCM(a,b) <= m + 1, else 0

Wait, no.

Actually, floor(m / LCM(a,b)) is the number of multiples of LCM(a,b) up to m.

If LCM(a,b) > m, then floor(m / LCM(a,b)) = 0

Else, it's 1

Hence, overlap = floor(m / LCM(a,b)) + 1

But LCM(a,b) could be up to 10^36, which is larger than m=10^18, so floor(m / LCM(a,b)) = 0

Hence, overlap = 1 in most cases.

Wait, but in the earlier example where a=2, b=3, m=3

LCM(2,3)=6, which is greater than m=3, so floor(3/6)=0, hence overlap=0 +1=1

Hence, total_visible(t) = floor(3/2) + 1 + floor(3/3) +1 -1 = 2 + 2 -1 =3, which matches the earlier calculation.

In the case where a=1, b=1, m=1

LCM(1,1)=1, floor(1/1)=1, overlap=1 +1=2

Hence, total_visible(t) = floor(1/1)+1 + floor(1/1)+1 -2 =2 +2 -2=2, which matches.

In the case where a=2, b=2, m=2

LCM(2,2)=2, floor(2/2)=1, overlap=1 +1=2

Hence, total_visible(t) = floor(2/2)+1 + floor(2/2)+1 -2 =2 +2 -2=2, but earlier I thought it was 4.

Wait, perhaps I made a mistake.

Wait, in a=2, b=2, m=2

At t=0: both launch, visible at t=0,1,2

At t=2: both launch again, visible at t=2,3,4

At t=2, total fireworks: from t=0 (2 fireworks) and t=2 (2 fireworks) → total 4

Hence, the formula would give floor(2/2)+1 + floor(2/2)+1 - overlap

overlap = floor(2/LCM(2,2)) +1 = floor(2/2) +1 =1 +1=2

Hence, total_visible(t) =2 +2 -2=2, but in reality, it's 4.

Hence, the formula is still incorrect.

So, perhaps I need to adjust the overlap term.

Wait, perhaps the overlap is only floor(m / LCM(a,b))