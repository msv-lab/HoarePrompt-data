Alright, I have this problem to solve. Monocarp wants to throw a party and invite some of his friends, but there are some conditions. He has n friends, and each friend has a best friend, denoted by p_i. The p_i are all distinct and no one is their own best friend. So, it's like a pairing or some kind of arrangement among the friends.

The goal is to send invitations to some friends such that at least two friends come to the party. A friend comes to the party only if both they and their best friend receive an invitation. Each invitation is sent to exactly one friend.

I need to find the minimum number of invitations required to ensure that at least two friends come to the party.

First, I need to understand how the best friends are arranged. Since p_i are distinct and p_i != i, it means that the best friend relationship is a permutation of the friends where no one is mapped to themselves.

For example, if n=3 and p=[2,3,1], it means:

- Friend 1's best friend is 2

- Friend 2's best friend is 3

- Friend 3's best friend is 1

This forms a cycle where each friend is connected to another in a loop.

Another example from the problem:

- n=5, p=[3,1,2,5,4]

- Friend 1's best friend is 3

- Friend 2's best friend is 1

- Friend 3's best friend is 2

- Friend 4's best friend is 5

- Friend 5's best friend is 4

Here, friends 1,2,3 form a cycle, and friends 4,5 form another cycle.

From the examples in the problem, I can see different scenarios:

1. In the first test case with n=5 and p=[3,1,2,5,4], sending invitations to friends 4 and 5 results in both coming because each has their best friend invited.

2. In the second test case with n=4 and p=[2,3,4,1], sending invitations to friends 1,2,3 results in friends 1 and 2 coming.

3. In the third test case with n=2 and p=[2,1], sending invitations to both friends results in both coming.

From these, I need to find a general approach to determine the minimum number of invitations needed.

Let me think about the structure of the best friend relationships. Since p_i are distinct and p_i != i, the relationships form disjoint cycles.

For example, in the first test case, there are two cycles: 1->3->2->1 and 4->5->4.

In the second test case, n=4, p=[2,3,4,1]: 1->2->3->4->1 (a single cycle of length 4).

In the third test case, n=2, p=[2,1]: 1->2->1.

So, the best friend relationships form one or more cycles.

Now, to have at least two friends come to the party, I need to have at least two friends who both received invitations and their best friends also received invitations.

Let me consider the cycles separately.

In a cycle of length k:

- If I invite k/2 people (if k is even), but I need to ensure that for each coming friend, both they and their best friend are invited.

Wait, it's a bit tricky.

Let me think about the third test case: n=2, p=[2,1]. If I invite both, both come. If I invite only one, neither comes because the invited one doesn't have their best friend invited.

So, in a cycle of length 2, inviting both is necessary for both to come.

In a cycle of length 3: n=3, p=[2,3,1]. If I invite all three, all three come, but that's not minimal. Is there a way to invite fewer than 3 to have at least 2 come?

Wait, in a cycle of length 3, if I invite any two, say friends 1 and 2, then friend 1 has best friend 2 invited, so friend 1 comes. Friend 2 has best friend 3, who isn't invited, so friend 2 doesn't come. So, only friend 1 comes.

If I invite friends 1 and 3, then friend 1 has best friend 2, who isn't invited, so friend 1 doesn't come. Friend 3 has best friend 1, who is invited, so friend 3 comes.

Similarly, if I invite friends 2 and 3, friend 2 has best friend 3, who is invited, so friend 2 comes. Friend 3 has best friend 1, who isn't invited, so friend 3 doesn't come.

So, in a cycle of length 3, inviting any two results in only one friend coming. Only by inviting all three do all three come.

But the problem requires at least two friends to come.

Wait, in a cycle of length 3, is there a way to have at least two friends come by inviting fewer than three?

From above, it seems not, because inviting any two results in only one coming.

Wait, but in the first test case with n=5 and p=[3,1,2,5,4], which has a cycle of length 3 and a cycle of length 2, inviting friends 4 and 5 makes both come.

So, in disjoint cycles, invitations can be targeted to specific cycles.

Wait, but in the cycle of length 3, inviting any two only makes one come, but in the cycle of length 2, inviting both makes both come.

So, in this case, inviting two from the cycle of length 2 is sufficient to have two friends come.

In the second test case, n=4, p=[2,3,4,1], which is a single cycle of length 4.

From the example, inviting friends 1,2,3 makes friends 1 and 2 come.

Is there a way to invite fewer than 3?

If I invite friends 1 and 2, does friend 1 come? Friend 1 has best friend 2, who is invited, so friend 1 comes. Friend 2 has best friend 3, who isn't invited, so friend 2 doesn't come. So, only friend 1 comes.

If I invite friends 1 and 3, friend 1 has best friend 2, who isn't invited, so friend 1 doesn't come. Friend 3 has best friend 4, who isn't invited, so friend 3 doesn't come.

If I invite friends 1 and 4, friend 1 has best friend 2, who isn't invited, so friend 1 doesn't come. Friend 4 has best friend 1, who is invited, so friend 4 comes.

So, only friend 4 comes.

If I invite friends 2 and 3, friend 2 has best friend 3, who is invited, so friend 2 comes. Friend 3 has best friend 4, who isn't invited, so friend 3 doesn't come. So, only friend 2 comes.

If I invite friends 2 and 4, friend 2 has best friend 3, who isn't invited, so friend 2 doesn't come. Friend 4 has best friend 1, who isn't invited, so friend 4 doesn't come.

If I invite friends 3 and 4, friend 3 has best friend 4, who is invited, so friend 3 comes. Friend 4 has best friend 1, who isn't invited, so friend 4 doesn't come. So, only friend 3 comes.

So, in a cycle of length 4, inviting any two results in only one friend coming, unless the two invited are adjacent in the cycle, in which case two come.

Wait, in the earlier case, inviting friends 1,2,3 makes friends 1 and 2 come.

Wait, but in a cycle of length 4, inviting three seems necessary to have two come.

Is there a better way?

Wait, if I invite friends 1,2,4, then friend 1 has best friend 2, who is invited, so friend 1 comes. Friend 2 has best friend 3, who isn't invited, so friend 2 doesn't come. Friend 4 has best friend 1, who is invited, so friend 4 comes. So, friends 1 and 4 come.

So, by inviting three, two come.

Is there a way to invite fewer than three?

From above, inviting two seems to only bring one friend.

So, in a cycle of length 4, inviting three is necessary to have two come.

Wait, but in the example given in the problem, inviting friends 1,2,3 makes friends 1 and 2 come.

So, it's possible to have two come by inviting three.

But is there a way to have two come by inviting fewer than three?

From above, it seems not.

Now, considering the general case, I need to find the minimum number of invitations such that at least two friends come.

Given that the best friend relationships form disjoint cycles, I need to consider each cycle separately and see how many invitations to send to each cycle to maximize the number of friends who come.

But actually, since the cycles are disjoint, the coming of friends in one cycle doesn't affect another cycle.

So, I can consider each cycle independently and see what's the minimal number of invitations to have at least two friends come from all cycles combined.

Wait, but it's easier to handle each cycle separately and then sum up the invitations.

But since the cycles are disjoint, the minimal number of invitations would be the sum of the minimal invitations needed for each cycle.

But actually, since the cycles are disjoint, the friends in one cycle don't affect the coming of friends in another cycle.

So, to have at least two friends come in total, I can choose to have some cycles contribute some coming friends, as long as the total is at least two.

But this seems a bit complicated.

Maybe I should think in terms of selecting subsets of friends to invite, such that the number of friends who come (those who have both themselves and their best friend invited) is at least two, and minimize the number of invitations sent.

But that sounds too general and may not lead to an efficient solution.

Let me think differently.

Suppose I have a cycle of length k.

I need to select a subset of friends to invite, and the number of friends who come is the number of friends who have both themselves and their best friend invited.

In a cycle, each friend's best friend is determined by the permutation p.

Wait, perhaps I can model this as a graph where friends are nodes, and best friends are edges.

But since p_i is the best friend of i, and p_{p_i} may or may not be i, it's a permutation, not necessarily a matching.

Wait, but in this problem, since p_i != i and all p_i are distinct, it's a derangement, and in particular, it's a permutation without fixed points.

So, the best friend relation forms a disjoint union of cycles.

So, in graph terms, it's a union of cycles.

Given that, perhaps I can analyze each cycle separately.

In a cycle of length k, I need to choose a subset of friends to invite such that the number of friends who have both themselves and their best friend invited is at least m (in this problem, m=2).

But since the cycles are disjoint, I can handle each cycle separately and combine the results.

Wait, but m is global across all cycles.

So, I need at least m friends coming from the entire set of cycles.

In this problem, m=2.

So, I need at least two friends coming from all cycles combined.

To minimize the number of invitations, I should look for a way to have at least two friends come by inviting as few friends as possible.

Given that, perhaps I can find, for each cycle, the minimal number of invitations needed to have at least a certain number of friends come from that cycle, and then combine them.

But this seems complicated.

Alternatively, perhaps I can look for pairs of friends who can come together with minimal invitations.

Wait, let's consider that.

If I can find two friends who can come together by inviting a minimal number of friends, that would be optimal.

But how?

Let me consider that in a cycle, to have a friend come, both the friend and their best friend must be invited.

So, if I invite a friend and their best friend, the friend will come.

But, if I invite more, perhaps I can cover multiple friends coming.

Wait, perhaps I can look for friend pairs where inviting both makes both come.

But, in a cycle, inviting two adjacent friends might make both come.

Wait, in a cycle, if I invite two friends who are best friends, i and p_i, then both will come because each has the other invited.

So, inviting i and p_i makes both come.

That seems useful.

In that case, in a cycle, inviting any two adjacent friends makes both come.

So, in a cycle of length k, inviting any two adjacent friends makes two friends come.

In terms of minimal invitations, that would be inviting two to get two coming.

Is there a way to invite fewer than that?

Well, inviting one friend doesn't help because their best friend also needs to be invited for them to come.

So, inviting one friend doesn't make anyone come.

Inviting two adjacent friends makes two come.

Inviting two non-adjacent friends may make only one come, as seen in earlier examples.

So, in general, in a cycle, the minimal number of invitations to have at least two friends come is two, provided that the two invited are adjacent in the cycle.

Wait, but in the second test case with n=4 and p=[2,3,4,1], which is a cycle of length 4, inviting any two adjacent friends makes both come.

For example, inviting friends 1 and 2: friend 1 has best friend 2, who is invited, so friend 1 comes. Friend 2 has best friend 3, who isn't invited, so friend 2 doesn't come. So, only friend 1 comes.

Wait, that doesn't work.

Wait, maybe I'm misunderstanding.

Wait, in the second test case, n=4, p=[2,3,4,1]:

- Friend 1's best friend is 2

- Friend 2's best friend is 3

- Friend 3's best friend is 4

- Friend 4's best friend is 1

So, in this cycle, if I invite friends 1 and 2:

- Friend 1 has best friend 2, who is invited, so friend 1 comes.

- Friend 2 has best friend 3, who isn't invited, so friend 2 doesn't come.

- Friend 3 isn't invited, so doesn't come.

- Friend 4 isn't invited, so doesn't come.

So, only friend 1 comes.

If I invite friends 1 and 3:

- Friend 1 has best friend 2, who isn't invited, so doesn't come.

- Friend 3 has best friend 4, who isn't invited, so doesn't come.

- Friend 2 isn't invited, so doesn't come.

- Friend 4 isn't invited, so doesn't come.

No one comes.

If I invite friends 1 and 4:

- Friend 1 has best friend 2, who isn't invited, so doesn't come.

- Friend 4 has best friend 1, who is invited, so friend 4 comes.

- Friend 2 isn't invited, so doesn't come.

- Friend 3 isn't invited, so doesn't come.

Only friend 4 comes.

If I invite friends 2 and 3:

- Friend 2 has best friend 3, who is invited, so friend 2 comes.

- Friend 3 has best friend 4, who isn't invited, so friend 3 doesn't come.

- Friend 1 isn't invited, so doesn't come.

- Friend 4 isn't invited, so doesn't come.

Only friend 2 comes.

If I invite friends 2 and 4:

- Friend 2 has best friend 3, who isn't invited, so doesn't come.

- Friend 4 has best friend 1, who isn't invited, so doesn't come.

- Friend 1 isn't invited, so doesn't come.

- Friend 3 isn't invited, so doesn't come.

No one comes.

If I invite friends 3 and 4:

- Friend 3 has best friend 4, who is invited, so friend 3 comes.

- Friend 4 has best friend 1, who isn't invited, so friend 4 doesn't come.

- Friend 1 isn't invited, so doesn't come.

- Friend 2 isn't invited, so doesn't come.

Only friend 3 comes.

So, in this cycle of length 4, inviting any two adjacent friends only makes one come.

Wait, but earlier I thought that inviting two adjacent friends would make both come.

But according to this, it's not the case.

Wait, perhaps I made a mistake.

Let me re-examine.

In the cycle of length 4:

- Friend 1's best friend is 2

- Friend 2's best friend is 3

- Friend 3's best friend is 4

- Friend 4's best friend is 1

If I invite friends 1 and 2:

- Friend 1 has best friend 2, who is invited, so friend 1 comes.

- Friend 2 has best friend 3, who isn't invited, so friend 2 doesn't come.

- Friend 3 isn't invited, so doesn't come.

- Friend 4 isn't invited, so doesn't come.

Only friend 1 comes.

Wait, but according to the problem's example, inviting friends 1,2,3 makes friends 1 and 2 come.

Wait, but in that case:

- Friend 1 has best friend 2, who is invited, so friend 1 comes.

- Friend 2 has best friend 3, who is invited, so friend 2 comes.

- Friend 3 has best friend 4, who isn't invited, so friend 3 doesn't come.

- Friend 4 isn't invited, so doesn't come.

So, friends 1 and 2 come.

So, to have both friends 1 and 2 come, I need to invite friends 1,2, and 3.

Wait, but why does friend 2 come? Because friend 2 has best friend 3, who is invited.

So, in this case, inviting friends 1,2,3 makes friends 1 and 2 come.

Similarly, inviting friends 1,2 makes only friend 1 come.

So, to have two friends come, I need to invite three in this cycle of length 4.

Is there a better way?

Wait, what if I invite friends 1,2, and 4?

- Friend 1 has best friend 2, who is invited, so friend 1 comes.

- Friend 2 has best friend 3, who isn't invited, so friend 2 doesn't come.

- Friend 4 has best friend 1, who is invited, so friend 4 comes.

- Friend 3 isn't invited, so doesn't come.

So, friends 1 and 4 come.

That also achieves two friends coming by inviting three.

Is there a way to have two friends come by inviting fewer than three?

From earlier attempts, it seems not.

In a cycle of length 4, inviting any two doesn't make two friends come.

Inviting three makes two come.

So, in this case, the minimal number of invitations is three.

Similarly, in a cycle of length 3, inviting any two makes only one come, but inviting all three makes all three come.

So, to have at least two come, I need to invite all three.

Wait, but in the first test case, which has a cycle of length 3 and a cycle of length 2, inviting two from the cycle of length 2 makes two come, which is better.

So, in that case, I can target the cycle of length 2 to get two friends coming by inviting two.

But in cycles of length 3 or 4, inviting two doesn't suffice to have two come.

Wait, in the cycle of length 2, inviting both makes both come.

So, in that case, inviting two makes two come.

In cycles of length 3 and 4, inviting two makes only one come.

So, in those cases, to have two come, I need to invite more.

So, perhaps the strategy is to identify cycles of length 2 and exploit them to get two friends coming by inviting two.

For cycles of length greater than 2, inviting two doesn't suffice, so I need to invite more.

But in the first test case, there's a cycle of length 2 and a cycle of length 3.

By inviting two from the cycle of length 2, I can have two friends come without needing to invite anyone from the cycle of length 3.

Hence, the minimal number of invitations is 2.

In the second test case, there's a single cycle of length 4.

To have two friends come, I need to invite three.

In the third test case, there's a single cycle of length 2.

Inviting both makes both come.

So, the minimal number of invitations is 2.

Hence, the minimal number of invitations is 2 when there's a cycle of length 2, and 3 when there's only cycles of length greater than 2.

Wait, but in the second test case, n=4, p=[2,3,4,1], which is a single cycle of length 4, and the minimal number of invitations is 3.

In the first test case, n=5, p=[3,1,2,5,4], which has a cycle of length 3 and a cycle of length 2, and the minimal number of invitations is 2.

In the third test case, n=2, p=[2,1], which is a cycle of length 2, and the minimal number of invitations is 2.

So, it seems that if there's at least one cycle of length 2, then the minimal number of invitations is 2.

Otherwise, for cycles of length greater than 2, it's 3.

Wait, but in the second test case, with a cycle of length 4, it's 3.

Is this general?

Let me check for a cycle of length 5.

Suppose n=5, p=[2,3,4,5,1]

- Friend 1's best friend is 2

- Friend 2's best friend is 3

- Friend 3's best friend is 4

- Friend 4's best friend is 5

- Friend 5's best friend is 1

If I invite friends 1,2,3:

- Friend 1 has best friend 2, who is invited, so friend 1 comes.

- Friend 2 has best friend 3, who is invited, so friend 2 comes.

- Friend 3 has best friend 4, who isn't invited, so friend 3 doesn't come.

- Friend 4 isn't invited, so doesn't come.

- Friend 5 isn't invited, so doesn't come.

So, friends 1 and 2 come.

So, by inviting three, two come.

Is there a way to have two come by inviting fewer than three?

If I invite friends 1 and 2:

- Friend 1 has best friend 2, who is invited, so friend 1 comes.

- Friend 2 has best friend 3, who isn't invited, so friend 2 doesn't come.

- Others not invited.

Only friend 1 comes.

If I invite friends 1 and 3:

- Friend 1 has best friend 2, who isn't invited, so doesn't come.

- Friend 3 has best friend 4, who isn't invited, so doesn't come.

- Others not invited.

No one comes.

If I invite friends 1 and 4:

- Friend 1 has best friend 2, who isn't invited, so doesn't come.

- Friend 4 has best friend 5, who isn't invited, so doesn't come.

- Others not invited.

No one comes.

If I invite friends 1 and 5:

- Friend 1 has best friend 2, who isn't invited, so doesn't come.

- Friend 5 has best friend 1, who is invited, so friend 5 comes.

- Others not invited.

Only friend 5 comes.

If I invite friends 2 and 3:

- Friend 2 has best friend 3, who is invited, so friend 2 comes.

- Friend 3 has best friend 4, who isn't invited, so friend 3 doesn't come.

- Others not invited.

Only friend 2 comes.

If I invite friends 2 and 4:

- Friend 2 has best friend 3, who isn't invited, so doesn't come.

- Friend 4 has best friend 5, who isn't invited, so doesn't come.

- Others not invited.

No one comes.

If I invite friends 3 and 4:

- Friend 3 has best friend 4, who is invited, so friend 3 comes.

- Friend 4 has best friend 5, who isn't invited, so friend 4 doesn't come.

- Others not invited.

Only friend 3 comes.

So, in a cycle of length 5, inviting three makes two come