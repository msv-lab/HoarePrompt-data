Alright, I've got this problem to solve. Let's see what it's asking for. So, I have an array of integers, and I need to perform exactly k operations on it. In each operation, I can select any contiguous subarray (which could even be empty) and insert the sum of that subarray anywhere in the array. My goal is to maximize the sum of the array after k such operations, and since the sum can be very large, I need to output it modulo 10^9 + 7.

First, I need to understand what exactly an operation entails. I can choose any contiguous subarray, compute its sum, and then insert that sum into the array at any position I like. Importantly, the subarray can be empty, and its sum would be zero. After inserting, the rest of the array remains as is, but now there's an additional element in the array.

So, for each operation, I'm adding one element to the array, which is the sum of some contiguous subarray. Since I'm performing k operations, I'll be adding k new elements to the array. My aim is to choose which subarrays to sum and where to insert those sums in such a way that the total sum of the array is maximized after k operations.

Let me think about how the sum of the array changes with each operation. Initially, the sum is just the sum of the original array. With each operation, I'm adding the sum of a chosen subarray to the array. So, each operation increases the total sum by the sum of the chosen subarray.

Wait a minute, actually, no. Because when I insert the sum of a subarray into the array, I'm adding that value to the array's sum. But I need to be careful not to double-count the elements of the subarray. However, in this problem, it seems that inserting the sum of a subarray doesn't remove the original elements; it just adds the sum as a new element. So, the sum of the array after each operation is the sum of the original array plus the sums of the subarrays chosen in each operation.

Therefore, to maximize the sum after k operations, I need to choose k subarrays whose sums are as large as possible, and add those sums to the array's total sum.

So, the problem reduces to selecting k subarrays with the maximum possible sums and adding their sums to the original array's sum.

But there's a catch: since I can choose where to insert the sum, does the insertion affect future operations? For example, if I insert a large sum into the array, can I use that new element in subsequent operations to create even larger sums?

Hmm, let's see. When I insert a new element, it becomes part of the array for future operations. So, in the next operation, I can choose subarrays that include this new element.

This seems like it could lead to exponential growth in the sum, but I need to find the optimal way to maximize this sum over k operations.

Let me consider a simple example to get a better understanding.

Take the first test case from the example:

Input:

2 2

-4 -7

According to the note, it's advantageous to take an empty subarray twice and insert zero each time, resulting in a final sum of -4 + (-7) + 0 + 0 = -11, which modulo 10^9 + 7 is 999,999,996.

In this case, since all elements are negative, adding any subarray sum would only make the sum smaller, so adding zero is the best option.

Another test case:

Input:

3 3

2 2 8

Output:

96

According to the note, one possible sequence is to take the sum of the entire array (12) and insert it three times, leading to sums 12, 24, and 48 being added, resulting in a total sum of 2 + 2 + 8 + 12 + 24 + 48 = 96.

This suggests that repeatedly taking the sum of the entire array and inserting it is a good strategy when there are positive elements.

Wait, but in the first test case, taking the sum of the entire array would be negative, so inserting zero is better.

So, perhaps the strategy is to, in each operation, choose the subarray with the maximum sum and insert it.

But in the second test case, inserting the total sum (12) multiple times seems better than inserting the sum of the maximum subarray each time.

Wait, but the maximum subarray sum is 12 in that case, so it's the same.

I need to think more generally.

Let me consider that in each operation, I can choose any subarray, compute its sum, and insert that sum into the array.

I need to maximize the sum of the array after k operations.

Each operation adds one element to the array, which is the sum of a chosen subarray.

So, the total sum after k operations is the original sum plus the sums of the k inserted subarrays.

My aim is to choose k subarrays whose sums are as large as possible, and add them to the original sum.

But, since the inserted sums become part of the array, they can potentially be included in future subarrays.

Wait, but in the example, it seems that inserting the sum of the entire array and repeating that process leads to exponential growth.

Wait, no. In the second test case, starting with [2,2,8], sum=12.

First operation: insert 12, array becomes [2,2,8,12], sum=24.

Second operation: insert 24, array becomes [2,2,8,12,24], sum=36.

Third operation: insert 48, array becomes [2,2,8,12,24,48], sum=48.

But according to the note, the sums added are 12, 24, and 48, leading to a total sum of 96.

Wait, but 2+2+8+12+24+48 = 96, yes.

But according to the note, it's 2+2+8+12+24+48=96.

Wait, but in the second operation, they seem to be inserting 24, which is twice the previous sum.

Wait, no, 12 is the sum of the original array, then 24 is the sum of the new array [2,2,8,12], which is indeed 24.

Then, 48 is twice the previous sum, but actually, it's the sum of the current array [2,2,8,12,24], which is 48.

Wait, but 2+2+8+12+24 = 48.

So, in each operation, they are computing the sum of the current array and inserting it.

But in the first operation, the sum is 12, insert 12, sum becomes 24.

Second operation, sum is 24, insert 24, sum becomes 48.

Third operation, sum is 48, insert 48, sum becomes 96.

So, it's like the sum doubles with each operation.

Wait, but actually, when you insert a sum, it's adding that sum to the array, so the new sum is the old sum plus the inserted sum.

So, starting with sum=12, insert 12, new sum=12+12=24.

Then, insert 24, new sum=24+24=48.

Then, insert 48, new sum=48+48=96.

So, each operation is effectively doubling the current sum.

This seems like an efficient way to maximize the sum: in each operation, insert the current sum of the array.

Because inserting the current sum increases the total sum by the current sum, and since the inserted sum becomes part of the array, the next insertion can be the new, larger sum.

This seems to be a strategy to maximize the sum.

But is this always the best strategy?

Let me consider another test case.

Input:

1 7

7

So, array [7], k=7.

If I insert the current sum (7) in each operation, then:

Operation 1: insert 7, array becomes [7,7], sum=14.

Operation 2: insert 14, array becomes [7,7,14], sum=28.

Operation 3: insert 28, array becomes [7,7,14,28], sum=56.

Operation 4: insert 56, array becomes [7,7,14,28,56], sum=112.

Operation 5: insert 112, array becomes [7,7,14,28,56,112], sum=224.

Operation 6: insert 224, array becomes [7,7,14,28,56,112,224], sum=448.

Operation 7: insert 448, array becomes [7,7,14,28,56,112,224,448], sum=896.

So, the final sum is 896.

Is this the maximum possible?

It seems so, because any other subarray sum would be less than or equal to the current sum.

Hence, inserting the current sum in each operation seems to be the optimal strategy.

Let me consider another test case.

Input:

5 1

4 -2 8 -12 9

According to the note, it's advantageous to take the subarray [4, -2, 8] and insert its sum (10), resulting in the array [10,4,-2,8,-12,9], sum=17.

But according to my previous strategy, if I insert the current sum (4 + (-2) + 8 + (-12) + 9 = 7), then the array becomes [4,-2,8,-12,9,7], sum=14, which is less than 17.

So, in this case, selecting a partial subarray sum and inserting it gives a higher sum than inserting the total sum.

Therefore, my previous assumption might not hold in all cases.

Wait, perhaps selecting the maximum subarray sum to insert is better than inserting the total sum.

In this case, the maximum subarray sum is 10 (4 + (-2) + 8), and inserting it gives a sum of 17, which is better than inserting the total sum of 7, which gives 14.

So, maybe the strategy should be to insert the maximum subarray sum in each operation.

But in the second test case, the maximum subarray sum is the sum of the entire array, so it's the same as inserting the total sum.

Wait, in the second test case, the array is [2,2,8], sum=12, which is the maximum subarray sum, so inserting 12 each time works.

In the fourth test case, the maximum subarray sum is 10, while the total sum is 7, so inserting 10 gives a better sum than inserting 7.

Hence, perhaps the strategy is to find the maximum subarray sum and insert it in each operation.

But let's see what happens if I insert the maximum subarray sum in each operation.

In the fourth test case, maximum subarray sum is 10.

So, operation 1: insert 10, array becomes [4,-2,8,-12,9,10], sum=17.

Operation 2: insert 10 again, array becomes [4,-2,8,-12,9,10,10], sum=27.

And so on.

Wait, but in the test case, only one operation is allowed, so sum would be 17.

But according to the example, it seems that only one operation is performed, inserting the sum of [4,-2,8], which is 10, resulting in sum=17.

But if I had more operations, I could insert 10 again, increasing the sum further.

But in that test case, k=1, so only one insertion is allowed.

Another test case:

7 4

8 14 -9 6 0 -1 3

Let's compute the maximum subarray sum.

Looking at the array: 8,14,-9,6,0,-1,3.

The maximum subarray sum can be found using Kadane's algorithm or by inspection.

Looking at subarrays:

8

8+14=22

22-9=13

13+6=19

19+0=19

19-1=18

18+3=21

So, the maximum subarray sum is 22 (8+14).

If I insert 22 in each of the 4 operations, the sum would increase by 22 in each operation.

Starting sum: 8+14-9+6+0-1+3=31.

After operation 1: 31 + 22 = 53.

After operation 2: 53 + 22 = 75.

After operation 3: 75 + 22 = 97.

After operation 4: 97 + 22 = 119.

But according to the sample output, the answer is 351, which is much larger than 119, so there must be a better strategy.

Wait, perhaps inserting the current sum each time is better.

Starting sum: 31.

Operation 1: insert 31, sum becomes 31 + 31 = 62.

Operation 2: insert 62, sum becomes 62 + 62 = 124.

Operation 3: insert 124, sum becomes 124 + 124 = 248.

Operation 4: insert 248, sum becomes 248 + 248 = 496.

But according to the sample output, it's 351, which is less than 496, so maybe inserting the maximum subarray sum isn't the best strategy.

Wait, perhaps I'm missing something.

Wait, in the fourth operation, if I insert the current sum, which is 248, the sum becomes 248 + 248 = 496, but the sample output is 351, which is less than that, so maybe inserting the current sum isn't always the best.

Wait, perhaps I need to consider inserting the maximum subarray sum of the current array after each insertion.

Wait, let's see.

Starting with [8,14,-9,6,0,-1,3], sum=31.

Maximum subarray sum is 8+14=22.

Insert 22, array becomes [8,14,-9,6,0,-1,3,22], sum=31+22=53.

Now, maximum subarray sum is 8+14+22=44.

Insert 44, array becomes [8,14,-9,6,0,-1,3,22,44], sum=53+44=97.

Maximum subarray sum is 8+14+22+44=88.

Insert 88, array becomes [8,14,-9,6,0,-1,3,22,44,88], sum=97+88=185.

Maximum subarray sum is 8+14+22+44+88=176.

Insert 176, array becomes [8,14,-9,6,0,-1,3,22,44,88,176], sum=185+176=361.

But the sample output is 351, which is less than 361, so perhaps there's a mistake in this approach.

Wait, maybe I miscalculated the maximum subarray sums.

Wait, in the first step, starting with [8,14,-9,6,0,-1,3], maximum subarray sum is 8+14=22.

Insert 22, array becomes [8,14,-9,6,0,-1,3,22], sum=31+22=53.

Now, the array is [8,14,-9,6,0,-1,3,22], the maximum subarray sum is 8+14+22=44.

Insert 44, array becomes [8,14,-9,6,0,-1,3,22,44], sum=53+44=97.

Now, the array is [8,14,-9,6,0,-1,3,22,44], maximum subarray sum is 8+14+22+44=88.

Insert 88, array becomes [8,14,-9,6,0,-1,3,22,44,88], sum=97+88=185.

Now, insert 8+14+22+44+88=176, sum becomes 185+176=361.

But sample output is 351, which is less than 361, so perhaps I'm missing something.

Wait, maybe the operations are limited to k=4, meaning only 4 insertions.

In the above, I did 4 insertions, resulting in sum=361, but sample output is 351.

So, perhaps there's a mistake in the calculation.

Wait, perhaps the maximum subarray sum after each insertion isn't being calculated correctly.

Alternatively, maybe there's a different strategy that leads to a higher sum.

Wait, perhaps instead of always inserting the maximum subarray sum, I should consider inserting the sum of the entire array each time.

Wait, in the second test case, inserting the sum of the entire array each time worked well.

In this case, starting sum is 31.

Insert 31, sum becomes 31 + 31 = 62.

Insert 62, sum becomes 62 + 62 = 124.

Insert 124, sum becomes 124 + 124 = 248.

Insert 248, sum becomes 248 + 248 = 496.

But sample output is 351, which is less than 496, so that can't be right.

Wait, maybe inserting the maximum subarray sum isn't always better.

Alternatively, perhaps there's a way to combine insertions to get a higher sum.

Wait, perhaps I need to consider that inserting a large sum can create new subarrays with even larger sums.

But in practice, it seems that inserting the current sum each time leads to exponential growth, but in the sample, it's giving a lower sum.

Wait, maybe I need to consider negative numbers more carefully.

Wait, in the fourth test case, there are negative numbers, but the strategy still seems to work.

Wait, perhaps I need to consider the sum of the entire array versus the maximum subarray sum.

In the second test case, they are the same, but in the fourth test case, the maximum subarray sum is larger than the total sum.

Wait, in the fourth test case, the total sum is 31, and the maximum subarray sum is 22.

But 31 > 22, so inserting 31 is better than inserting 22.

Wait, no, in the first insertion, inserting 31 would lead to sum=31+31=62.

Then, inserting 62 leads to sum=62+62=124, and so on, up to 496.

But according to the sample, it's 351, which is less than 496, so perhaps inserting the maximum subarray sum is better.

Wait, but in practice, when I tried inserting the maximum subarray sum, I got 361, which is still higher than 351.

So, perhaps the sample is wrong, or I'm missing something.

Wait, perhaps there are constraints on where I can insert the sum.

Wait, no, the problem says I can insert the sum anywhere in the array.

So, perhaps I need to choose where to insert it to maximize the sum for future operations.

Wait, but since I'm only adding the sum, and it's just added to the sum of the array, the position doesn't matter for the total sum.

Wait, perhaps I'm missing that inserting the sum in a specific position can create better subarrays.

But in terms of the total sum, it's just adding the inserted sum to the total sum, so the position shouldn't matter.

Hence, perhaps the best strategy is to, in each operation, insert the maximum possible sum of any subarray.

But in practice, it seems that inserting the current sum of the array leads to higher sums.

Wait, in the second test case, inserting the current sum leads to higher sums than inserting the maximum subarray sum.

In the fourth test case, inserting the maximum subarray sum leads to higher sums than inserting the current sum.

So, perhaps I need to choose, in each operation, the largest possible sum that I can insert.

Wait, perhaps the strategy is to, in each operation, insert the sum of the maximum subarray of the current array.

But in practice, it seems that inserting the current sum leads to higher sums in some cases, but not in others.

Wait, perhaps I need to consider that inserting the current sum includes all elements, while inserting the maximum subarray sum may exclude some negative elements.

But in the fourth test case, inserting the maximum subarray sum excludes the negative elements, leading to a higher sum.

In the second test case, inserting the current sum includes all positive elements, leading to higher sums.

Wait, perhaps the best strategy is to insert the sum of the maximum subarray in each operation.

To find the maximum subarray sum, I can use Kadane's algorithm.

Then, in each operation, insert this maximum subarray sum into the array, and update the new maximum subarray sum for the next operation.

But in practice, as shown in the fourth test case, this leads to a sum of 361, while the sample output is 351.

So, perhaps there's a mistake in the sample or in my understanding.

Wait, perhaps I need to consider that after inserting a sum, the new maximum subarray sum changes.

Wait, in the fourth test case, starting with [8,14,-9,6,0,-1,3], maximum subarray sum is 22.

Insert 22, array becomes [8,14,-9,6,0,-1,3,22], new maximum subarray sum is 8+14+22=44.

Insert 44, array becomes [8,14,-9,6,0,-1,3,22,44], new maximum subarray sum is 8+14+22+44=88.

Insert 88, array becomes [8,14,-9,6,0,-1,3,22,44,88], new maximum subarray sum is 8+14+22+44+88=176.

Insert 176, array becomes [8,14,-9,6,0,-1,3,22,44,88,176], sum=31+22+44+88+176=361.

But sample output is 351, which is less than 361, so perhaps I'm missing a better strategy.

Wait, maybe I need to choose different subarrays in each operation to maximize the sum.

Alternatively, perhaps I need to consider that inserting the sum creates a new element that can be part of future subarrays, potentially creating larger sums.

But in practice, it seems that inserting the maximum subarray sum in each operation leads to the highest possible sum.

Wait, perhaps in the sample, they are using