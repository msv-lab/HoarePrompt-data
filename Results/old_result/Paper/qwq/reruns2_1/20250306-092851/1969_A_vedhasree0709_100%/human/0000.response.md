Alright, I've got this problem to solve. Let's see what it's asking for. So, Monocarp wants to throw a party and he has n friends. He wants at least 2 of them to come to the party. Each friend has a best friend, and this best friend relationship is represented by p_i, which means the best friend of the i-th friend is p_i. The conditions are that all p_i are distinct and p_i is not equal to i for any friend. That makes sense; no one is their own best friend.

Now, Monocarp can send invitations to some of his friends. A friend will come to the party only if both they and their best friend receive an invitation. Importantly, the best friend doesn't have to come, just receive an invitation. Each invitation is sent to exactly one friend.

The goal is to find the minimum number of invitations Monocarp has to send so that at least 2 friends come to the party.

Let me try to understand this with the example provided.

In the first test case:

n = 5

p = [3, 1, 2, 5, 4]

So, friend 1's best friend is 3, friend 2's best friend is 1, friend 3's best friend is 2, friend 4's best friend is 5, and friend 5's best friend is 4.

Monocarp sends invitations to friends [1, 2, 4, 5]. Let's see who comes:

- Friend 1: Does friend 1 and their best friend (3) both have invitations? Friend 1 has an invitation, but friend 3 does not. So, friend 1 does not come.

- Friend 2: Friend 2 has an invitation, and their best friend is 1, who also has an invitation. So, friend 2 comes.

- Friend 3: Friend 3 does not have an invitation, so they don't come.

- Friend 4: Friend 4 has an invitation, and their best friend is 5, who also has an invitation. So, friend 4 comes.

- Friend 5: Friend 5 has an invitation, and their best friend is 4, who also has an invitation. So, friend 5 comes.

Wait, but according to the example, only friends 2, 4, and 5 come, but the explanation says only 2, 4, and 5 come. But actually, based on the rules, both 4 and 5 should come since both and their best friends have invitations. Friend 2 also comes because friend 2 and friend 1 have invitations, even though friend 1 doesn't come because their best friend, friend 3, doesn't have an invitation.

Okay, I think I got that.

Now, the task is to find the minimum number of invitations needed so that at least 2 friends come to the party.

Looking at the first test case, the example says that sending invitations to friends 4 and 5 is sufficient, because both will come since each has their best friend invited. So, that's 2 invitations.

In the second test case:

n = 4

p = [2, 3, 4, 1]

Monocarp sends invitations to friends 1, 2, and 3.

- Friend 1: Has invitation, best friend is 2 (has invitation), so friend 1 comes.

- Friend 2: Has invitation, best friend is 3 (has invitation), so friend 2 comes.

- Friend 3: Has invitation, best friend is 4 (does not have invitation), so friend 3 does not come.

- Friend 4: Does not have invitation, so does not come.

So, friends 1 and 2 come. The output is 3 invitations.

But the problem says it's impossible to have at least 2 friends come with fewer than 3 invitations. Let's see if that's true.

Suppose Monocarp sends invitations to only 2 friends. Let's try friends 1 and 2.

- Friend 1: Has invitation, best friend is 2 (has invitation), so friend 1 comes.

- Friend 2: Has invitation, best friend is 3 (no invitation), so friend 2 does not come.

- Friend 3: No invitation, does not come.

- Friend 4: No invitation, does not come.

Only friend 1 comes, which is less than 2. Not sufficient.

Another try: friends 1 and 3.

- Friend 1: Has invitation, best friend is 2 (no invitation), does not come.

- Friend 2: No invitation, does not come.

- Friend 3: Has invitation, best friend is 4 (no invitation), does not come.

- Friend 4: No invitation, does not come.

No one comes. That's worse.

Another try: friends 2 and 3.

- Friend 1: No invitation, does not come.

- Friend 2: Has invitation, best friend is 3 (has invitation), so friend 2 comes.

- Friend 3: Has invitation, best friend is 4 (no invitation), does not come.

- Friend 4: No invitation, does not come.

Only friend 2 comes. Still less than 2.

Another try: friends 3 and 4.

- Friend 1: No invitation, does not come.

- Friend 2: No invitation, does not come.

- Friend 3: Has invitation, best friend is 4 (has invitation), so friend 3 comes.

- Friend 4: Has invitation, best friend is 1 (no invitation), does not come.

Only friend 3 comes.

Another try: friends 2 and 4.

- Friend 1: No invitation, does not come.

- Friend 2: Has invitation, best friend is 3 (no invitation), does not come.

- Friend 3: No invitation, does not come.

- Friend 4: Has invitation, best friend is 1 (no invitation), does not come.

No one comes.

So, it seems impossible to have at least 2 friends come with only 2 invitations. Hence, the minimum is 3 invitations.

In the third test case:

n = 2

p = [2, 1]

Monocarp sends invitations to both friends 1 and 2.

- Friend 1: Has invitation, best friend is 2 (has invitation), so friend 1 comes.

- Friend 2: Has invitation, best friend is 1 (has invitation), so friend 2 comes.

Both come, so with 2 invitations, which is the minimum required since n=2.

From these examples, it seems that the minimum number of invitations needed is related to the structure of the best friend relationships.

Looking deeper, the best friend relationships form cycles. For example, in the first test case, there are two cycles: 1-3-2 and 4-5.

In the second test case, it's a single cycle: 1-2-3-4.

In the third test case, it's a cycle of length 2: 1-2.

So, in the first test case, with two cycles, sending invitations to 2 friends in the same cycle of length 3 is enough to have 2 come.

In the second test case, with a single cycle of length 4, sending invitations to 3 friends is necessary to have at least 2 come.

In the third test case, with a single cycle of length 2, sending invitations to both is necessary.

It seems that in cycles of length 2, sending invitations to both is necessary to have both come, which is the minimum required.

In cycles of length greater than 2, sending invitations to k friends such that at least 2 come, with k being less than n.

Specifically, in the first test case, cycle 1-3-2 has length 3, and sending invitations to any 2 friends in this cycle makes both of them come.

In the second test case, cycle 1-2-3-4 has length 4, and sending invitations to 3 friends makes 2 come.

Wait, but in the first test case, sending invitations to friends 4 and 5, who are in a cycle of length 2, makes both come.

Wait, no, in the first test case, 4 and 5 are in a cycle of length 2, and sending invitations to both makes both come.

Similarly, in the third test case, which is also a cycle of length 2, sending invitations to both makes both come.

In the second test case, which is a cycle of length 4, sending invitations to 3 friends makes 2 come.

So, perhaps in general, for a cycle of length k, the minimum number of invitations needed to make at least 2 friends come is:

- If k = 2, send 2 invitations to make both come.

- If k >= 3, send k-1 invitations to make k-1 friends come.

Wait, but in the first test case, for the cycle 1-3-2 of length 3, sending invitations to any 2 friends makes both come.

Wait, no, sending invitations to friends 1 and 3 would make friend 1 come (since friend 1 and friend 3 have invitations), and friend 3 comes (since friend 3 and friend 2 have invitations). So, both friend 1 and friend 3 come.

Similarly, sending invitations to friends 1 and 2: friend 1 comes (since friend 1 and friend 3 have invitations), friend 2 comes (since friend 2 and friend 1 have invitations). So, both come.

Similarly, sending invitations to friends 2 and 3: friend 2 comes (friend 2 and friend 1 have invitations), friend 3 comes (friend 3 and friend 2 have invitations).

So, in a cycle of length 3, sending invitations to any 2 friends makes both come.

Similarly, in a cycle of length 4, sending invitations to any 3 friends makes at least 2 come.

Wait, but in the second test case, sending invitations to friends 1, 2, and 3:

- Friend 1 comes (has invitation, friend 2 has invitation).

- Friend 2 comes (has invitation, friend 3 has invitation).

- Friend 3 does not come (has invitation, friend 4 does not have invitation).

- Friend 4 does not come (no invitation).

So, friends 1 and 2 come.

Another way: send invitations to friends 1, 2, and 4.

- Friend 1 comes (has invitation, friend 2 has invitation).

- Friend 2 comes (has invitation, friend 3 has invitation).

- Friend 3 does not come (no invitation).

- Friend 4 comes (has invitation, friend 1 has invitation).

So, friends 1, 2, and 4 come.

Similarly, sending invitations to friends 2, 3, and 4.

- Friend 1 does not come (no invitation).

- Friend 2 comes (has invitation, friend 3 has invitation).

- Friend 3 comes (has invitation, friend 4 has invitation).

- Friend 4 comes (has invitation, friend 1 does not have invitation).

So, friends 2, 3, and 4 come.

Wait, but according to the problem, it's acceptable as long as at least 2 come.

So, in this case, sending invitations to any 3 friends makes at least 2 come.

But is there a way to make at least 2 come with only 2 invitations?

Let's try sending invitations to friends 1 and 2.

- Friend 1 comes (has invitation, friend 2 has invitation).

- Friend 2 comes (has invitation, friend 3 has invitation).

- Friend 3 does not come (no invitation).

- Friend 4 does not come (no invitation).

So, friends 1 and 2 come. That's 2 friends coming with 2 invitations.

Wait, but the problem says it's impossible to have at least 2 come with fewer than 3 invitations. But according to this, sending invitations to friends 1 and 2 makes 2 friends come.

Wait, maybe I misread the problem.

Wait, in the second test case, the output is 3, meaning that the minimum number of invitations needed is 3.

But according to my earlier reasoning, sending invitations to friends 1 and 2 makes 2 friends come, which should suffice.

But the problem says it's impossible with fewer than 3 invitations.

Wait, perhaps I misunderstood the condition.

Let me read the problem again.

"Calculate the minimum number of invitations Monocarp has to send so that at least 2 friends come to the party."

In the second test case, the output is 3.

But according to my earlier reasoning, sending invitations to friends 1 and 2 makes friends 1 and 2 come.

Wait, but according to the problem's explanation, it says:

"For example, if p = [2,3,4,1], and Monocarp sends invitations to friends [1,2,3], then friends [1,2] will come to the party. The friend 1 won't come since his best friend didn't receive an invitation; the friend 3 won't come since he didn't receive an invitation."

Wait, no, in this case, friend 1 has invitation, best friend 2 has invitation, so friend 1 comes.

Friend 2 has invitation, best friend 3 has invitation, so friend 2 comes.

Friend 3 has invitation, best friend 4 does not have invitation, so friend 3 does not come.

Friend 4 does not have invitation, so does not come.

So, friends 1 and 2 come.

So, with 3 invitations, 2 friends come.

But according to the problem, sending invitations to [1,2,3] makes friends 1 and 2 come.

But in my earlier attempt, sending invitations to friends 1 and 2 makes friends 1 and 2 come.

Wait, maybe there's a mistake in the problem's explanation or in my understanding.

Let me check again.

Given p = [2,3,4,1]

So, friend 1's best friend is 2, friend 2's best friend is 3, friend 3's best friend is 4, friend 4's best friend is 1.

If Monocarp sends invitations to friends 1 and 2:

- Friend 1: has invitation, best friend 2 has invitation, so friend 1 comes.

- Friend 2: has invitation, best friend 3 does not have invitation, so friend 2 does not come.

- Friend 3: does not have invitation, does not come.

- Friend 4: does not have invitation, does not come.

So, only friend 1 comes.

Wait, that's different from what I thought earlier.

I must have made a mistake earlier.

So, actually, sending invitations to friends 1 and 2 makes only friend 1 come, because friend 2 does not have their best friend (friend 3) invited.

Therefore, friend 2 does not come.

Hence, only friend 1 comes, which is less than 2.

That's why sending invitations to only 2 friends is not sufficient in this case.

Wait, but earlier I thought that friend 2 would come because friend 2 has invitation and friend 3 has invitation, but actually, friend 3 does not have invitation in this scenario.

Wait, no, if Monocarp sends invitations to friends 1 and 2, then:

- Friend 1: has invitation, best friend 2 has invitation, so friend 1 comes.

- Friend 2: has invitation, best friend 3 does not have invitation, so friend 2 does not come.

- Friend 3: does not have invitation, does not come.

- Friend 4: does not have invitation, does not come.

Hence, only friend 1 comes.

So, to have at least 2 friends come, Monocarp needs to send invitations to at least 3 friends, as in the example.

I must have misremembered the conditions earlier.

So, in this case, sending invitations to friends 1, 2, and 3:

- Friend 1: has invitation, best friend 2 has invitation, so friend 1 comes.

- Friend 2: has invitation, best friend 3 has invitation, so friend 2 comes.

- Friend 3: has invitation, best friend 4 does not have invitation, so friend 3 does not come.

- Friend 4: does not have invitation, does not come.

So, friends 1 and 2 come.

Similarly, sending invitations to friends 2, 3, and 4:

- Friend 1: does not have invitation, does not come.

- Friend 2: has invitation, best friend 3 has invitation, so friend 2 comes.

- Friend 3: has invitation, best friend 4 has invitation, so friend 3 comes.

- Friend 4: has invitation, best friend 1 does not have invitation, so friend 4 does not come.

So, friends 2 and 3 come.

Similarly, sending invitations to friends 1, 3, and 4:

- Friend 1: has invitation, best friend 2 does not have invitation, does not come.

- Friend 2: does not have invitation, does not come.

- Friend 3: has invitation, best friend 4 has invitation, so friend 3 comes.

- Friend 4: has invitation, best friend 1 does not have invitation, does not come.

So, only friend 3 comes.

Wait, that's only one friend.

Wait, perhaps I made a mistake here.

Wait, friend 3 has invitation, best friend 4 has invitation, so friend 3 comes.

Friend 4 has invitation, best friend 1 does not have invitation, so friend 4 does not come.

Friend 1 does not have invitation, does not come.

Friend 2 does not have invitation, does not come.

So, only friend 3 comes.

Hence, with invitations to friends 1, 3, and 4, only friend 3 comes.

That doesn't satisfy the condition of having at least 2 friends come.

Wait, but earlier, the problem's explanation says that sending invitations to [1,2,3] makes friends [1,2] come.

But according to my reasoning, only friend 1 comes.

Is there a misunderstanding here?

Wait, perhaps I misinterpreted the condition for a friend to come.

The problem says:

"The i-th friend comes to the party if both the i-th friend and the p_i-th friend receive an invitation."

Wait, re-reading this carefully: "The i-th friend comes to the party if both the i-th friend and the p_i-th friend receive an invitation."

So, for friend i to come, two conditions must be met:

1. Friend i receives an invitation.

2. Friend p_i receives an invitation.

Now, in the second test case, with p = [2,3,4,1], and sending invitations to friends [1,2,3]:

- Friend 1: has invitation, p_1 = 2 has invitation → friend 1 comes.

- Friend 2: has invitation, p_2 = 3 has invitation → friend 2 comes.

- Friend 3: has invitation, p_3 = 4 does not have invitation → friend 3 does not come.

- Friend 4: does not have invitation → does not come.

So, friends 1 and 2 come.

Hence, with 3 invitations, at least 2 friends come.

Similarly, with only 2 invitations, say to friends 1 and 2:

- Friend 1: has invitation, p_1 = 2 has invitation → friend 1 comes.

- Friend 2: has invitation, p_2 = 3 does not have invitation → friend 2 does not come.

- Friend 3: does not have invitation → does not come.

- Friend 4: does not have invitation → does not come.

So, only friend 1 comes.

Hence, it's impossible to have at least 2 friends come with only 2 invitations.

Therefore, the minimum number is 3.

So, in general, for a cycle of length k, the minimum number of invitations needed to make at least 2 friends come is:

- If k = 2: send 2 invitations to make both come.

- If k >= 3: send k-1 invitations to make k-1 friends come.

Wait, but in the second test case, with k=4, sending k-1=3 invitations makes at least 2 friends come.

Similarly, in the first test case, with a cycle of length 3, sending k-1=2 invitations makes 2 friends come.

And with a cycle of length 2, sending 2 invitations makes both come.

So, perhaps the general rule is:

For a cycle of length k:

- If k = 2: minimum invitations = 2

- If k >= 3: minimum invitations = k-1

But in the first test case, there are two cycles: one of length 3 (1-3-2) and one of length 2 (4-5).

In this case, sending invitations to 2 friends in the cycle of length 3 makes 2 friends come, which is sufficient.

Alternatively, sending invitations to both friends in the cycle of length 2 also makes 2 friends come.

Hence, the minimum is 2 invitations.

In the second test case, with a single cycle of length 4, sending k-1=3 invitations makes at least 2 friends come.

In the third test case, with a cycle of length 2, sending 2 invitations makes both come.

Hence, the general approach seems to be:

- Identify the cycles in the best friend relationships.

- For each cycle, determine the minimum number of invitations needed to make at least 2 friends come.

- Choose the option that requires the fewest invitations across all cycles and combinations.

But in the first test case, there are two cycles: one of length 3 and one of length 2.

Sending invitations to 2 friends in the cycle of length 3 makes 2 come, which is sufficient.

Similarly, sending invitations to both friends in the cycle of length 2 makes 2 come.

Hence, the minimum is 2 invitations.

In the second test case, with a single cycle of length 4, sending 3 invitations makes at least 2 come.

Hence, the minimum is 3 invitations.

In the third test case, with a single cycle of length 2, sending 2 invitations makes both come.

Hence, the minimum is 2 invitations.

So, in general, for multiple cycles, we can choose to send invitations to the cycle that allows us to achieve at least 2 friends coming with the fewest invitations.

Hence, the strategy is:

- If there is a cycle of length 2, send 2 invitations to make both come.

- If there are cycles of length >=3, send k-1 invitations for the smallest such cycle.

- Choose the option that requires the fewest invitations.

In the first test case, there is a cycle of length 2, so sending 2 invitations suffices.

In the second test case, there is only a cycle of length 4, so sending 3 invitations is necessary.

In the third test case, only a cycle of length 2, so sending 2 invitations is necessary.

Hence, the program needs