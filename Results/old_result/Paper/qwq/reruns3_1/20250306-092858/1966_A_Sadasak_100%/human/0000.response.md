Alright, I have this problem to solve. Let's read it carefully.

So, I have a hand of n cards, each with a number on it, and a fixed integer k. I can perform an operation any number of times, where I choose k cards that all have the same number and exchange them for k-1 cards, each of which can have any number I choose. The goal is to find the minimum number of cards I can have in the end.

First, I need to understand the operation clearly. If I have k cards with the same number, I can replace them with k-1 cards of any numbers I choose. The idea seems to be that I can reduce the total number of cards by performing these operations.

Let's look at the example provided:

Input:

7

5 3

4 1 1 4 4

1 10

7

7 2

4 2 1 100 5 2 3

10 4

1 1 1 1 1 1 1 1 1 1

5 2

3 8 1 48 7

6 2

10 20 30 10 20 40

6 3

10 20 30 10 20 40

Output:

2

1

1

3

5

1

6

Let's take the first test case:

n = 5, k = 3

cards: 4, 1, 1, 4, 4

From the description, it seems that we can perform operations on groups of 3 cards with the same number, replacing them with 2 cards of any numbers.

Looking at the cards: 4,1,1,4,4

I have three 4's and two 1's.

I can perform the operation on the three 4's, replacing them with two cards of any number, say two 1's.

Now, my hand is: 1,1,1

Now, I can perform the operation again on three 1's, replacing them with two cards of any number, say two 1's.

Wait, but in the example, it seems to lead to 2 cards.

Wait, maybe I need to choose differently.

Wait, perhaps I should think in terms of frequencies.

Let me think about the frequencies of each number.

In the first test case:

4 appears three times, 1 appears twice.

So, frequency of 4 is 3, frequency of 1 is 2.

Given k = 3, I can perform operations on the frequency if it's at least k.

So, for frequency of 4, which is 3, I can perform one operation, reducing it by k and adding k-1 cards.

Wait, but in this case, since k = 3, and frequency of 4 is 3, after one operation, the frequency of 4 becomes 3 - 3 + (k-1) = 3 - 3 + 2 = 2, but wait, no.

Wait, let's clarify the operation.

I choose k cards with the same number and replace them with k-1 cards of any numbers.

So, in terms of frequency, for a number that appears f times, if f >= k, I can perform floor(f / k) operations, each reducing f by k and adding k-1 cards.

Wait, but in the first operation, I choose k cards of the same number and replace them with k-1 cards of any numbers.

So, the net reduction in the total number of cards is k - (k-1) = 1 card.

Wait, so each operation reduces the total number of cards by 1.

Therefore, the minimum number of cards I can have is n - floor(f / k) for each frequency f >= k.

Wait, but that seems too simplistic.

Wait, perhaps I need to consider that the k-1 cards I add can be of any numbers, possibly the same as existing ones, so their frequencies can be increased.

Wait, perhaps it's better to think in terms of reducing the frequencies.

Let me consider that for each number, I can reduce its frequency by k and add k-1 to some other numbers' frequencies.

But this seems a bit tangled.

Maybe I should look for a different approach.

Let me think about the total number of cards.

Each operation reduces the total number of cards by 1, as I replace k cards with k-1 cards.

Therefore, the maximum number of operations I can perform is floor((number of cards with frequency >=k) / k) * (k -1).

Wait, that doesn't seem right.

Wait, perhaps I should think recursively.

Start with the current set of frequencies, perform operations on frequencies >=k, and see how it reduces.

But that might be time-consuming.

Is there a smarter way?

Wait, perhaps I can think in terms of the maximum frequency and the total number of cards.

Wait, maybe I can use the formula:

minimum cards = n - sum floor(f_i / k) * (k -1)

where f_i is the frequency of each number.

Wait, not sure.

Let me try with the first test case.

n = 5, k =3

frequencies: 4 appears 3 times, 1 appears 2 times.

floor(3 /3) =1, so reduce by 1 operation, which reduces total cards by 1.

So, 5 -1 =4.

But according to the example, it's 2.

Wait, that doesn't match.

Maybe my approach is wrong.

Let me think differently.

Each operation allows me to replace k cards of the same number with k-1 cards of any numbers.

So, effectively, I can choose to reduce the number of cards by 1 each time, but also change the distribution of the numbers.

Perhaps the key is to minimize the numbers that have high frequencies, by repeatedly performing operations on them.

In the first example, I have three 4's and two 1's.

I can perform one operation on the three 4's, replacing them with two cards of any number, say two 1's.

Now, I have two 1's + two 1's from the operation, so four 1's.

Now, I can perform another operation on three of these four 1's, replacing them with two cards of any number, say two 1's.

Now, I have two 1's from the remaining ones plus two from the operation, totaling four 1's again.

Wait, that doesn't seem right.

Wait, perhaps I need to choose differently.

Alternatively, maybe I can choose to replace the three 4's with two different numbers, say one 1 and one 2.

Then, my hand would be: 1,1,4

Now, no group has k=3 same numbers, so no more operations can be performed.

But in this case, I have three cards left.

But according to the example, it's possible to have two cards left.

Wait, perhaps I can choose to replace the three 4's with two 1's.

Then, my hand would be: 1,1,1,4

Now, I can perform another operation on three 1's, replacing them with two cards, say two 4's.

Then, my hand would be: 4,4,4

Now, I can perform another operation on these three 4's, replacing them with two cards, say two 1's.

Now, I have two 1's.

No more operations can be performed.

So, total cards left are two.

This matches the example.

So, the key is to choose wisely which numbers to replace with during each operation to minimize the total number of cards.

But this seems a bit tricky to implement.

Is there a pattern or formula that can give me the minimum number of cards directly?

Let me consider the frequencies.

In the first example:

frequencies: 4 appears 3 times, 1 appears 2 times.

I performed operations until no group has k or more cards.

In the end, I have two cards.

Is there a mathematical way to compute this?

Let me consider the general case.

Suppose I have frequencies f1, f2, ..., fm for m different numbers.

I can perform operations on any fi where fi >=k, replacing fi with fi -k + (k-1) = fi -1.

Because k-1 cards are added, but k cards are removed.

So, fi -k + (k-1) = fi -1.

So, each operation reduces fi by 1, and reduces the total number of cards by 1.

Therefore, the maximum number of operations I can perform is equal to the sum of (fi // k) for all fi >=k.

Wait, no.

Wait, each operation reduces fi by 1 and reduces the total number of cards by 1.

But I can perform operations until no fi >=k.

So, for each fi, the number of operations I can perform on it is fi - (fi %k), if fi >=k.

Wait, perhaps it's fi //k operations per fi.

But in the first example, fi=3, k=3, so fi//k=1 operation.

Similarly, fi=2, k=3, fi//k=0 operations.

So, total operations:1.

Total cards reduced:1.

Initial n=5, so final cards:5-1=4.

But according to the example, it's 2.

So, my reasoning is flawed.

Wait, perhaps I need to consider that operations can be performed in a chained manner.

That is, after performing an operation, new frequencies might allow further operations.

In the first example:

Initial: 4:3, 1:2

Perform one operation on 4's: replace three 4's with two 1's.

Now: 1:4

Now, perform one operation on 1's: replace three 1's with two 1's.

Now: 1:2

No more operations possible.

Total cards left:2.

Total operations performed:2.

Wait, but according to my earlier calculation, sum of fi//k =1 (only 4:3//3=1), but in reality, I performed two operations.

So, perhaps the total operations is not just sum of fi//k, but more, considering the new frequencies generated by the operations.

This seems recursive or iterative.

Maybe I need to iteratively reduce the frequencies until none is >=k.

But that would be time-consuming for large n.

Is there a smarter way?

Let me consider the total number of cards that cannot be reduced: those with frequencies <k.

In the first example, initially, 1 appears twice, which is less than k=3, so those two 1's cannot be reduced further.

The 4's can be reduced.

So, perhaps the minimum number of cards is the sum of frequencies that are less than k, plus the reduced frequencies of those that are >=k.

But I need to find a way to calculate the reduced frequencies.

Wait, perhaps it's n - sum(floor(fi/(k-1)) for fi >=k).

Wait, not sure.

Let me think differently.

Each operation reduces the total number of cards by 1.

So, the maximum number of operations is n - m, where m is the minimum number of cards possible.

But I need to find m.

Wait, perhaps I need to find the minimum m such that no frequency is >=k.

Wait, but frequencies can be adjusted by operations.

I'm getting stuck.

Let me look at another test case.

Second test case:

n=1, k=10

cards:7

Only one card, k=10.

Cannot perform any operation since I need at least k=10 cards with the same number.

So, minimum cards left:1.

Third test case:

n=7, k=2

cards:4,2,1,100,5,2,3

Frequencies:2 appears twice, others appear once.

So, only 2 can be operated on.

Perform operation on two 2's, replace them with one card of any number, say 2.

Now, hand:4,2,1,100,5,2,3

Wait, no, we replaced two 2's with one card, say 2.

So, hand:4,2,1,100,5,2,3

Wait, but I replaced two 2's with one 2, so hand:4,1,100,5,2,3

Now, only one 2 left, which is less than k=2, so no more operations.

Total cards left:6.

But according to the example, it's 1.

Wait, that doesn't match.

Wait, perhaps I need to perform operations until no group has k or more cards.

But in this case, after one operation, no group has k or more cards.

But the example says output is 1, which contradicts my calculation.

Wait, perhaps I need to choose differently.

Alternatively, maybe there's a better sequence of operations.

Wait, perhaps I can choose to replace two 2's with one card of a new number, say 10.

Then, hand:4,1,100,5,10,3

Now, all numbers appear once, so no more operations.

Total cards:6.

But according to the example, it's 1.

Wait, perhaps I misread the example output.

Wait, checking the example output:

7

1 10

7

7 2

4 2 1 100 5 2 3

10 4

1 1 1 1 1 1 1 1 1 1

5 2

3 8 1 48 7

6 2

10 20 30 10 20 40

6 3

10 20 30 10 20 40

Output:

2

1

1

3

5

1

6

So, for the third test case, output is 1.

Wait, perhaps I need to consider that I can choose to replace k cards with k-1 cards of any numbers, including new numbers not present before.

But in the third test case, n=7, k=2.

cards:4,2,1,100,5,2,3

Frequencies:2 appears twice, others appear once.

So, only 2 can be operated on.

Perform operation on two 2's, replace them with one card of any number, say a new number, 10.

Now, hand:4,1,100,5,10,3

All numbers appear once.

No group has k=2 same numbers.

So, minimum cards left:6.

But according to the example, it's 1.

Wait, that doesn't make sense.

Unless I misread the example output.

Wait, perhaps the third test case has n=7, k=2, and the output is 1.

But according to my reasoning, it should be 6.

Wait, maybe I'm misunderstanding the problem.

Wait, perhaps I can perform operations on different groups.

Wait, in the third test case, after replacing two 2's with one 10, I have:

4,1,100,5,10,3

Now, no group has k=2 same numbers, so no more operations.

But according to the example, output is 1.

Wait, perhaps I need to think differently.

Maybe I can choose to replace two different numbers with one card.

Wait, but the operation specifies choosing k cards with the same number.

Wait, in the third test case, only the two 2's can be operated on.

I can't operate on different numbers.

Wait, unless I choose to replace two 2's with one card, say a 2 again.

Then, hand:4,1,100,5,2,3

Still, only one 2 left.

No more operations.

Again, total cards left:6.

But according to the example, it's 1.

I must be misunderstanding something.

Wait, perhaps I can choose to replace two different numbers with one card, but the problem says to choose k cards with the same number.

So, only groups with at least k cards with the same number can be operated on.

In the third test case, only the two 2's can be operated on.

After operating on them, replacing them with one card, say a 2, then I have one 2 left, and other unique cards.

No more operations possible.

Total cards:6.

But example output is 1.

Wait, perhaps the test case input is misread.

Wait, checking the input again:

7

5 3

4 1 1 4 4

1 10

7

7 2

4 2 1 100 5 2 3

10 4

1 1 1 1 1 1 1 1 1 1

5 2

3 8 1 48 7

6 2

10 20 30 10 20 40

6 3

10 20 30 10 20 40

Output:

2

1

1

3

5

1

6

Wait, the second test case is n=1, k=10, card:7.

Output:1

Third test case: n=7, k=2, cards:4,2,1,100,5,2,3

Output:1

Wait, perhaps in the third test case, I can choose to replace two 2's with one card, say a 10.

Then, hand:4,1,100,5,10,3

Now, all cards are unique.

No more operations.

Total cards:6.

But according to the example, it's 1.

I must be missing something.

Wait, perhaps the problem allows choosing k cards from different numbers.

But the problem says: choose any k cards from your hand that all have the same number.

So, they must be the same number.

Wait, in the third test case, only the two 2's can be operated on.

After one operation, only one 2 left, so no more operations.

Thus, according to my reasoning, it should be 6 cards left, but the example output is 1.

Wait, perhaps I misread the test case.

Wait, checking the input again.

Wait, perhaps the test case is misaligned.

Wait, the input has:

7

5 3

4 1 1 4 4

1 10

7

7 2

4 2 1 100 5 2 3

10 4

1 1 1 1 1 1 1 1 1 1

5 2

3 8 1 48 7

6 2

10 20 30 10 20 40

6 3

10 20 30 10 20 40

Output:

2

1

1

3

5

1

6

Wait, perhaps the second test case is n=1, k=10, card=7.

Output=1

Third test case: n=7, k=2, cards=4,2,1,100,5,2,3

Output=1

Wait, perhaps I need to think about the possibility of choosing k cards from different numbers, but the problem clearly states "that all have the same number."

So, I can only choose k cards with the same number.

In the third test case, only the two 2's can be operated on.

Wait, perhaps I need to perform operations in a way that creates new groups.

Wait, for example, operate on the two 2's, replace them with one 2.

Now, hand:4,1,100,5,2,3

No group has k=2 same numbers, so no more operations.

Total cards:6.

But according to the example, it's 1.

Wait, perhaps I need to choose to replace the two 2's with one card of a number that already exists.

Wait, for example, replace two 2's with one 1.

Then, hand:4,1,100,5,1,3

Now, 1 appears twice.

Now, perform operation on two 1's, replace them with one 1.

Wait, but there are only two 1's, so after replacing them with one 1, hand:4,100,5,1,3

Now, only one 1 left.

No group has k=2 same numbers.

Total cards:5.

Wait, but according to the example, it's 1.

This is confusing.

Wait, perhaps the test case is misread.

Wait, perhaps the third test case is n=7, k=2, cards:4,2,1,100,5,2,3

So, frequencies:2 appears twice, others once.

Perform operation on two 2's, replace them with one 2.

Now, hand:4,1,100,5,2,3

No more operations.

Total cards:6.

But according to the example, it's 1.

Wait, perhaps I need to choose to replace the two 2's with one card of a new number, say 10.

Then, hand:4,1,100,5,10,3

All unique, no operations possible.

Total cards:6.

Still, according to the example, it's 1.

Wait, perhaps the problem allows choosing k cards from different numbers under certain conditions, but the problem clearly states "that all have the same number."

I'm probably misreading something.

Wait, perhaps the operations can be performed in a way that overlaps or chains in a specific manner to minimize cards further.

But in this particular case, it seems impossible to reach 1 card.

Unless the problem allows multiple operations in parallel or something.

Wait, perhaps I need to consider that operations can be performed simultaneously on different groups.

But in this test case, only one group has k=2 same numbers.

Wait, perhaps there's a misprint in the test case or the explanation.

Given that, perhaps I should look for a different approach.

Let me consider the general approach.

Each operation reduces the total number of cards by 1.

So, the maximum number of operations is n - m, where m is the minimum number of cards left.

But I need to find m.

Alternatively, perhaps m is the remainder when n is divided by (k-1).

Wait, perhaps m is n modulo (k-1).

But in the first test case, n=5, k=3, 5 modulo 2 is 1, but the example output is 2.

Doesn't match.

Wait, perhaps m is the minimum number such that n - m is divisible by (k-1).

But again, n - m divisible by (k-1).

Wait, perhaps m is the number of cards that cannot be reduced further.

That is, the number of cards with frequencies less than k.

But in the first test case, frequencies:4:3,1:2.

1:2 <k=3, so m=2.

But according to the example, it's 2.

Wait, but in the third test case, frequencies:2:2, others:1.

m=6 (since only two 2's can be reduced, and the rest are 1's).

But according to the example, it's 1.

Doesn't match.

Wait, perhaps I need to consider the maximum number of operations I can perform.

Each operation reduces n by 1.

So, the maximum number of operations is n - m, where m is the minimum number of cards left.

But I need to find m.

Alternatively, perhaps m is n - floor(n/(k-1)).

Wait, not sure.

Wait,