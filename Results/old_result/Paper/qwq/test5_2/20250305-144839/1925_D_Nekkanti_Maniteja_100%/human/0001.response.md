Alright, I've got this problem to solve. Let's see what it's asking for. There are n children in a class, and m pairs among them are friends with some friendship value. The teacher goes on k excursions, and for each excursion, she randomly chooses a pair of children. If the pair are friends, their friendship value increases by 1 for all subsequent excursions. If they're not friends, their friendship value is 0 and doesn't change.

I need to find the expected value of the sum of friendship values of all k pairs chosen for the excursions, and this sum should be calculated at the time of being chosen. Also, the answer should be modulo (10^9 + 7).

First, I need to understand the problem clearly. There are n children, and m pairs of friends, each with a friendship value f_i. The teacher chooses k pairs randomly, with replacement, meaning the same pair can be chosen multiple times.

Each time a pair of friends is chosen, their friendship value increases by 1 for all future excursions. Pairs that are not friends have a friendship value of 0, which never changes.

I need to calculate the expected sum of the friendship values at the time each pair is chosen.

Let me think about how to approach this.

First, let's consider the total number of possible pairs. Since the order doesn't matter, it's combinations, not permutations. So, the total number of unique pairs is C(n, 2) = n*(n-1)/2.

Out of these, m pairs are friends with initial friendship values f_i.

Now, for each excursion, a pair is chosen randomly and equiprobably from all possible pairs.

When a pair is chosen:

- If they are friends, their friendship value increases by 1 for all subsequent excursions.

- If they are not friends, their friendship value remains 0.

I need to find the expected sum of the friendship values at the time each pair is chosen, over k excursions.

Let me try to model this.

Let’s denote the pairs as p1, p2, ..., pm (the friend pairs with initial values f1, f2, ..., fm), and the non-friend pairs have value 0.

For each excursion, the teacher chooses a pair uniformly at random from all possible pairs (C(n,2)).

If the chosen pair is a friend pair, say pi, then fi increases by 1 for all subsequent excursions.

I need to calculate the expected sum of the friendship values at the time of choice over k excursions.

This seems a bit tricky because the friendship values can change over time based on previous choices.

Let me see if I can find a way to compute this expected sum.

Perhaps I can think in terms of linearity of expectation.

Let me define X_j as the friendship value of the pair chosen in the j-th excursion.

Then, the total sum S = X1 + X2 + ... + Xk.

I need to find E[S] = E[X1 + X2 + ... + Xk] = E[X1] + E[X2] + ... + E[Xk].

So, I need to compute the expected value of X_j for each j from 1 to k.

Now, for each X_j, it depends on which pair is chosen in the j-th excursion, and the current friendship value of that pair at that time.

This seems a bit complicated because the current friendship value depends on how many times that pair has been chosen in previous excursions.

Maybe I need to consider the probability that a particular pair is chosen in the j-th excursion and what its friendship value would be at that time.

Alternatively, perhaps I can think in terms of the contribution of each friend pair to the total expected sum.

Let me consider a specific friend pair pi with initial friendship value fi.

Each time pi is chosen in an excursion, its friendship value increases by 1 for all subsequent excursions.

So, if pi is chosen t times across the k excursions, then its contribution to the sum S is fi + (fi +1) + (fi +2) + ... + (fi + t-1), depending on when it was chosen.

Wait, no. More precisely, each time pi is chosen, its current friendship value at that time is added to S, and then it increases by 1 for subsequent excursions.

So, if pi is chosen in excursion j1, j2, ..., jt, with j1 < j2 < ... < jt, then:

- In excursion j1, its value is fi.

- In excursion j2, its value is fi +1.

- In excursion j3, its value is fi +2.

- ...

- In excursion jt, its value is fi + (t-1).

So, its total contribution to S is fi + (fi +1) + (fi +2) + ... + (fi + t-1) = t*fi + (0 + 1 + 2 + ... + t-1) = t*fi + t*(t-1)/2.

Similarly, for non-friend pairs, their value is always 0, so they don't contribute to S.

Now, to find E[S], I need to sum over all possible t for each friend pair pi, and sum over all friend pairs.

But this seems too involved. Maybe there's a better way.

Let me think about the expected value of X_j, the friendship value of the pair chosen in the j-th excursion.

Since the choices are independent across excursions, perhaps there's a way to model this.

Wait, but the choices are not entirely independent because choosing a friend pair in one excursion affects its friendship value in future excursions.

This seems complicated.

Maybe I can model this as a Markov process, where the state is the current friendship values of all pairs, and then compute the expected sum over k steps.

But that seems too computationally intensive, especially since n and k can be up to 10^5 and 2*10^5, respectively, and t can be up to 5*10^4.

I need a smarter approach.

Let me consider the following:

At each excursion, the teacher chooses a pair uniformly at random from all possible pairs.

The probability of choosing any specific pair is 1 / C(n,2).

Now, for a specific friend pair pi, each time it is chosen, its friendship value increases by 1 for subsequent choices.

I need to find the expected sum of the friendship values of the pairs chosen in each of the k excursions.

Let me think about the expected contribution of a specific friend pair pi to the total sum S.

Let’s denote by I_j(pi) an indicator variable that is 1 if pi is chosen in the j-th excursion, and 0 otherwise.

Then, the contribution of pi to S is sum over j from 1 to k of I_j(pi) * (fi + number of times pi was chosen before j).

Wait, more precisely, if pi is chosen t times in excursions j1 < j2 < ... < jt, then its contribution to S is sum over l from 1 to t of (fi + (l-1)).

Which simplifies to t*fi + (0 + 1 + ... + t-1) = t*fi + t*(t-1)/2.

But t is random, as it depends on how many times pi is chosen in k excursions.

Wait, but this seems too involved to compute directly.

Maybe there's another way.

Let me consider that each time a pair is chosen, its current friendship value is added to S, and then (if it's a friend pair), its friendship value increases by 1.

This seems similar to a process where each friend pair has a counter that starts at fi and increases by 1 each time it's chosen.

But since the choices are independent (with replacement), the number of times a specific pair is chosen follows a binomial distribution.

But because the friendship values affect future choices, it's not straightforward.

Perhaps I can think in terms of the expected value of the friendship value of a specific pair at the time it's chosen.

Let me consider a specific friend pair pi with initial friendship value fi.

Let’s define E[fi, k] as the expected sum of friendship values for pi over k excursions.

But this seems too vague.

Wait, maybe I can think about the expected increase in friendship value for each friend pair per excursion.

But I'm getting stuck.

Let me try to think differently.

Suppose I fix the set of pairs chosen in the k excursions, with their order.

Then, for each excursion, I add the current friendship value of the chosen pair, and if it's a friend pair, increase its friendship value by 1 for future excursions.

But summing over all possible sequences seems infeasible.

I need a better approach.

Let me consider the total expected sum S.

Since S is the sum of the friendship values at the time of choice over k excursions, and the choices are independent, perhaps I can find a formula for E[S].

Wait, but the choices are not independent because choosing a friend pair affects its future friendship values.

This is confusing.

Maybe I can model this using linearity of expectation, considering each friend pair separately.

Let me try that.

For each friend pair pi with initial friendship value fi, let's compute its expected contribution to S.

Let’s denote by ti the number of times pi is chosen in the k excursions.

Then, ti follows a binomial distribution with parameters k and p = 1/C(n,2), where C(n,2) is the total number of possible pairs.

Wait, but in reality, C(n,2) is n*(n-1)/2, so p = 2/(n*(n-1)).

But p = 1/C(n,2).

Wait, no, p = 1/C(n,2) is correct, since there are C(n,2) possible pairs, and each is chosen with equal probability.

Now, if pi is chosen t times, its contribution to S is sum from l=1 to t of (fi + l -1) = t*fi + t*(t-1)/2.

So, E[contribution of pi] = E[t*fi + t*(t-1)/2] = fi*E[t] + E[t*(t-1)/2].

Now, t follows a binomial distribution with parameters k and p = 1/C(n,2).

So, E[t] = k*p = k/C(n,2).

Similarly, for a binomial random variable t ~ Bin(k,p), E[t*(t-1)] = k*(k-1)*p^2.

Therefore, E[t*(t-1)/2] = [k*(k-1)*p^2]/2.

So, E[contribution of pi] = fi*k/C(n,2) + [k*(k-1)*p^2]/2.

But p = 1/C(n,2), so p^2 = 1/C(n,2)^2.

Therefore, E[contribution of pi] = fi*k/C(n,2) + [k*(k-1)/(2*C(n,2)^2)].

Now, the total expected sum S is the sum over all friend pairs pi of E[contribution of pi].

So, E[S] = sum over i=1 to m of [fi*k/C(n,2) + k*(k-1)/(2*C(n,2)^2)].

This can be written as:

E[S] = (k/C(n,2)) * sum over i=1 to m of fi + (m * k*(k-1))/(2*C(n,2)^2).

Wait, that seems promising.

Now, sum over i=1 to m of fi is the total initial friendship values of all friend pairs, let's call it F.

So, E[S] = (k/C(n,2)) * F + (m * k*(k-1))/(2*C(n,2)^2).

But C(n,2) = n*(n-1)/2, so let's substitute that in.

E[S] = (2k)/(n(n-1)) * F + (m * k*(k-1))/(2*(n(n-1)/2)^2)

Simplify the second term:

( m * k*(k-1) ) / (2 * (n(n-1)/2)^2 ) = ( m * k*(k-1) ) / (2 * (n(n-1)/2)^2 ) = ( m * k*(k-1) ) / (2 * (n(n-1)/2)^2 ) = ( m * k*(k-1) ) / (2 * (n(n-1)/2)^2 ) = ( m * k*(k-1) ) / (2 * (n(n-1)/2)^2 ) = ( m * k*(k-1) ) / (2 * (n(n-1)/2)^2 ) = ( m * k*(k-1) ) / (2 * (n(n-1)/2)^2 ) = ( m * k*(k-1) ) / (2 * (n(n-1)/2)^2 ) = ( m * k*(k-1) ) / (2 * (n(n-1)/2)^2 ) = ( m * k*(k-1) ) / (2 * (n(n-1)/2)^2 )

Wait, let's compute this step by step.

First, C(n,2) = n*(n-1)/2.

So, C(n,2)^2 = [n(n-1)/2]^2 = n^2 (n-1)^2 / 4.

Therefore, 1/C(n,2)^2 = 4 / [n^2 (n-1)^2].

So, the second term:

(m * k*(k-1)) / (2 * C(n,2)^2) = (m * k*(k-1)) / (2 * n^2 (n-1)^2 / 4) = (m * k*(k-1)) / ( (n^2 (n-1)^2)/2 ) = 2 m k (k-1) / (n^2 (n-1)^2).

Therefore, E[S] = (2k)/(n(n-1)) * F + m k (k-1)/(n^2 (n-1)^2).

Wait, I think I made a mistake in the second term.

Wait, let's recast this.

We have:

E[S] = (k / C(n,2)) * F + (m * k*(k-1)) / (2 * C(n,2)^2).

Substituting C(n,2) = n(n-1)/2:

E[S] = (k / (n(n-1)/2)) * F + (m * k*(k-1)) / (2 * (n(n-1)/2)^2 )

Simplify each term:

First term: (k / (n(n-1)/2)) = 2k / (n(n-1)).

Second term: (m * k*(k-1)) / (2 * (n(n-1)/2)^2 ) = (m * k*(k-1)) / (2 * (n(n-1)/2)^2 ) = (m * k*(k-1)) / (2 * (n(n-1)/2)^2 ) = (m * k*(k-1)) / (2 * (n(n-1)/2)^2 ) = (m * k*(k-1)) / (2 * (n(n-1)/2)^2 ) = (m * k*(k-1)) / (2 * (n(n-1)/2)^2 ) = (m * k*(k-1)) / (2 * (n(n-1)/2)^2 ) = (m * k*(k-1)) / (2 * (n(n-1)/2)^2 ) = (m * k*(k-1)) / (2 * (n(n-1)/2)^2 ) = (m * k*(k-1)) / (2 * (n(n-1)/2)^2 )

Wait, I need to compute this properly.

Let’s compute 1 / C(n,2)^2:

C(n,2)^2 = [n(n-1)/2]^2 = n^2 (n-1)^2 / 4.

Therefore, 1 / C(n,2)^2 = 4 / [n^2 (n-1)^2].

So, the second term:

(m * k*(k-1)) / (2 * C(n,2)^2) = m * k*(k-1) / (2 * n^2 (n-1)^2 / 4) = m * k*(k-1) / ( (n^2 (n-1)^2)/2 ) = 2 m k (k-1) / (n^2 (n-1)^2).

Wait, no:

(m * k*(k-1)) / (2 * C(n,2)^2) = m * k*(k-1) / (2 * n^2 (n-1)^2 / 4) = m * k*(k-1) / ( (n^2 (n-1)^2)/2 ) = 2 m k (k-1) / (n^2 (n-1)^2).

Yes, that's correct.

So, E[S] = (2k)/(n(n-1)) * F + 2 m k (k-1) / (n^2 (n-1)^2).

Wait, no, I think I made a mistake.

Wait, let's double-check:

C(n,2)^2 = [n(n-1)/2]^2 = n^2 (n-1)^2 / 4.

So, 1 / C(n,2)^2 = 4 / [n^2 (n-1)^2].

Therefore, (m * k*(k-1)) / (2 * C(n,2)^2) = m * k*(k-1) / (2 * n^2 (n-1)^2 / 4 ) = m * k*(k-1) * 4 / (2 * n^2 (n-1)^2 ) = (4 m k (k-1)) / (2 n^2 (n-1)^2 ) = (2 m k (k-1)) / (n^2 (n-1)^2 ).

Yes, that's correct.

So, E[S] = (2k)/(n(n-1)) * F + (2 m k (k-1)) / (n^2 (n-1)^2 ).

Now, I need to compute this expression modulo (10^9 + 7), but as a fraction in lowest terms, and then compute p * q^{-1} mod (10^9 + 7), where p/q is the reduced fraction of E[S].

This seems manageable.

First, I need to compute E[S] as a fraction.

Let me denote C(n,2) = n(n-1)/2.

Then, E[S] = (k / C(n,2)) * F + (m * k*(k-1)) / (2 * C(n,2)^2 ).

Substituting C(n,2) = n(n-1)/2:

E[S] = (k / (n(n-1)/2)) * F + (m * k*(k-1)) / (2 * (n(n-1)/2)^2 )

Simplify:

First term: (k / (n(n-1)/2)) = 2k / (n(n-1)).

Second term: (m * k*(k-1)) / (2 * (n(n-1)/2)^2 ) = (m * k*(k-1)) / (2 * (n(n-1)/2)^2 ) = (m * k*(k-1)) / (2 * (n(n-1)/2)^2 ) = (m * k*(k-1)) / (2 * (n(n-1)/2)^2 ) = (m * k*(k-1)) / (2 * (n(n-1)/2)^2 ) = (m * k*(k-1)) / (2 * (n(n-1)/2)^2 ) = (m * k*(k-1)) / (2 * (n(n-1)/2)^2 ) = (m * k*(k-1)) / (2 * (n(n-1)/2)^2 ) = (m * k*(k-1)) / (2 * (n(n-1)/2)^2 ) = (m * k*(k-1)) / (2 * (n(n-1)/2)^2 )

Wait, I need to compute this properly.

Let’s compute the denominator:

(n(n-1)/2)^2 = n^2 (n-1)^2 / 4.

So, 2 * (n(n-1)/2)^2 = 2 * (n^2 (n-1)^2 / 4) = n^2 (n-1)^2 / 2.

Therefore, (m * k*(k-1)) / (2 * C(n,2)^2 ) = m * k*(k-1) / (n^2 (n-1)^2 / 2 ) = 2 m k (k-1) / (n^2 (n-1)^2 ).

So, E[S] = (2k)/(n(n-1)) * F + 2 m k (k-1) / (n^2 (n-1)^2 ).

Now, I need to compute this expression modulo (10^9 + 7), but as a fraction in lowest terms, and then compute p * q^{-1} mod (10^9 + 7), where p/q is the reduced fraction of E[S].

To do this, I need to compute E[S] as a fraction, reduce it to lowest terms, and then compute p * q^{-1} mod (10^9 + 7).

Alternatively, since all operations are modulo (10^9 + 7), I can compute the numerator and denominator separately and then multiply the numerator by the modular inverse of the denominator.

But first, I need to express E[S] as a single fraction.

Let’s find a common denominator for the two terms.

The first term is (2k F)/(n(n-1)), and the second term is (2 m k (k-1))/(n^2 (n-1)^2 ).

The common denominator is n^2 (n-1)^2.

So, let's write both terms over this common denominator.

First term: (2k F)/(n(n-1)) = (2k F * n (n-1))/ (n^2 (n-1)^2 ).

Wait, no:

(2k F)/(n(n-1)) = (2k F * n (n-1)) / (n (n-1) * n (n-1)) = (2k F * n (n-1)) / (n^2 (n-1)^2 ).

Wait, no:

Wait, (2k F)/(n(n-1)) = (2k F * n (n-1)) / (n(n-1) * n (n-1)) = (2k F * n (n-1)) / (n^2 (n-1)^2 ).

Wait, but n(n-1) * n(n-1) = n^2 (n-1)^2.

Wait, no, n(n-1) * n(n-1) = n^2 (n-1)^2.

So, (2k F)/(n(n-1)) = (2k F * n (n-1)) / (n^2 (n-1)^2 ).

Wait, but that's incorrect.

Wait, (2k F)/(n(n-1)) = (2k F * n (n-1)) / (n(n-1) * n (n-1)) = (2k F * n (n-1)) / (n^2 (n-1)^2 ).

Wait, but n(n-1) * n(n-1) = n^2 (n-1)^2.

Wait, no, n(n-1) * n(n-1) = n^2 (n-1)^2.

So, (2k F)/(n(n-1)) = (2k F * n (n-1)) / (n^2 (n-1)^2 ).

Wait, that doesn't make sense.

Wait, to write (2k F)/(n(n-1)) over denominator n^2 (n-1)^2, I need to multiply numerator and denominator by n(n-1):

(2k F)/(n(n-1)) = (2k F * n (n-1)) / (n(n-1) * n (n-1)) = (2k F * n (n-1)) / (n^2 (n-1)^2 ).

Wait, but that would be (2k F * n (n-1)) / (n^2 (n-1)^2 ), which simplifies to (2k F)/(n(n-1)), which is correct.

Similarly, the second term is already over denominator n^2 (n-1)^2.

So, E[S] = (2k F * n (n-1)) / (n^2 (n-1)^2 ) + (2 m k (k-1)) / (n^2 (n-1)^2 ) = [2k F * n (n-1) + 2 m k (k-1)] / (n^2 (n-1)^2 ).

Therefore, numerator = 2k F * n (n-1) + 2 m k (k-1)

Denominator = n^2 (n-1)^2

Now, I need to compute this fraction modulo (10^9 + 7), but as p/q where p and q are coprime, and then compute p * q^{-1} mod (10^9 + 7).

So, first, compute numerator = 2k F n (n-1) + 2 m k (k-1)

Denominator = n^2 (n-1)^2

Then, simplify the fraction numerator / denominator, and compute p * q^{-1} mod (10^9 + 7).

But since we're dealing with modulo operations, I need to compute this efficiently, especially since n and m can be up to 1e5, and k up to 2e5, and t up to 5e4.

I need to make sure that the computation is efficient.

Also, since F is the sum of all f_i, which can be up to 1e5 * 1e9 = 1e14, and k can be up to 2e5, and n up to 1e5, the numbers can get quite large, so I need to handle large integers properly.

Given that we're working modulo 1e9+7, I can perform all operations modulo 1e9+7.

But since I need to compute p * q^{-1} mod (1e9+7), I need to compute the modular inverse of q.

Also, I need to make sure that the denominator is invertible modulo 1e9+7, which it is, since 1e9+7 is prime and q is not a multiple of 1e9+7.

Now, let's think about how to compute this efficiently.

First, for each test case, I need to read n, m, k, and then read m lines each with a_i, b_i, f_i.

I need to compute F = sum of all f_i.

Then, compute numerator = 2k F n (n-1) + 2 m k (k-1)

And denominator = n^2 (n-1)^2

Then, compute (numerator / denominator) modulo 1e9+7.

But since I can't directly divide, I need to compute numerator * denominator^{-1} mod (1e9+7).

But first, I need to compute numerator and denominator modulo 1e9+7.

Wait, but denominator could be 0 modulo 1e9+7 if n or n-1 is a multiple of 1e9+7, but since n can be up to 1e5 and 1e9+7 is much larger, n and n-1 are less than 1e9+7, so n^2 (n-1)^2 is not 0 modulo 1e9+7.

Therefore, denominator is invertible.

So, the plan is:

1. For each test case:

a. Read n, m, k.

b. Compute C = n*(n-1)/2.

c. Read m friend pairs and sum their f_i to get F.

d. Compute numerator = 2*k*F*n*(n-1) + 2*m*k*(k-1)

e. Compute denominator = n^2*(n-1)^2

f. Compute result = (numerator * denominator^{-1}) mod (1e9+7)

g. Print result.

But I need to make sure that all computations are done modulo 1e9+7 to prevent overflow.

Also, I need to compute the modular inverse of denominator modulo 1e9+7, which can be done using Fermat's Little Theorem since 1e9+7 is prime.

Specifically, denominator^{-1} = denominator^{1e9+7-2} mod (1e9+7)

But computing this directly would be too slow for t up to 5e4.

Therefore, I need a smarter way.

Wait, perhaps I can simplify the expression further.

Let me look back at the expression:

E[S] = (2k F)/(n(n-1)) + (2 m k (k-1))/(n^2 (n-1)^2 )

Let me factor out 2k / (n(n-1))^2:

E[S] = (2k)/(n(n-1)) * [F / (n(n-1)) + m (k-1)/n(n-1)]

Wait, no.

Alternatively, let me write E[S] = (2k F n (n-1) + 2 m k (k-1)) / (n^2 (n-1)^2 )

= 2k [F n (n-1) + m (k-1)] / (n^2 (n-1)^2 )

= 2k [F n (n-1) + m (k-1)] / (n^2 (n-1)^2 )

= 2k [F / (n(n-1)) + m (k-1)/(n^2 (n-1)^2 )]

Wait, not sure if that helps.

Alternatively, perhaps I can think in terms of linearity of expectation, considering that each friend pair contributes independently.

Wait, perhaps I should consider that the expected sum is the sum over all excursions of the expected friendship value at the time of choice.

So, E[S] = sum_{j=1 to k} E[X_j], where X_j is the friendship value at the time of choosing the j-th pair.

Now, for each X_j, it depends on which pair is chosen, and their current friendship value.

But since the choices are independent, perhaps I can compute E[X_j] for each j and sum them up.

Let’s try that.

For a specific excursion j, E[X_j] is the expected friendship value of the chosen pair at that excursion.

Since the choices are independent, E[X_j] is the same for all j.

Therefore, E[S] = k * E[X_j], where E[X_j] is the expected friendship value of a randomly chosen pair at any excursion.

Now, I need to find E[X_j].

To find E[X_j], I need to consider the distribution of friendship values at any excursion.

But the friendship values change over time as pairs are chosen.

This seems tricky.

Wait, perhaps I can model this as follows:

At each excursion, the teacher chooses a pair uniformly at random.

If the pair is a friend pair, their friendship value increases by 1 for all subsequent excursions.

So, the friendship value of a pair at the time of choice depends on how many times it has been chosen before.

This seems similar to modeling the expected value of a random variable that depends on the number of times a specific pair has been chosen in previous excursions.

This seems too involved.

Maybe I need to think differently.

Let me consider that for each friend pair pi, the expected number of times it is chosen in k excursions is k / C(n,2).

Then, the expected sum of friendship values for pi over k excursions is the sum over t from 0 to k of the probability that pi is chosen t times multiplied by the sum of its friendship values at those choices.

But this seems too complicated.

Wait, perhaps I can think in terms of the linearity of expectation, considering that the expected sum is the sum of expected contributions of each friend pair.

Let me formalize this.

For each friend pair pi with initial friendship value fi, let’s define S_i as the sum of its friendship values over all excursions where it is chosen.

Then, S = sum over i=1 to m of S_i.

Therefore, E[S] = sum over i=1 to m of E[S_i].

Now, E[S_i] is the expected sum of friendship values for pi over all excursions where it is chosen.

As we saw earlier, if pi is chosen t times, its contribution is t*fi + t*(t-1)/2.

Therefore, E[S_i] = sum over t=0 to k of P(t) * [t*fi + t*(t-1)/2], where P(t) is the probability that pi is chosen t times in k excursions.

But P(t) follows a binomial distribution: P(t) = C(k, t) * p^t * (1-p)^{k-t}, where p = 1/C(n,2).

This seems too involved to compute directly.

Perhaps there's a better way.

Wait, maybe I can consider that for each friend pair pi, its expected contribution to S is the expected number of times it is chosen, multiplied by its expected friendship value at the time of choice.

But I need to model the expected friendship value at the time of choice.

This seems tricky.

Let me try to think about it differently.

Suppose I fix a particular excursion j.

Then, the expected friendship value at that excursion is the sum over all friend pairs of the probability that pair is chosen in excursion j multiplied by its expected friendship value at that time.

But again, this seems too involved.

I need a better approach.

Let me consider that the friendship value of a friend pair pi at the time of choice in excursion j is fi plus the number of times pi has been chosen before in excursions 1 to j-1.

So, if ti,j is the number of times pi has been chosen in the first j-1 excursions, then the friendship value at excursion j is fi + ti,j.

Therefore, the total sum S is sum over j=1 to k of X_j, where X_j is the friendship value at excursion j.

But X_j depends on which pair is chosen, and their ti,j.

This seems too complex.

Perhaps I need to think about the problem differently.

Let me consider that the expected sum S is equal to the sum over all friend pairs pi of their expected contribution to S.

As I thought earlier, E[S] = sum over i=1 to m of E[S_i], where S_i is the sum of friendship values of pi over all excursions where it is chosen.

Now, for each friend pair pi, its expected contribution E[S_i] can be computed as follows:

- The probability that pi is chosen in any single excursion is p = 1/C(n,2).

- The number of times pi is chosen in k excursions follows a binomial distribution: ti ~ Bin(k, p).

- Each time pi is chosen, its friendship value at that time is fi plus the number of times it has been chosen before.

Wait, perhaps I can model E[S_i] as fi * E[ti] + E[ti*(ti-1)/2].

Because each time pi is chosen, its friendship value is fi plus the number of times it has been chosen before.

Wait, no.

Let me think carefully.

Suppose ti is the number of times pi is chosen in k excursions.

Then, the sum of its friendship values over these ti choices is sum from l=1 to ti of (fi + l -1).

Which is ti*fi + sum from l=1 to ti (l-1) = ti*fi + sum from m=0 to ti-1 m = ti*fi + ti*(ti-1)/2.

Therefore, E[S_i] = E[ti*fi + ti*(ti-1)/2] = fi*E[ti] + E[ti*(ti-1)/2].

Now, ti ~ Bin(k, p), where p = 1/C(n,2).

We know that E[ti] = k*p = k/C(n,2).

Also, for a binomial random variable, E[ti*(ti-1)] = k*(k-1)*p^2.

Therefore, E[ti*(ti-1)/2] = [k*(k-1)*p^2]/2.

Therefore, E[S_i] = fi*(k/C(n,2)) + [k*(k-1)*p^2]/2.

Now, p = 1/C(n,2), so p^2 = 1/C(n,2)^2.

Therefore, E[S_i] = fi*(k/C(n,2)) + [k*(k-1)/(2*C(n,2)^2)].

Now, summing over all m friend pairs, E[S] = sum over i=1 to m of [fi*(k/C(n,2)) + k*(k-1)/(2*C(n,2)^2)].

Which is (k/C(n,2)) * sum over i=1 to m of fi + m*(k*(k-1)/(2*C(n,2)^2)).

Let F = sum over i=1 to m of fi.

Therefore, E[S] = (k/C(n,2)) * F + m*(k*(k-1)/(2*C(n,2)^2)).

Now, C(n,2) = n*(n-1)/2.

Therefore, C(n,2)^2 = [n*(n-1)/2]^2 = n^2*(n-1)^2/4.

Therefore, 1/C(n,2)^2 = 4/[n^2*(n-1)^2].

Therefore, E[S] = (2k)/(n*(n-1)) * F + m*(k*(k-1)*4)/(2*n^2*(n-1)^2) = (2k F)/(n(n-1)) + (2 m k (k-1))/ (n^2 (n-1)^2 )

Now, I need to compute this expression modulo (1e9+7), but as a fraction in lowest terms, and then compute p * q^{-1} mod (1e9+7), where p/q is the reduced fraction of E[S].

To do this efficiently, I need to compute numerator and denominator separately, reduce them, and then compute the modular inverse.

But since all operations are modulo 1e9+7, I can compute numerator and denominator modulo 1e9+7, and then multiply numerator by the modular inverse of denominator.

Wait, but I need to make sure that denominator is invertible modulo 1e9+7, which it is since 1e9+7 is prime and denominator is not a multiple of 1e9+7.

Given that n and n-1 are less than 1e9+7, and m and k are within limits, denominator should be invertible.

Therefore, the plan is:

1. For each test case:

a. Read n, m, k.

b. Compute C = n*(n-1)/2.

c. Read m friend pairs and sum their f_i to get F.

d. Compute numerator = (2*k*F*n*(n-1) + 2*m*k*(k-1)) % (1e9+7)

e. Compute denominator = (n*n*(n-1)*(n-1)) % (1e9+7)

f. Compute denominator_inv = pow(denominator, 1e9+7-2, 1e9+7)

g. Compute result = (numerator * denominator_inv) % (1e9+7)

h. Print result.

Wait, but in the numerator, there is 2*k*F*n*(n-1) + 2*m*k*(k-1).

But in the denominator, it's n^2*(n-1)^2.

So, in code, I need to compute:

numerator = (2*k*F*n*(n-1) + 2*m*k*(k-1)) % (1e9+7)

denominator = (n*n*(n-1)*(n-1)) % (1e9+7)

Then, result = (numerator * pow(denominator, 1e9+7-2, 1e9+7)) % (1e9+7)

This should work.

Now, let's verify this with the sample input.

Sample Input:

4

100 0 24

2 1 10

1 2 1

3 1 2

2 1 1

5 2 4

1 2 25

3 2 24

Sample Output:

0

55

777777784

40000020

Let's take the first test case:

n=100, m=0, k=24

Since m=0, there are no friend pairs, so F=0.

Therefore, E[S] = (2*24*0*100*99 + 2*0*24*23) / (100^2 * 99^2) = 0 / something = 0.

Which matches the sample output of 0.

Second test case:

n=2, m=1, k=10

Friend pair: 1-2 with f=1

C(2,2)=1

F=1

E[S] = (2*10*1*2*1 + 2*1*10*9) / (4 * 1) = (40 + 180) / 4 = 220 / 4 = 55.

Which matches the sample output of 55.

Third test case:

n=3, m=1, k=2

Friend pair: 2-1 with f=1

C(3,2)=3

F=1

E[S] = (2*2*1*3*2 + 2*1*2*1) / (9 * 4) = (24 + 4) / 36 = 28 / 36 = 7/9.

7/9 modulo (1e9+7) is 7 * 9^{-1} mod (1e9+7).

9^{-1} mod (1e9+7) is 9^{1e9+7-2} mod (1e9+7) = 9^{1e9+5} mod (1e9+7).

But since 9 and 1e9+7 are coprime, this is valid.

Compute 9^{1e9+5} mod (1e9+7).

But in code, it's better to use pow(9, 1e9+5, 1e9+7).

But in practice, 9^{-1} mod (1e9+7) is 111111114, because 9*111111114 mod (1e9+7) =1.

Therefore, 7 * 111111114 mod (1e9+7) = 777777798 mod (1e9+7) = 777777798.

But the sample output is 777777784.

Wait, perhaps I made a mistake in computation.

Wait, in the formula, E[S] = (2*2*1*3*2 + 2*1*2*1)/ (3^2 * 2^2 ) = (24 + 4)/36 = 28/36 = 7/9.

So, 7 * 111111114 mod (1e9+7) = 777777798.

But the sample output is 777777784.

Wait, perhaps I need to recheck the formula.

Wait, perhaps I missed something.

Wait, let's recompute E[S].

E[S] = (2k F n (n-1) + 2 m k (k-1)) / (n^2 (n-1)^2 )

For n=3, m=1, k=2, F=1.

So, numerator = 2*2*1*3*2 + 2*1*2*1 = 24 + 4 = 28.

Denominator = 9 * 4 = 36.

So, E[S] = 28 / 36 = 7/9.

Now, 7 * 9^{-1}