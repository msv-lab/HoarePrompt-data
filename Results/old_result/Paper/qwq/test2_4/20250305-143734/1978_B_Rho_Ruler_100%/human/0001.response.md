Alright, I have this problem to solve. Let's read it carefully.

Bob has n buns to sell. Normally, each bun costs a coins. But he's running a promotion to attract customers. He can choose an integer k (from 0 to the minimum of n and b) and sell the first k buns at a modified price: the i-th bun sells for (b - i + 1) coins. The remaining (n - k) buns are sold at the usual price a coins each.

I need to help Bob maximize his profit by choosing the best k.

First, I need to understand the promotion clearly. If Bob chooses k=0, he sells all n buns at price a, so the total profit is n*a.

If he chooses k=1, he sells the first bun at b coins and the remaining (n-1) buns at a coins each. Total profit: b + (n-1)*a.

If k=2, first bun at b, second at (b-1), and the remaining (n-2) at a. Total: b + (b-1) + (n-2)*a.

Generalizing, for any k, the profit is the sum of the first k terms: b, (b-1), ..., (b - k + 1), plus (n - k)*a.

So, the profit function for a given k is:

profit(k) = sum from i=0 to k-1 of (b - i) + (n - k)*a

Simplifying the sum:

sum from i=0 to k-1 of (b - i) = k*b - sum from i=0 to k-1 of i = k*b - (k*(k-1))/2

Therefore, profit(k) = k*b - (k*(k-1))/2 + (n - k)*a

Now, I need to find the k that maximizes this profit, where k can be from 0 to min(n, b).

Given that n, a, b can be up to 10^9, and there are up to 10^4 test cases, I need an efficient way to compute this.

Let's think about how profit(k) behaves as k increases.

First, compute profit(k+1) - profit(k):

profit(k+1) = (k+1)*b - (k+1)*k/2 + (n - k - 1)*a

profit(k) = k*b - k*(k-1)/2 + (n - k)*a

difference = profit(k+1) - profit(k) = [(k+1)*b - (k+1)*k/2 + (n - k - 1)*a] - [k*b - k*(k-1)/2 + (n - k)*a]

Simplify:

= (k+1)*b - (k+1)*k/2 + (n - k - 1)*a - k*b + k*(k-1)/2 - (n - k)*a

= b - (k+1)*k/2 + k*(k-1)/2 - a

= b - a - k

So, profit(k+1) - profit(k) = b - a - k

This difference tells us when to increase k:

- If b - a - k > 0, then profit increases by increasing k.

- If b - a - k < 0, then profit decreases by increasing k.

- If b - a - k = 0, profit stays the same.

So, the profit is increasing as long as b - a - k > 0, which is equivalent to k < b - a.

At k = b - a, the difference is b - a - (b - a) = 0, so profit is the same as k increases further.

Beyond k = b - a, the difference becomes negative, so profit starts decreasing.

Therefore, the maximum profit occurs at k = b - a, but we need to handle the cases where b - a is negative or exceeds min(n, b).

Specifically:

- If b - a < 0, then k=0 is the best choice.

- If b - a >= min(n, b), then k=min(n, b) is the best choice.

- Otherwise, k = b - a is the optimal.

Wait, but k has to be between 0 and min(n, b).

So, let's define k_opt = min(max(0, b - a), min(n, b))

But min(n, b) is already the upper limit, so k_opt = min(max(0, b - a), min(n, b))

This should give the optimal k.

But let's verify this with the sample inputs.

First sample input:

n=4, a=4, b=5

k_opt = min(max(0, 5-4), min(4,5)) = min(1,4) =1

Profit: 5 + 4*3 = 5 + 12 = 17

Which matches the sample output.

Second sample:

n=5, a=5, b=9

k_opt = min(max(0,9-5), min(5,9)) = min(4,5) =4

Profit: 9 +8 +7 +6 +5*1 =35

Wait, but in the sample output, it's 35, but according to the promotion, k=5 would give 9+8+7+6+5=35, which is the same.

Wait, but according to my formula, k_opt=4, but k=5 gives the same profit.

Wait, perhaps I need to adjust the formula.

Wait, in this case, k=5 is allowed, and profit is 9+8+7+6+5=35, which is the same as k=4 + (n-k)*a =35.

So, in this case, k=5 is also optimal.

Wait, but according to my earlier difference formula, profit(k+1)-profit(k) = b - a - k

Set this to zero to find the peak: b - a - k =0 => k = b - a

So, when k = b - a, profit(k+1) = profit(k)

Hence, any k from 0 to b - a inclusive will give the same profit, which is the maximum.

Therefore, k_opt can be any k from 0 to b - a, inclusive, but limited by min(n, b).

So, in the second sample, b - a =4, min(n,b)=5, so k can be from 0 to 4, and profit is the same up to k=4, and k=5 gives the same profit as k=4 if n >=5.

Wait, but in the second sample, k=5 gives the same profit as k=4.

So, to generalize, the maximum profit is achieved for k from 0 to b - a, but limited by min(n, b).

Hence, to compute the maximum profit, I can choose k = min(b - a, min(n, b))

And compute the profit accordingly.

But in the code provided, it's using a binary search to find the optimal k.

Let's look at the code.

There's a func_1 which computes the profit for a given k, as we derived: k*b - k*(k-1)/2 + (n - k)*a

And func_2 performs a binary search between low=0 and high=min(n,b), to find the k that maximizes the profit.

It maintains a max_profit variable, and in each step, it calculates profit for mid and mid+1, and decides whether to go left or right based on whether profit_next > profit_mid.

This seems like it's trying to find the point where the profit starts decreasing.

Given that the profit function is a quadratic in k, and it has a single peak, binary search can be used to find the maximum efficiently.

Since n, a, b can be up to 10^9, and t up to 10^4, this approach should work efficiently.

But, in terms of correctness, I need to ensure that this indeed finds the maximum profit.

Given that the profit function is a quadratic in k, and it's a single peak, binary search is appropriate.

Hence, the given program is correct.

**Final Answer**

\[\boxed{\text{See the provided program}}\]