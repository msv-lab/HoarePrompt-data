Alright, I have this problem to solve. Monocarp wants to throw a party and invite some of his friends, but there are specific conditions about who comes to the party based on who gets invited. Let's break this down.

First, Monocarp has n friends, and each friend has a best friend, denoted by p_i, where p_i is the index of their best friend. The problem says that all p_i are distinct and p_i ≠ i, meaning no one is their own best friend, and everyone has a unique best friend.

The goal is to send invitations to some friends such that at least two friends come to the party. A friend comes to the party only if both they and their best friend receive an invitation.

I need to find the minimum number of invitations required to ensure that at least two friends come to the party.

Let's look at the example provided:

Input:

3

5

3 1 2 5 4

4

2 3 4 1

2

2 1

Output:

2

3

2

In the first test case, n=5 and p=[3,1,2,5,4]. Monocarp sends invitations to friends 4 and 5, and both come because each other is their best friend.

In the second test case, n=4 and p=[2,3,4,1]. Sending invitations to friends 1,2, and 3 results in friends 1 and 2 coming to the party.

In the third test case, n=2 and p=[2,1]. Inviting both friends results in both coming.

From these examples, it seems like the minimum number of invitations needed is either 2 or 3, depending on the structure of the best friend relationships.

I need to generalize this.

First, observe that the best friend relationships form a collection of cycles. Since p_i are distinct and p_i ≠ i, the relationships form a permutation of the friends, which can be decomposed into disjoint cycles.

For example, in the first test case:

p = [3,1,2,5,4]

This can be seen as:

1 -> 3 -> 2 -> 1 (cycle of length 3)

4 -> 5 -> 4 (cycle of length 2)

So, there's a 3-cycle and a 2-cycle.

In the second test case:

p = [2,3,4,1]

1 -> 2 -> 3 -> 4 -> 1 (single cycle of length 4)

In the third test case:

p = [2,1]

1 -> 2 -> 1 (cycle of length 2)

So, cycles are important here.

Now, in terms of inviting friends, consider a cycle of length k.

To have at least two friends come from this cycle, we need to invite certain friends such that at least two pairs (friend and their best friend) are both invited.

Wait, no. A friend comes if they and their best friend are both invited.

In a cycle of length k, what's the minimal number of invitations to have at least two friends come?

Let's think about it.

Suppose we have a cycle of length 2: A -> B -> A.

If we invite both A and B, then both come, since each has their best friend invited.

If we invite only one, say A, then B doesn't come because B's best friend A is invited, but A doesn't come because B isn't invited. So only B is invited, but neither comes.

So, for a cycle of length 2, we need to invite both to have both come.

But wait, the problem is to have at least two friends come, not necessarily both.

Wait, no. In this case, inviting both makes both come, which satisfies the condition.

What if we have a cycle of length 3: A -> B -> C -> A.

If we invite A and B, then:

- A has B invited, but B's best friend is C, who isn't invited, so A doesn't come.

- B has C invited, but C's best friend is A, who is invited, so B comes.

- C has A invited, but A is invited, so C comes.

Wait, no. Let's re-examine.

If we invite A and B:

- A has best friend B, who is invited, so A comes.

- B has best friend C, who isn't invited, so B doesn't come.

- C has best friend A, who is invited, but C wasn't invited, so C doesn't come.

Wait, that's not right.

Wait, the condition is: friend i comes if both friend i and friend p_i are invited.

So, for friend A (p_A = B):

- A is invited and p_A = B is invited → A comes.

For friend B (p_B = C):

- B is invited and p_B = C is not invited → B doesn't come.

For friend C (p_C = A):

- C is not invited → C doesn't come.

So, only A comes, which doesn't satisfy the condition of having at least two friends come.

So, inviting A and B in this cycle isn't sufficient.

What if we invite A and C?

- A is invited, p_A = B is not invited → A doesn't come.

- C is invited, p_C = A is invited → C comes.

- B has p_B = C, who is invited, but B isn't invited → B doesn't come.

So, only C comes.

Still not enough.

What if we invite B and C?

- B is invited, p_B = C is invited → B comes.

- C is invited, p_C = A is invited → C comes.

- A has p_A = B, who is invited → but A isn't invited → A doesn't come.

So, both B and C come. That satisfies the condition.

So, in a 3-cycle, inviting any two consecutive friends makes both of them come.

Similarly, in a 4-cycle: A -> B -> C -> D -> A.

If we invite A, B, and C:

- A: invited, p_A = B invited → A comes.

- B: invited, p_B = C invited → B comes.

- C: invited, p_C = D invited → C comes.

- D: invited, p_D = A invited → D comes.

Wait, but in this case, if we invite A, B, C, then D isn't invited.

So:

- A: comes.

- B: comes.

- C: comes.

- D: not invited → doesn't come.

So, A, B, C come.

But can we do better? Can we invite fewer than 3?

What if we invite A, B, D?

- A: invited, p_A = B invited → A comes.

- B: invited, p_B = C not invited → B doesn't come.

- C: not invited → doesn't come.

- D: invited, p_D = A invited → D comes.

So, A and D come.

That works with 3 invitations.

Is there a way to have at least two friends come with fewer invitations?

What if we invite A and B?

- A: invited, p_A = B invited → A comes.

- B: invited, p_B = C not invited → B doesn't come.

- C: not invited → doesn't come.

- D: not invited → doesn't come.

So, only A comes, which isn't enough.

What if we invite A and D?

- A: invited, p_A = B not invited → A doesn't come.

- D: invited, p_D = A invited → D comes.

- B: not invited → doesn't come.

- C: not invited → doesn't come.

So, only D comes, which isn't enough.

What if we invite B and D?

- B: invited, p_B = C not invited → B doesn't come.

- D: invited, p_D = A not invited → D doesn't come.

- A: not invited → doesn't come.

- C: not invited → doesn't come.

No one comes.

What if we invite B and C?

- B: invited, p_B = C invited → B comes.

- C: invited, p_C = D invited → C comes.

- A: not invited → doesn't come.

- D: invited, p_D = A not invited → D doesn't come.

So, B and C come.

That works with 2 invitations.

Wait, but earlier when I tried inviting A, B, C in the 4-cycle, A, B, C came.

But with inviting B and C, B and C come.

So, inviting B and C is sufficient for at least two friends to come.

Is this general?

In a cycle of length k, what's the minimal number of invitations needed to have at least two friends come?

It seems that in cycles of even length, inviting two specific friends who are not directly opposite can suffice, while in odd-length cycles, inviting two consecutive friends suffices.

Wait, in the 3-cycle, inviting two consecutive friends made two come.

In the 4-cycle, inviting two specific friends (like B and C) made two come.

So perhaps in general, in any cycle, inviting two friends who are not directly opposite (if the cycle is even) or just any two consecutive friends (if the cycle is odd) suffices.

But in the 4-cycle, inviting B and C made B and C come, which are consecutive.

Wait, but in the 4-cycle, inviting A and C would make only C come, because A's best friend B is not invited.

Wait, earlier I thought inviting A and C in the 3-cycle made C come, but in the 4-cycle, inviting A and C:

- A: invited, p_A = B not invited → A doesn't come.

- C: invited, p_C = D invited → C comes.

- B: not invited → doesn't come.

- D: invited, p_D = A invited → D comes.

So, C and D come.

That works with 3 invitations.

Wait, but earlier, inviting B and C in the 4-cycle made B and C come with 2 invitations.

So, in this case, 2 invitations suffice.

Is there a general rule here?

It seems that in any cycle, inviting two specific friends can make at least two friends come, provided that their best friends are also invited in some way.

Wait, perhaps in any cycle, the minimal number of invitations to have at least two friends come is 2, unless the cycle is of length 2.

Wait, in a cycle of length 2, inviting both makes both come, and inviting only one doesn't make any come.

But to have at least two friends come, in a cycle of length 2, we need to invite both, which is 2 invitations.

In cycles of length >=3, inviting any two consecutive friends makes at least two friends come.

Wait, in the 4-cycle, inviting B and C made B and C come.

Similarly, in a 3-cycle, inviting B and C made B and C come.

So, perhaps in any cycle of length >=2, inviting two specific friends suffices to have at least two friends come, provided that their best friends are also invited.

Wait, but in the 4-cycle, inviting B and C:

- B: invited, p_B = C invited → B comes.

- C: invited, p_C = D invited → C comes.

- A: not invited → doesn't come.

- D: invited, p_D = A invited → D comes.

Wait, in this case, B and C come, and D also comes, but we only invited B and C, but D is invited, which might be a mistake.

Wait, no, the invitation is sent to B and C, but D is invited because someone else is invited, but actually, invitations are sent to specific friends.

Wait, the problem says: "Each invitation is sent to exactly one of the friends."

So, in the 4-cycle, if we invite B and C:

- B is invited, p_B = C is invited → B comes.

- C is invited, p_C = D is invited → C comes.

- D is invited, p_D = A is invited → D comes.

- A is invited, p_A = B is invited → A comes.

Wait, but we only invited B and C, right? So, who is invited among A and D?

Wait, the invitation is sent to specific friends, but in the 4-cycle, if we invite B and C:

- B is invited, p_B = C is invited → B comes.

- C is invited, p_C = D is invited → C comes.

- D is invited, p_D = A is invited → D comes.

- A is invited, p_A = B is invited → A comes.

Wait, but we only sent invitations to B and C, so who is invited among A and D?

Wait, the problem says: "Each invitation is sent to exactly one of the friends."

Wait, but in the example, Monocarp can send invitations to friends [1,2,4,5], meaning he can send invitations to multiple friends, but each invitation is sent to exactly one friend.

So, in the 4-cycle, if he invites B and C, then B and C are invited.

Then, B comes because B and C are invited.

C comes because C and D are invited.

But D is invited, but p_D = A is invited, but A isn't invited, so D doesn't come.

Wait, no, if only B and C are invited, then:

- B: invited, p_B = C is invited → B comes.

- C: invited, p_C = D is not invited → C doesn't come.

- D: not invited → doesn't come.

- A: not invited → doesn't come.

Wait, that seems contradictory to my earlier thought.

Wait, perhaps I need to clarify the condition again.

The condition is: "The i-th friend comes to the party if both the i-th friend and the p_i -th friend receive an invitation."

So, for friend B (p_B = C):

- B is invited, and C is invited → B comes.

For friend C (p_C = D):

- C is invited, and D is not invited → C doesn't come.

For friend D (p_D = A):

- D is not invited → doesn't come.

For friend A (p_A = B):

- A is not invited → doesn't come.

So, only B comes, which isn't enough.

Wait, but earlier I thought inviting B and C in the 4-cycle makes B and C come.

But according to this, only B comes.

Wait, perhaps I made a mistake.

Wait, in the earlier thought, I had:

- B: invited, p_B = C invited → B comes.

- C: invited, p_C = D invited → C comes.

- D: invited, p_D = A invited → D comes.

- A: invited, p_A = B invited → A comes.

But in this case, if we're only inviting B and C, then D is not invited, so C doesn't come because D isn't invited.

Wait, no, hold on.

If we invite B and C in the 4-cycle:

- B is invited, p_B = C is invited → B comes.

- C is invited, p_C = D is not invited → C doesn't come.

- D is not invited → doesn't come.

- A is not invited → doesn't come.

So, only B comes.

That contradicts my earlier thought.

Wait, perhaps I need to think differently.

Wait, maybe in the 4-cycle, inviting B and D:

- B: invited, p_B = C is not invited → B doesn't come.

- D: invited, p_D = A is not invited → D doesn't come.

- A: not invited → doesn't come.

- C: not invited → doesn't come.

No one comes.

What about inviting A and D:

- A: invited, p_A = B is not invited → A doesn't come.

- D: invited, p_D = A is invited → D comes.

- B: not invited → doesn't come.

- C: not invited → doesn't come.

Only D comes.

What about inviting A and C:

- A: invited, p_A = B is not invited → A doesn't come.

- C: invited, p_C = D is invited → C comes.

- D: invited, p_D = A is invited → D comes.

- B: not invited → doesn't come.

So, C and D come.

That works with 2 invitations.

So, in this case, inviting A and C makes C and D come.

Similarly, inviting B and D makes no one come.

Wait, earlier I thought inviting B and D didn't work.

Wait, perhaps I need to find pairs where inviting two specific friends results in at least two friends coming.

In the 4-cycle:

- Inviting A and C: C and D come.

- Inviting B and C: only B comes.

- Inviting A and B: only A comes.

- Inviting C and D: C and D come.

So, inviting C and D also works.

So, in the 4-cycle, inviting two specific friends who are not directly opposite can make at least two friends come.

Similarly, in the 3-cycle:

- Inviting A and B: only A comes.

- Inviting B and C: B and C come.

- Inviting A and C: only C comes.

So, inviting B and C works.

In the 2-cycle:

- Inviting A and B: both come.

So, in general, in any cycle of length >=2, inviting two specific friends can make at least two friends come, provided that their best friends are also invited in some way.

Wait, but in the 4-cycle, inviting A and C makes C and D come, because C is invited and D is invited, so C comes, and D is invited and A is invited, so D comes.

Similarly, inviting B and D makes no one come, because B's best friend C isn't invited, and D's best friend A isn't invited.

So, in the 4-cycle, inviting two friends who are not directly opposite works.

Similarly, in a 3-cycle, inviting two consecutive friends makes two come.

So, perhaps in general, in any cycle of length k >=2, inviting two specific friends who are not directly opposite (if k is even) or any two consecutive friends (if k is odd) suffices.

Therefore, in any cycle, inviting two friends suffices to have at least two friends come, provided that those two friends are chosen such that their best friends are also invited.

Wait, but in the 4-cycle, inviting A and C works because C's best friend D is invited, and D's best friend A is invited.

Similarly, in the 3-cycle, inviting B and C works because C's best friend A is invited, and B's best friend C is invited.

So, perhaps in any cycle, inviting any two friends who are not directly opposite in even cycles or any two consecutive in odd cycles suffices.

Therefore, in general, for any cycle of length k >=2, inviting two specific friends suffices to have at least two friends come.

Hence, the minimal number of invitations needed is 2.

But in the second test case, the answer is 3.

Wait, but according to this reasoning, it should be 2.

Wait, perhaps I'm missing something.

Wait, in the second test case, n=4, p=[2,3,4,1], which is a single 4-cycle.

Earlier, I found that inviting A and C makes C and D come, which is 2 invitations.

But according to the example, the answer is 3.

Wait, perhaps I misread the example.

Wait, in the second test case, the output is 3.

But according to my earlier reasoning, inviting two friends can make at least two friends come.

Wait, perhaps there's a misunderstanding.

Wait, in the second test case, if Monocarp sends invitations to friends [1,2,3], then:

- Friend 1: invited, p_1=2 is invited → Friend 1 comes.

- Friend 2: invited, p_2=3 is invited → Friend 2 comes.

- Friend 3: invited, p_3=4 is invited → Friend 3 comes.

- Friend 4: invited, p_4=1 is invited → Friend 4 comes.

So, all four friends come.

But the minimal number should be 2, as per my earlier reasoning.

But according to the example, the answer is 3.

Wait, perhaps I need to re-examine the problem statement.

"Each invitation is sent to exactly one of the friends."

Wait, perhaps I misinterpreted this.

Wait, no, each invitation is sent to one friend, but Monocarp can send multiple invitations.

Wait, in the second test case, the answer is 3, but according to my earlier thought, inviting two friends can make at least two friends come.

Wait, perhaps there's a misunderstanding in the condition.

Wait, the condition is: "The i-th friend comes to the party if both the i-th friend and the p_i -th friend receive an invitation."

So, for friend i to come, both i and p_i must receive invitations.

But in the second test case, if Monocarp invites friends [1,2,3], then:

- Friend 1: invited, p_1=2 is invited → Friend 1 comes.

- Friend 2: invited, p_2=3 is invited → Friend 2 comes.

- Friend 3: invited, p_3=4 is invited → Friend 3 comes.

- Friend 4: invited, p_4=1 is invited → Friend 4 comes.

So, all four come.

But if he invites only [1,2], then:

- Friend 1: invited, p_1=2 is invited → Friend 1 comes.

- Friend 2: invited, p_2=3 is not invited → Friend 2 doesn't come.

- Friend 3: not invited → doesn't come.

- Friend 4: not invited → doesn't come.

So, only Friend 1 comes, which isn't enough.

If he invites [1,3]:

- Friend 1: invited, p_1=2 is not invited → Friend 1 doesn't come.

- Friend 2: not invited → doesn't come.

- Friend 3: invited, p_3=4 is invited → Friend 3 comes.

- Friend 4: invited, p_4=1 is invited → Friend 4 comes.

So, Friends 3 and 4 come.

That works with 2 invitations.

Similarly, inviting [2,4]:

- Friend 1: not invited → doesn't come.

- Friend 2: invited, p_2=3 is not invited → Friend 2 doesn't come.

- Friend 3: not invited → doesn't come.

- Friend 4: invited, p_4=1 is invited → Friend 4 comes.

So, only Friend 4 comes.

Not enough.

Inviting [3,4]:

- Friend 1: not invited → doesn't come.

- Friend 2: not invited → doesn't come.

- Friend 3: invited, p_3=4 is invited → Friend 3 comes.

- Friend 4: invited, p_4=1 is invited → Friend 4 comes.

So, Friends 3 and 4 come.

That works with 2 invitations.

So, in this case, inviting 2 friends can make at least 2 friends come.

But according to the example, the answer is 3.

Wait, perhaps I misread the example.

Wait, the second test case's output is 3, but according to my reasoning, 2 invitations suffice.

Is there something wrong with my reasoning?

Wait, perhaps the problem is that when a friend comes, their best friend must be invited, but their best friend doesn't necessarily come, unless their best friend is also invited.

Wait, no, the condition is clear: friend i comes if both i and p_i are invited.

So, in the second test case, inviting [1,2,3]:

- Friends 1,2,3,4 are invited.

- Friends 1,2,3,4 come.

Inviting [1,3]:

- Friends 1,3,4 are invited.

- Friends 3 and 4 come.

Inviting [3,4]:

- Friends 3 and 4 are invited.

- Friends 3 and 4 come.

So, in all these cases, at least two friends come with at most 3 invitations.

But according to the example, the answer is 3.

Wait, perhaps I need to check the minimal number of invitations such that at least two friends come.

Wait, in the second test case, inviting [1,3] makes Friends 3 and 4 come, which is at least two friends, with 2 invitations.

But the example says the answer is 3.

Wait, perhaps I'm missing something.

Wait, perhaps there's a misunderstanding in the problem statement.

Wait, the problem says: "Calculate the minimum number of invitations Monocarp has to send so that at least 2 friends come to the party."

In the second test case, according to my reasoning, inviting [1,3] makes Friends 3 and 4 come, which is at least two friends, with only 2 invitations.

But the example output is 3.

So, perhaps my reasoning is incorrect.

Wait, perhaps in the second test case, inviting [1,3] doesn't make Friend 4 come.

Wait, in the second test case, p=[2,3,4,1].

So, p_1=2, p_2=3, p_3=4, p_4=1.

If Monocarp invites Friends 1 and 3:

- Friend 1: invited, p_1=2 is not invited → Friend 1 doesn't come.

- Friend 2: not invited → doesn't come.

- Friend 3: invited, p_3=4 is invited → Friend 3 comes.

- Friend 4: invited, p_4=1 is invited → Friend 4 comes.

Wait, but in this case, Friend 1 doesn't come because Friend 2 isn't invited.

Friend 2 isn't invited.

Friend 3 comes because Friend 3 and Friend 4 are invited.

Friend 4 comes because Friend 4 and Friend 1 are invited.

So, Friends 3 and 4 come.

So, with 2 invitations, at least two friends come.

But according to the example, the answer is 3.

So, perhaps there's a misunderstanding.

Wait, perhaps the problem is that when you invite Friend 3 and Friend 4, Friend 4 looks at Friend 1, who isn't invited, so Friend 4 doesn't come.

Wait, no, in the second test case, if Monocarp invites Friends 3 and 4:

- Friend 3: invited, p_3=4 is invited → Friend 3 comes.

- Friend 4: invited, p_4=1 is invited → Friend 4 comes.

- Friend 1: not invited → doesn't come.

- Friend 2: not invited → doesn't come.

So, Friends 3 and 4 come.

That seems correct.

But according to the example, the answer is 3.

Wait, perhaps in the problem, when you invite Friend 4, p_4=1, and Friend 1 isn't invited, so Friend 4 doesn't come.

Wait, no, in the condition, Friend 4 comes if both Friend 4 and p_4=1 are invited.

In this case, Friend 4 is invited, and Friend 1 is not invited, so Friend 4 doesn't come.

Wait, hold on.

So, in the second test case, if Monocarp invites Friends 3 and 4:

- Friend 3: invited, p_3=4 is invited → Friend 3 comes.

- Friend 4: invited, p_4=1 is not invited → Friend 4 doesn't come.

- Friend 1: not invited → doesn't come.

- Friend 2: not invited → doesn't come.

So, only Friend 3 comes.

That's different from what I thought earlier.

So, in this case, inviting Friends 3 and 4 makes only Friend 3 come, because Friend 4's best friend Friend 1 isn't invited.

Hence, only one friend comes, which isn't sufficient.

Therefore, inviting Friends 3 and 4 doesn't work.

Similarly, inviting Friends 1 and 3:

- Friend 1: invited, p_1=2 is not invited → Friend 1 doesn't come.

- Friend 3: invited, p_3=4 is invited → Friend 3 comes.

- Friend 4: invited, p_4=1 is not invited → Friend 4 doesn't come.

- Friend 2: not invited → doesn't come.

So, only Friend 3 comes.

Again, only one friend comes.

Similarly, inviting Friends 1 and 2:

- Friend 1: invited, p_1=2 is invited → Friend 1 comes.

- Friend 2: invited, p_2=3 is not invited → Friend 2 doesn't come.

- Friend 3: not invited → doesn't come.

- Friend 4: not invited → doesn't come.

Only Friend 1 comes.

Inviting Friends 2 and 3:

- Friend 2: invited, p_2=3 is invited → Friend 2 comes.

- Friend 3: invited, p_3=4 is invited → Friend 3 comes.

- Friend 4: invited, p_4=1 is invited → Friend 4 comes.

- Friend 1: invited, p_1=2 is invited → Friend 1 comes.

So, Friends 2, 3, 4, and 1 come.

That works, but requires inviting 2 friends, and results in 4 friends coming.

But according to the example, the answer is 3.

Wait, perhaps the example is wrong, or I'm misunderstanding something.

Wait, in the problem statement, it says:

"For example, if p = [2,3,4,1] , and Monocarp sends invitations to friends [1,2,3] , then friends [1,2,3,4] will come to the party."

Wait, in this case, inviting Friends 1,2,3:

- Friend 1: invited, p_1=2 is invited → Friend 1 comes.

- Friend 2: invited, p_2=3 is invited → Friend 2 comes.

- Friend 3: invited, p_3=4 is invited → Friend 3 comes.

- Friend 4: invited, p_4=1 is invited → Friend 4 comes.

So, all four friends come.

But according to the example, the minimal number of invitations is 3.

But according to my earlier thought, inviting Friends 2 and 3 makes Friends 2,3,4,1 come, which is at least two friends, with only 2 invitations.

So, why is the answer 3 in the example?

Wait, perhaps I need to check the condition again.

The condition is: "The i-th friend comes to the party if both the i-th friend and the p_i -th friend receive an invitation."

Wait, in the second test case, p = [2,3,4,1].

If Monocarp invites Friends 2 and 3:

- Friend 2: invited, p_2=3 is invited → Friend 2 comes.

- Friend 3: invited, p_3=4 is invited → Friend 3 comes.

- Friend 4: invited, p_4=1 is invited → Friend 4 comes.

- Friend 1: invited, p_1=2 is invited → Friend 1 comes.

So, all four friends come with inviting only two friends, which contradicts the example's output of 3.

Wait, perhaps I'm missing that when you invite Friend 2 and Friend 3, Friend 4 is invited because Friend 3's best friend is Friend 4, but Friend 4's best friend is Friend 1, who isn't invited, so Friend 4 doesn't come.

Wait, no, in my earlier thought, Friend 4 is invited because Friend 3 is invited, and p_3=4, so Friend 4 is invited.

Then, Friend 4 comes if both Friend 4 and p_4=1 are invited.

But Friend 1 isn't invited, so Friend 4 doesn't come.

Similarly, Friend 1 is invited, but p_1=2 is invited, so Friend 1 comes.

Wait, no, in this scenario, Friend 1 is invited because Friend 4 is invited, but Friend 4 is only invited because Friend 3 is invited.

Wait, perhaps I'm getting confused.

Let's clarify: Monocarp decides who to invite by choosing a set of friends to send invitations to.

Each invitation is sent to exactly one friend.

So, if Monocarp invites Friends 2 and 3:

- Friend 2 is invited, p_2=3 is invited → Friend 2 comes.

- Friend 3 is invited, p_3=4 is invited → Friend 3 comes.

- Friend 4 is invited, p_4=1 is not invited → Friend 4 doesn't come.

- Friend 1 is invited, p_1=2 is invited → Friend 1 comes.

Wait, but in this case, Friend 4 is invited because Monocarp invited Friend 3, whose best friend is Friend 4.

Similarly, Friend 1 is invited because Friend 4 is invited, but in reality, Monocarp only sent invitations to Friend 2 and Friend 3.

Wait, no, Monocarp sends invitations only to the friends he chooses.

So, if he invites Friends 2 and 3, then only Friends 2 and 3 are invited.

But p_2=3 is invited, so Friend 2 comes.

p_3=4 is invited, so Friend 3 comes.

But Friend 4 is not invited, unless Monocarp invited them.

Wait, no, Monocarp only invites Friends 2 and 3.

So, Friend 4 is not invited.

Similarly, Friend 1 is not invited.

So, in this case:

- Friend 2: invited, p_2=3 is invited → Friend 2 comes.

- Friend 3: invited, p_3=4 is not invited → Friend 3 doesn't come.

- Friend 4: not invited → doesn't come.

- Friend 1: not invited → doesn't come.

So, only Friend 2 comes.

That doesn't satisfy the condition of having at least two friends come.

Wait, perhaps I was misunderstanding the invitation process.

Wait, the problem says: "Each invitation is sent to exactly one of the friends."

But it also says: "the p_i -th friend receives an invitation."

Wait, no, it says: "the i-th friend comes to the party if both the i-th friend and the p_i -th friend receive an invitation."

So, to have friend i come, both friend i and friend p_i must receive invitations.

But the invitations are sent only to the friends Monocarp chooses.

So, in the second test case, p = [2,3,4,1].

If Monocarp invites Friends 2 and 3:

- Friend 2 is invited, p_2=3 is invited → Friend 2 comes.

- Friend 3 is invited, p_3=4 is not invited → Friend 3 doesn't come.

- Friend 4 is not invited → doesn't come.

- Friend 1 is not invited → doesn't come.

So, only Friend 2 comes.

Not enough.

If Monocarp invites Friends 2,3,4:

- Friend 2: invited, p_2=3 is invited → Friend 2 comes.

- Friend 3: invited, p_3=4 is invited → Friend 3 comes.

- Friend 4: invited, p_4=1 is invited → Friend 4 comes.

- Friend 1: invited, p_1=2 is invited → Friend 1 comes.

So, all four come.

That works with 3 invitations.

Similarly, inviting Friends 1,2,3:

- Friend 1: invited, p_1=2 is invited → Friend 1 comes.

- Friend 2: invited, p_2=3 is invited → Friend 2 comes.

- Friend 3: invited, p_3=4 is invited → Friend 3 comes.

- Friend 4: invited, p_4=1 is invited → Friend 4 comes.

Again, all four come.

So, with 3 invitations, at least two friends come.

But in the earlier thought, inviting only two friends doesn't suffice because only one friend comes.

Hence, the minimal number of invitations needed is 3.

So, perhaps in cycles of length 4, the minimal number of invitations to have at least two friends come is 3.

Similarly, in cycles of length 3, it's 2.

In cycles of length 2, it's 2.

Wait, but in the third test case, n=2, p=[2,1], and the output is 2.

But according to my earlier thought, in a 2-cycle, inviting both makes both come, which is at least two friends.

So, in 2-cycles, inviting two friends suffices.

In 3-cycles, inviting two friends suffices.

In 4-cycles, inviting three friends is necessary.

Wait, but in the second test case, which is a 4-cycle, inviting three friends suffices.

Is there a general rule based on the cycle length?

Perhaps, for cycles of even length k, the minimal number of invitations needed is k/2, or something similar.

Wait, in the 4-cycle, it's 3, which is more than 2.

Wait, perhaps it's ceil(k/2).

In a 2-cycle, ceil(2/2)=1, but in the problem, for 2-cycle, inviting two friends is necessary.

Wait, that doesn't match.

Wait, maybe it's different.

Perhaps, in cycles of length k, the minimal number of invitations to have at least two friends come is:

- If k is 2: 2

- If k is odd: 2

- If k is even: 3

But in the second test case, k=4 (even), and the answer is 3.

In the first test case, k=3 (odd), and the answer is 2.

In the third test case, k=2, and the answer is 2.

So, perhaps for even-length cycles greater than 2, the minimal number of invitations is 3.

Hence, the general rule is:

- For cycles of length 2: 2 invitations.

- For cycles of length >=3: 2 invitations, except for cycles of even length greater than 2, where it's 3.

Wait, but in the 4-cycle, as per the example, it's 3.

Wait, perhaps for even-length cycles greater than 2, it's 3.

For odd-length cycles, it's 2.

For 2-cycle, it's 2.

Hence, the minimal number of invitations is:

- 2 for odd cycles and 2-cycles.

- 3 for even cycles greater than 2.

But in the second test case, which is a 4-cycle, the answer is 3.

In the first test case, which has a 3-cycle and a 2-cycle, the answer is 2.

In the third test case, which is a 2-cycle, the answer is 2.

So, perhaps when there are multiple cycles, the minimal number of invitations is the minimum over the cycles.

Wait, no, in the first test case, there are two cycles: a 3-cycle and a 2-cycle.

To have at least two friends come, we can choose to invite in one of the cycles.

In the first test case, inviting in the 3-cycle (2 invitations) or in the 2-cycle (2 invitations), so the minimal is 2.

In the second test case, a single 4-cycle, minimal is 3.

In the third test case, a single 2-cycle, minimal is 2.

Hence, the general approach is:

- Decompose the permutation into disjoint cycles.

- For each cycle, determine the minimal number of invitations needed to have at least two friends come from that cycle.

- Then, the overall minimal number of invitations is the minimal over these values.

But in the first test case, it's the minimum of 2 (from 3-cycle) and 2 (from 2-cycle), which is 2.

In the second test case, it's 3 (from 4-cycle).

In the third test case, it's 2 (from 2-cycle).

Hence, the answer is the minimal number from the minimal invitations required for each cycle.

But in the second test case, it's just one cycle, so it's 3.

Hence, the general rule is:

- For a cycle of length 2: 2

- For a cycle of odd length k >=3: 2

- For a cycle of even length k >=4: 3

Hence, the minimal number of invitations is:

- 2 for odd cycles and 2-cycles.

- 3 for even cycles of length >=4.

But in the second test case, it's a 4-cycle, so it's 3.

In the first test case, it's a 3-cycle and a 2-cycle, both require 2, so minimal is 2.

In the third test case, it's a 2-cycle, requiring 2.

Hence, this seems consistent.

Therefore, the approach is:

- Decompose the permutation into disjoint cycles.

- For each cycle, determine its length.

- Based on the cycle's length, determine the minimal number of invitations needed:

- If the cycle is of length 2: 2 invitations.

- If the cycle is of odd length >=3: 2 invitations.

- If the cycle is of even length >=4: 3 invitations.

- Then, the overall minimal number of invitations is the minimal value among the minimal invitations required for each cycle.

Wait, but in the first test case, there are two cycles: one of length 3 and one of length 2, both requiring 2 invitations, so the minimal is 2.

In the second test case, a single 4-cycle, requiring 3 invitations.

In the third test case, a single 2-cycle, requiring 2 invitations.

Hence, this seems correct.

But let's verify with another example.

Suppose n=6, p=[2,1,4,3,6,5].

This has two cycles: a 2-cycle (1,2) and a 2-cycle (3,4) and a 2-cycle (5,6).

In this case, each cycle requires 2 invitations.

Hence, the minimal number of invitations is 2.

Another example: n=6, p=[2,3,1,5,6,4].

This has two cycles: a 3-cycle (1,2,3) and a 3-cycle (4,5,6).

Each cycle requires 2 invitations.

Hence, the minimal number of invitations is 2.

Another example: n=6, p=[2,1,4,3,6,5].

Same as the earlier example.

Another example: n=5, p=[2,1,4,5,3].

This has two cycles: a 2-cycle (1,2) and a 3-cycle (3,4,5).

Minimal invitations are 2.

Another example: n=6, p=[2,3,4,1,6,5].

This has two cycles: a 4-cycle (1,2,3,4) and a 2-cycle (5,6).

For the 4-cycle, minimal invitations are 3, for the 2-cycle, minimal invitations are 2.

Hence, the overall minimal is 2.

Wait, but in this case, inviting two friends from the 2-cycle makes two friends come.

Hence, even though the 4-cycle requires 3, the overall minimal is 2.

But, in reality, we need to ensure that at least two friends come, which could be from any cycle.

So, we can choose to invite from the 2-cycle to have two friends come, with only 2 invitations.

Hence, the overall minimal is 2.

So, the approach is correct.

Hence, the general solution is:

- Decompose the permutation into disjoint cycles.

- For each cycle, determine its length.

- Based on the cycle's length, determine the minimal invitations needed as per the rules above.

- The overall minimal number of invitations is the minimal among these values.

Now, considering the provided program:

def func():

for _ in range(int(input())):

n = int(input())

l = list(map(int, input().split()))

i = 0

j = 0

while i <= n - 1:

p = l[i]

q = l[p - 1]

if q == i + 1:

print(2)

j = 1

break

i += 1

if j == 0:

print(3)



This program seems to be checking for cycles of length 2.

It iterates through the list and checks if there exists a pair (i, p_i) such that p_p_i = i.

If such a pair exists, it prints 2.

Otherwise, it prints 3.

In other words, it's checking for 2-cycles.

But according to our earlier analysis, in cycles of length 2, we need to invite both to have both come.

In cycles of length >=3, we need to invite two friends in odd cycles or three in even cycles >=4.

But