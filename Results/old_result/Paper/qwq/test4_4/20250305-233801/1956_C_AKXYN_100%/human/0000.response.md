Alright, I've got this problem to solve. Let's see what it's asking for. So, there's this n by n matrix, initially all zeros, and I can perform two types of operations. Each operation allows me to set a whole row or a whole column to a permutation of numbers from 1 to n. The goal is to maximize the sum of all the elements in the matrix, and I need to do this with no more than 2n operations.

First, I need to understand what these operations do. A type 1 operation lets me choose a row and set each element in that row to a permutation of 1 to n. Similarly, a type 2 operation lets me choose a column and set each element in that column to a permutation of 1 to n.

Since I can perform these operations multiple times, I need to think about how these operations interact with each other. Each operation overwrites the current values in the row or column with the new permutation.

I need to maximize the sum of all elements in the matrix. So, I should aim to have the highest possible numbers in as many positions as possible.

Let me consider a small value of n to get an intuition. Let's take n=1. In this case, the matrix has only one element. The only operation I can perform is either type 1 or type 2, both of which will set that single element to 1. So, the maximum sum is 1, and I can achieve it with one operation.

Now, for n=2, let's see. The matrix has 4 elements. I need to maximize their sum. Each operation can set a row or a column to permutations of 1 and 2.

Let me think about performing operations in sequence. If I do a type 1 operation on row 1, setting it to [2,1], and then a type 2 operation on column 1, setting it to [2,1], what happens?

After the first operation, the matrix is:

2 1

0 0

Then, applying the type 2 operation on column 1, setting it to [2,1], the matrix becomes:

2 (from column operation) 1

1 0

Wait, that doesn't seem right. Actually, when I apply a type 2 operation on column 1, it sets the entire column to [2,1], so the matrix becomes:

2 1

1 0

Then, if I apply another type 1 operation on row 2, setting it to [2,1], it would overwrite row 2:

2 1

2 1

So, the sum would be 2 + 1 + 2 + 1 = 6.

But in the example provided, they achieved a sum of 7 with 3 operations for n=2. So, I must be missing something.

Let me look back at the example. In the example, they performed:

1 1 1 2 (type 1 on row 1 with permutation [1,2])

1 2 1 2 (type 1 on row 2 with permutation [1,2])

2 1 1 2 (type 2 on column 1 with permutation [1,2])

After the first operation:

Row 1 set to [1,2]

Matrix:

1 2

0 0

After the second operation:

Row 2 set to [1,2]

Matrix:

1 2

1 2

After the third operation:

Column 1 set to [1,2]

Which means set the first element of each row in column 1 to [1,2], overwriting what's there.

So, the matrix becomes:

1 2

2 2

Sum is 1+2+2+2=7.

Okay, so by doing operations in this order, they achieved a higher sum. I see that operations can build upon each other. So, the order in which operations are performed matters because later operations can overwrite earlier ones.

I need to find a way to maximize the sum by strategically choosing which rows and columns to operate on and in what order.

Let me think about what the maximum possible sum could be. If I could set every element in the matrix to n, that would be ideal, but is it possible?

Well, since each operation sets a row or column to a permutation of 1 to n, I can't just set all elements to n in one go. I need to see how to maximize the values in the cells.

One approach could be to focus on setting the diagonal elements to n, and then see if I can maximize the off-diagonal elements.

Wait, but I need to maximize the sum of all elements, not just some of them.

Let me consider that each operation allows me to set a row or column to a permutation, and I can choose which permutation to use each time.

I need to think about how to distribute the highest numbers across the matrix in such a way that their sum is maximized.

I recall that in some scheduling problems, a similar approach is used where you assign priorities to certain tasks. Maybe I can prioritize setting the highest values where they can contribute the most to the total sum.

Alternatively, perhaps there's a mathematical formula that can give me the maximum possible sum based on n.

Let me try to derive such a formula.

Considering that I can perform up to 2n operations, and each operation affects an entire row or column, I need to find an optimal way to cover the matrix with these operations.

Wait a minute, this sounds similar to covering a matrix with rows and columns in a way that maximizes the sum.

I recall that in matrix terms, the sum of all elements can be thought of as the sum over all rows or all columns.

If I consider that each row can be set to a permutation of 1 to n, and similarly for columns, I need to find a way to assign these permutations such that the overlapping cells (where rows and columns are both set) have higher values.

This seems a bit tricky. Maybe I should look for a pattern or a formula that directly gives me the maximum sum based on n.

Let me consider small values of n and see if I can find a pattern.

For n=1:

Maximum sum is 1.

For n=2:

From the example, maximum sum is 7.

For n=3:

Let me try to compute it.

If I perform operations to set rows and columns optimally.

Suppose I set row 1 to [3,2,1], row 2 to [3,2,1], and column 1 to [3,2,1].

Let's see:

First, set row 1 to [3,2,1]:

3 2 1

0 0 0

0 0 0

Then, set row 2 to [3,2,1]:

3 2 1

3 2 1

0 0 0

Then, set column 1 to [3,2,1]:

3 (from column) 2 1

2 (from column) 2 1

1 (from column) 0 0

So, the matrix is:

3 2 1

2 2 1

1 0 0

Sum is 3+2+1 + 2+2+1 + 1+0+0 = 12.

Is there a better way?

What if I set row 1 to [3,2,1], row 3 to [3,2,1], and column 1 to [3,2,1]?

First, set row 1 to [3,2,1]:

3 2 1

0 0 0

0 0 0

Then, set row 3 to [3,2,1]:

3 2 1

0 0 0

3 2 1

Then, set column 1 to [3,2,1]:

3 (from column) 2 1

2 (from column) 0 0

1 (from column) 2 1

Sum is 3+2+1 + 2+0+0 + 1+2+1 = 12 again.

Hmm, same sum.

What if I set column 2 to [3,2,1] after that?

Matrix becomes:

3 3 (from column) 1

2 2

1 2 1

Sum is 3+3+1 + 2+2 + 1+2+1 = 14.

Better than before.

Can I get higher?

Let me try setting more operations.

Set row 2 to [3,2,1]:

3 3 1

3 2 1

1 2 1

Sum is 3+3+1 + 3+2+1 + 1+2+1 = 17.

Is this the maximum?

Let me see if I can get higher.

Set column 3 to [3,2,1]:

3 3 3 (from column)

3 2 2 (from column)

1 2 1 (from column)

Sum is 3+3+3 + 3+2+2 + 1+2+1 = 20.

Better.

Can I get higher?

Set row 3 to [3,2,1]:

3 3 3

3 2 2

3 2 1

Sum is 3+3+3 + 3+2+2 + 3+2+1 = 23.

Is this the maximum?

Let me see.

In this configuration, the sum is 23.

Is there a way to get higher than that?

If I set more operations, but I'm limited to 2n=6 operations.

Wait, in this case, n=3, 2n=6 operations.

In the above, I used 5 operations:

Set row 1 to [3,2,1]

Set row 3 to [3,2,1]

Set column 1 to [3,2,1]

Set column 3 to [3,2,1]

Set row 2 to [3,2,1]

That's 5 operations, but I can use up to 6.

Maybe I can optimize further.

Alternatively, perhaps there's a pattern here that can be generalized for any n.

Let me try to find a general formula.

Looking back at n=1, sum=1.

N=2, sum=7.

N=3, sum=23.

Let me see if there's a pattern.

For n=1: 1

N=2: 7

N=3: 23

Looking at these numbers, 1, 7, 23.

Let me see the differences:

7 - 1 = 6

23 - 7 = 16

6 and 16 are 6=2^2*3, 16=2^4.

Not sure.

Alternatively, perhaps it's related to the sum of the first n squares or something similar.

Wait, for n=1: 1 = 1^3

N=2: 7 = 1^3 + 2^3

N=3: 27 = 1^3 + 2^3 + 3^3 = 36, but 23 is not 36. Wait, perhaps not.

Wait, 1^3 + 2^3 + 3^3 = 1 + 8 + 27 = 36, but in my earlier manual calculation, I got 23. Maybe my manual calculation was wrong.

Wait, perhaps I miscalculated the sum for n=3.

Let me recalculate for n=3.

If I set row 1 to [3,2,1], row 2 to [3,2,1], row 3 to [3,2,1], and column 1 to [3,2,1], column 2 to [3,2,1], column 3 to [3,2,1], but that's 6 operations, which is 2n.

But in this case, the matrix would be:

3 (from column) 3 (from column) 3 (from column)

3 3 3

3 3 3

Sum would be 3+3+3 + 3+3+3 + 3+3+3 = 27.

Wait, that's higher than my previous manual calculation of 23.

So, perhaps I can achieve 27.

Let me see how.

If I set all rows to [3,2,1] and all columns to [3,2,1], but in operations, setting a row overwrites the previous values in that row.

Wait, let's think carefully.

Suppose I set row 1 to [3,2,1], then set column 1 to [3,2,1], then set row 2 to [3,2,1], then set column 2 to [3,2,1], then set row 3 to [3,2,1], then set column 3 to [3,2,1].

Let's simulate this step by step.

Start with all zeros.

Step 1: Set row 1 to [3,2,1]:

3 2 1

0 0 0

0 0 0

Step 2: Set column 1 to [3,2,1]:

3 (from column) 2 1

2 (from column) 0 0

1 (from column) 0 0

Step 3: Set row 2 to [3,2,1]:

3 2 1

3 2 1

1 0 0

Step 4: Set column 2 to [3,2,1]:

3 3 (from column) 1

3 2 (from column) 1

1 2 (from column) 0

Step 5: Set row 3 to [3,2,1]:

3 3 1

3 2 1

3 2 1

Step 6: Set column 3 to [3,2,1]:

3 3 3 (from column)

3 2 2 (from column)

3 2 1 (from column)

Sum is 3+3+3 + 3+2+2 + 3+2+1 = 22.

Wait, that's 22, not 27.

Hmm, seems like there's some overwriting happening.

Is there a better sequence of operations to achieve a higher sum?

Let me try a different sequence.

First, set all rows to [3,2,1], then set all columns to [3,2,1].

So, set row 1 to [3,2,1]:

3 2 1

0 0 0

0 0 0

Set row 2 to [3,2,1]:

3 2 1

3 2 1

0 0 0

Set row 3 to [3,2,1]:

3 2 1

3 2 1

3 2 1

Now, set column 1 to [3,2,1]:

3 (from column) 2 1

2 (from column) 2 1

1 (from column) 2 1

Sum so far: 3+2+1 + 2+2+1 + 1+2+1 = 14.

Then, set column 2 to [3,2,1]:

3 3 (from column) 1

2 2 (from column) 1

1 2 (from column) 1

Sum: 3+3+1 + 2+2+1 + 1+2+1 = 15.

Then, set column 3 to [3,2,1]:

3 3 3 (from column)

2 2 2 (from column)

1 2 1 (from column)

Sum: 3+3+3 + 2+2+2 + 1+2+1 = 19.

This is better than previous, but still not 27.

Seems like I can't achieve 27 with this approach.

Maybe 27 is not achievable, but perhaps there's a better way.

Wait, maybe if I interleave row and column operations differently.

Let me try setting columns first, then rows.

Set column 1 to [3,2,1]:

3 0 0

2 0 0

1 0 0

Set column 2 to [3,2,1]:

3 3 0

2 2 0

1 2 0

Set column 3 to [3,2,1]:

3 3 3

2 2 2

1 2 1

Sum: 3+3+3 + 2+2+2 + 1+2+1 = 19.

Then, set row 1 to [3,2,1]:

3 2 1

2 2 2

1 2 1

Sum: 3+2+1 + 2+2+2 + 1+2+1 = 14.

Wait, that's worse.

Alternatively, set row 1 to [3,2,1]:

3 2 1

0 0 0

0 0 0

Then set column 1 to [3,2,1]:

3 (from column) 2 1

2 (from column) 0 0

1 (from column) 0 0

Then set row 2 to [3,2,1]:

3 2 1

3 2 1

1 0 0

Then set column 2 to [3,2,1]:

3 3 (from column) 1

3 2 (from column) 1

1 2 (from column) 0

Then set row 3 to [3,2,1]:

3 3 1

3 2 1

3 2 1

Then set column 3 to [3,2,1]:

3 3 3 (from column)

3 2 2 (from column)

3 2 1 (from column)

Sum: 3+3+3 + 3+2+2 + 3+2+1 = 22.

Still 22.

Is there a way to get higher?

Maybe if I set rows and columns in a different order or choose different permutations.

Wait, in all previous attempts, I used the permutation [3,2,1]. Maybe I should use different permutations to maximize the sum.

Let me try using different permutations.

For n=3, permutations are all arrangements of 1,2,3.

Let me try setting row 1 to [3,2,1], row 2 to [2,3,1], row 3 to [1,3,2], and columns similarly.

But this seems too ad-hoc. I need a systematic way to maximize the sum.

Perhaps I should consider that each cell in the matrix can be set by either a row operation or a column operation, and the last operation that sets that cell determines its value.

So, to maximize the sum, I should aim to set as many cells as possible to the highest values in their respective operations.

Wait, maybe I can think in terms of assigning the highest possible values to the cells by choosing appropriate operations.

Alternatively, perhaps I can think of the matrix as being built by a sequence of row and column operations, and I need to maximize the sum over all such sequences with at most 2n operations.

This seems complicated. Maybe I should look for a pattern in the sums for small n and try to generalize.

Let me try n=4.

If I set all rows to [4,3,2,1] and all columns to [4,3,2,1], and see what sum I get.

But first, for n=3, perhaps there's a formula.

Looking back, for n=1: sum=1

N=2: sum=7

N=3: sum=22 (from my previous attempt)

Wait, but earlier I thought of 1=1, 7=7, 22=22, but I need to find a general formula.

Let me see the differences:

7 - 1 = 6

22 - 7 = 15

For n=1: 1

N=2: 7 = 1 + 6

N=3: 22 = 1 + 6 + 15

This looks like 1 + ∑_{k=2}^n (k*(k+1)/2)

Wait, 6=3*2/2=3, but 6≠3. Hmm, not matching.

Wait, 7-1=6, and 6=2*(2+1)=6, which is 2*(2+1).

22-7=15, which is 3*(3+1)=12, but 15≠12. Wait, maybe not.

Alternatively, perhaps it's related to the sum of squares: n(n+1)(2n+1)/6.

For n=1: 1

N=2: 1 + 2^3 = 9, but I have 7.

N=3: 1 + 2^3 + 3^3 = 1 + 8 + 27 = 36, but I have 22.

Not matching.

Alternatively, perhaps it's the sum of the first n triangular numbers.

Triangular number T_k = k(k+1)/2.

Sum of first n triangular numbers is n(n+1)(n+2)/6.

For n=1: 1

N=2: 1 + 3 = 4 ≠7

N=3: 1 + 3 + 6 = 10 ≠22

Not matching.

Hmm.

Maybe I need to think differently.

Each operation sets a row or column to a permutation of 1 to n.

Since permutations are arrangements of 1 to n, their sum is always n(n+1)/2.

So, for each row or column operation, the sum added is n(n+1)/2.

But since operations can overwrite each other, the total sum isn't just m * n(n+1)/2, where m is the number of operations.

I need to account for the overlaps.

Wait, perhaps inclusion-exclusion can be applied here.

But that seems complicated.

Let me consider that each cell can be set by either a row operation or a column operation, and the last operation that sets that cell determines its value.

So, if a cell is set by both a row operation and a column operation, the last one overwrites the previous value.

Therefore, to maximize the sum, I should aim to set as many cells as possible to the highest values in their respective operations.

Wait, perhaps I can prioritize setting the diagonal cells to high values.

But I need a more concrete approach.

Let me consider that each row operation sets an entire row, and each column operation sets an entire column.

If I set all rows to [n, n-1, ..., 1], and all columns to [n, n-1, ..., 1], in some order, what would be the resulting matrix?

Well, the last operation that sets each cell determines its value.

So, if I set all rows first, and then all columns, the column operations would overwrite the row operations for the corresponding columns.

Wait, perhaps I can think in terms of which operations affect which cells last.

Let me try to formalize this.

Suppose I perform k row operations and m column operations, with k + m ≤ 2n.

For each cell (i,j), the value will be:

- If the last operation on cell (i,j) is a row operation on row i, then it's p_j for that row operation.

- If the last operation on cell (i,j) is a column operation on column j, then it's p_i for that column operation.

To maximize the sum, I need to choose which operations to perform and in what order, to maximize the sum of these values.

This seems quite involved.

Maybe I can look for a pattern in the sums for small n and try to generalize.

From n=1: sum=1

N=2: sum=7

N=3: sum=22 (from my earlier attempt)

Wait, but in n=2, the example shows sum=7 with 3 operations.

Is there a formula that gives sum=7 for n=2, sum=22 for n=3, and sum=1 for n=1?

Let me see.

Looking at the sequence: 1, 7, 22, ...

Let me see the differences:

7 - 1 = 6

22 - 7 = 15

Next difference: 15 - 6 = 9

This suggests a quadratic relationship.

Wait, for n=1: 1

N=2: 7 = 1 + 6

N=3: 7 + 15 = 22

So, the differences are 6, 15, which are 6 and 15.

Looking at 6=2*3, 15=3*5.

Not sure.

Alternatively, perhaps it's related to n^3 - n^2 + n.

For n=1: 1 -1 +1=1

N=2: 8 -4 +2=6 ≠7

N=3: 27 -9 +3=21 ≠22

Not matching.

Alternatively, n^3 - n + 1.

N=1: 1 -1 +1=1

N=2: 8 -2 +1=7

N=3: 27 -3 +1=25 ≠22

Still not matching.

Wait, for n=3, my earlier manual calculation gave 22, but perhaps that's not the maximum.

Maybe the maximum is higher.

Wait, in the n=3 case, if I set all rows and all columns to [3,2,1], in some order, perhaps the sum can be higher than 22.

Let me try a different sequence.

First, set row 1 to [3,2,1]:

3 2 1

0 0 0

0 0 0

Then, set column 1 to [3,2,1]:

3 (from column) 2 1

2 (from column) 0 0

1 (from column) 0 0

Then, set row 2 to [3,2,1]:

3 2 1

3 2 1

1 0 0

Then, set column 2 to [3,2,1]:

3 3 (from column) 1

3 2 (from column) 1

1 2 (from column) 0

Then, set row 3 to [3,2,1]:

3 3 1

3 2 1

3 2 1

Then, set column 3 to [3,2,1]:

3 3 3 (from column)

3 2 2 (from column)

3 2 1 (from column)

Sum: 3+3+3 + 3+2+2 + 3+2+1 = 22.

Same as before.

Is there a way to get higher?

Maybe if I choose different permutations.

For example, set row 1 to [3,2,1], column 1 to [3,2,1], row 2 to [3,2,1], column 2 to [3,2,1], row 3 to [3,2,1], and column 3 to [3,2,1].

Wait, I just did that and got 22.

Alternatively, perhaps choosing different permutations can lead to higher sums.

Let me try setting row 1 to [3,2,1], column 1 to [3,2,1], row 2 to [2,3,1], column 2 to [2,3,1], row 3 to [1,3,2], column 3 to [1,3,2].

Let's see:

Start with all zeros.

Set row 1 to [3,2,1]:

3 2 1

0 0 0

0 0 0

Set column 1 to [3,2,1]:

3 (from column) 2 1

2 (from column) 0 0

1 (from column) 0 0

Set row 2 to [2,3,1]:

2 3 1

2 3 1

1 0 0

Set column 2 to [2,3,1]:

2 2 (from column) 1

2 3 (from column) 1

1 3 (from column) 0

Set row 3 to [1,3,2]:

1 3 2

2 3 1

1 3 2

Set column 3 to [1,3,2]:

1 2 1 (from column)

2 3 3 (from column)

1 3 2 (from column)

Sum: 1+2+1 + 2+3+3 + 1+3+2 = 17.

This is lower than 22, so not better.

Perhaps sticking to [n, n-1, ..., 1] is the way to go.

But in n=3, 22 seems to be the maximum achievable with 6 operations.

Wait, but earlier I thought of n^3 - n +1, which for n=3 would be 27 -3 +1=25, but I can't achieve 25.

Maybe that formula is incorrect.

Alternatively, perhaps it's ∑_{k=1}^n k^2.

For n=1: 1

N=2: 1 + 4 =5 ≠7

N=3: 1 +4 +9=14 ≠22

Not matching.

Alternatively, ∑_{k=1}^n k^2 + k.

For n=1: 1 +1=2 ≠1

N=2: 4 +2=6 ≠7

N=3: 9 +3=12 ≠22

Nope.

Alternatively, perhaps it's n*(n+1)^2 /2.

For n=1: 1*2^2 /2 = 2 ≠1

N=2: 2*3^2 /2 = 9 ≠7

No.

Wait, perhaps it's n^3 - n^2 + n.

For n=1:1 -1 +1=1

N=2:8 -4 +2=6 ≠7

N=3:27 -9 +3=21 ≠22

Still not matching.

Alternatively, perhaps it's n*(n+1)^2 /2 - n.

For n=1:1*4/2 -1=0 ≠1

N=2:2*9/2 -2=7

N=3:3*16/2 -3=24 -3=21 ≠22

Not matching.

Hmm.

Maybe I need to think differently.

Let me consider that with 2n operations, I can set each row and each column once.

So, for n=2, set both rows and both columns once.

Each row operation sets a row to a permutation, and each column operation sets a column to a permutation.

The cells where a row and a column are both set will have the column operation overwrite the row operation.

So, for n=2, if I set row 1 to [2,1], row 2 to [2,1], column 1 to [2,1], column 2 to [2,1], the matrix would be:

2 (from column) 2 (from column)

2 (from column) 2 (from column)

Sum: 2+2+2+2=8.

But in the example, they achieved 7 with 3 operations.

Wait, that's lower than 8.

So, perhaps there's a trade-off.

Wait, perhaps I need to choose which operations to perform to maximize the sum.

In the n=2 case, with 3 operations, they achieved 7, which is higher than what I can achieve with 4 operations.

Wait, in my earlier calculation, with 4 operations, I get 8, but in the example, with 3 operations, they get 7.

Wait, perhaps my calculation is wrong.

Let me simulate it again.

Set row 1 to [2,1]:

2 1

0 0

Set column 1 to [2,1]:

2 (from column) 1

1 (from column) 0

Set row 2 to [2,1]:

2 1

2 1

Set column 2 to [2,1]:

2 2 (from column)

2 1 (from column)

Sum: 2+2+2+1=7.

Same as the example.

So, with 4 operations, I get the same sum as with 3 operations.

Perhaps I can save one operation by not setting one of them.

But in this case, it's the same sum.

Wait, perhaps the maximum sum is 8, but the example shows 7 with 3 operations.

Wait, in the example, they used 3 operations to get 7, but with 4 operations, I can get 8.

Is 8 the maximum?

Let me try.

Set row 1 to [2,1]:

2 1

0 0

Set row 2 to [2,1]:

2 1

2 1

Set column 1 to [2,1]:

2 (from column) 1

1 (from column) 1

Set column 2 to [2,1]:

2 2 (from column)

1 1 (from column)

Sum: 2+2+1+1=6, which is less than 7.

Wait, this is confusing.

Wait, perhaps the order of operations matters.

Let me try a different sequence.

First, set row 1 to [2,1]:

2 1

0 0

Then, set column 1 to [2,1]:

2 (from column) 1

1 (from column) 0

Then, set row 2 to [2,1]:

2 1

2 1

Then, set column 2 to [2,1]:

2 2 (from column)

2 1 (from column)

Sum: 2+2+2+1=7.

Same as before.

So, with 4 operations, I still get 7.

Wait, but earlier I thought I could get 8.

Wait, perhaps not.

Wait, if I set row 1 to [2,1], row 2 to [2,1], column 1 to [2,1], and column 2 to [2,1], the matrix becomes:

2 (from column) 2 (from column)

2 (from column) 2 (from column)

Sum: 2+2+2+2=8.

But according to the example, with 3 operations, they get 7.

Wait, perhaps there's a conflict in operation overwriting.

Wait, perhaps when I set both rows and columns, some cells are overwritten in a way that reduces the sum.

Wait, in the sequence:

Set row 1 to [2,1]:

2 1

0 0

Set column 1 to [2,1]:

2 (from column) 1

1 (from column) 0

Set row 2 to [2,1]:

2 1

2 1

Set column 2 to [2,1]:

2 2 (from column)

2 1 (from column)

Sum: 2+2+2+1=7.

Same as with 3 operations.

So, perhaps 7 is the maximum achievable sum for n=2.

Wait, but with 4 operations, I can get 8, but perhaps in the problem constraints, it's acceptable to use up to 2n operations, but the maximum sum doesn't necessarily increase with more operations.

In this case, with 4 operations, I can get 8, but perhaps the example shows that with 3 operations, I can get 7, which is less than 8.

But according to the problem, it's acceptable to use up to 2n operations, but I need to maximize the sum.

So, perhaps for n=2, the maximum sum is 8, achievable with 4 operations.

But in the example, they show 7 with 3 operations.

Wait, perhaps I misread the example.

Wait, in the example, for n=2, they output:

7 3

1 1 1 2

1 2 1 2

2 1 1 2

Which corresponds to:

Set row 1 to [1,2]

Set row 2 to [1,2]

Set column 1 to [1,2]

Resulting matrix:

1 (from column) 2

2 (from column) 2

Sum: 1+2+2+2=7.

But if I set row 1 to [2,1], row 2 to [2,1], column 1 to [2,1], and column 2 to [2,1], I get:

2 (from column) 2 (from column)

2 (from column) 2 (from column)

Sum: 2+2+2+2=8.

So, perhaps 8 is achievable.

Wait, but in the example, they achieved 7 with 3 operations, but I can achieve 8 with 4 operations.

Is 8 the maximum?

Is there a way to achieve higher than 8?

Let me try setting row 1 to [2,1], column 1 to [2,1], row 2 to [2,1], column 2 to [2,1], as above, getting 8.

Is there a way to get higher than 8?

Suppose I set row 1 to [2,1], column 1 to [2,1], column 2 to [2,1], and row 2 to [2,1].

Same as before, sum=8.

Alternatively, set row 1 to [2,1], row 2 to [2,1], column 1 to [2,1], column 2 to [2,1].

Again, sum=8.

Is there a way to get higher than 8?

Wait, perhaps if I choose different permutations.

Set row 1 to [2,1], row 2 to [1,2], column 1 to [2,1], column 2 to [2,1].

Let's see:

Set row 1 to [2,1]:

2 1

0 0

Set row 2 to [1,2]:

2 1

1 2

Set column 1 to [2,1]:

2 (from column) 1

1 (from column) 2

Set column 2 to [2,1]:

2 2 (from column)

1 1 (from column)

Sum: 2+2+1+1=6.

Lower than 8.

Not better.

Alternatively, set row 1 to [2,1], column 1 to [2,1], row 2 to [2,1], column 2 to [2,1].

Same as before, sum=8.

So, it seems that 8 is the maximum achievable sum for n=2 with 4 operations.

But in the example, they show 7 with 3 operations.

Perhaps 8 is achievable, but the problem's example shows 7 with 3 operations.

Is there a restriction I'm missing?

Wait, the problem says "As she doesn't want to make too many operations, you should provide a solution with no more than 2n operations."

So, for n=2, 2n=4 operations are allowed, but the example uses 3 operations to get 7.

But I can get 8 with 4 operations.

Is 8 the actual maximum?

Wait, perhaps the problem expects the maximum sum achievable with up to 2n operations, but in the n=2 case, is 8 achievable?

Wait, in the n=2 case, is there a way to achieve higher than 8?

Let me think.

If I set row 1 to [2,1], column 1 to [2,1], row 2 to [2,1], column 2 to [2,1], getting sum=8.

Is there a way to get higher than 8?

Wait, perhaps if I set row 1 to [2,1], column 1 to [2,1], row 2 to [2,1], column 2 to [2,1], same as before, sum=8.

Alternatively, set row 1 to [2,1], row 2 to [2,1], column 1 to [2,1], column 2 to [2,1], again sum=8.

Seems like 8 is the maximum.

But in the example, they show 7 with 3 operations.

Is 8 acceptable, or is there a reason why they used 3 operations to get 7?

Wait, perhaps with 3 operations, 7 is the maximum, but with 4 operations, 8 is achievable.

So, perhaps the maximum sum increases with more operations.

But according to the problem, it's acceptable to use up to 2n operations, and I need to maximize the sum.

So, for n=2, the maximum sum should be 8, achievable with 4 operations.

But in the example, they show 7 with 3 operations.

Is there a mistake here?

Wait, perhaps I misread the example.

Wait, in the problem statement, for n=2, they show:

Output:

7 3

1 1 1 2

1 2 1 2

2 1 1 2

Which corresponds to:

Set row 1 to [1,2]

Set row 2 to [1,2]

Set column 1 to [1,2]

Resulting matrix:

1 (from column) 2

2 (from column) 2

Sum: 1+2+2+2=7.

But if I set row 1 to [2,1], row 2 to [2,1], column 1 to [2,1], and column 2 to [2,1], I get:

2 (from column) 2 (from column)

2 (from column) 2 (from column)

Sum: 2+2+2+2=8.

So, with 4 operations, I can get 8.

But the problem says it's acceptable to use up to 2n operations, which for n=2 is 4 operations.

So, why in the example, they used 3 operations to get 7, when I can get 8 with 4 operations?

Is there a mistake in the problem statement, or am I missing something?

Wait, perhaps the operations are limited to no more than 2n operations, but I can use fewer if I want.

In that case, for n=2, using 4 operations, I can get 8, but using 3 operations, I can get 7.

So, the maximum sum is 8 for n=2, achievable with 4 operations.

But in the example, they show 7 with 3 operations, which is acceptable since it's less than or equal to 2n=4 operations.

Perhaps the problem's example is just showing one possible solution, not necessarily the maximum sum achievable with the maximum number of operations.

But according to the problem statement, "it is guaranteed that the maximum possible sum can always be obtained in no more than 2n operations."

So, perhaps there's a way to achieve the maximum sum with no more than 2n operations.

In the n=2 case, is 8 achievable with 3 operations or less?

Let me try.

With 3 operations:

Option 1:

Set row 1 to [2,1]:

2 1

0 0

Set row 2 to [2,1]:

2 1

2 1

Set column 1 to [2,1]:

2 (from column) 1

2 (from column) 1

Sum: 2+1+2+1=6.

Option 2:

Set row 1 to [2,1]:

2 1

0 0