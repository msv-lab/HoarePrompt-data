```python
# Include necessary imports if any
import io
import sys
from program import func

def run_program_with_captured_io(input_data):
    original_stdin = sys.stdin
    original_stdout = sys.stdout

    try:
        sys.stdin = io.StringIO(input_data)
        captured_output = io.StringIO()
        sys.stdout = captured_output

        func()

        return captured_output.getvalue().strip()
    
    finally:
        sys.stdin = original_stdin
        sys.stdout = original_stdout

# Write your test cases below
# Each test case should include assertions based on the problem description

# Test case 1
input_data = """5
2
1 1
4
2 3 3 1
5
2 2 3 2 2
2
10 3
3
1 2 3"""
expected_output = """2
4
5
13
5"""
assert run_program_with_captured_io(input_data) == expected_output

# Test case 2: All books have the same number of pages
input_data = """1
3
5 5 5"""
expected_output = """10"""
assert run_program_with_captured_io(input_data) == expected_output

# Test case 3: Two books with different number of pages
input_data = """1
2
1 10"""
expected_output = """11"""
assert run_program_with_captured_io(input_data) == expected_output

# Test case 4: Large number of books
input_data = """1
100
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100"""
expected_output = """199"""
assert run_program_with_captured_io(input_data) == expected_output

# Test case 5: Books with large number of pages
input_data = """1
3
1000000000 1000000000 1000000000"""
expected_output = """2000000000"""
assert run_program_with_captured_io(input_data) == expected_output

# End of script
```