```python
import io
import sys

def run_program_with_captured_io(input_data):
    original_stdin = sys.stdin
    original_stdout = sys.stdout

    try:
        sys.stdin = io.StringIO(input_data)
        captured_output = io.StringIO()
        sys.stdout = captured_output

        with open("program.py", "r", encoding="utf-8") as f:
            code = f.read()
            exec(code, {})

        return captured_output.getvalue().strip()
    
    finally:
        sys.stdin = original_stdin
        sys.stdout = original_stdout

# Test cases
test_cases = [
    (
        "8\n6\nWBBWBW\n1\nB\n2\nWB\n3\nBBW\n4\nBWWB\n6\nBWBWWB\n6\nWWBBWB\n9\nWBWBWWWBW",
        "4\n1\n1\n2\n4\n6\n4\n7"
    ),
    (
        "1\n10\nBBBBBBBBBB",
        "10"
    ),
    (
        "1\n10\nWWWWWWWWWW",
        "0"
    ),
    (
        "1\n10\nWBBBBBBBBW",
        "9"
    ),
    (
        "1\n10\nWBWBWBWBWB",
        "10"
    ),
    (
        "1\n5\nBBBWB",
        "5"
    ),
    (
        "1\n5\nWBBBW",
        "4"
    ),
    (
        "1\n5\nBWBBB",
        "5"
    ),
    (
        "1\n5\nBBBBW",
        "5"
    ),
    (
        "1\n5\nWBWWW",
        "1"
    )
]

# Run test cases
for i, (input_data, expected_output) in enumerate(test_cases):
    assert run_program_with_captured_io(input_data) == expected_output, f"Test case {i+1} failed"

print("All test cases passed!")
```

This script includes a function `run_program_with_captured_io` to capture the output of the program when given specific input. It then defines several test cases based on the problem description and checks if the output matches the expected results using assertions. If all assertions pass, it prints a success message.