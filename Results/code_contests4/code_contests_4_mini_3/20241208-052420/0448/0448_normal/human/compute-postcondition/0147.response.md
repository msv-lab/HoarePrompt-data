Postcondition: ***`hidx` is equal to the length of `h`, `pidx` is equal to the length of `p`, and `furthestright` is the last computed value based on the final `curpos`. If `works` is True, then `ll` is equal to `avg`. If `works` is False, then `ss` is equal to `avg + 1`, with `avg` remaining unchanged throughout.***