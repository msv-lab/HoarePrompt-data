<div class="problem-statement"><div class="header"><div class="title">D. Drunken Maze</div><div class="time-limit"><div class="property-title">time limit per test</div>2 seconds</div><div class="memory-limit"><div class="property-title">memory limit per test</div>1024 megabytes</div><div class="input-file input-standard"><div class="property-title">input</div>standard input</div><div class="output-file output-standard"><div class="property-title">output</div>standard output</div></div><div><center> <img class="tex-graphics" src="https://espresso.codeforces.com/7dcadce65182d3b0007655152d071bd721aba768.png" style="max-width: 100.0%;max-height: 100.0%;" width="265px">  <span class="tex-font-size-small">Image generated by ChatGPT 4o.</span> </center><p>You are given a two-dimensional maze with a start and end position. Your task is to find the fastest way to get from the start to the end position. The fastest way is to make the minimum number of steps where one step is going left, right, up, or down. Of course, you cannot walk through walls.</p><p>There is, however, a catch: If you make more than three steps in the same direction, you lose balance and fall down. Therefore, it is forbidden to make more than three consecutive steps in the same direction. It is okay to walk three times to the right, then one step to the left, and then again three steps to the right. This has the same effect as taking five steps to the right, but is slower.</p></div><div class="input-specification"><div class="section-title">Input</div><p>The first line contains two numbers <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.539em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.848em, 1000.48em, 2.622em, -999.997em); top: -2.438em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: STIXGeneral-Italic;">ğ‘›</span></span><span style="display: inline-block; width: 0px; height: 2.443em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-1">n</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>m</mi></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-4" style="width: 1.015em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.836em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.848em, 1000.78em, 2.622em, -999.997em); top: -2.438em; left: 0em;"><span class="mrow" id="MathJax-Span-5"><span class="mi" id="MathJax-Span-6" style="font-family: STIXGeneral-Italic;">ğ‘š</span></span><span style="display: inline-block; width: 0px; height: 2.443em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">m</script>, which are the height and width of the maze. This is followed by an ASCII-representation of the maze where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;monospace&quot;>&amp;#x0023;</mi></mrow></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-7" style="width: 0.717em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.61em, 1000.6em, 2.622em, -999.997em); top: -2.438em; left: 0em;"><span class="mrow" id="MathJax-Span-8"><span class="texatom" id="MathJax-Span-9"><span class="mrow" id="MathJax-Span-10"><span class="mi" id="MathJax-Span-11" style="font-family: STIXGeneral-Regular;">#</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.443em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="monospace">#</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-3">\tt{\#}</script> is a wall, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo mathvariant=&quot;monospace&quot;>.</mo></mrow></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-12" style="width: 0.301em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.241em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(2.146em, 1000.18em, 2.622em, -999.997em); top: -2.438em; left: 0em;"><span class="mrow" id="MathJax-Span-13"><span class="texatom" id="MathJax-Span-14"><span class="mrow" id="MathJax-Span-15"><span class="mo" id="MathJax-Span-16" style="font-family: STIXGeneral-Regular;">.</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.443em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.289em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mo mathvariant="monospace">.</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-4">\tt{.}</script> is an empty space, and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi mathvariant=&quot;monospace&quot;>S</mi></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-17" style="width: 0.717em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.61em, 1000.54em, 2.622em, -999.997em); top: -2.438em; left: 0em;"><span class="mrow" id="MathJax-Span-18"><span class="mi" id="MathJax-Span-19" style="font-family: STIXGeneral-Regular;">ğš‚</span></span><span style="display: inline-block; width: 0px; height: 2.443em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="monospace">S</mi></math></span></span><script type="math/tex" id="MathJax-Element-5">\tt S</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi mathvariant=&quot;monospace&quot;>T</mi></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-20" style="width: 0.717em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.61em, 1000.6em, 2.622em, -999.997em); top: -2.438em; left: 0em;"><span class="mrow" id="MathJax-Span-21"><span class="mi" id="MathJax-Span-22" style="font-family: STIXGeneral-Regular;">ğšƒ</span></span><span style="display: inline-block; width: 0px; height: 2.443em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="monospace">T</mi></math></span></span><script type="math/tex" id="MathJax-Element-6">\tt T</script> are the start and end positions.</p><ul> <li> <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>12</mn><mo>&amp;#x2264;</mo><mi>n</mi><mo>&amp;#x00D7;</mo><mi>m</mi><mo>&amp;#x2264;</mo><mn>200000</mn></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-23" style="width: 11.908em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.884em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.61em, 1009.88em, 2.741em, -999.997em); top: -2.438em; left: 0em;"><span class="mrow" id="MathJax-Span-24"><span class="mn" id="MathJax-Span-25" style="font-family: STIXGeneral-Regular;">12</span><span class="mo" id="MathJax-Span-26" style="font-family: STIXGeneral-Regular; padding-left: 0.301em;">â‰¤</span><span class="mi" id="MathJax-Span-27" style="font-family: STIXGeneral-Italic; padding-left: 0.301em;">ğ‘›</span><span class="mo" id="MathJax-Span-28" style="font-family: STIXGeneral-Regular; padding-left: 0.241em;">Ã—</span><span class="mi" id="MathJax-Span-29" style="font-family: STIXGeneral-Italic; padding-left: 0.241em;">ğ‘š</span><span class="mo" id="MathJax-Span-30" style="font-family: STIXGeneral-Regular; padding-left: 0.301em;">â‰¤</span><span class="mn" id="MathJax-Span-31" style="font-family: STIXGeneral-Regular; padding-left: 0.301em;">200000</span></span><span style="display: inline-block; width: 0px; height: 2.443em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>12</mn><mo>â‰¤</mo><mi>n</mi><mo>Ã—</mo><mi>m</mi><mo>â‰¤</mo><mn>200000</mn></math></span></span><script type="math/tex" id="MathJax-Element-7">12 \leq n\times m \leq 200000</script>. </li><li> <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>3</mn><mo>&amp;#x2264;</mo><mi>n</mi><mo>,</mo><mi>m</mi><mo>&amp;#x2264;</mo><mn>10000</mn></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-32" style="width: 9.646em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.039em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.61em, 1008.04em, 2.741em, -999.997em); top: -2.438em; left: 0em;"><span class="mrow" id="MathJax-Span-33"><span class="mn" id="MathJax-Span-34" style="font-family: STIXGeneral-Regular;">3</span><span class="mo" id="MathJax-Span-35" style="font-family: STIXGeneral-Regular; padding-left: 0.301em;">â‰¤</span><span class="mi" id="MathJax-Span-36" style="font-family: STIXGeneral-Italic; padding-left: 0.301em;">ğ‘›</span><span class="mo" id="MathJax-Span-37" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-38" style="font-family: STIXGeneral-Italic; padding-left: 0.182em;">ğ‘š</span><span class="mo" id="MathJax-Span-39" style="font-family: STIXGeneral-Regular; padding-left: 0.301em;">â‰¤</span><span class="mn" id="MathJax-Span-40" style="font-family: STIXGeneral-Regular; padding-left: 0.301em;">10000</span></span><span style="display: inline-block; width: 0px; height: 2.443em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>3</mn><mo>â‰¤</mo><mi>n</mi><mo>,</mo><mi>m</mi><mo>â‰¤</mo><mn>10000</mn></math></span></span><script type="math/tex" id="MathJax-Element-8">3\leq n,m \leq 10000</script>. </li><li> Characters are only <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo mathvariant=&quot;monospace&quot;>.</mo><mi mathvariant=&quot;monospace&quot;>&amp;#x0023;</mi><mi mathvariant=&quot;monospace&quot;>S</mi><mi mathvariant=&quot;monospace&quot;>T</mi></mrow></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-41" style="width: 2.741em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.265em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.61em, 1002.26em, 2.622em, -999.997em); top: -2.438em; left: 0em;"><span class="mrow" id="MathJax-Span-42"><span class="texatom" id="MathJax-Span-43"><span class="mrow" id="MathJax-Span-44"><span class="mo" id="MathJax-Span-45" style="font-family: STIXGeneral-Regular;">.</span><span class="mi" id="MathJax-Span-46" style="font-family: STIXGeneral-Regular; padding-left: 0.182em;">#</span><span class="mi" id="MathJax-Span-47" style="font-family: STIXGeneral-Regular;">ğš‚</span><span class="mi" id="MathJax-Span-48" style="font-family: STIXGeneral-Regular;">ğšƒ</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.443em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mo mathvariant="monospace">.</mo><mi mathvariant="monospace">#</mi><mi mathvariant="monospace">S</mi><mi mathvariant="monospace">T</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-9">\tt{.\#ST}</script> and there is exactly one <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;monospace&quot;>S</mi></mrow></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-49" style="width: 0.717em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.61em, 1000.54em, 2.622em, -999.997em); top: -2.438em; left: 0em;"><span class="mrow" id="MathJax-Span-50"><span class="texatom" id="MathJax-Span-51"><span class="mrow" id="MathJax-Span-52"><span class="mi" id="MathJax-Span-53" style="font-family: STIXGeneral-Regular;">ğš‚</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.443em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="monospace">S</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-10">\tt{S}</script> and one <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;monospace&quot;>T</mi></mrow></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-54" style="width: 0.717em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.61em, 1000.6em, 2.622em, -999.997em); top: -2.438em; left: 0em;"><span class="mrow" id="MathJax-Span-55"><span class="texatom" id="MathJax-Span-56"><span class="mrow" id="MathJax-Span-57"><span class="mi" id="MathJax-Span-58" style="font-family: STIXGeneral-Regular;">ğšƒ</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.443em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="monospace">T</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-11">\tt{T}</script>. </li><li> The outer borders are only <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;monospace&quot;>&amp;#x0023;</mi></mrow></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-59" style="width: 0.717em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.61em, 1000.6em, 2.622em, -999.997em); top: -2.438em; left: 0em;"><span class="mrow" id="MathJax-Span-60"><span class="texatom" id="MathJax-Span-61"><span class="mrow" id="MathJax-Span-62"><span class="mi" id="MathJax-Span-63" style="font-family: STIXGeneral-Regular;">#</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.443em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="monospace">#</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-12">\tt{\#}</script> (walls). </li></ul></div><div class="output-specification"><div class="section-title">Output</div><p>The minimum number of steps to reach the end position from the start position or <span class="tex-font-style-tt">-1</span> if that is impossible.</p></div><div class="sample-tests"><div class="section-title">Examples</div><div class="sample-test"><div class="input"><div class="title">Input<div title="Copy" data-clipboard-target="#id0024972620156456404" id="id0020842990874877465" class="input-output-copier">Copy</div></div><pre id="id0024972620156456404"><div class="test-example-line test-example-line-even test-example-line-0">7 12</div><div class="test-example-line test-example-line-even test-example-line-0">############</div><div class="test-example-line test-example-line-even test-example-line-0">#S........T#</div><div class="test-example-line test-example-line-even test-example-line-0">#.########.#</div><div class="test-example-line test-example-line-even test-example-line-0">#..........#</div><div class="test-example-line test-example-line-even test-example-line-0">#..........#</div><div class="test-example-line test-example-line-even test-example-line-0">#..#..#....#</div><div class="test-example-line test-example-line-even test-example-line-0">############</div></pre></div><div class="output"><div class="title">Output<div title="Copy" data-clipboard-target="#id004007529523844118" id="id004478866017389931" class="input-output-copier">Copy</div></div><pre id="id004007529523844118">15
</pre></div><div class="input"><div class="title">Input<div title="Copy" data-clipboard-target="#id0004452361136441585" id="id004757479429389846" class="input-output-copier">Copy</div></div><pre id="id0004452361136441585"><div class="test-example-line test-example-line-even test-example-line-0">5 8</div><div class="test-example-line test-example-line-even test-example-line-0">########</div><div class="test-example-line test-example-line-even test-example-line-0">#......#</div><div class="test-example-line test-example-line-even test-example-line-0">#.####.#</div><div class="test-example-line test-example-line-even test-example-line-0">#...T#S#</div><div class="test-example-line test-example-line-even test-example-line-0">########</div></pre></div><div class="output"><div class="title">Output<div title="Copy" data-clipboard-target="#id008578239275177006" id="id00838159615525389" class="input-output-copier">Copy</div></div><pre id="id008578239275177006">14
</pre></div><div class="input"><div class="title">Input<div title="Copy" data-clipboard-target="#id006878685639600834" id="id004132862162161137" class="input-output-copier">Copy</div></div><pre id="id006878685639600834"><div class="test-example-line test-example-line-even test-example-line-0">5 8</div><div class="test-example-line test-example-line-even test-example-line-0">########</div><div class="test-example-line test-example-line-even test-example-line-0">#.#S...#</div><div class="test-example-line test-example-line-even test-example-line-0">#.####.#</div><div class="test-example-line test-example-line-even test-example-line-0">#...T#.#</div><div class="test-example-line test-example-line-even test-example-line-0">########</div></pre></div><div class="output"><div class="title">Output<div title="Copy" data-clipboard-target="#id008328994572758399" id="id003403940106829253" class="input-output-copier">Copy</div></div><pre id="id008328994572758399">-1
</pre></div></div></div></div>